!function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],u=0,m=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(d&&d(t);m.length;)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var l=n[o];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={"web/imn":0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(){return Promise.resolve()},s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/js/cmodules/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;i.push([237,"common","palette","vendors","0aebc81ccad4d0d58a7b723bc3b9f074","7ed9e4d544bccc8a5ada0a712a9cf1ad","29ce115e24facf4cb9fb345ec7c74430","902866c362380432bb8fab2a5e67d693"]),n()}({"1MUc":function(e,t,n){"use strict";n.d(t,"a",(function(){return V}));var a=n("q1tI"),r=n.n(a),i=n("6krn"),s=n("QDnf"),o=n("e87a"),l=n("euvX"),c=function(e){var t=e.children,n=e.title,a=e.onClose,s=e.onBack;return r.a.createElement(o.default,{onClose:a,disableBodyScroll:!0,className:"ChatCreationModal"},r.a.createElement(l.a,{title:n,onClose:a,backText:s?Object(i.b)("global_back"):void 0,onBack:s,appearance:"blue"}),r.a.createElement("div",{className:"ChatCreationModal__content"},t))},d=n("iukX"),u=function(e){var t=e.setFlags,n=e.flags,a=e.onClose;return r.a.createElement(d.a,{flags:n,back:a,isChatCreation:!0,onSave:function(e){return t(e),Promise.resolve()},afterSave:a,onCancel:a})},m=n("F0+T"),g=function(e){var t=e.usersList,n=e.onRemoveToken,a=e.onChange,s=e.onSelect,o=e.renderSuggest,l=e.tokens,c=e.query;return r.a.createElement(m.a,{className:"ChatCreationUserList",tokens:l,removeTokenPlaceholder:Object(i.b)("mail_create_chat_remove_user"),onRemoveToken:n,placeholder:Object(i.b)("mail_search_creation"),value:c,onChange:a,onSelect:s,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:function(){},notFoundText:Object(i.b)("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:o,data:t})},_=n("Hri0"),p=n("5R8M"),b=n("Cx1h"),h=n("P13b"),f=n("Aegd"),v=function(e){var t=e.data,n=e.onSelect,a=e.isSelected,i=t.photo?t.photo:r.a.createElement(f.a,{id:t.peerId,text:Object(h.Ab)(t.name),size:"34",specificType:7});return r.a.createElement(p.default,{"data-id":t.peerId,onClick:function(){return n(t.peerId)},selectable:!0,aside:r.a.createElement(b.a,{isSelected:a})},r.a.createElement(_.a,{"data-id":t.peerId,size:"34",title:t.name,photo:i}))},O=n("XuPN"),j=n("nAFc"),y=function(e,t){for(var n=0,a=t.length,r=e.length;n<a;n++,r++)e[r]=t[n];return e},w=function(e){var t=e.usersList,n=e.selectedMap,i=e.setSelectedMap,s=e.onServerSearch,o=Object(a.useState)(""),l=o[0],c=o[1],d=Object(a.useState)(t.map((function(e){return e.peerId}))),u=d[0],m=d[1],_=Object(a.useRef)(C(t)),p=Object(a.useCallback)((function(e){return e.name}),[]),b=Object(a.useCallback)((function(e){return e.peerId}),[]),h=Object(O.a)(Array.from(_.current.values()),p,b),f=Object(a.useMemo)((function(){return Array.from(_.current.keys())}),[_.current]),j=Object(a.useCallback)((function(e,t){return s(e,t)}),[s]);Object(a.useEffect)((function(){var e=h.search(l).map((function(e){return e.peerId}));m(e),j(l,e).then((function(t){if(0!==l.length){var n=[],a=[];t.forEach((function(e){_.current.has(e.peerId)||(a.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(r=_,i=C(n),r.current=new Map(y(y([],Array.from(r.current.entries())),Array.from(i.entries()))),m(y(y([],e),a)))}var r,i})).catch((function(){}))}),[l]);var w=function(e){n.delete(e),i((function(){return new Map(n)}))},S=function(e){n.has(e)?w(e):(!function(e){var t=_.current.get(e);t&&(n.set(e,k(t)),i((function(){return new Map(n)})))}(e),c(""))},E=Object(a.useCallback)((function(e){w(+e)}),[n]),I=Object(a.useCallback)((function(e){c(e.target.value)}),[l]),T=Array.from(n.values());return r.a.createElement(g,{query:l,tokens:T,usersList:l?u:f,onSelect:S,onChange:I,onRemoveToken:E,renderSuggest:function(e){var t=_.current.get(e);return t?r.a.createElement(v,{key:e,data:t,onSelect:S,isSelected:n.has(e)}):r.a.createElement(r.a.Fragment,null)}})};function C(e){return e.reduce((function(e,t){return t.name=Object(j.a)(t.name),e.set(t.id,t)}),new Map)}function k(e){return{id:e.id.toString(),text:e.name}}var S=n("RXF5"),E=n("s0Wt"),I=n("h7Kf"),T=n("WfnU"),M=function(e){var t=e.onChangeTitle,n=e.onResetTitle,a=e.onShowSettings,s=e.onButtonClickHandler,o=e.title,l=e.photo,c=e.loading,d=e.onUploadAvatar,u=e.onRemoveAvatar,m=e.isButtonDisabled,g=e.buttonText;return r.a.createElement("div",{className:"ChatCreationInfo"},r.a.createElement("div",{className:"ChatCreationInfo__avatarWrapper"},r.a.createElement(S.a,{photo:l,title:o,className:"ChatCreationInfo__avatar",onClick:d}),l&&r.a.createElement(E.default,{text:Object(i.b)("mail_settings_remove_photo"),position:"t",align:"left"},r.a.createElement("button",{onClick:u,className:"ChatCreationInfo__avatarRemove"}))),r.a.createElement(I.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:o,onChange:function(e){return t(e.target.value)},onCancel:n,placeholder:Object(i.b)("mail_im_chat_title_intro")}),r.a.createElement(E.default,{text:Object(i.b)("mail_chat_creation_settings_icon_tooltip"),position:"t"},r.a.createElement("button",{className:"ChatCreationInfo__settings",onClick:a,"aria-label":Object(i.b)("mail_chat_creation_settings_icon_tooltip")})),r.a.createElement(T.default,{disabled:m,loading:c,onClick:s},g))},L=function(e){var t=e.title,n=e.photo,s=e.selectedUserIds,o=e.onShowSettings,l=e.onTitleChange,c=e.onCreateChat,d=e.onUploadAvatar,u=e.onRemoveAvatar,m=e.onGoToConvo,g=Object(a.useState)(!1),_=g[0],p=g[1],b=Object(a.useState)(!x(t)),h=b[0],f=b[1],v=1===s.length&&!h&&!n,O=0!==s.length||h,j=Object(a.useCallback)((function(e){f(!x(e)),l(e)}),[]),y=!v&&!O,w=v?Object(i.b)("mail_im_go_to_dialog"):Object(i.b)("mail_im_create_chat");return r.a.createElement(M,{title:t,onResetTitle:function(){return j("")},onChangeTitle:j,photo:n,onShowSettings:o,onButtonClickHandler:function(){if(!_)if(p(!0),v){var e=s[0];m(+e)}else c().catch((function(){p(!1)}))},loading:_,isButtonDisabled:y,onUploadAvatar:d,onRemoveAvatar:u,buttonText:w})};function x(e){return!e.trim().replace("\n","")}var P,B=n("5PZO"),D=n("BiHW"),A=n("bTOO"),N=n("zjLC"),R=n("R5GP"),F=n("DM26"),H=n("shih"),q=n("Iqrf"),U=n("XLJO"),K=n("6x51"),z=function(e,t){for(var n=0,a=t.length,r=e.length;n<a;n++,r++)e[r]=t[n];return e};!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(P||(P={}));var V=function(e){var t=e.store,n=e.uploadAvatar,o=e.onClose,l=e.onBack,d=e.onCreateChat,m=e.onGoToConvo,g=e.preselectedUsers,_=Object(a.useState)([]),p=_[0],b=_[1],h=Object(a.useState)(P.LOADING),f=h[0],v=h[1],O=Object(a.useState)(0),j=O[0],y=O[1],C=Object(a.useState)(""),S=C[0],E=C[1],I=Object(a.useState)(""),T=I[0],M=I[1],x=Object(a.useState)(void 0),V=x[0],W=x[1],G=Object(a.useState)(g?new Map(g.map((function(e){return[e.id,k(e)]}))):new Map),X=G[0],Q=G[1];Object(a.useEffect)((function(){(function(e){return Object(R.b)(e).hintsTree.then((function(t){var n=t.list.map((function(e){var t=e[0];return{id:+t,peerId:+t,name:e[1],photo:e[2]}}));return function(e,t){return Object(U.a)(e).then((function(e){var n=e.get().contactsList.filter((function(e){return!e.user})).sort((function(e,t){return e.id<t.id?1:-1})).map((function(e){return{id:Object(K.a)(e.id),peerId:Object(K.a)(e.id),name:e.name,photo:e.photo||""}})),a=n.splice(0,n.length<3?n.length:3);return z(z(z(z([],t.slice(0,4)),a),t.slice(4)),n)}))}(e,n)}))})(t).then((function(e){if(g){var t=g.reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=g.concat(e.filter((function(e){return!t[e.peerId]})));b(n)}else b(e)})).then((function(){return v(P.LIST)})).catch((function(){v(P.ERROR)}))}),[]);var $=Object(F.b)(H.c,300);switch(f){case P.SETTINGS:return r.a.createElement(c,{title:Object(i.b)("mail_chat_creation_settings"),onClose:o,onBack:function(){return v(P.LIST)}},r.a.createElement(u,{flags:j,setFlags:y,onClose:function(){return v(P.LIST)}}));case P.LIST:return r.a.createElement(c,{title:Object(i.b)("mail_im_create_chat"),onBack:l,onClose:o},r.a.createElement(w,{usersList:p,selectedMap:X,setSelectedMap:Q,onServerSearch:function(e,n){return $(e,n,q.a.FRIENDS_AND_CONTACTS,{},t.get())}}),r.a.createElement(L,{title:S,photo:T,selectedUserIds:Array.from(X.keys()),onTitleChange:E,onShowSettings:function(){return v(P.SETTINGS)},onCreateChat:function(){var e=Array.from(X.keys()),n=V||void 0;return t.set((function(t){return Object(N.c)(t,n,e,S,j)})).then((function(e){d(e.get().next_peer)}))},onUploadAvatar:function(){v(P.PHOTO),n().then((function(e){if(e.photo&&e.photoData){var t=e.photo,n=e.photoData;M(t),W(n)}else W(void 0);v(P.LIST)})).catch((function(){v(P.ERROR)}))},onRemoveAvatar:function(){M(""),W(void 0)},onGoToConvo:m}));case P.ERROR:return r.a.createElement(c,{title:Object(i.b)("global_error"),onClose:o},r.a.createElement(A.a,null,r.a.createElement("p",null,Object(i.b)("global_error"))),r.a.createElement(B.a,{actionButtons:r.a.createElement(D.a,{onClick:o},Object(i.b)("global_close"))}));case P.LOADING:return r.a.createElement(s.a,null);case P.PHOTO:return r.a.createElement(r.a.Fragment,null)}}},"1nu5":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),r=a.length;r--;){var i=a[r],s="";if(i){for(var o=0;o<6;o++){var l=i.charCodeAt(o);if(l){var c=this.toTranslit[l],d=i.substr(o,1);s+=null!=c?c:d}}n[s]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},i=n[a],s="",o="",l="",c=i.length>1;if(i){for(var d=0;d<6;d++){var u=i.charCodeAt(d);if(u){var m=this.toTranslit[u],g=i.substr(d,1);if(s+=null!=m?m:g,c){var _=this.toLocalCase[g],p=this.toLocalTranslit[u];o+=null!=_?_:g,l+=null!=p?p:g}}}r[s]=1,c&&(r[o]=2,r[l]=3),t.push(r)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,i=0;i<6;i++){var s=a.substr(i,1)||-1;if(!r[s])break;r=r[s]}if(r.length)for(var i in r)if(this.equals(r[i],e)){r.splice(i,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(r(e[0])||r(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var i in n)if(n.hasOwnProperty(i)){if(r&&!a)break;var s=this.localSearch(n[i],0,t);s.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,s):s,r=!0}for(var o=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=o&&(c.push(o),o=u)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)e.hasOwnProperty(r)&&(a[s=r.substr(t,1)||-1]||(a[s]={}),a[s][r]=1);if(6==t++)return n;var i=[];for(var s in a)if("-1"===s)for(var o in n)n.hasOwnProperty(o)&&i.push.apply(i,this.localSearch(a[s],t,n[o]));else{var l=this.localSearch(a[s],t,n[s]);i.push.apply(i,l)}return i},e}();function r(e){return!isNaN(e)}},237:function(e,t,n){e.exports=n("V1UX")},"8h6g":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}));n("KKXr");var a="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),r=5,i=4194304},"9KdC":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var a,r=function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};!function(e){e.Online="online"}(a||(a={}));var i=function(e){var t=this,n=e.getQueue,a=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var n=r({},e);t.intervalId=window.setInterval((function(){t.registerQueue(n,(function(e,a){if(function(e){return void 0!==e.err}(a))t.restart();else{n.ts=a.ts;for(var r=0,i=a.events;r<i.length;r++)for(var s=i[r],o=0,l=t.listeners;o<l.length;o++)(0,l[o])(s)}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=a,this.getQueue=n}},J4gp:function(e,t,n){"use strict";n.d(t,"b",(function(){return C})),n.d(t,"a",(function(){return M}));var a=n("q1tI"),r=n.n(a),i=n("i8i4"),s=n.n(i),o=n("ZxpX"),l=n("CGHU"),c=n("8tCR"),d=n("3blr"),u=n("URsI"),m=n("h++7"),g=n("6krn"),_=n("5R8M"),p=n("Hri0"),b=n("P13b"),h=n("mvjr"),f=n("Aegd"),v=n("RXF5"),O=n("gdug"),j=function(){return(j=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},y=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},w=function(e){var t=e.peerId,n=e.name,a=e.photo,i=e.online,s=e.memberCount,l=e.mode,c=void 0===l?C.DEFAULT:l,d=e.isSelected,u=e.isDisabled,m=e.isActive,g=e.isCasper,w=e.className,k=y(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]),S=function(e,t,n,a){void 0===a&&(a=0);var i=Object(b.Pb)(e);switch(!0){case Array.isArray(n):return r.a.createElement(h.a,{photos:n});case i:return r.a.createElement(f.a,{id:e,text:Object(b.Ab)(t),size:"34",specificType:7});default:return r.a.createElement(v.a,{isOnline:!!a,isMobile:!!O.d[a],title:t,photo:n,onlineSize:"s"})}}(t,n,a,i),E=g?'<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          '+n+"\n        </span>\n      </span>":n,I=c===C.RADIO?r.a.createElement("span",{className:Object(o.a)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":d})}):void 0,T=Object(o.a)("ConvoPickerRow",w,{"ConvoPickerRow--disabled":u});return r.a.createElement(_.default,j({active:m,selectable:!u,canBeHovered:!1,chevron:c===C.DEFAULT&&!u,aside:I,className:T},k),r.a.createElement(p.a,{size:"34",title:E,photo:S,description:s,className:"ConvoPickerRow__itemContent"}))};var C,k=n("rHUl"),S=n("d8ub"),E=function(){return(E=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},I=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},T=g.a.getLang;!function(e){e.DEFAULT="default",e.RADIO="radio"}(C||(C={}));var M=function(e){var t,n=e.searchValue,i=void 0===n?"":n,g=e.isLoading,p=void 0!==g&&g,h=e.convos,f=e.mode,v=void 0===f?C.DEFAULT:f,O=e.selectedConvos,j=void 0===O?[]:O,y=e.checkDisabled,M=e.onSearchValueChange,L=e.onSearchInputKeydown,x=e.onConvoSelect,P=e.onListLoadMore,B=void 0===P?function(){}:P,D=e.onAddClick,A=e.searchInputGetter,N=e.className,R=e.style,F=I(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]),H=Object(o.a)("ConvoPicker",N),q=Object(a.createRef)(),U=Object(a.useState)(0),K=U[0],z=U[1],V=function(e){var t=Math.max(e-1,0);return y&&y(h[t])?V(t):t},W=function(e){var t=Math.min(e+1,h.length-1);return y&&y(h[t])?W(t):t},G=function(e){e!==K&&(z(e),function(e){if(t){var n=h[e].peerId,a=t.querySelector('[data-id="'+n+'"]');if(a&&a instanceof HTMLElement){var r=a.offsetTop,i=t.scrollTop;if(r<i)t.scrollTop=r;else{var s=t.offsetHeight,o=r+a.offsetHeight;o>i+s&&(t.scrollTop=o-s)}}}}(e))};Object(a.useEffect)((function(){A&&q.current&&A(q.current.element)}),[]);var X=!!D&&!i,Q=(X?[r.a.createElement(_.default,{selectable:!1,key:"add","data-id":0},r.a.createElement(S.a,{onClick:D},T("mail_new_convo_from_invite")))]:[]).concat(h.map((function(e,t){var n=e.peerId,a=e.photo,i=e.name,s=e.online,o=!!y&&y(e);return r.a.createElement(w,{key:n,"data-id":n,peerId:n,photo:a,name:i,online:s,memberCount:Object(b.mb)(e),mode:v,isCasper:Object(k.y)(e),isSelected:j.includes(n),isActive:t===K,isDisabled:o,onClick:function(){o||x(n)},onMouseEnter:function(){return z(o?-1:t)}})})));return r.a.createElement("div",E({className:H,onMouseLeave:function(){return z(-1)},style:R},F),r.a.createElement(l.a,{value:i,onChange:M,onKeyDown:function(e){switch(e.which||e.keyCode){case m.b:G(V(K)),e.preventDefault();break;case m.a:G(W(K)),e.preventDefault();break;case m.e:x(h[K].peerId),e.preventDefault()}L(e)},placeholder:T("mail_top_search"),autoFocus:!0,key:"search",ref:q}),p&&r.a.createElement(c.default,{className:"ConvoPicker__stub",key:"loading"},r.a.createElement(d.default,null)),!p&&i&&0===h.length&&r.a.createElement(c.default,{className:"ConvoPicker__stub",key:"no-results"},T("mail_im_search_empty_chats")),!p&&(h.length>0||X)&&r.a.createElement(u.a,{virtualized:!0,className:"ConvoPicker__results",loadMore:B,hasMore:!1,ref:function(e){var n=s.a.findDOMNode(e);n&&n instanceof HTMLElement&&(t=n)},key:"results"},Q))}},LYnS:function(e,t,n){"use strict";n("pIFo");var a=n("86+7"),r=n("6krn"),i=n("ftTi"),s=r.a.getLang;t.a=()=>[{id:"user name",label:s("mail_community_templates_hint_name"),process:e=>Object(a.c)(e,Object(i.e)(e)).first_name},{id:"user surname",label:s("mail_community_templates_hint_last_name"),process(e){var t=Object(a.c)(e,Object(i.e)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:s("mail_community_templates_hint_your_name"),process:e=>Object(a.c)(e,vk.id).first_name},{id:"admin surname",label:s("mail_community_templates_hint_your_last_name"),process(e){var t=Object(a.c)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:s("mail_community_templates_hint_community"),process:e=>Object(a.c)(e,e.get().id).name},{id:"greeting",label:s("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return s(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},RQ7Z:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=function(){var e=function(){for(var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],a=0,r=n.length,i={};a<r;a++)if((e=n[a])&&e[1]in document){for(a=0,t=e.length;a<t;a++)i[n[0][a]]=e[a];return i}return!1}(),t={request:function(t){var n=e.requestFullscreen;(t=t||document.documentElement)[n]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},V1Nw:function(e,t,n){"use strict";function a(e,t,n){var a=0,r=e,i=[],s=!1;function o(){!i.length||a>0||s||(t(i),i=[])}return{pause:function(){a++},resume:function(){a>0&&(a--,o())},onLp:function(e,t,a){s||(r>=e?(r=t,i.push.apply(i,a),o()):n&&(s=!0,n(r).then((function(e){var t=e[1],n=e[2];r=t,s=!1,i.push.apply(i,n),o()}))))}}}n.d(t,"a",(function(){return a}))},V1UX:function(e,t,n){"use strict";n.r(t);n("rE2o"),n("ioFf"),n("HEwt"),n("a1Th"),n("91GP"),n("VRzm"),n("Vd3H"),n("pIFo"),n("SRfc"),n("T39b"),n("OEbY"),n("rGqo"),n("Btvt"),n("9AAn"),n("OG14");var a=n("vT4u"),r=n("P13b"),i=n("rHUl"),s=n("MhhX"),o=n("UIlX"),l=n("aong"),c=n("ofcU"),d=n("rDjD");function u(e,t,n){var i=intval(domData(n,"msgid"));if(!Object(l.d)()&&!Object(r.W)(t)){var s=intval(domData(n,"peer"));return e.set(a.o.bind(null,s)),e.get().longpoll.push([Object(d.a)(s,i)]),!1}}function m(e,t){return{isAll:e=>Object(a.bb)(e.get().peer,e.get()),loadMore:e=>function(e){return Object(a.bb)(e.get().peer,e.get())?Promise.resolve(""):Object(a.uc)(e.get().peer,e.get())}(e),unmount(){Object(c.c)(t)}}}function g(e){return e.findIndex(e=>"number"==typeof e.peerId&&e.href)>-1}function _(e,t){var n=u.bind(null,t);return m(0,Object(c.a)({handlers:(t,a)=>{a(e,"click","_im_mess",n)}}))}var p=n("h++7"),b=n("R5GP"),h=n("+/AQ");function f(e,t){return Object(l.q)(e).find(e=>domData(e,"list-id")===t)}function v(e,t){return Object(l.q)(e).findIndex(e=>domData(e,"list-id")===t)}function O(e,t,n,a){if(n){j(e,t,a);var r=domData(n,"list-id"),i=r&&f(t.children,r);i&&a.forEach(e=>addClass(i,e)),e.setState({hoveredListItemId:r})}}function j(e,t,n){var a=domQuery("."+n.join("."),t);a&&Object(l.q)(a).forEach(e=>{n.forEach(t=>removeClass(e,t))}),e.setState({hoveredListItemId:null})}function y(e,t){var n=t&&domQuery("."+t.join("."),e)[0];return n?domData(n,"list-id"):null}function w(e,t,n){return e.map(t).reduce((e,t)=>(e[t]=!0,e),n)}function C(e,t,n){return{ids:w(n.get().elements,e,{}),scrolls:t,activated:!0}}function k(e,t,n){return n.elements=n.elements.filter(n=>t(n)!==e),delete n.ids[e],Promise.resolve(n)}function S(e,t,n){var a=[];n.elements=n.elements.map(n=>{var r=t(n),i=e.filter(e=>t(e)===r)[0];return a.push(r),i||n});var r=e.filter(e=>!inArray(t(e),a));return n.elements=n.elements.concat(r),Promise.resolve(n)}function E(e){var t={};return e.forEach(e=>{"r"===e[0]&&t["a,"+e[1]]?delete t["a,"+e[1]]:t[`${e[0]},${e[1]}`]=e}),Object.keys(t).map(e=>t[e])}function I(e,t,n,a,r,i,s){for(var o=0;o<a;o++)e=domNS(e);var l=se(r(t));return domData(l,"list-id",n),e?i.insertBefore(l,e):i.appendChild(l),s&&s(l),e}function T(e,t,n,a,r){var i=a.get(),s=i.limit,o=i.offset,c=function(e,t){var n=t.get();return!n._sortedEls&&e&&t.setState({elements:n.elements.sort(e),_sortedEls:!0}),t.get().elements}(n().sortFn,a).slice(0,o+s),d=function(e,t){for(var n=[],a=Math.max(e.length,t.length),r=0;r<a;r++){var i=e[r],s=t[r];!i&&s?n.push(["a",s,r]):i&&!s?n.push(["r",i,r]):i!==s&&(n.push(["r",i,r]),n.push(["a",s,r]))}var o=E(n),l=E(n.reverse());return o.length>l.length?l:o}(Object(l.q)(e.children).map(e=>domData(e,"list-id")).filter(e=>!!e),c.map(e=>n().idFn(e).toString()));if(function(e,t,n,a,r){if(0!==t.length){var i=(t=t.sort((e,t)=>e[2]-t[2])).filter(e=>"a"===e[0]);if(t.filter(e=>"r"===e[0]).map(t=>e.children[t[2]]).forEach(e=>re(e)),0!==i.length)for(var s=i.shift(),o=s[2],l=(I(e.children[o],n[s[2]],s[1],0,a,e,r),0);l<i.length;l++)s=i[l],I(e.children[o],n[s[2]],s[1],s[2]-o,a,e,r),o=s[2]}}(e,d,c,n().renderFn,n().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(a,t),r)return d.filter(e=>"a"==e[0]).map(e=>parseInt(e[1]))}function M(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=e.get(),l=t.getContainer().children,c=v(l,a||o.hoveredListItemId);c<0||(o.limit+o.offset<c?e.setState({offset:c-o.limit+1}).then(T.bind(null,t.getContainer(),t,n)):Promise.resolve()).then(()=>{var e=l[c],n=t.scrollTop(),a=t.getScrollHeight(),o=e.offsetHeight;i="center"===i?-.5*a:i,s="center"===s?a/2:s;var d=r?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=n+i>e.offsetTop,m=o+e.offsetTop>n+a-s;u?d(e.offsetTop-i):m&&d(e.offsetTop-a+o+s)})}function L(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var n=arguments.length,a=new Array(n>2?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];return t(...a).then(()=>{e.get().loading=!1})}function x(e,t,n){return n.scrolls||(n.scrolls={}),n.scrolls[e]&&!t||(n.scrolls[e]={scrolled:n.scrolled||0,scrollItem:n.scrollItem}),Promise.resolve(n)}function P(e,t,n,a){var i=e.get(),s=i.elements,o=a.getContainer(),l=e.setState({offset:i.offset+i.limit}).then(()=>{var n,r=i.offset,l=i.limit;return l+r>s.length?n=t().more(r,l).then(t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t)).then(D.bind(null,e,o,a,t,i.pipeId)):(n=Promise.resolve(),T(o,a,t,e)),n});if(!n){var c=s.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";Object(r.Rd)(o)(l,"bottom",c)}return l}function B(e,t){var n=e.get().pipeId;return!(void 0!==n&&void 0!==t&&n!==t)}function D(e,t,n,a,r,i){return!!B(e,r)&&e.setState(function(e,t,n){var a=e.filter(e=>!n.ids[t(e)]);return{_sortedEls:!1,els:a,ids:w(a,t,n.ids),elements:n.elements.concat(a)}}(i,a().idFn,e.get())).then(T.bind(null,t,n,a))}function A(e,t,n){var a=L.bind(null,t,P.bind(null,t,n)),r=(e,a)=>{(t.get().activated||e)&&(void 0!==a&&t.get().elements.length>0&&t.setState({scrolled:a}),n().onScroll&&n().onScroll())},i=Object(h.a)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:r.bind(null,!1),more:!!n().more&&a.bind(null,!1)}),s=Object(c.a)({handlers:(a,r)=>{r(e,"click",t.get().elCls,n().onClick)}});return t.setState(C(n().idFn,{},t)),{pipe:(e,a)=>(t.setState({pipeId:a}),e.then(D.bind(null,t,i.getContainer(),i,n,a))),replacePreserveOrder:e=>t.set(S.bind(null,e,n().idFn)).then(T.bind(null,i.getContainer(),i,n)),pipeReplace(e,a){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.setState({pipeId:a,stop:!1}),e.then(e=>{if(B(t,a))return t.setState({elements:e,_sortedEls:!1,ids:w(e,n().idFn,{})}).then(T.bind(null,i.getContainer(),i,n,t,r))})},wipe(){i.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,n)=>t.set(x.bind(null,e,n)),updateScroll(){i.update(!1,!0)},toTop(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?i.smoothScroll(-i.scrollTop()):i.scrollTop(0),e&&r(e,0)},scrollTop:e=>i.scrollTop(e),restoreScroll(e){var n=t.get().scrolls,a=n[e];return a&&(t.setState({scrolls:extend({},n,{[e]:null})}),i.scrollTop(a.scrolled)),!!a},unsetScroll(e){t.setState({scrolls:extend({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var n=i.scroll.scroller,a=i.scrollTop(),r=a+("up"===e?-1:1)*n.clientHeight;t?i.smoothScroll(r-a):i.scrollTop(r)},scrollToElement(e,a,r,s){M(t,i,n,e,a,r,s)},getScroller:()=>i.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?a(e,i):Promise.resolve([]),add:(e,a)=>D(t,i.getContainer(),i,n,a,e),hoverNextElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,c=v(o,t.get().hoveredListItemId||y(s,a)),d=Object(l.q)(o).slice(c+1).find(n().hoverableFn);O(t,s,d,e),M(t,i,n,null,!1,r.top,r.bottom)},hoverPrevElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,c=v(o,t.get().hoveredListItemId||y(s,a)),d=c>=0&&Object(l.q)(o).slice(0,c).reverse().find(n().hoverableFn);O(t,s,d,e),M(t,i,n,null,!1,r.top,r.bottom)},hoverFirstElement(e,a){var r=i.getContainer(),s=r.children,o=Object(l.q)(s).findIndex(n().hoverableFn),c=s[o];!t.get().hoveredListItemId&&c&&(O(t,r,c,e),M(t,i,n,o,!1,a.top,a.bottom))},hoverElement(e,a,r){var s=i.getContainer(),o=s.children,l=v(o,e),c=o[l];c&&(O(t,s,c,a),M(t,i,n,l,!1,r.top,r.bottom))},unhoverElements(e){j(t,i.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(C(n().idFn,e,t))},getHoveredElement:()=>f(i.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(k.bind(null,e,n().idFn)).then(T.bind(null,i.getContainer(),i,n))},unmount(){Object(c.c)(s),i.destroy()}}}var N=n("eaP7"),R=n("1y80"),F=n("86+7"),H=n("kxld"),q=n("FWc3"),U=n("3qfP"),K=n("rudk"),z=n("6x51"),V=n("gdug"),W=n("zxIV"),G=n("BJj/");function X(e){return Object(W.q)("_im_carousel",e.target)}function Q(e,t){var n=t.querySelector("._im_carousel_control_left"),a=t.querySelector("._im_carousel_control_right"),r=t.querySelector("._im_carousel_viewport"),i=t.querySelector("._im_carousel_layer");a&&n&&r instanceof HTMLElement&&i instanceof HTMLElement&&(n.classList.toggle("Carousel__control--hidden",e<=0),a.classList.toggle("Carousel__control--hidden",e+r.offsetWidth>=i.offsetWidth))}function $(e){var t=X(e),n=Object(W.q)("_im_carousel_control",e.target),a=Number(n.dataset.direction);if(t){var r=t.querySelector("._im_carousel_viewport"),i=t.querySelector("._im_carousel_layer");if(r&&i&&a){var s=Number(t.dataset.scrollCount)||1,o=Math.floor(i.offsetWidth/i.childElementCount),l=(Math.floor(r.scrollLeft/o)+a*s)*o;Q(l,t),r.scrollTo({left:l,behavior:"smooth"})}}}var Y=Object(G.a)((function(e){var t=X(e),n=t&&t.querySelector("._im_carousel_viewport");n&&Q(n.scrollLeft,t)}),20);function J(e){var t=X(e);(t&&t.querySelector("._im_carousel_viewport")).addEventListener("scroll",Y)}function Z(e){var t=X(e);(t&&t.querySelector("._im_carousel_viewport")).removeEventListener("scroll",Y)}function ee(e){return{unmount:function(){Object(c.c)(e)}}}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ae=["_im_dialog_selected","nim-dialog_selected"],ie=["_im_dialog_hovered","nim-dialog_hovered"];function oe(e,t,n){removeClass(t.parentNode,"im-page--dialogs_with-mess");var a=n.getCurrentElements().filter(e=>e.message);n.toTop(),n.reset(),Object(R.b)(.01,"im_search_stat",1,"search_messages_only"),a.length>0?(a=[{type:"sep_messages"}].concat(a),e.setState({searchOnlyMessages:!0})):a=[Pe()],n.pipeReplace(Promise.resolve(a))}function le(e){return hasClass(e,"_im_search")}function de(e,t,n,s){if(Object(i.R)(e)&&e.get().searchAllLoaded||Object(i.N)(e))return Promise.resolve([]);if(e.get().dialog_search_going||Object(r.Mb)(e)&&0!==e.get().peer)return Promise.resolve(!1);if(Object(i.R)(e))return Object(a.tc)(Object(i.q)(e),e.get()).then(e=>{var t=te(e,2),n=t[0];return xe(t[1],n)});var o=e.get().active_tab,l=e.get().dialog_tabs_all;return![p.k,p.m].includes(o)&&l[p.g]&&!Object(r.gc)(e)||l[o]?0===Xe(e).length?Object(i.M)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):Promise.resolve([{type:"empty_dialogs"}]):Promise.resolve([]):e.set(a.kb).then(t=>{var n=Xe(e);if(Object(r.oc)(e)){if(n.length<2&&!e.get().hasContacts)return n.push({type:"find_friends_stub"}),n;if(1===n.length)return[{type:"empty_dialogs"}]}return 0===n.length?Object(i.M)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):[{type:"empty_dialogs"}]:n})}function ue(e,t,n,s,o,l){var c=parseInt(domData(l,"peer"),10),u=Object(i.s)(n,c),m=hasClass(l,"_im_sugg_"+c),g=l.classList.contains("ConvoRecommendList__button");if(u||m||g){var _=gpeByClass("_im_peer_target",o.target)&&checkEvent(o),p=Object(r.Nb)(n)&&gpeByClass("_im_dialog_peer_tags",o.target);if(!_&&!p){var b=n.get(),h=le(l),f=parseInt(domData(l,"msgid"),10);if(u&&Object(i.Z)(u))return e().showChatInvitationBox(n,c),cancelEvent(o);var v="";if(Object(i.R)(n)&&(v="conversations_search"),Object(i.N)(n)&&(v="recent_searches"),m&&(v="popular_suggestions"),g&&(v="list_all_suggestions"),h&&(v="message_search"),u&&checkEvent(o))return window.open(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(r.lb)(e),s=()=>`${i}?sel=${Object(r.ab)(t.peerId)}${a&&n?"&msgid="+n:""}`;if(a)return s();if(Object(r.nc)(t.peerId)||Object(r.Ob)(t.peerId))return Object(r.Mb)(e)?s():t.href;return s()}(n,u,f,h));if(s.saveScroll("list"),h&&b.msgid!==f)b.longpoll.push([Object(d.a)(c,f,!1,!1,v)]);else if(c!==b.peer){b.longpoll.push([Object(d.a)(c,!1,!0,!0,v)]);var O=Object(i.R)(n);O&&!hasClass(l,"_dont_add_recent")&&Object(a.oc)(c,cur.imDb),O&&u&&!Object(r.Mb)(n)&&setTimeout(()=>{var e=u.message?u.message.messageId:u.peerId;s.scrollToElement(e.toString(),!0,0,"center")},100)}else c===b.peer&&e().goToHistoryEnd();cancelEvent(o)}}}function me(e,t,n,a){var s,o="string"==typeof n.photo&&""!==n.photo,l=Object(r.Pb)(t),c=n.tab||n.name,d=l?Object(r.xc)(c):c;if(Object(r.Lb)(t)&&!o)s=Object(r.Oc)(e,n,a);else{if(l&&!o){var u=Object(r.Ab)(c),m=Object(i.R)(e)&&!n.message?34:a?50:46;s=getTemplate("sImContactAvatar",{name:u,size:m,classes:"nim-peer--contact-avatar"})}else s=`<img src="${n.photo}" alt="">`;a&&(s=getTemplate("im_dialogs_link_img",{href:n.href||n.link,photo:s}))}return{photo:s,userLink:`<span class="_im_dialog_link">${d}</span>`}}function _e(e){return!Object(r.ec)(e)}function pe(e,t,n,a){return n?"":a?getTemplate("im_img_prebody",{photo:t}):e+":"}function be(e,t,n,a,s,o,l,c,d,u){var m="",g=Object(i.z)(Object(i.s)(e,n));return t&N.p?m=pe(getLang("mail_by_you"),u,g,d):Object(r.Lb)(n)&&0!==a&&(m=pe(Object(F.c)(e,a).first_name,Object(F.c)(e,a).photo,g,d)),l=Object(r.Tc)(n,c,l,s,o),m?getTemplate("im_drow_prebody",{prebody:m,body:l}):l}function he(e,t,n,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=[];return Object(r.Mb)(a)&&o.push("nim-dialog_classic"),Object(i.N)(a)&&o.push("nim-dialog_recent"),o.push("nim-dialog_empty"),s.search&&o.push("_im_search"),getTemplate("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:n,date:"",body:"",unread:"",more:o.join(" "),is_star:"",unread_message_string:"",is_online:onlinePlatformClass(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==a.get().peer?"nim-dialog_selected _im_dialog_selected":""})}function fe(e,t,n){return!!(n&N.p)&&(!Object(r.hc)(t.peerId,e.get().gid)&&(!(Object(r.Lb)(t.peerId)&&t.data&&t.data.closed)&&(!t.unread&&!(!t.lastmsg||t.lastmsg<=t.out_up_to))))}function ve(e){var t=Se(e);return!!(e.unread>0&&t)||!!Object(i.U)(e)}function Oe(e){return!(!e.mentions||!e.mentions.length)}function je(e){return function(e){return!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!Oe(e)}function ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n||Se(t),l=me(e,t.peerId,t,Object(r.Mb)(e)),c=l.photo,d=l.userLink;if(!o)return he(t,c,d,e,a);var u=o.flags,m=Object(r.Tb)(e,t.peerId),g=Object(i.Z)(t),_=Object(i.x)(e,t.peerId),p=Object(r.Pb)(t.peerId),b=ke(t,e,n),h=Object(i.D)(e,t.peerId),f=t.major_sort_id,v=[];a.search&&v.push("_im_search","nim-dialog_search"),inArray(t.peerId,e.get().mutedPeers)&&v.push("nim-dialog_muted"),t.verified&&v.push("nim-dialog_verified"),_&&v.push("nim-dialog_casper"),Object(i.N)(e)&&v.push("nim-dialog_recent"),Object(s.n)(o)&&!_&&v.push("nim-dialog_empty"),Object(r.Mb)(e)&&v.push("nim-dialog_classic"),t.folders&N.u&&v.push("nim-dialog_starred"),!a.search&&Object(r.lc)(e,t.peerId,t)&&v.push("nim-dialog_unrespond"),(m||h)&&e.get().gid&&v.push("nim-dialog_deny-remove"),Oe(t)&&v.push("nim-dialog_unread-mentions"),je(t)&&v.push("nim-dialog_unread-expiring"),t.callInProgress&&v.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&v.push("nim-dialog_active-call-empty"),Object(K.h)(f)&&v.push("nim-dialog_pinned");var O=Object(i.Z)(t)?t.mr&&t.mr.request_date:o.date,j=e.get().timeshift,y=O?getShortDateOrTime(O,j,!0,getLang("months_sm_of","raw")):"",w=!fe(e,t,u)||g||Object(i.R)(e)?"":"nim-dialog_unread-out",C=t.unread>0?getLang("mail_im_new_messages",t.unread):"",k=p?Object(r.xc)(t.tab):t.tab;return getTemplate("im_drow",{peer:t.peerId,msg_id:o.messageId||"",photo:c,user_link:d,date:y,body:b,unread_message_string:C,tab_name:stripHTML(k),unread:Object(r.Dd)(t.unread),more:v.join(" "),is_online:onlinePlatformClass(t.online),is_unread:ve(t)?"nim-dialog_unread":"",is_unread_out:w,is_selected:a.noselect||g||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected"})}function we(e,t,n,a,o){if(!t.deletedDialog)if(hasClass(e,"nim-conversation-search-row"))Ce(e,t,n);else{var c=n.get(),d=Se(t),u=d.flags,m=ke(t,n),g=me(n,t.peerId,t,Object(r.Mb)(n)),_=g.photo,p=g.userLink,b=n.get().timeshift,h=d.date?getShortDateOrTime(d.date,b,!0,getLang("months_sm_of","raw")):"";Ae(e,t),val(geByClass1("_dialog_body",e),m),val(geByClass1("_im_dialog_date",e),h),val(geByClass1("_im_dialog_unread_ct",e),Object(r.Dd)(t.unread));var f=geByClass1("_im_dialog_link",e);f&&val(f.parentNode,p);var v=geByClass1("_im_dialog_photo",e);v.innerHTML!==_&&val(v,_),c.is_peer_profile_enabled&&(c.peer||Ke(e,n));var O=Object(i.x)(n,t.peerId);toggleClass(e,"nim-dialog_verified",!!t.verified),toggleClass(e,"nim-dialog_casper",O),toggleClass(e,"nim-dialog_muted",inArray(t.peerId,n.get().mutedPeers)),toggleClass(e,"nim-dialog_unrespond",Object(r.lc)(n,t.peerId,t)),toggleClass(e,"nim-dialog_classic",Object(r.Mb)(n)),toggleClass(e,"nim-dialog_unread",ve(t)),toggleClass(e,"nim-dialog_unread-mentions",Oe(t)),toggleClass(e,"nim-dialog_unread-expiring",je(t)),toggleClass(e,"nim-dialog_active-call",!!t.callInProgress),toggleClass(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),toggleClass(e,"nim-dialog_pinned",Object(K.h)(t.major_sort_id)),toggleClass(e,"nim-dialog_deny-remove",n.get().gid>0&&(Object(r.Tb)(n,t.peerId)||Object(i.D)(n,t.peerId))),removeClass(e,"nim-dialog_failed"),removeClass(e,"nim-dialog_deleted"),addClass(e,"_im_dialog"),Object(l.r)(geByClass1("_im_peer_online",e),t.online),toggleClass(e,"nim-dialog_recent",Object(i.N)(n)),toggleClass(e,"nim-dialog_empty",Object(s.n)(d)&&!O),toggleClass(e,"nim-dialog_unread-out",fe(n,t,u)&&!Object(i.R)(n)),Ue(e),toggleClass(e,"nim-dialog_starred",t.folders&N.u),o&&setTimeout((function(){addClass(geByClass1("_im_dialog_"+t.peerId,a),"nim-dialog_injected")}),100)}}function Ce(e,t,n){Ae(e,t),toggleClass(e,"nim-dialog_recent",Object(i.N)(n)),val(geByClass1("_im_dialog_unread_ct",e),Object(r.Dd)(t.unread)),toggleClass(e,"nim-dialog_unread",ve(t)),toggleClass(e,"nim-dialog_unread-expiring",je(t)),toggleClass(e,"nim-dialog_unread-mentions",Oe(t));var a=me(n,t.peerId,t,Object(r.Mb)(n)).photo,s=geByClass1("_im_dialog_photo",e);s.innerHTML!==a&&val(s,a),Object(l.r)(geByClass1("_im_peer_online",e),t.online)}function ke(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=n||Se(e),o=Object(i.Z)(e),l=Object(i.x)(t,e.peerId);if(o){var c=Object(r.Mb)(t),d=e.mr&&e.mr.inviter_id,u=Object(F.c)(t,d),m=c?u.name:u.short_name,g=c?getTemplate("im_img_prebody",{photo:u.photo}):"",_=getLang("mail_mr_service_message").replace(/{user}/,m);return g+_}if(Object(r.cc)(e.peerId,t)){var p=t.get().block_states[e.peerId].name,b=getLang("mail_community_answering").replace("{username}",p);return getTemplate("im_drow_prebody",{prebody:b,body:""})}return Object(s.s)(a)&&!o?Object(r.Sc)(t,a,e.peerId,!1):l&&Object(s.n)(a)?getLang("mail_empty_casper_message"):Object(s.j)(a)?getLang("mail_expired_message"):be(t,a.flags,e.peerId,a.userId,!0,a.attaches,a.text,a.subject,Object(r.Mb)(t),Object(F.c)(t,t.get().id).photo)}function Se(e){var t=e.lastmsg_meta;return Array.isArray(t)&&(t=Object(U.a)(t)),t||Object(U.a)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function Ee(e,t,n){var s=Object(i.s)(e,t),o=Object(i.Z)(s),l=Object(r.td)(e,t,i=>{n().updateMenu(e);var s=Promise.resolve();Object(r.Lb)(t)&&(s=o?e.set(a.Qb.bind(null,t)):e.set(a.eb.bind(null,t))),i&&s.then(()=>Object(r.X)(e,l,n,a.K,t)),l.hide()})}function Ie(e,t,n,i,s,o){var l=gpeByClass("_im_dialog",o,n);if(cancelEvent(s),!l)return!1;var c=intval(domData(l,"peer")),d=t.get(),u=Object(r.Ob)(c)||Object(r.nc)(c);if(d.recentSearch){var m=Object(a.Wb)(c,cur.imDb);re(l),0===m.length&&qe(t,i,e)}else Object(r.Mb)(t)&&u?Object(a.A)(c,d).then(n=>{var a=te(n,2),r=a[0],i=a[1];r?(!function(e,t,n,a,r){var i=geByClass1("_dialog_body",t);addClass(t,"nim-dialog_deleted"),removeClass(t,"_im_dialog"),val(i,getTemplate("im_delete_actions",{text:langNumeric(n,getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:a}))}(c,l,r,i),e().updateMenu(t)):Ee(t,c,e)}):Ee(t,c,e);return!1}function Te(e,t){Object(r.Ld)(e,e=>{t().restoreDialogs(e,!0),Object(b.b)(e).active_tab===p.g&&t().updateRecommendationList(e)},a.q)}function Me(e,t){switch(t.type){case"sep_btn_search_msg":return Object(r.Ec)(e);case"sep_messages":return Object(r.Nc)();case"sep_conversations":return Object(r.Hc)();case"sep_popular":return Object(r.Qc)();case"popular_sugg":return Object(r.Rc)(e);case"recommend_list":return Object(r.Ic)(e);case"find_friends_stub":return Object(r.Kc)(e);case"clear_recent":return Object(r.Gc)();case"empty_dialogs":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_list_empty")});case"empty_message_requests":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_mr_empty")});case"empty":return getTemplate("im_dialogs_none",{msg:getLang("mail_im_search_empty")});case"message_request_notice":return getTemplate("im_dialogs_message_requests_notice",{msg:getLang("mail_message_request_tab_notice")});case"message_request_button_go":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_tab_mr")});case"message_request_button_return":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_go_to_all_tab")});default:return t.message?ye(e,t,t.message,{noselect:!0,search:!0}):t.local_index||Object(i.R)(e)?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=me(e,t.peerId,t,Object(r.Mb)(e)),s=a.photo,o=a.userLink,l=Object(r.Pb)(t.peerId)?Object(r.xc)(t.tab):t.tab,c=_e(e),d=""===n?[]:[n];return Object(i.N)(e)&&d.push("nim-dialog_recent"),Object(r.Mb)(e)&&d.push("nim-csr_classic"),inArray(t.peerId,e.get().mutedPeers)&&d.push("nim-dialog_muted"),Object(i.y)(t)&&d.push("nim-dialog_casper"),Oe(t)&&d.push("nim-dialog_unread-mentions"),je(t)&&d.push("nim-dialog_unread_expiring"),getTemplate("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:s,user_link:o,unread:Object(r.Dd)(t.unread),tab_name:stripHTML(l),is_unread:ve(t)?"nim-dialog_unread":"",is_online:onlinePlatformClass(t.online),is_selected:t.peerId==e.get().peer&&c?"nim-dialog_selected _im_dialog_selected":"",more:d.join(" ")})}(e,t):ye(e,t)}}function Le(e,t,n,i,s,o){var l=intval(domData(o,"peer")),c=domData(o,"action"),d=domData(o,"sid"),u=geByClass1("_im_dialog_"+l,t),m=intval(domData(o,"spam"));switch(c){case"restore":u&&e.set(a.hc.bind(null,l,d,m)).then(()=>{addClass(u,"_im_dialog"),removeClass(u,"nim-dialog_deleted"),we(u,e.get().tabs[l],e,t,!1),i().updateMenu(e)});break;case"spam":var g=`${getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${d}" data-peer="${l}">\n            ${getLang("mail_restore")}\n        </button>`;if(u){var _=geByClass1("_dialog_body",u);val(_,g),Object(a.Pc)(l,d,e.get())}break;case"block":(Object(r.Nb)(e)?Object(r.id)(l,e):Object(r.jd)(l,e)).once("success",(function(){e.set(a.K.bind(null,l)).then(()=>{n().restoreDialogs(e)})}))}cancelEvent(s)}function xe(e,t){return e.map(e=>Object(U.a)(e)).map(e=>extend({},t[e.peerId],{message:e}))}function Pe(e){return{type:"empty",lang:e}}function Be(e,t,n,r){var i=gpeByClass("_im_dialog",r,t),s=intval(domData(i,"peer"));return e.set(a.Yc.bind(null,s)),setTimeout((function(){De(e,t,n,r)}),100),cancelEvent(n),!1}function De(e,t,n,a){Object(q.c)(a,{text:function(){var n=gpeByClass("_im_dialog",a,t),r=domData(n,"peer");return e.get().tabs[r].folders&N.u?getLang("mail_im_toggle_important_off"):getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:Qe(e,a.getBoundingClientRect().top)})}function Ae(e,t){var n=t.unread>0?getLang("mail_im_new_messages",t.unread):"",a=geByClass1("_im_unread_blind_label",e);val(a,n)}function Ne(e,t,n,r,s){var o=gpeByClass("_im_dialog",s,t),l=intval(domData(o,"peer")),c=e.get().tabs[l].lastmsg;return e.set(a.yb.bind(null,l,c)).then(()=>{we(o,e.get().tabs[l],e,t),Object(i.N)(e)||n().restoreDialogs(e)}),showDoneBox(getLang("mail_marked_as_answered"),{out:1e3}),cancelEvent(r),!1}function Re(e){var t=Object(i.R)(e),n=e.get().searchOnlyMessages;return Object(r.Mb)(e)?{top:t&&!n?96:60,bottom:Object(r.Nb)(e)?42:87}:{top:t&&!n?36:0,bottom:0}}function Fe(e,t){e.hoverFirstElement(ie,Re(t))}function He(e){e.unhoverElements(ie)}function qe(e,t,n){if(Object(i.c)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else n().cancelSearch(e),cancelStackFilter("im_search")}function Ue(e){var t=geByClass1("_im_dialog_star",e),n=geByClass1("_im_dialog_date",e);if(t&&n){var a=n.offsetWidth;t.style.right=15+a+14+"px"}}function Ke(e,t){var n=t.get(),a=parseInt(domData(e,"peer")),s=Object(i.s)(n,a);if(n.is_peer_profile_enabled&&Object(r.Nb)(n)&&s&&!Object(i.z)(s)&&!Object(i.D)(n,a)){var l=geByClass1("_im_dialog_peer_tags",e);if(s.ad_id||n.peer_profile_tags&&s.peer_tags&&s.peer_tags.ids){var c=s.peerTagsMaxWidth||0;if(!c){var d=geByClass1("_im_dialog_name_w",e).offsetWidth;c=340-(d+6+(s.verified?16:0)),t.set(e=>(e.tabs[a].peerTagsMaxWidth=c,Promise.resolve(e)))}Object(o.k)(l,c,t,a)}else l.innerHTML&&(l.innerHTML="")}}function ze(e,t){if(Object(r.Nb)(e)){["empty_dialogs","empty"].includes(domData(t,"list-id"))?Object(o.n)():hasClass(t,"_im_dialog")&&(Ue(t),Ke(t,e))}}function Ve(e){checkEvent(e)||cancelEvent(e)}function We(){return window.FriendsSearch?Promise.resolve():window.stManager.add([jsc("web/friends_search.js")])}function Ge(e,t,n,a,s){return{selectPeer(t,n){for(var a=geByClass("_im_dialog",e),r=n.get().peer,i=0;i<a.length;i++){var s=a[i],o=intval(domData(s,"peer")),l=intval(domData(s,"msgid"));o===r&&(!le(s)||t===l&&le(s))?(addClass(s,"nim-dialog_selected"),addClass(s,"_im_dialog_selected")):hasClass(s,"_im_dialog_selected")&&(removeClass(s,"nim-dialog_selected"),removeClass(s,"_im_dialog_selected"))}},appendFastDialogs(t,a,s){removeClass(e.parentNode,"im-page--dialogs_with-mess"),n.saveScroll("list"),s?(n.reset(),Object(r.ec)(t)||Object(i.N)(t)||!g(a)?Object(i.N)(t)&&(g(a)&&(a=[{type:"clear_recent"}].concat(a)),Object(i.c)(t)&&(a=[{type:"sep_popular"},{type:"popular_sugg"}].concat(a))):a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a),t.setState({searchOnlyMessages:!1}),n.pipeReplace(Promise.resolve(a)).then(()=>Fe(n,t))):n.pipe(Promise.resolve(a)),Object(r.Mb)(t)&&!Object(r.fc)(t.get().peer)||n.toTop()},deactivate(){n.deactivate()},activate(){n.activate()},hoverFirstDialog(e){Fe(n,e)},hoverNextDialog(e){n.hoverNextElement(ie,ae,Re(e))},hoverPrevDialog(e){n.hoverPrevElement(ie,ae,Re(e))},unhoverDialogs:He.bind(n),selectHoveredDialog(t){var r=geByClass1("_im_dialog_hovered",e);r||(r=geByClass1("_im_dialog",e)),r&&ue(a,0,t,n,{},r)},appendSearch(t,a,r){var i=xe(r,a);r.length>0?(addClass(e.parentNode,"im-page--dialogs_with-mess"),n.pipe(Promise.resolve([{type:"sep_messages"}].concat(i))).then(()=>Fe(n,t))):(0===n.getCurrentElements().length&&n.pipeReplace(Promise.resolve([Pe()])),removeClass(e.parentNode,"im-page--dialogs_with-mess"))},update(e){n.pipeReplace(Promise.resolve(Xe(e)))},updateDialog(t,n){var a=geByClass1("_im_dialog_"+t,e);a&&!le(a)&&we(a,Object(i.s)(n,t),n,e)},focusOnSelected(t){var a=t.get().peer;if(a){var r=geByClass1("_im_dialog_"+a,e);r?n.scrollTop(r.offsetTop-r.offsetHeight):n.toTop()}},restoreScroll(e){n.restoreScroll("list")||n.toTop()},forceScrollReinit(){var e=n.getScroller();e&&(e.style.overflowY="hidden",setTimeout(()=>e.style.overflowY="",0))},restoreDialogs:(t,i,s)=>(removeClass(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),0!==Xe(t).length||n.isLoading()||(i=!0),i&&n.reset(),s&&n.wipe(),n.pipeReplace(Promise.resolve(Xe(t))).then(()=>{if(i&&(!Object(r.Mb)(t)||!t.get().peer)){var e=function(e,t,n){return Object(r.Mb)(n)||t().toggleSettingsLoader(n,!0),e.checkMore(!Object(r.Mb)(n)).then(()=>{Object(r.Mb)(n)||t().toggleSettingsLoader(n,!1)})}(n,a,t);return n.toTop(),e}}).then(()=>He(n))),appendDialogs(t,a){removeClass(e.parentNode,"im-page--dialogs_with-mess"),a.forEach(n=>{var a=geByClass1("_im_dialog_"+n.peerId,e);a&&Ce(a,n,t)}),Object(r.ec)(t)||Object(i.N)(t)||!g(a)||(a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a)),t.setState({searchOnlyMessages:!1}),n.isEmpty()&&0===a.length&&Object(r.ec)(t)&&(a=[Pe(getLang("mail_im_search_empty_chats"))]),n.replacePreserveOrder(a)},updateCounter(t,n){var a=geByClass1("_im_dialog_"+n,e),s=Object(i.s)(t,n);if(a&&!le(a)&&(Ae(a,s),val(geByClass1("_im_dialog_unread_ct",a),Object(r.Dd)(s.unread)),toggleClass(a,"nim-dialog_unread",ve(s)),toggleClass(a,"nim-dialog_unread-out",fe(t,s,Se(s).flags)),toggleClass(a,"nim-dialog_unread-mentions",Oe(s)),toggleClass(a,"nim-dialog_unread-expiring",je(s))),Object(i.N)(t)){var o=geByClass1("_im_sugg_"+n,e);o&&(val(geByClass1("_sugg_unread_ct",o),Object(r.Dd)(s.unread)),toggleClass(o,"sugg-is_unread",s.unread>0))}},removeDialog(e,t){n.remove(t)},updateOnline(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a){var r=n.get().tabs[t],i=geByClass1("_im_peer_online",a);Object(l.r)(i,r.online)}},updateRecommendedOnline(t,n){var a=Object(H.d)(n),r=e.querySelector(`.ConvoRecommendList__button[data-peer="${t}"]`);if(r&&a){var i=a.item_data[t].online_info,s=r.querySelector("._online");s.classList.toggle("online",i.is_online||i.is_mobile),s.classList.toggle("mobile",i.is_mobile)}},updateRecommendationList(t){var n=e.querySelector(".ConvoRecommendList ._im_carousel_viewport"),a=n&&n.querySelector("._im_carousel_layer:not(.ConvoRecommendList__fadeOut)");if(a){var i=se(Object(r.Ic)(t)).querySelector("._im_carousel_layer");i.classList.add("ConvoRecommendList__fadeIn"),a.classList.add("ConvoRecommendList__fadeOut"),a.addEventListener("animationend",()=>{i.classList.remove("ConvoRecommendList__fadeIn"),a&&a.parentNode&&a.remove()}),n.appendChild(i)}},setRecommendationListVisibility(t){var n=e.querySelector(".ConvoRecommendList");n&&n.classList.toggle("ConvoRecommendList--hidden",!t)},setDialogFailed(t,n,a){var r=geByClass1("_im_dialog_"+t,e);r&&(a.get().tabs[t].lastmsg===n&&(addClass(r,"nim-dialog_failed"),val(geByClass1("_im_dialog_unread_ct",r),"!")))},scrollUp(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.toTop(e,t),n.saveScroll("list",!0)},saveScroll(e){n.saveScroll("list",!0)},promoteDialog(a,r){var s=geByClass1("_im_dialog_"+r,e);s&&!le(s)||!Object(i.R)(a)?(n.pipeReplace(Promise.resolve(Xe(a)),void 0,!0).then(t=>{!inArray(r,t)&&s&&we(s,Object(i.s)(a,r),a,e)}),t().updateTyping(r,a)):n.unsetScroll("list")},removeSelection(t){var a=t.get().peer.toString(),i=`._im_dialog_${a}.${ae.join(".")}`,s=domQuery(i,e)[0];ae.forEach(e=>removeClass(s,e)),Object(r.Mb)(t)||n.hoverElement(a,ie,Re(t))},updateScroll(){n.updateScroll()},updateTyping(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a&&!le(a)&&!n.get().tabs[t].deletedDialog){var s=geByClass1("_im_dialog_typing",a),o=!Object(r.Mb)(n),l=Object(r.hb)(Object(i.s)(n,t).activity,t,!Object(r.Lb)(t),n.get(),1,o);val(s,l),toggleClass(a,"nim-dialog_typing",l)}},updateStarPosition(){!function(e){geByClass("_im_dialog",e).forEach(e=>{Ue(e)})}(e)},renderPeerTags(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n?Ke(geByClass1("_im_dialog_"+n,e),t):function(e,t){var n=t.get();n.is_peer_profile_enabled&&Object(r.Nb)(n)&&geByClass("_im_dialog",e).forEach(e=>{Ke(e,t)})}(e,t)},unmount(){n.unmount(),Object(c.c)(s)}}}function Xe(e){var t=e.get(),n=t.active_tab,a=t.dialog_tabs[n],i=t.tabs,s=a.map(e=>i[""+e]).sort(z.i.bind(null,e)),o=t.dialog_tab_cts.mr;if(Object(r.oc)(e)&&(e.get().hasContacts||a.length>1)&&s.unshift({type:"recommend_list"}),n===p.k&&s.unshift({type:"message_request_notice"}),!Object(r.Mb)(e))switch(n){case p.g:o>0&&s.unshift({type:"message_request_button_go"});break;case p.k:s.unshift({type:"message_request_button_return"})}return s}function Qe(e,t){var n=e.get().gid?220:150;return!(Object(o.d)(e)&&t<=n+46)&&(t>n||Object(i.R)(e))}function $e(e,t,n,s){var d=Object(c.b)(Ge),u=d.callMutations,m=d.bindMutations,g=function(e,n){Object(q.c)(n,{text:()=>{if(Object(i.N)(t))return getLang("mail_hide_from_recent");var e=Number(n.getAttribute("data-peer")),a=Object(i.s)(t,e),s=Object(i.Z)(a);return Object(r.Lb)(e)&&!s?Object(H.a)(Object(i.s)(t,e),1024)?getLang("mail_unfollow_channel"):Object(i.A)(a)?getLang("mail_leave_chat"):getLang("mail_delete"):getLang("mail_delete")},black:1,[Object(r.Mb)(t)?"center":"needLeft"]:!0,shift:Object(r.Mb)(t)?[-4,10]:[0,10],toup:Qe(t,n.getBoundingClientRect().top),zIndex:1})},_=function(e,n){Object(q.c)(n,{text:getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:Qe(t,n.getBoundingClientRect().top)})},p=De.bind(null,t,e),h=Be.bind(null,t,e),f=Ne.bind(null,t,e,u),v={idFn:e=>function(e,t){return t.message?t.message.messageId:Object(i.R)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}(t,e),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:Me.bind(null,t),more:de.bind(null,t,u),onScroll:!!Object(r.Mb)(t)&&(()=>{(bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&V.a.safari?addClass(s,"im-page--header_static"):removeClass(s,"im-page--header_static")}),onRenderFn:ze.bind(null,t)},O=A(e,Object(b.a)({limit:40,offset:0,nativeScroll:!!Object(r.Mb)(t),height:64,elements:Xe(t)}),()=>v);V.a.mozilla&&We();var j=ue.bind(null,n,u,t,O),y=oe.bind(null,t,e,O),w=Le.bind(null,t,e,u,n),C=Ie.bind(null,n,t,e,O),k=Te.bind(null,t,n),S=Object(c.a)({handlers:(i,s)=>{s(e,"click","_im_dialog_close",C),s(e,"click","_im_dialog_markre",f),s(e,"click","_im_dialog_star",h),s(e,"click","_im_dialog",j),s(e,"click",r.B,y),s(e,"mouseover","_im_dialog_close",g),s(e,"mouseover","_im_dialog_markre",_),s(e,"click",r.s,()=>{Object(a.fc)(cur.imDb),qe(t,O,n)}),s(e,"click",r.J,k),s(e,"mouseover","_im_dialog_star",p),s(e,"click","_im_dialog_daction",w),s(e,"click","_im_peer_target",Ve),s(e,"click","_convoRecommendAction",e=>function(e,t){var n=e.target.closest("._convoRecommendAction").dataset.action,a=Object(b.b)(t).externalAuthParams;switch(n){case"invite_by_phone_number":We().then(()=>{window.FriendsSearch.inviteBox()});break;case"import_ok":if(!a)return;We().then(()=>{window.FriendsSearch.checkOAuth(a.lngCode,a.state,4)});break;case"import_gmail":if(!a)return;We().then(()=>{window.FriendsSearch.checkOAuth(a.lngCode,a.state,1)})}}(e,t)),Object(r.Nb)(t)&&t.get().is_peer_profile_enabled&&(s(e,"mouseover","_im_peer_tags_extra",e=>Object(o.h)(e,t)),s(e,"click","_im_dialog_peer_tag",e=>Object(o.e)(e,t))),i(e,"mouseover",Object(l.o)(O.unhoverElements.bind(O,ie),100))}});return m(e,u,O,n,S)}n("KKXr"),n("hhXQ");var Ye,Je,Ze,et,tt,nt,at,rt,it,st,ot,lt,ct,dt,ut,mt=n("O8ze"),gt=n("hC3G"),_t=n("ftTi"),pt=n("/eGY"),bt=n("RQ7Z"),ht=n("XLJO"),ft=(n("/8Fb"),n("ZVxX")),vt=n("EasH"),Ot=browser.msie&&intval(browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function jt(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var yt=!1,wt=!1,Ct=100;function kt(e){var t=e.get().peer;Object(r.Sb)(e,t)&&!Object(r.Jb)(e)&&Date.now()-(Object(r.zb)(e,t).lastTyping||0)>1e3*a.b&&e.set(a.zc.bind(null,t))}function St(e){if(!wt){wt=!0,Object(r.sc)(nt);var t={peer:it.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise((t,n)=>{var a=e.getFormData(),r=new Ot;r.onload=r.onerror=function(e){var a=e.currentTarget.response;200==this.status&&a.length>0&&"{"==a[0]?(a=JSON.parse(a),t(a)):n()},r.open("POST",ut.upload_url,!0),r.send(a)})})(e).then(e=>e.file?new Promise((n,a)=>{ajax.post("/docs.php",extend({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,a)=>{Lt(),lt([["doc",e+"_"+a,"audiomsg"]],{},t.peer),Nt(),n()},onFail:function(e){a(e)},progress:null})}):Promise.reject()).then(()=>{Object(r.Nd)(nt),wt=!1}).catch(()=>{wt=!1,Object(r.Nd)(nt),Object(vt.d)(getLang("global_error"),getLang("mail_audio_message_upload_error"))})}}function Et(){dt(),Je.innerHTML=jt(yt.duration),yt.duration>=600&&At()}function It(e){e.set(a.n).then(Bt)}function Tt(){dt(),stManager.add(["voice_message_player.js","speech.js"],(function(){yt||(yt=Speech.newRecorder(),addEvent(yt,"progress",Et)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),yt.record().then(()=>{var e;e=it,ut.isRecording=!0,cancelStackPush("audio_message_cancel",It.bind(null,e)),hideProgress(geByClass1("im-audio-message-send-wrapper",Ye)),Je.innerHTML="0:00",addClass(Ye,"im-audio-message_recording"),removeClass(Ye,"im-audio-message_recorded"),function(){Ye&&Ye.classList&&Ye.classList.remove("im-audio-message-input--hidden");geByClass1("_im_chat_input_parent",rt).classList.add("im-chat-input--hidden")}(),(ot=Speech.createVisualization("wave",yt.source,Ze)).start();var t=Ze.getBoundingClientRect();Ct=(t.right-t.left)/3}).catch(e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}Object(vt.d)(getLang("global_error"),getLang(t)),console.error(e)})}))}function Mt(){yt&&yt.stop(),ot&&(ot.destroy(),ot=null)}function Lt(){ut.isRecording=!1,cancelStackFilter("audio_message_cancel")}function xt(){Pt(),St(yt)}function Pt(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),removeEvent(yt,"finish",Pt),removeEvent(yt,"finish",xt),e=URL.createObjectURL(yt.buffer),domData(st,"duration",yt.duration),domData(st,"ogg",e),domData(st,"mp3",e),geByClass1("audio-msg-track--duration",st).innerHTML=jt(yt.duration),geByClass1("audio-msg-track--wave-wrapper",st).innerHTML=AudioMessagePlayer.getWave(yt.wave,Ct),removeClass(Ye,"im-audio-message_recording"),addClass(Ye,"im-audio-message_recorded")}function Bt(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Lt(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),removeEvent(yt,"finish",Pt),removeEvent(yt,"finish",xt),Mt(),Nt(),e&&ct()}function Dt(){yt.isRecording?(addEvent(yt,"finish",xt),removeEvent(yt,"finish",Pt),Mt()):St(yt)}function At(){addEvent(yt,"finish",Pt),removeEvent(yt,"finish",xt),Mt()}function Nt(){removeClass(Ye,"im-audio-message_recorded"),removeClass(Ye,"im-audio-message_recording"),Ye&&Ye.classList&&Ye.classList.add("im-audio-message-input--hidden"),geByClass1("_im_chat_input_parent",rt).classList.remove("im-chat-input--hidden")}function Rt(){ge("audiomsg_record"),st=ge("audiomsg_player"),rt=geByClass1("_im_chat_input_w"),Ye=geByClass1("im-audio-message-input",rt),Je=geByClass1("audio-msg-track--duration",Ye),Ze=geByClass1("audio-msg-track--wave",Ye),tt=geByClass1("im-audio-message--cancel-btn",Ye),nt=geByClass1("_im_audio_send",Ye),at=geByClass1("audio-msg-track--btn",Ye),geByClass1("im-chat-input--text",rt);var e=geByClass1("im-chat-input--textarea",rt);addClass(e,"_voice_field_wrap"),addEvent(et,"click",Tt),addEvent(tt,"click",Bt),addEvent(nt,"click",Dt),addEvent(at,"click",At)}function Ft(){!function(){yt&&removeEvent(yt,"progress",Et);removeEvent(et,"click",Tt),removeEvent(tt,"click",Bt),removeEvent(nt,"click",Dt),removeEvent(at,"click",At)}(),st=Ye=Je=Ze=et=tt=nt=at=null}function Ht(e,t,n){return{cancelRecording:Bt,start:function(){Tt()},unmount(){Bt(!1),Ft()}}}function qt(e,t,n,i,s){return it=t,ut=t.get().audio_msg,dt=kt.bind(null,t),lt=n,ct=s,Object(ft.a)(),Object(r.jb)().then(e=>{var n=e.length>0;n?(Rt(),i()):setCookie("remixvoice","0",7),t.set(a.Nc.bind(null,n))}).catch(e=>{throw setCookie("remixvoice","0",7),e}),(0,Object(c.b)(Ht).bindMutations)(e,t,n)}var Ut=n("q1tI"),Kt=n.n(Ut),zt=n("i8i4"),Vt=n.n(zt),Wt=n("1Ot2"),Gt=n("Jbbb"),Xt=n("ZxpX"),Qt=n("BiHW"),$t=n("N4ZS"),Yt=n("Egk5");n("17x9");function Jt(){return(Jt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Zt(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class en extends Ut.Component{constructor(){super(...arguments),this.onLinkClick=e=>{var t=this.props.action.link;if(/^https:\/\/(.+\.)?vk\.com\/gifts580392144\?act=send&ref=[^&]+$/.test(t))return Object(vt.b)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(Yt.c)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,n=e.sendMessage,a=e.appHash,r=e.keyboardAuthorId,i=e.store;return Object(pt.g)(t,n,i,{appHash:a,keyboardAuthorId:r})}}render(){var e=this.props,t=e.action,n=(e.sendMessage,e.appHash,e.keyboardAuthorId,Zt(e,["action","sendMessage","appHash","keyboardAuthorId"])),a=Object(pt.e)(this.props),r=Object(pt.f)(this.props),i=t.type,s=Ut.createElement(Qt.a,Jt({wide:!0,overflow:!0},n,{type:t.type,appearance:a,className:"BotButton BotButton--"+i,onClick:this.onButtonClick}),Ut.createElement("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:r}}));switch(t.type){case pt.b:return this.wrapLinkButton(s);default:return s}}wrapLinkButton(e){var t=this.props.action,n=Object($t.a)(t.link,!0);return Ut.createElement("a",{href:n,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick},e)}}en.defaultProps={color:pt.a};var tn=en;class nn extends Ut.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,n=e.get(),a=Object(i.g)(e),r=n.keyboard_app_hash;return a&&a.buttons?Ut.createElement("div",{className:Object(Xt.a)("Keyboard",{"Keyboard--hidden":a.hide})},Ut.createElement(Wt.a,{className:"Keyboard__scroll-wrapper"},Ut.createElement("div",{className:"Keyboard__container"},a.buttons.map((n,i)=>Ut.createElement("div",{key:"row-"+i,className:"Keyboard__row"},n.map((i,s)=>Ut.createElement("div",{className:"Keyboard__button",key:"cell-"+s,style:{width:nn.getButtonWidth(n.length)}},Ut.createElement(tn,{sendMessage:t,appHash:r,keyboardAuthorId:a.author_id,action:i.action,type:i.action.type,color:i.color,store:e})))))))):null}}var an=Object(Gt.a)(nn);function rn(){return document.getElementById("_im_keyboard_container")}function sn(e,t,n){return{init(){return new Promise(e=>{this.isMounted=!0,function(e,t,n){var a=rn();if(a){var r=Ut.createElement(Gt.b,{value:e},Ut.createElement(an,{send:t}));zt.render(r,a,n)}}(t,n,e)})},toggle:(e,n,r)=>t.set(a.Zc.bind(null,e,n,r)),unmount(){var t=rn();t&&this.isMounted&&zt.unmountComponentAtNode(t),this.isMounted=!1,Object(c.c)(e)}}}var on=n("LYnS"),ln=n("nAFc"),cn=n("fD+e").default,dn=n("m5nf").default,un=n("m5nf"),mn=un.MAIN,gn=un.EDIT;function _n(e,t){return Object(on.a)().reduce((function(t,n){return t.replace(new RegExp("({"+n.id+"})","gi"),n.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function pn(e,t,n,r,s){var o;return{closeSettingsPopup:function(){o&&o.hide()},showSettingsPopup:function(e){var n=this,a={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var a=document.getElementById("TemplatesSettings");a&&zt.render(Ut.createElement(Gt.b,{value:t},Ut.createElement(dn,{popup:o,section:e,getTemplates:function(){return Object(i.u)(t)},saveTemplate:n.saveTemplate.bind(n),deleteTemplate:n.deleteTemplate.bind(n),closePopup:n.closeSettingsPopup.bind(n)})),a),requestAnimationFrame((function(){return o.updateBoxCoords()}))}};(o=new vt.a(a).content('<div id="TemplatesSettings"></div>')).show()},applyTemplate:function(e){var n=Object(i.u)(t).find((function(t){return t.id===e}));Object(mt.d)(),r(_n(t,Object(ln.c)(n.text)))},getPreparedTemplates:function(){return Object(i.u)(t).map((function(e){return Object.assign({},e,{name:e.name,text:_n(t,e.text)})}))},saveTemplate:function(e){var n=Object(ln.a)(e.name),r=Object(ln.a)(e.text);return t.set(e.id?a.Ad.bind(null,e.id,n,r):a.z.bind(null,n,r))},deleteTemplate:function(e){return t.set(a.C.bind(null,e))},isNeedRenderTemplates:function(){var e=Object(_t.e)(t);if(!e)return!1;if(!Object(i.E)(t))return!1;var n=Object(H.b)(t);return(!n||!Object(i.z)(n))&&!Object(i.D)(t,e)},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),s(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}var bn=n("DM26");function hn(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function fn(e,t){var n=t.queues[e].currEv;return n?(t.queues[e].errored.push(n),hn(e,t)):Promise.resolve(t)}function vn(e,t,n){return n.queues[e]?(n.queues[e].errored=t?[]:n.queues[e].errored.concat(n.queues[e].evs),n.queues[e].evs=[],hn(e,n)):Promise.resolve(n)}function On(e,t,n,a){var r=a.get().queues[e];if(r&&!r.currEv&&r.evs.length>0&&!r.pause){var i=On.bind(null,e,t,n,a),s=r.evs.shift();r.currEv=s,t(e,s).then(()=>{a.get().opts.waitCommit||a.set(hn.bind(null,e))}).then(i).catch(t=>a.set(fn.bind(null,e)).then(()=>{n(e,function(e,t){var n=Cn(e,t.get()).errored;return n.length>0&&n[n.length-1]}(e,a),t)}).then(i))}}function jn(e,t,n){var a=n.queues[e];return a.errored.filter(e=>e.mess.messageId===t).forEach(e=>{e.failed=!1,a.evs.push(e)}),a.errored=a.errored.filter(e=>e.mess.messageId!==t),Promise.resolve(n)}function yn(e){var t=Date.now();return Object.keys(e.queues).forEach(n=>wn(n,e,t,18e5)),Promise.resolve(e)}function wn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.queues[e],i=[];return r.errored.forEach(e=>{e.ts>=n-a?(e.failed=!1,r.evs.push(e)):i.push(e)}),r.errored=i,Promise.resolve(t)}function Cn(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function kn(e,t,n){return Cn(e,n).pause=t,Promise.resolve(n)}function Sn(e,t,n){return t.ts=Date.now(),Cn(e,n).evs.push(t),Promise.resolve(n)}function En(e){Object.keys(e.get().queues).forEach(t=>{e.set(fn.bind(null,t)),e.set(vn.bind(null,t,!1))})}function In(e,t,n){var a=Object(b.a)({queues:{},debug:n&&n.debug,opts:extend({},n)},n);return n&&n.store?(a.setState(function(e){for(var t={},n=Object.keys(e.queues),a=n.length,r=0;r<a;r++){var i=n[r],s=e.queues[i];(s.currEv||s.evs.length||s.errored.length)&&(t[i]=s)}return{queues:t,opts:e.opts}}(a.get())),En(a)):En(a),{pushMessage:(n,r)=>a.set(Sn.bind(null,n,r)).then(a=>{On(n,e,t,a)}),resend(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a.set(jn.bind(null,n,r)).then(()=>{var i=a.get().queues[n].evs.filter(e=>e.mess.messageId===r)[0];return On(n,e,t,a),i})},resendAll:()=>a.set(yn).then(()=>{Object.keys(a.get().queues).forEach(n=>{On(n,e,t,a)})}),resendPeer:n=>a.set(wn.bind(null,n)).then(()=>{On(n,e,t,a)}),reset:n=>a.set(vn.bind(null,n,!0)).then(a=>{On(n,e,t,a)}),setErrored:(e,t)=>a.set(n=>(Cn(e,n).errored=t,Promise.resolve(n))),pause(e){a.set(kn.bind(null,e,!0))},isPaused:e=>!!Cn(e,a.get()).pause,complete(n,r){var i=a.get();i.queues[n].currEv&&i.queues[n].currEv.rid===r&&a.set(hn.bind(null,n)).then(()=>{On(n,e,t,a)})},resume(n){a.set(kn.bind(null,n,!1)).then(Object(bn.c)(.1)).then(()=>{On(n,e,t,a)})},inspectQueue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!a.get().queues[e])return[];var n=a.get().queues[e];return(t&&n.currEv?[n.currEv]:[]).concat(n.evs.slice()).concat(n.errored.slice().map(e=>extend({},e,{failed:!0}))).sort((e,t)=>e.ts-t.ts)}}}var Tn=n("hOuX"),Mn=n("4+be"),Ln=n("QGEU"),xn=(n("Oyvg"),n("rCUf")),Pn="jpg jpeg png gif heic heif".split(" "),Bn=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function Dn(e){var t=Pn.slice(0,Pn.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+Pn.join(",."):"mask"===e?Pn.join("|"):""}function An(e,t,n){var a=void 0!==t.ind?t.ind:t,r=t.fileName?a+"_"+t.fileName:t;if(re("upload"+r+"_progress_wrap"),e().unchoose(r),!geByClass1("popup_box_container")){var i=Object(Mn.d)("mail_add_doc_error");"wrong_music_file"===n?i=Object(Mn.d)("mail_upload_music_fail"):"wrong_arch_file"===n||"wrong_arch_mp3_file"===n?i=Object(Mn.d)("mail_upload_arch_fail"):"photo"===Upload.options[a].file_name?i=Object(Mn.d)("mail_add_photo_error"):"video_file"===Upload.options[a].file_name&&(i=Object(Mn.d)("video_upload_error")),setTimeout(Object(vt.d)({title:Object(Mn.d)("global_error")},i).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+a)||{}).action}),Upload.embed(a)}function Nn(e){var t=void 0!==e.ind?e.ind:e,n=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),a=n?t+"_"+n:e,r=ge("upload"+a+"_progress_wrap");return r&&hide(geByClass1("progress_x",r)),a}function Rn(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var n="^("+Dn("mask")+")";return[].slice.call(t.items).every(e=>{var t=e.type.split("/");return new RegExp(n,"i").test(t[1])})?"photo":[].slice.call(t.items).every(e=>"video"===e.type.split("/")[0]||~Bn.indexOf(e.type))?"video":"doc"}function Fn(e){var t=geByClass1("_im_upload_dropbox"),n=geByClass1("im-page--chat-header").getBoundingClientRect(),a=geByClass1("im-chat-input").getBoundingClientRect();(n.width<10||a.bottom-n.bottom<10)&&(e="none"),t.style.top=n.bottom+"px",t.style.left=n.left+1+"px",t.style.width=n.width-2+"px",t.style.height=a.bottom-n.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function Hn(){geByClass1("_im_upload_dropbox").classList.remove("im-dropbox--visible")}function qn(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function Un(e,t,n,a){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),a().reHeight(n)}function Kn(e,t,n,a,r){var i=t.get().upload_opts,s=geByClass1("_im_upload_photo",r),o=geByClass1("_im_drop_photo",r);return Upload.init(s,i.url,i.params,{accept:Dn("accept"),file_name:"photo",file_size_limit:26214400,file_types:Dn("types"),file_match:i.opts.ext_re,lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:o,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(a,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var r=window.parseJSON(a);r.photos?function(e,t,n,a){var r=Nn(e);ajax.post("al_photos.php",extend({act:"choose_uploaded"},t),{onDone:function(e,t){a().choose("photo",e,extend(t,{upload_ind:r}))},onFail:An.bind(null,a,e)})}(e,r,0,n):Un(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("photo",r,qn(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_photo_fails",1,i.opts.server,t),An(n,e,t)},onDragEnter(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Fn(Rn(n,e.dataTransfer))},onDragOut(){Hn()},onDrop(){Hn()}})}function zn(e,t,n,a){var r=t.get().upload_doc_opts,i=geByClass1("_im_upload_doc",a),s=geByClass1("_im_drop_doc",a);return Upload.init(i,r.url,r.params,{file_name:"file",file_size_limit:1024*(parseInt(r.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:r.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:r.opts.server,error:r.opts.default_error,error_hash:r.opts.error_hash,dropbox:s,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var i=window.parseJSON(a);i.file?function(e,t,n,a){var r=Nn(e),i={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};n.opts.imhash&&(i=extend(i,{from_place:"from_gim",imhash:n.opts.imhash})),ajax.post("docs.php",extend(i,t),{onDone:function(e,t,n){a().choose("doc",e+"_"+t,extend(n,{upload_ind:r}))},onFail:An.bind(null,a,e)})}(e,i,r,n):Un(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("doc",r,qn(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_doc_fails",1,r.opts.server,t),An(n,e,t)}})}function Vn(e,t,n){removeEvent(bodyNode,"dragover dragenter");var r=geByClass1("_im_upload_dropbox"),i=zn(0,t,n,r),s=function(e,t,n,r,i){var s=t.get().upload_video_params;if(s){var o=geByClass1("_im_upload_video",i),l=geByClass1("_im_drop_video",i);return s.options.visible_dropbox=!1,Object(xn.b)(o,l,s,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,r){var i=window.parseJSON(r);i.video_id?Object(xn.d)(e,i,t.get().textMediaSelector,(e,n)=>{var r=document.querySelector('[data-video="'+n+'"]'),i=e.editable.sizes.x[0]||e.thumb;if(r&&i){r.style.backgroundImage=`url(${i})`;var s=gpeByClass("_im_mess",r);"im"===cur.module&&s&&Object(a.Bd)(t,s)}}):Un(e,r,t,n)},onUploadProgress:function(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("video",r,qn(e,t,a))},onUploadError:function(e,t){statlogsValueEvent("upload_video_fails",1,s.options.server,t),An(n,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(r,e)},onDragEnter:function(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Fn(Rn(n,e.dataTransfer))},onDragOut:function(){Hn()},onDrop:function(){Hn()}})}}(0,t,n,i,r),o=Kn(0,t,n,s,r);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var l=Object(c.a)({handlers:e=>{var t=ge("im_full_upload");e(t,"change",(function a(r){if(window.Upload&&r.target.files){if(n().canAddMedia()){var i=Array.from(r.target.files),d=i.filter(e=>Upload.checkFileType(e.name,Dn("types"))),u=i.filter(e=>Upload.checkFileType(e.name,Object(xn.c)("types")));Upload.onFileApiSend(o,d),Upload.onFileApiSend(s,u)}else Object(vt.d)(Object(Mn.d)("global_error"),Object(Mn.d)("global_error"));Object(c.c)(l);var m=t.cloneNode();m.value="",t.parentNode.replaceChild(m,t),e(t=m,"change",a)}}))}});return{paste(e){Upload.onFileApiSend(o,e)},unmount(){Object(c.c)(l),Upload.deinit(o),Upload.deinit(s),Upload.deinit(i)}}}var Wn=n("wSs/"),Gn=n("rjmT"),Xn=n("V1lx");function Qn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $n(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Yn(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Jn(e){return e.map(e=>({id:e[1],type:e[0],kind:e[2]||null}))}function Zn(e,t,n,a,s,o){var l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(Ta(t,a))return Promise.resolve(!1);var c=oa(a),d=Object(i.s)(a,t);c.getBoundAttach(n.message)&&(n.message=""),n.share_url=c.getShareUrl(),n.cancelled_shares=c.getCancelledShares();var u=Object(Tn.a)(),m={peerId:t,messageId:"rid"+u,flags:N.p,date:intval(Date.now()/1e3)-a.get().timeshift,subject:"",text:Object(r.Zc)(clean(n.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:a.get().gid?vk.id:null},type:N.a,attaches:Jn(n.attaches),minorSortId:d.minor_sort_id};return n.rid=u,n.mess=m,e(t,n),a.get().longpoll.push([m]),l&&o().clearText(t,a),s().newMessage(a),Promise.resolve(!0)}function ea(e,t,n,a,r,i,s){var o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];o||(o=e.get().peer);var l=oa(e),c=ta(l,s),d=c?l.dData.attaches.map(e=>[e.type,e.id]):[],u={message:"",attaches:[].concat(d,i)};s&&extend(u,s),na(e,t,!1).then(()=>Zn(n,o,u,e,t,a,!1).then(n=>(c&&fa(e,r,t),Promise.resolve(n)))).catch(t=>{debugLog(t),sa(e,r)})}function ta(e,t){var n=e.dData,a=t&&t.sticker_referrer,r=a&&0===a.indexOf("suggestion"),i=t&&t.is_hintach_item;return(!n.txt.trim()||r||i)&&0===n.attaches.filter(e=>"reply"!==e.type).length}function na(e,t,n){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(a.r.bind(null,e.get().peer,!1,!1)).then(()=>e.set(a.ub.bind(null,e.get().peer,!0,-1,!1))).then(()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),n))):Promise.resolve(n)}function aa(e,t,n){var r=!!intval(domData(n,"val"));r!==cur.ctrl_submit&&(cur.ctrl_submit=r,e.set(a.s.bind(null,r)))}function ra(e,t,n,r){return!e.get().delayed_ts&&setTimeout(()=>{e.set(a.Hc.bind(null,!1,!1)).then(()=>{n(...r)})},t)}function ia(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(Mn.d)("mail_send_error"),t=Object(Mn.d)("global_error");Object(vt.d)({title:t},e,Object(Mn.d)("mail_ok"),()=>{nav.reload({force:!0})})}function sa(e,t){document.activeElement&&document.activeElement.blur(),ia();var n=geByClass1("_im_send",t);return e.set(a.cd.bind(null,!0)).then(()=>{Object(r.sc)(n)})}function oa(e){return e.get().tfdraft||new Gn.a}function la(e,t,n,s,o,c){var d=Object(_t.e)(e),u=Object(i.g)(e)||{},m=u.one_time,g=void 0!==m&&m,_=geByClass1("_im_send",s);return Promise.resolve().then(()=>{if(Object(i.T)(e)){if(Object(a.Z)(e.get())||!Object(r.Sb)(e,e.get().peer)){var s=ra(e,2e3,la,Object(l.q)(arguments));return e.set(a.Hc.bind(null,!0,s)).then(()=>{Object(r.sc)(_)})}return clearTimeout(e.get().delayed_ts),e.set(a.Hc.bind(null,!1,!1)).then(()=>Object(r.Nd)(_)).then(na.bind(null,e,t)).then(()=>{var a=c.keyboardAuthorId,i=c.action||{},s=i.attaches||[],l=Object(ln.a)(i.payload||""),u=Object(ln.a)(i.label||"");Object(r.Lb)(d)&&(u=`@${Object(F.c)(e,a).link.slice(1)} ${u}`);return Object(R.c)("message_send_from_keyboard",0,e.get().id,d,a),Zn(n,d,{message:u,attaches:s,payload:l},e,t,o,!1)}).then(()=>g?e.set(a.B.bind(null,d)):Promise.resolve()).then(()=>o().fixKeyboard())}}).catch(t=>{debugLog(t),sa(e,s)})}function ca(e,t,n,s,o,c){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return Promise.resolve().then(()=>{var m=geByClass1("_im_send",s);if(!Object(i.T)(e))return!1;if(Object(a.Z)(e.get())||!Object(r.Sb)(e,e.get().peer)){var g=ra(e,2e3,ca,Object(l.q)(arguments));return e.set(a.Hc.bind(null,!0,g)).then(()=>{Object(r.sc)(m)})}clearTimeout(e.get().delayed_ts),o().saveText(e);var _=!1,p=oa(e),b=p.dData.attaches.map(e=>{if("poll"==e.type){var t=c.pollData();return t||(_=!0),[e.type,e.id,t]}return[e.type,e.id]}).concat(u);if(_)return!1;var h=e.set(a.Hc.bind(null,!1,!1)).then(()=>{Object(r.Nd)(m)}),f=Object(_t.e)(e);return h.then(()=>{var a=p.dData.txt,i=t().getEditingMessage();if(i||a||b.length){if(i)return a||b.length&&!p.hasOnlyReplies(i)?Object(r.Yb)(a)?void Object(vt.d)(Object(Mn.d)("global_error"),Object(Mn.d)("mail_err_edit_too_long")):(t().cancelEditing(),void(Object(Wn.e)(e,i,p)&&(Object(Wn.d)(e,i,a,b,p.getShareUrl(),p.getCancelledShares()),t().sendEditMessage(e,i),e.get().longpoll.push([Object(d.d)(i)])))):void da(e,t,s,i.messageId);var l=Object(r.Ed)(a,b).map(a=>Zn(n,f,{message:a.msgText||"",attaches:a.attaches||[]},e,t,o));return Promise.all(l)}}).then(na.bind(null,e,t))}).catch(t=>{debugLog(t),sa(e,s)})}function da(e,t,n,r){var i=e.get(),s=i.peer,o=Object(vt.d)({title:Object(Mn.d)("mail_dialog_msg_delete_title"),dark:1},Object(Mn.d)("mail_dialog_msg_delete_for_all"),Object(Mn.d)("mail_delete"),(function(e){Object(a.Xb)([r],s,null,"deleteforall",i),o.hide(),t().cancelEditing()}),Object(Mn.d)("global_cancel"),(function(){o.hide(),pa(geByClass1("_im_text",n))}))}function ua(e,t,n){return e.set(a.F.bind(null,t,n,{}))}function ma(e,t,n,a){e.get().longpoll.push([Object(d.e)(t,n.mess,a)])}function ga(e,t,n,s,o,l,c,d,u){var m,g=Object(G.a)(Ma.bind(null,e,n),500);var _=Emoji.init(geByClass1("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Da(e,t).then(e=>e&&s([])),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(n,s){var o=e.get().peer,l=Emoji.val(s);Object(r.fc)(o)||Ta(o,e)||oa(e).dData.txt==l||!l||function(e){var t=e.get().peer;Object(r.Sb)(e,t)&&!Object(i.w)(e)&&Date.now()-(Object(i.s)(e,t).lastTyping||0)>1e3*a.b&&e.set(a.Ac.bind(null,t))}(e),Aa(e,t,l),Ra(e,t,l),g(s);var c=t.offsetHeight;if(m&&m!==c){var u=d().updateScroll();d().scrollFix(e,e.get().peer,u)}m=c},onStickerSend:(e,t,n)=>o([["sticker",e,n]],{sticker_referrer:t}),onHintachSend:(e,t)=>l([[e,t]],{is_hintach_item:!0}),uploadActions:c,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){u().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(_),e.setState({emojiOptId:_}),_}function _a(e,t,n){var a=Emoji.val(geByClass1("_im_text",t));Object(i.w)(e)&&""!==a||Da(e,t).then(t=>{var r=intval(domData(n.target,"tttype"));(2===r&&!0!==t||1===r&&!0===t||3!==r&&""===a)&&window.tooltips&&tooltips.destroy(n.target,{fasthide:!0});var s=oa(e).dData.attaches.length>0;if(Object(i.w)(e)&&""===a&&!s)return domData(n.target,"tttype",3),Object(q.c)(n.target,{text:Object(Mn.d)("mail_delete_for_all"),black:!0,force:3!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return domData(n.target,"tttype",1),Object(q.c)(n.target,{text:Object(Mn.d)("mail_added_audiomsg"),black:!0,force:1!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});domData(n.target,"tttype",2);var o=e.get().ctrl_submit?1:0;return Object(q.c)(n.target,{text:getTemplate("ctrl_submit_hint",{enter_on:o?"":"on",ctrl_on:o?"on":""}),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==r,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:Object(l.q)(geByClass("_im_submit_btn")),val:o}}})})}function pa(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function ba(e,t,n,a){var o=e.getFwdRaw(),l=t.querySelector("._im_media_fwd"),c=t.parentNode.querySelector("._im_replied_content");if(!(Object(i.g)(a)||{}).hide&&o&&n.toggleKeyboard(!0),l.innerHTML="",c.innerHTML="",o){var d=function(e,t){if(e.get().isEditing){var n=Object(r.wb)(e);return n&&Object(s.e)(n)}return"reply"===t.type}(a,o),u=d?c:l,m=o.object;u.innerHTML=d?ha(m):function(e,t,n,a){if(n.object&&n.object.authorName){var i=Object(r.Tc)(0,"",a.text,!0,Object(K.b)(a.kludges,0));return getTemplate("im_attach_mess",{messages:i,text:a.authorName,date:getSmDate(a.date,e.get().timeshift),modifier:"im-fwd_msg"})}return getTemplate("im_attach_mess",{messages:Object(Mn.d)("mail_title_X_msgs",t.getFwdCount()),text:Object(Mn.d)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(a,e,o,m)}}function ha(e){var t=Object(r.Tc)(0,"",e.text,!0,Object(K.b)(e.kludges,0));return getTemplate("im_replied_message",{authorName:e.authorName,text:t})}function fa(e,t,n){return e.set(a.M.bind(null,null,oa(e),!1)).then(()=>{var a=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content"),i=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");r&&r.children.length&&(r.innerHTML="",ja(e,n)),i&&i.children.length&&(i.innerHTML="",ja(e,n)),a&&a.children.length&&(a.innerHTML="",ja(e,n)),Aa(e,t)})}function va(e,t,n){var r=Object(_t.e)(e);e.set(a.f.bind(null,r)).then(()=>{Ba(e,r,t),n()}).catch(()=>ia())}function Oa(e,t,n){var i=Object(_t.e)(e);e.set(a.Qb.bind(null,i)).then(()=>{Object(r.Mb)(e)&&t(e),n(e,i),i===e.get().peer&&e.get().longpoll.push([Object(d.g)()])}).catch(()=>ia())}function ja(e,t){var n=t().updateScroll();t().scrollFix(e,e.get().peer,n)}function ya(e,t,n,r){var i=e.get().peer,s=inArray(i,e.get().mutedPeers);e.set(a.bd.bind(null,i,!s,-1)).then(n().updateState.bind(null,i)),cancelEvent(r)}function wa(e,t,n,r){var i=e.get().peer;e.set(a.mc.bind(null,i)).then(e=>e.set(a.U.bind(null,i))).then(n().updateChatTopic.bind(null,i)),cancelEvent(r)}function Ca(e,t,n,a,s,o,l,c){if("close"!==l&&"open"!==l&&"hide"!==l)throw new Error(`Action "${l}" not found`);var d=e.get(),u=Object(i.g)(e);(Object(r.Nb)(e)||!u||d.isEditing)&&(l="hide");var m="close"===l||"hide"===l,g=Promise.resolve();m||n.isMounted||(g=n.init());var _=!u&&"open"!==l;return g.then(()=>(toggleClass(t,"im-chat-input_open-keyboard",!m),toggleClass(t,"im-chat-input_close-keyboard",m&&"hide"!==l),toggleClass(a,"im_chat-input--keyboard-button_hidden","hide"===l),n.toggle(d.peer,m,o))).then(()=>{if(!_||c){var t=s().updateScroll();return s().scrollFix(e,d.peer,t)}})}function ka(e,t){if(Object(i.w)(e))return!1;var n=e.get();if(Object(r.Nb)(e))return!1;if(!Object(H.b)(e).moneyTransferAvail)return!1;if(Object(r.Ob)(t))return n.moneyTransferCommAvail;if(Object(r.nc)(t)){var a=inArray(t,n.moneyTransferExcept);return t!=vk.id&&!a&&!Object(r.Pb)(t)}return!1}function Sa(e,t){return!Object(i.w)(e)&&(!!e.get().moneyRequestAvail&&(!!Object(H.b)(e).moneyRequestAvail&&(!(!Object(r.Ob)(t)&&!Object(r.Lb)(t))||!!Object(r.nc)(t)&&(t!=vk.id&&!Object(r.Pb)(t)))))}function Ea(e,t,n,a,s,o,l,d,u,m,g,_,p,b,h,f){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[Object(_t.e)(e)])},toggleKeyboard(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!Object(i.g)(e).hide,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ca(e,a,_,g,o,n,t?"close":"open")},initKeyboard(){if(!e.get().peer||!Object(i.g)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[Object(_t.e)(e)];return Ca(e,a,_,g,o,!0,t?"close":"open")},fixKeyboard(){var t,n=Object(i.g)(e);return t=n?n.hide?"close":"open":"hide",Ca(e,a,_,g,o,!0,t,!0)},hideKeyboard:()=>Ca(e,a,_,g,o,!1,"hide"),restoreDraft(e,s,l){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1}));var c=e.get().peer,d={gift:Object(r.Ub)(e,c)&&!Object(i.w)(e),money:Object(r.ac)(e,c)&&!Object(i.w)(e),poll:Object(r.Lb)(c)},u=geByClass1("ms_items_more",a);Object.entries(d).forEach(e=>{var t=Qn(e,2),n=t[0],a=t[1],r=geByClass1("ms_item_"+n,u);toggleClass(r,"ms_item--hidden",!a)});var m={im:!0,fromId:-Object(i.i)(e)||vk.id,peer:c,moneyTransfer:{request:Sa(e,c),send:ka(e,c)}},g=e.get().emojiOptId;if(void 0===g?e.setState({suggestionsConfig:m}):Emoji.setSuggestionsConfig(g,m),Object(r.fc)(c))return Promise.resolve();var _=oa(e);return Emoji.val(n)!==_.dData.txt?(!function(e,t){Emoji.val(e,clean(t)),pa(e)}(n,_.dData.txt),Ra(e,a,_.dData.txt)):pa(n),_.prepareObjects(e.get().gid,s&&s.messageId).then(()=>{if(!Ba(e,c,n)&&c==e.get().peer){for(var r=_.dData.attaches,i=0;i<r.length;i++)t.chooseMedia(r[i].type,r[i].id,r[i].object||{});if(ba(_,a,this,e),l){var s=o().updateScroll();o().scrollFix(e,c,s)}Aa(e,a,_.dData.txt)}})},sendMessage(){s([])},sendMessageFromKeyboard(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return la.call(null,e,o,b,a,...n)},choose(e,n,a){t.chooseMedia(e,n,a)},updateChosenMedia(e,n,a){t.updateChosenMedia(e,n,a)},canAddMedia:()=>!t.hasRestrictingAttach()&&!Ta(e.get().peer,e),isEmpty:e=>!trim(Emoji.val(n))&&!oa(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,n,a){t.showMediaProgress(e,n,a)},updateState(e){this.restoreKeyboard(),Ba(e,e.get().peer,n)},focusOn(e){Emoji.editableFocus(n,!1,!0)},setDraft(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Object(i.s)(e,e.get().peer);Object(H.a)(a,1024)&&!e.get().gid||(p&&p.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,o().getEditingMessage(),n))},clearText(e,r){oa(r).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(n,""),fa(r,a,o);var i=o().updateScroll();o().scrollFix(r,r.get().peer,i)},attachMessages(e,t){if(e.get().peer===t){ba(oa(e),a,this,e);var n=o().updateScroll();o().scrollFix(e,t,n),Aa(e,a)}},detachMessages(t){var n=oa(e).getFwdRaw();if(n&&!!n.id.split(";").find(e=>Math.abs(e)===t.messageId))return fa(e,a,o).then(()=>{var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)});return Promise.resolve()},cancelRecording(){m.cancelRecording()},reHeight(e){var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)},isBlocked:()=>Ta(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers(e.get().emojiOptId,!t)},saveText(e){oa(e).setText(Emoji.val(geByClass1("_im_text",a)))},resendAll(){h()},resendPeer(){f(e.get().peer)},unmount(){Object(c.c)(u),t.destroy(),d.unmount(),_.unmount(),p&&p.unmount(),Emoji.destroy(e.get().emojiOptId),m.unmount()}}}function Ia(e,t){return!!Object(r.Lb)(e)&&t.get().tabs[e].data.kicked}function Ta(e,t){return Ia(e,t)||Object(i.s)(t,e)&&Object(i.s)(t,e).block_error>0||Object(r.Xb)(t)&&Object(r.cc)(e,t)}function Ma(e,t,n){var a=e.get().peer,i=Emoji.val(n);Object(r.fc)(a)||oa(e).dData.txt==i||Ta(a,e)||(t.checkMessageURLs(i,!0,2e3),oa(e).setText(i))}function La(e){var t=oa(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function xa(e,t){e.disabled=!0,e.contentEditable="false",addClass(e,"im-chat-input--text_disabled"),addClass(t,"im-chat-input_error"),addClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Pa(e,t){e.disabled=!1,e.contentEditable="true",removeClass(e,"im-chat-input--text_disabled"),removeClass(t,"im-chat-input_error"),removeClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Ba(e,t,n){var a=gpeByClass("_im_chat_input_parent",n),s=geByClass1("_im_chat_input_error",a),o=Object(i.s)(e,t);if(Ta(t,e)){xa(n,a);var l=function(e,t,n){switch(n.block_error){case 7:case 5:return Object(Mn.d)("mail_peer_deleted");case 14:return Object(Mn.d)("mail_community_deleted");case 11:return Object(Mn.d)("mail_group_banned_messages");case 28:return Object(Mn.d)("mail_cant_send_messages_by_time");case 29:return Object(Mn.d)("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return Object(r.Ob)(t)?Object(Mn.d)("mail_send_privacy_community_error"):Object(Mn.d)("mail_send_privacy_error");case 23:var a=Object(F.c)(e,t);return langSex(a.sex,Object(Mn.d)("mail_blacklist_user","raw")).replace("{user}",a.kick_name);case 12:return Object(Mn.d)("mail_cant_send_messages_to_community");case 16:return Object(Mn.d)("mail_chat_youre_kicked");case 26:return Object(Mn.d)("mail_chats_is_disabled");case 0:if(Ia(t,e))return Object(Mn.d)("mail_chat_youre_kicked");var i=e.get().block_states[t].name;return Object(Mn.d)("mail_community_answering").replace("{username}",i);default:return Object(Mn.d)("mail_send_privacy_error")}}(e,t,o);if(Object(i.z)(o)&&addClass(geByClass1("_im_page_history"),"is_channel"),Object(r.Tb)(e,t)&&!e.get().gid){addClass(a,"is-f-vkcomgroup");var c=inArray(t,e.get().mutedPeers);l=Object(i.A)(o)?getTemplate("sImPeerMuteUnmute",{text:c?Object(Mn.d)("mail_im_unmute"):Object(Mn.d)("mail_im_mute"),type:c?"unmute":"mute"}):getTemplate("sImPeerReturnToChat",{text:Object(Mn.d)("mail_return_to_vkcomgroup")})}else removeClass(a,"is-f-vkcomgroup");return val(s,l),!0}return o&&Object(r.Id)(o)&&!Object(r.Kd)(o)?(xa(n,a),addClass(a,"is-message_request"),val(s,getTemplate("sImPeerAcceptOrRejectMessageRequest",{cls_accept:"_mr_button_accept",cls_reject:"_mr_button_reject"})),!0):(a.classList.contains("is-message_request")&&(Pa(n,a),removeClass(a,"is-message_request"),val(s,"")),n.disabled&&(removeClass(a,"is-f-vkcomgroup"),removeClass(geByClass1("_im_page_history"),"is_channel"),Pa(n,a),removeClass(a,"is-message_request"),val(s,"")),!1)}function Da(e,t,n){return Promise.resolve().then(()=>{var a=null!=n?n:Emoji.val(geByClass1("_im_text",t));if(trim(a))return!Object(i.w)(e)||!Object(r.Yb)(a);var s=oa(e),o=Object(r.wb)(e);return s.hasAttaches()&&!s.hasOnlyReplies(o)})}function Aa(e,t,n){var a=geByClass1("_im_send",t.parentNode);Yn(a,{fasthide:!0}),Promise.all([Da(e,t,n),Object(r.pc)(e)]).then(t=>{var n=Qn(t,2),r=n[0],s=n[1];if(Object(i.w)(e))toggleClass(a,"is_input_empty",!r),attr(a,"aria-label",Object(Mn.d)("mail_im_edit"));else{toggleClass(a,"im-send-btn_audio",!r&&s),toggleClass(a,"im-send-btn_send",r),r&&removeClass(a,"im-send-btn_saudio");var o=r?Object(Mn.d)("mail_send2"):Object(Mn.d)("mail_added_audiomsg");attr(a,"aria-label",o)}})}function Na(e){var t=geByClass1("MassMentionWarning",e);t.classList.contains("MassMentionWarning--hidden")||t.classList.add("MassMentionWarning--hidden")}function Ra(e,t,n){var a=Object(H.b)(e);if(a){if(!Object(r.Lb)(a.peerId)||Object(i.z)(a))return Na(t);var s=(n.match(gt.b)||[]).map(e=>e.slice(1));if(0===s.length)return Na(t),void e.set(e=>(a.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e)));var o=geByClass1("MassMentionWarning",t),l=geByClass1("MassMentionWarning__title",o),c=geByClass1("MassMentionWarning__text",o),d=(e,t)=>{a.dontReopenWarningForCurrentMassMention||(l.innerHTML!==e&&(l.innerHTML=e),c.innerHTML!==t&&(c.innerHTML=t),o.classList.remove("MassMentionWarning--hidden"))},u=gt.a.all.some(e=>s.includes(e)),m=gt.a.online.some(e=>s.includes(e));switch(!0){case u&&a.membersCount>=11:return d(Object(Mn.d)("mail_im_mass_mention_warning_title"),Object(Mn.d)("mail_im_mass_mention_warning_many_people_mentioned_text",a.membersCount-1));case m&&a.membersCount>=30:return d(Object(Mn.d)("mail_im_mass_mention_warning_title"),Object(Mn.d)("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return Na(t)}}}function Fa(e,t,n,s,o){cur.share_timehash=t.get().share_timehash;var l=Object(c.b)(Ea),u=l.callMutations,m=l.bindMutations,g=Vn(0,t,u),_=ua.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var p=In(_,ma.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0}),b=p.pushMessage,h=p.inspectQueue,f=p.resend,v=p.resendAll,O=p.resendPeer,j=p.setErrored,y=p.complete,w=ea.bind(null,t,o,b,u,e),C=ea.bind(null,t,o,b,u,e),k=La.bind(null,t);hide(geByClass1("ms_items_more_helper",e));var S=t.get().mediaTypes||[["photo",Object(Mn.d)("mail_added_photo")],["video",Object(Mn.d)("profile_wall_video")],["audio",Object(Mn.d)("profile_wall_audio")],["doc",Object(Mn.d)("profile_wall_doc")],["map",Object(Mn.d)("profile_wall_map")],["gift",Object(Mn.d)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&S.push(["money",Object(Mn.d)("profile_wall_money")]);var E=new MediaSelector(geByClass1("_im_media_selector",e),"_im_media_preview",S,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(n,r,i,s){return n&&u().toggleKeyboard(!0),function(e,t,n,r,i,s,o,l,c){if(!t.get().removingMedias){if("album"===i||"page"===i||"mail"===i||"reply"===i)return!1;if("share"===i&&!o.title)return!1;var d,u;s&&"string"==typeof i?(l&&oa(t).addBindUrl(l,i,s),oa(t).addAttach(i,s,o)):(oa(t).syncWithSelector(c),"number"==typeof s&&c.chosenMedias[s]&&(d=c.chosenMedias[s],u=oa(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&u.dData.cancelled.push(`${d[0]},${d[1]}`)));var m=e().updateScroll();if(e().scrollFix(t,t.get().peer,m),t.get().delayed_message&&!Object(a.Z)(t.get()))return n([]),!1;Aa(t,r)}}(o,t,I,e,n,r,i,s,E)},onMediaChange:function(){return function(e,t,n,a,r){if(!t.get().removingMedias){var i=r.getMedias().find(e=>"poll"===e[0]);i&&oa(t).addAttach(i[0],i[1],r.pollData(!0,!0)),Aa(t,a)}}(0,t,0,e,E)},editable:1,onChangedSize:function(){var n,a,r=o().updateScroll();o().scrollFix(t,t.get().peer,r),n=e,a=ge("_im_media_preview").offsetHeight,toggleClass(n,"im-chat-input--overflowed",a>400)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}}),I=ca.bind(null,t,o,b,e,u,E),T=_a.bind(null,t,e),M=geByClass1("_im_send",e),L=ea.bind(null,t,o,b,u,e),x=qt(e,t,L,()=>{addClass(M,"im-send-btn_audio"),removeClass(M,"im-send-btn_static")},()=>{u().restoreKeyboard()});!function(e,t){var n=geByClass1("_im_text",e),a=Object(bn.d)(stManager.add);(window.Wall?Promise.resolve():a(["page.js"])).then((function(){Wall.initComposer(n,{lang:{introText:Object(Mn.d)("profile_mention_start_typing"),noResult:Object(Mn.d)("profile_mention_not_found")},toup:!0,getValue:()=>t.get().peer>2e9?(window.Emoji&&Emoji.editableVal||val)(n):"",onShow:()=>{addClass(e,"im_mention_shown");var t=data(n,"composer");if(t&&t.wdd&&t.wdd.shown){var a=0,r=!1,i=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,val(t.wddInput,""),Composer.toggleSelectList(t)};each(t.wdd.shown,(function(){this[0]&&(a++,"@"+t.curTerm==this[2]&&(r=!0))})),!a||r&&1==a?i():cancelStackPush("im_mention",i)}},onHide:()=>{removeClass(e,"im_mention_shown"),cancelStackFilter("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=E,t.set(a.X.bind(null,h,f,j,y));var P=geByClass1("_im_text",e);setTimeout(()=>{Object(_t.e)(t)&&u().setDraft(t,Object(i.t)(Object(H.b)(t))),ga(t,e,E,I,w,C,g,o,u)},0);var B=fa.bind(null,t,e,o),D=va.bind(null,t,P,()=>{var e=o().updateScroll();o().scrollFix(t,Object(_t.e)(t),e)}),A=Oa.bind(null,t,n,s),N=ya.bind(null,t,e,o),R=wa.bind(null,t,e,o),F=aa.bind(null,t);Ba(t,t.get().peer,P);var U=e.querySelector("._im_keyboard_button"),K=function(e,t,n,a,r){return(0,Object(c.b)(sn).bindMutations)(Object(c.a)({handlers:(e,t)=>{}}),t,a)}(0,t,0,la.bind(null,t,o,b,e,u)),z=Object(r.Nb)(t)?function(e,t,n,a){var r=(0,Object(c.b)(pn).bindMutations)(Object(c.a)({handlers:function(){}}),e,t,n,a);if("function"!=typeof r){r.toggleImText();var i=Ut.createElement(Gt.b,{value:e},Ut.createElement(cn,{getTemplates:r.getPreparedTemplates,applyTemplate:r.applyTemplate.bind(r),isNeededRendering:r.isNeedRenderTemplates,showSettingsPopup:r.showSettingsPopup.bind(r,mn),showCreatingTemplatePopup:r.showSettingsPopup.bind(r,gn)}));zt.render(i,t)}return r}(t,e.querySelector("._message_templates_container"),e=>Object(Xn.b)(P,e),t=>toggleClass(e,"im-chat-input--textarea_show-templates",t)):null,V=Object(c.a)({handlers:(n,s)=>{n(M,"click",()=>{Na(e),Promise.resolve().then(()=>Da(t,e)).then(e=>{e||Object(i.w)(t)?I([]):Object(r.pc)(t).then(e=>{if(e){var n=oa(t);ta(n)&&function(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),n=e.getFwdRaw();if(n){var a=n.object;t&&(t.innerHTML=ha(a))}else t.innerHTML=""}(n),Yn(M,{fasthide:!0}),x.start(),setTimeout(()=>removeClass(M,"im-send-btn_saudio"),300)}})})}),n(M,"mouseover",T),n(P,"focus",()=>{t.get().longpoll.push([Object(d.h)("message")]),cur.focused=t.get().peer}),n(P,"blur",()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([Object(d.h)(e)]),cur.focused=!1}),n(U,"click",()=>u().toggleKeyboard(void 0)),n(U,"mouseover",()=>{Object(q.c)(U,{text(){var e=Object(i.g)(t);return!e||e.hide?Object(Mn.d)("mail_show_keyboard"):Object(Mn.d)("mail_hide_keyboard")},black:!0,shift:[4,5]})}),n(geByClass1("MassMentionWarning__close"),"click",()=>{!function(e,t){Na(t),e.set(e=>(Object(H.b)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e)))}(t,e),pa(P)}),s(e.parentNode,"click","_im_peer_mute_unmute",N),s(e.parentNode,"click","_im_peer_return_to_chat",R),s(e.parentNode,"click","_im_remove_replied",B),s(e.parentNode,"click","_mr_button_accept",D),s(e.parentNode,"click","_mr_button_reject",A),s(e,"click","_im_fwd_close",B),s(e,"click","_im_will_fwd",k),s(e,"keydown","_im_text",e=>function(e,t,n,r){if(38===r.which&&n().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!Object(Ln.a)()&&!Object(a.Z)(e.get())){var s=Object(Wn.c)(e,Object(H.b)(e));s&&t().startEditing(Object(i.m)(e,e.get().peer,s))}}(t,o,u,e)),s(bodyNode,"click","_im_submit_btn",F)}}),W=m(t,E,P,e,I,o,h,g,V,x,U,K,z,b,v,O);return W.initKeyboard(),W}var Ha=n("y/eL");function qa(e,t,n,a,r,i){return{focus(e){uiSearch.focus(t),function(e,t,n,a){cancelStackPush("im_hist_search",Wa.bind(null,e,t,n,a))}(e,t,n,a)},changePeer(e,n){uiSearch.getFieldEl(t).value=n.get().tabs[e].searchText||""},search(){i({})},unmount(){Object(c.c)(r),cancelStackFilter("im_hist_search"),a.then(e=>e.destroy())}}}function Ua(e,t,n,r){e.set(a.Gc.bind(null,e.get().peer,`${r.d}.${r.m}.${r.y}`)).then(za.bind(null,e,t,n))}function Ka(e,t){e.then(e=>{triggerEvent(geByClass1("datepicker_control",t),"mousedown",!1,!0)})}function za(e,t,n){var r=e.get().peer;uiSearch.showProgress(n),Object(a.uc)(r,e.get()).then(a=>{uiSearch.hideProgress(n),t().insertSearch(a,e),Object(Ha.a)(location.href,document.referrer)}).catch(()=>{uiSearch.focus(n),uiSearch.hideProgress(n)})}function Va(e,t,n,r,i,s){if("keyup"!==s.type||13==s.which){var o=clean(uiSearch.getFieldEl(t).value);e.set(a.Fc.bind(null,o,e.get().peer)).then(i.bind(null,e,r,t))}}function Wa(e,t,n,r){cancelStackFilter("im_hist_search"),r.then(e=>{e.hide()}),e.set(a.o.bind(null,e.get().peer)).then(()=>{uiSearch.getFieldEl(t).value="",n().cancelSearch(e)})}function Ga(e,t,n,r){n.then(e=>{e.hide()}),e.set(a.x.bind(null,e.get().peer)).then(za.bind(null,e,t,r))}function Xa(e,t,n){var a=geByClass1("_im_search_date_input",e),r=geByClass1("_im_search_history_input",e),i=function(e,t,n,a){var r='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+getLang("wall_clear_date_filter")+"</button></td>";return new Promise(e=>{stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(n,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+r+"</tr>",addRowsM:'<tr id="im_month_clear">'+r+"</tr>",onUpdate:a,pastActive:!0,noFuture:!0});e(t)}))})}(0,0,a,Ua.bind(null,t,n,r)),s=Ka.bind(null,i,e),o=Va.bind(null,t,r,a,n,Object(G.a)(za,300)),l=Wa.bind(null,t,r,n,i),d=Ga.bind(null,t,n,i,r),u=Object(c.a)({handlers:(t,n)=>{t(geByClass1("_im_search_date",e),"click",s),t(uiSearch.getFieldEl(r),"keyup",o),t(geByClass1("_im_start_inplace_search",e),"click",o),t(geByClass1("_im_cancel_inplace_search",e),"click",l),n(e,"click","_im_clear_date",d)}});return qa(0,r,n,i,u,o)}var Qa=n("t7TG");function $a(e,t,n,a,i){var s=Object(r.qb)(e);Object(q.c)(t,{shift:[n,10],black:1,className:"_im_history_tooltip "+a,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>s+37,text:i})}function Ya(e,t,n){var r=gpeByClass("_im_mess",n),o=intval(domData(r,"msgid")),l=e.get().peer,c=Object(i.m)(e,l,o),d=!Object(s.m)(c);return e.get().longpoll.push([{peerId:l,messageId:o,type:d?N.gb:N.cb,flags:N.o}]),e.set(a.I.bind(null,[o],d,l)),Ja(e,-10,t,n,!0),!1}function Ja(e,t,n,a,r){var o=domData(gpeByClass("_im_mess",a),"msgid"),l=Object(i.m)(e,e.get().peer,o),c=getLang("mail_im_unmark_important"),d=getLang("mail_im_toggle_important"),u=Object(s.m)(l)?c:d,m=u.length>16;r&&window.tooltips&&tooltips.destroy(a),$a(e,a,m?84:34,m?"im-star-tt_long":"im-star-tt",l?u:"")}function Za(e,t,n,i){var s=e.get().peer,o=+domData(domClosest("im-mess",i.target),"msgid");if(Object(r.Q)(e,[o]))return Object(mt.f)(),Object(a.Nb)([o],s,e).then(t=>e.set(a.Lb.bind(null,t))).then(()=>{Object(Qa.a)(n,e)}),!1}function er(e,t,n){var r=e.get().peer,i=+domData(domClosest("im-mess",n.target),"msgid");return Object(a.Nb)([i],r,e).then(t=>e.set(a.M.bind(null,t,e.get().tfdraft,!0))).then(()=>t().respond(e,r)),!1}function tr(e,t,n,a){$a(e,a,18,"im-reply-tt",getLang("mail_im_mark_forward"))}function nr(e,t,n,a){$a(e,a,18,"im-reply-tt",getLang("mail_im_reply"))}function ar(e,t,n,a){var r=intval(domData(gpeByClass("_im_mess",a),"msgid")),s=Object(i.m)(e,e.get().peer,r);return s&&t().startEditing(s),!1}function rr(e,t,n){$a(e,n,18,"im-edit-tt",getLang("mail_im_edit"))}function ir(e,t,n){var a=Ja.bind(null,t,0),i=Ya.bind(null,t),s=tr.bind(null,t,0),o=Za.bind(null,t,e.querySelector("_im_dialog_actions"),n),l=nr.bind(null,t,0),d=er.bind(null,t,n),u=rr.bind(null,t),m=ar.bind(null,t,n),g=Object(c.a)({handlers:(t,n)=>{n(e,"click","_im_mess_fav",i),n(e,"mouseover","_im_mess_fav",a),n(e,"click","_im_mess_forward",o),n(e,"mouseover","_im_mess_forward",s),n(e,"click","_im_mess_reply",d),n(e,"mouseover","_im_mess_reply",l),n(e,"click","_im_mess_edit",m),n(e,"mouseover","_im_mess_edit",u)}});return function(e,t){return{markImportant(t,n,a){Object(r.Qd)(t,n,e)},unmount(){Object(c.c)(t)}}}(e,g)}function sr(e,t,n,s,o){if(!Object(a.cb)(e.get().peer,e.get())&&!(hasClass(o,r.v)||hasClass(o,r.I)||hasClass(o,"_im_mess_srv")||Object(r.W)(s,o)||Object(i.w)(e)||"A"===s.target.tagName||domClosest("_im_replied_message",s.target)||s.target.classList.contains("_im_retry_media")||s.target.closest("."+r.A)||s.target.closest("."+r.a))){var l,c,d=intval(domData(o,"msgid")),u=e.get().peer;if(!Object(r.Ib)(e,u,d))l=s.shiftKey?Object(i.n)(e,u,d):[d],e.set(a.l.bind(null,l)).then(()=>{var a=Object(i.r)(e),r=!1;l.forEach(e=>{var t=geByClass1("_im_mess_"+e,n);if(t){var i=inArray(e,a);r|=i,toggleClass(t,"im-mess_selected",i);var s=i?getLang("mail_deselect_message"):getLang("mail_select_message"),o=geByClass1("_im_mess_blind_label_select",t);attr(o,"aria-label",s)}}),r&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)}).then(()=>{1!==e.get().selectedMessages.length||c?c&&c.hide():c=function(e){var t=e.get();if(t.pinnedMessagesPromo&&Object(r.Lb)(t.peer)){var n=geByClass1("_mess-action-promo"),i=new ElementTooltip(n,{autoShow:!1,appendTo:n,content:getTemplate("im_pinned_messages_promo",{content:getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),Object(a.V)()}});return i.show(),i}}(e)})}}function or(e,t,n){var a=sr.bind(null,t,n,e),r=Object(c.a)({handlers:(t,n)=>{n(e,"click","_im_mess",a)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map(t=>geByClass1("_im_mess_"+t,e)).filter(e=>e).forEach(e=>removeClass(e,"im-mess_selected"))},unmount(){Object(c.c)(t)}}}(e,r)}function lr(e,t,n){var a=n.get(),r=a.observer,o=a.targets;o.length&&o.forEach(r.unobserve.bind(r));var l=function(e,t){var n=Object(_t.e)(e);if(!Object(i.H)(e,n))return[];var a=Object(i.s)(e,n);return Object.keys(a.msgs).reduce((e,n)=>{var r=a.msgs[n],o=t||document;if(Object(s.u)(a,Object(i.W)(r))){var l=o.querySelector("._im_mess_"+n);l&&e.push(l)}return e},[])}(e,t);n.setState({targets:l}),l.length&&l.forEach(r.observe.bind(r))}var cr=n("Syd7"),dr=n("Wu9C");var ur={onNewMessagesChunk:function(e){var t=geByClass("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach(e=>LongView.register(e,"im"))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}};function mr(){return(mr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function gr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function pr(e,t,n,a){var r=e instanceof Array?e:geByClass("_im_bar_date",e),i=t.contHeight();ur.onNewMessagesChunk();var s=r.reduce((e,t)=>(e[domData(t,"date")]=[t.offsetTop+10,i,t],e),{}),o=!n&&a.barMap?a.barMap:{};return a.barMap=extend(o,s),a.barMapKeys=Object.keys(a.barMap).sort(),Promise.resolve(a)}function br(e,t){return t.barMapKeys.forEach(n=>{t.barMap[n][0]-=e}),Promise.resolve(t)}function hr(e,t,n,a,i){var s=e.get().barMap[t],o=Object(r.Mb)(i)?68:20;return n-(s[0]+n-s[1])+a-o}function fr(e,t,n,a){return a.barTransition=a.barMap[t][2],n>0?(addClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),addClass(e,"im-page--date-bar-transition-inverse")):n<0&&(removeClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),removeClass(e,"im-page--date-bar-transition-inverse")),addClass(a.barMap[t][2],"im-page--date-bar-transition"),addClass(e,"im-page--date-bar-transition"),Promise.resolve(a)}function vr(e,t){return t.barTransition&&(removeClass(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),removeClass(e,"im-page--date-bar-transition"),Promise.resolve(t)}function Or(e,t,n,a,r){var i,s,o=e.get(),l=n-t;o.barMapKeys.forEach(t=>{var o=hr(e,t,n,a,r);if(o>=l){var c=i?hr(e,i,n,a,r):n;i=c>o?t:i}else if(o<l){var d=s?hr(e,s,n,a,r):0;s=o>d?t:s}});var c={};return[[s,"prev"],[i,"cur"]].forEach(t=>{var i=gr(t,2),s=i[0],o=i[1];s&&(c[o+"Bar"]=function(e,t){var n=e.get().barMap[t][2];return{text:n.textContent,date:domData(n,"date")}}(e,s),c[o+"Left"]=hr(e,s,n,a,r)-l)}),c}function jr(e,t,n,i,s){var o=e.get(),l=Object(a.ab)(o),c=t.get(),d=s.scrollTop(),u=c.lastTop?c.lastTop-d:0;c.lastTop=d;var m=Object(dr.a)(o,o.peer)?Object(r.xb)(e):0,g=Object(a.cb)(o.peer,o)&&o.tabs[o.peer]&&o.tabs[o.peer].top_banner?50:0,_=(Object(r.Mb)(e)?68+m+g:0)-16,p=Or(t,d,s.contHeight(),_,e),b=p.prevBar,h=p.curBar,f=p.prevLeft,v="translateY(0px)",O=!1,j=!1,y=!1;h||l||(h=function(e){var t=geByClass1("_im_mess",e),n=domData(t,"ts");return t&&n?{text:getShortDate(intval(n),!1,!0,getLang("months_of","raw")),date:n}:null}(i)),h?O=h:j=!0,b&&h&&f>-32&&f<0&&(y=!0,j=!1,O=h,v=`translateY(${-32-f}px)`),O&&function(e,t){domData(e,"ts")!==t.date&&(e.innerHTML=t.text,domData(e,"ts",t.date),e.style.visibility="visible")}(n,O),y?t.set(fr.bind(null,n,b.date,u)):t.set(vr.bind(null,n)),v&&(n.style.transform=v),toggleClass(n,"im-page--top-date-bar_no-b",j)}function yr(e,t){var n=geByClass1("_im_top_date_bar",t),a={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},r=Object(b.a)(a),i=null,s=null,o=null,l=Object(G.a)(e=>{var n=r.get();Object.keys(n).length&&!n.isDisabled&&r.set(pr.bind(null,t,e,!1))},500);return{reset(a){r.get().isDisabled||r.set(pr.bind(null,t,a,!0)).then(jr(e,r,n,t,a))},disable(){r.setState(mr({},a,{isDisabled:!0}))},enable(){r.setState({isDisabled:!1})},heightIncreased(e,t){r.get().isDisabled||(l(t),r.set(br.bind(null,e)))},parseMore(a,i){r.get().isDisabled||r.set(pr.bind(null,a,i,!1)).then(()=>{jr(e,r,n,t,i)})},toggle(e){r.get().isDisabled&&e||n.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){r.get().isDisabled||(s=Date.now(),o||(addClass(t,"im-page--top-date-bar_visible"),o=setInterval((function(){Date.now()-s>2e3&&(removeClass(t,"im-page--top-date-bar_visible"),clearInterval(o),o=null)}),100)))},update(a){r.get().isDisabled||(i&&(clearTimeout(i),i=null),i=setTimeout((function(){jr(e,r,n,t,a)}),300),jr(e,r,n,t,a))},unmount(){i&&(clearTimeout(i),i=null),o&&(clearInterval(o),o=null),r.unmount()}}}var wr=n("bIHZ"),Cr=n("uytb"),kr=n("S2bU"),Sr=n("t7n3");function Er(){return(Er=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ir(e){return!e.children.length}function Tr(e,t){var n=geByClass1("_im_dialog_actions",e);Object(W.zb)(n,"im-page--chat-header_top-banner",t)}function Mr(e,t){var n=geByClass1("_im_top_banner_hide",e);n&&window.tooltips&&tooltips.hide(n),Tr(e,!1),t.innerHTML=""}function Lr(e,t,n){var a=t.participants,i=a.count>0?langNumeric(a.count,getLang("mail_im_n_chat_members","raw")):"";return Object(Sr.n)("sImCallBannerContent",{user_list:Object(r.Fc)(e,a.list),title:getLang("calls_group_call_banner_title"),desc:i,cls:n?"CallBanner--classic":""})}function xr(e){var t=e.peerId;if(Object(r.Lb)(e.peerId)&&!Object(i.A)(e))return!1;var n=e.callInProgress,a=cur.imDb.selectByKey("hiddenCallBanners");return a?!(!n||a[t]&&a[t]===n.join_link):!!n}function Pr(e,t,n){var s=geByClass1("_im_top_banner",e),o=Object(c.a)({handlers:(o,l)=>{var c=geByClass1("_im_dialog_actions",e);l(e,"click","_im_top_banner_hide",()=>{var o=t.get().peer,l=Object(i.s)(t,o);xr(l)?function(e){var t=e.peerId,n=e.callInProgress,a=cur.imDb.selectByKey("hiddenCallBanners")||{};cur.imDb.updateByKey("hiddenCallBanners",Er({},a,{[t]:n.join_link}))}(l):t.set(e=>Object(a.W)(o,e)),Mr(e,s);var c=!!Object(r.Pc)(t);Object(r.Y)(t,c,!0,n)}),l(e,"click","_im_top_banner_button",i=>{var o=function(e,t,n,i){var s=e.target,o=t.get().peer;if(s.classList.contains("_im_call_banner_join_btn")){var l=s.dataset.link;return Object(r.qc)(t,o,l,!1,r.c),!1}var c=s.dataset.payload;return c?(t.set(e=>Object(a.m)(o,c,e)),Mr(n,i),!0):(s.classList.contains("_im_top_banner_button_gifts")&&(showBox("al_gifts.php",{act:"get_gift_box",mid:o,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(R.c)("gifts_im_birthday_banner","click",o),e.originalEvent.preventDefault()),!1)}(i,t,e,s),l=!o,c=!!Object(r.Pc)(t)||!o;Object(r.Y)(t,c,l,n)}),l(c,"mouseover","_im_top_banner_hide",(e,t)=>{Object(q.c)(t,{text:getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})})}});return{renderPeer(t){var a=Object(i.s)(t,t.get().peer),o=a.top_banner,l=a.callInProgress,c=!Ir(s),d=xr(a);!d&&!o||Object(i.Q)(t)?c&&Mr(e,s):(Tr(e,!0),s.innerHTML=d?function(e,t){return Object(Sr.n)("im_top_banner",{text:Lr(e,t,Object(i.B)(e)),icon:"",buttons:[Object(Sr.n)("sImCallBannerButton",{call_link:t.join_link}),Object(Sr.n)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,l):function(e){var t=e.icon?Object(Sr.n)("im_top_banner_icon",{icon:e.icon}):"",n=e.text;"employees_banner"===e.name&&(n=Object(kr.d)(n,e=>Object(kr.a)(!1,e)),n=Object(kr.f)(n));var a=(e.buttons||[]).map(e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return Object(Sr.n)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=" _im_top_banner_button_gifts",Object(Sr.n)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});default:return Object(Sr.n)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}});return a=a.concat([Object(Sr.n)("im_top_banner_hide_btn",{})]),Object(Sr.n)("im_top_banner",{text:n,icon:t,buttons:a.join("")})}(o),o&&"birthday"===o.name&&Object(R.c)("gifts_im_birthday_banner","view",t.get().peer));var u=!Ir(s);Object(r.Y)(t,u,c,n)},unmount(){Object(c.c)(o)}}}var Br=n("cGUQ"),Dr=n("W9Tc"),Ar=n("cYwl");function Nr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Fr="im-audio-message_recorded",Hr=!1,qr={};function Ur(e){return e.get().isMassMentionsMessageAllowed}function Kr(e){var t=Object(i.s)(e,e.get().peer);return!!Object(i.o)(e)||!(!t||!t.top_banner)}function zr(e,t){var n=Object(l.s)(e),a=Object(i.s)(n,t);return Object(r.Lb)(t)&&Object(dr.a)(n,t)||!!a.top_banner&&!Object(i.Q)(t,n)}function Vr(e){return Object(r.xb)(e)}function Wr(e,t,n){var a=n||window.clientHeight();return Math.min(a-15,Math.max(0,e,742+t.offsetTop))}function Gr(e,t){var n=intval(domData(t.target,"msgid")),a=gpeByClass("_im_mess_"+n,t.target),r=geByClass1("_im_log_body",a),i=geByClass1("_im_mess_susp_cont",a);r.innerHTML=i.innerHTML}function Xr(e,t){return geByClass1("_im_mess_"+t,e)}function Qr(e,t,n){var a,i,s,o,l,c,d,u,m,g=geByClass1(e,t);o={onStartDrag:(e,t)=>{addClass(bodyNode,"cursor_ns_resize"),a=t,i=t},onDrop:()=>{removeClass(bodyNode,"cursor_ns_resize")},onDrag:(e,s)=>{var o=Wr(i-a+s,t);Object(r.fd)(o),n().fixHeight()}},d=function(e){l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onDrag&&o.onDrag.call(s,l,c)},u=function e(t){o.onDrop&&o.onDrop.call(s,l,c),removeEvent(document,"mouseup touchend mouseleave",e),removeEvent(document,"mousemove touchmove",d)},m=function(e){(1===e.which||e.touches&&e.touches[0])&&(addEvent(document,"mouseup touchend mouseleave",u),addEvent(document,"mousemove touchmove",d),l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onStartDrag&&o.onStartDrag.call(s,l,c),o.onDrag&&o.onDrag.call(s,l,c),cancelEvent(e))},(s=g).beginDragHandler=m,addEvent(s,"mousedown touchstart",m)}function $r(e,t){var n;n=geByClass1(e,t),removeEvent(n,"mousedown touchstart",n.beginDragHandler)}function Yr(e){e().hideError()}function Jr(e,t,n,r,i){if(checkEvent(r))return!0;var s=Object(Br.fromQueryString)(i.getAttribute("href")),o=intval(s.msgid);o&&e.set(a.r.bind(null,e.get().peer,o,!1)).then(()=>ui(n,t,o,e)),cancelEvent(r)}function Zr(e,t,n){var r=Object(i.s)(t,n),s=Object(a.Qc)(r.history);toggleClass(e,"im-page--history_empty-hist",!s)}function ei(e,t,n,a){if(hasClass(n.target,"_im_mess_marker")){var i=n.target,s=Object(l.q)(geByClass(r.v,t));window.tooltips&&s.map(e=>geByClass1("_im_mess_marker",e)).filter(e=>e!==i).forEach(e=>tooltips.hide(e,{fasthide:!0}));var o=domData(a,"msgid");Object(q.c)(i,{content:getTemplate("im_failed_menu",{count:s.length,modifiers:Object(Xt.a)("im-settings_failed",{"im-settings_no_delete":o>0,"im-settings_single":1===s.length}),id:o}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function ti(e){return geByClass1("_im_peer_history",e)}function ni(e,t){var n=t.contHeight(),a=e.scrollTop+(n-e.contHeight);t.scrollTop(a)}function ai(e,t,n,s,o,l,c,d,u){var m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=(t.get().tabs||{})[n];o().hideError(),l.renderPeer(t),d.renderPeer(t),u.render(t);var p=Object(i.x)(t,n);if(toggleClass(e,"im-page--history_casper",p),!t.get().tabHistoryNotChanged){l.reRenderTitle(t),Zr(e,t,n);var b=Object(a.Qc)(_.history);if(b){var h=geByClass1("_im_peer_history",e);val(h,b)}else o().showEmptyScreen();getAudioPlayer().isPlaying()&&getAudioPlayer().updateCurrentPlaying(),Si(t,s,e)}if(Object(a.cb)(n,t.get())?o().showSearch(t):o().cancelSearch(t,!1),c.changePeer(n,t),t.get().msgid)ui(s,e,t.get().msgid,t);else if(_.scrollBottom&&m){ni(_,s);var f=Object(r.Zb)(t,e,s),v=Nr(f,1),O=v[0];_.skipped||setTimeout(()=>{_.unread&&!O&&(_i(t,e,!0),pi(t,e,!0)),si(t,s,e),oi(t,s,e)},100)}else di(s,e,o,t,g)||s.scrollBottom(-30);window.LazyLoad&&window.LazyLoad.scan(!!s.scroll&&s.scroll.scroller)}function ri(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n||t.scrollTop(),i=t.scrollBottom(),s=t.contHeight(),o=e.get().peer;e.set(a.nc.bind(null,o,r,i,s))}function ii(){return bt.a.isFullscreen}function si(e,t,n){var a=Object(i.J)(e),r=Object(i.I)(e),s=t.getScrollHeight()/4,o=t.scrollTop()>0;t.scrollBottom()>s&&(!r||a)&&o&&_i(e,n,!0,40)}function oi(e,t,n){if(Ur(e)){var a=t.getScrollHeight()/4,r=t.scrollTop()>0,s=Object(i.J)(e);t.scrollBottom()>a&&!s&&r&&pi(e,n,!0,40)}}function li(e,t,n,s,o,l,c,d){var u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if((e.get().history_init||(e.get().history_init=!0,!(d.scrollTop()>0)))&&!ii()){o.update(d),o.show();var m=e.get().peer;if(0!==m&&Object(r.Sb)(e.get(),m)&&(ur.onHistoryScroll(d.scrollTop()),!layers.visible)){var g=Object(i.s)(e,m);g&&!g.skipped&&d.scrollBottom()>40?(si(e,d,l),oi(e,d,l)):g.skipped||g.unread||(Mi(e,l),Li(e,l));var _=Object(r.Rd)(n);if(!Object(a.cb)(m,e.get())&&u&&s(d),!Hr&&(c<0||0===d.scrollBottom())&&d.scrollBottom()<1e3){if(Object(a.cb)(m,e.get()))return;if(g.skipped>0&&!e.get().no_moving_down){var p=gpeByClass("_im_page_history",l),b=e.get();Hr=!0;var h=e.set(a.ob).then(t().loadHistory.bind(null,b.peer,{reversed:!0})).then(()=>{t().updateObserver(),Hr=!1,_i(e,p),pi(e,p),g.skipped||e.set(a.r.bind(null,e.get().peer,!1,!1))});return wi(p,!0),void h.then(wi.bind(null,p,!1))}}if(!Hr&&d.scrollTop()<1e3){if(Object(a.cb)(m,e.get())){Hr=!0;var f=t().getSearchResulstModule();return f.isAll(e)?void(Hr=!1):void _(f.loadMore(e).then(n=>{Hr=!1,n&&(t().loadHistory(e.get().peer,{},e,n),s(d))}),"up")}var v=e.get();g.allShown||(Hr=!0,_(e.set(a.sb.bind(null,0,0)).then(t().loadHistory.bind(null,v.peer,{})).then(()=>{Hr=!1,s(d)}),"up"))}c<0&&Ri(e,m,d.scrollBottom(),l,t),Object(a.Cd)()}}}function ci(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(a.Pb.bind(null,t,e.get().peer))}function di(e,t,n,i,s){var o=geByClass1("_im_unread_bar_row",t);if(o){var l=i.get(),c=l.peer,d=o.getBoundingClientRect(),u=geByClass1("_im_chat_body_abs",t).getBoundingClientRect().top+20;Object(r.Mb)(i)&&(u+=47+(zr(l,c)?Vr(i):0));var m=e.scrollTop()-u+d.top;return e.scrollTop(m),ri(i,e,m),setTimeout(()=>{c===i.get().peer&&li(i,n,ti(t),(function(){}),s,t,0,e)},80),Object(Dr.b)("mail_history_unread_counter_observer")?n().updateObserver():function(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)e.set(a.Ob.bind(null,t))}(i),!0}return!1}function ui(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"top",s=Xr(t,n);if(s){var o=Object(r.Mb)(a),l=a.get().peer,c=o?window.clientHeight():geByClass1("_im_chat_body_abs",t).offsetHeight,d=s.offsetTop+domPN(s).offsetTop+domPN(domPN(s)).offsetTop+domPN(domPN(domPN(s))).offsetTop;o&&zr(a,l)&&(d-=Vr(a)),"top"===i?e.scrollTop(d-e.getScrollHeight()/2+c/2):e.scrollTop(d-e.getScrollHeight()+c/4),addClass(s,"im-mess_light"),setTimeout(()=>{removeClass(s,"im-mess_light")},2e3)}}function mi(e,t,n){n.updateLastSeen(e)}function gi(e,t,n,r,i,s){var o=domData(s,"action"),l=domData(s,"msgid"),c=geByClass1("_im_mess_marker",Xr(n,l)),d=Number(l)>0?"edit":"send",u=e.get().peer,m=ti(n);switch(o){case"resend":Object(mt.j)("retry",d),t(i,s);break;case"resend_all":Object(mt.j)("retry",d),r().resendPeer();break;case"delete":Object(mt.j)("delete",d),e.set(t=>Object(a.Vb)(e,m,u,l,t));break;case"delete_all":Object(mt.j)("delete",d),e.set(t=>Object(a.Vb)(e,m,u,void 0,t))}tooltips.hide(c,{fasthide:!0})}function _i(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=e.get(),o=s.peer;if(!Object(r.fc)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_end"),d=!1;(n||l.skipped>0||l.unread>0)&&!Object(a.cb)(o,e.get())?(d=!0,bi(t,e),addClass(c,"im-navigation_shown")):Ti(c,!0),e.set(a.od.bind(null,[d,+i]))}}function pi(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Ur(e))return!1;var s=e.get(),o=s.peer;if(!Object(r.fc)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_mention"),d=fi(e).length,u=!1;l.unread>0&&d>0&&!Object(a.cb)(o,e.get())?(u=!0,hi(t,e,d),addClass(c,"im-navigation_shown")):Ti(c,!0),e.set(a.pd.bind(null,[u,+i]))}}function bi(e,t){var n=t.get().peer,a=Object(i.s)(t,n);(e||document).querySelector("._im_to_end").querySelector("._im_to_end_label").innerHTML=Number(a.unread)>0?Object(Sr.l)(a.unread):""}function hi(e,t,n){(e||document).querySelector("._im_to_mention").querySelector("._im_to_mention_label").innerHTML=n>0?Object(Sr.l)(n):""}function fi(e){var t=e.get(),n=t.id,a=t.peer,r=Object(i.s)(e,a);if(!a||!r)return[];var o=r.msgs||{};return Object.values(o).filter(e=>!(!e||Array.isArray(e)||Object(s.r)(e)||!Object(s.u)(r,e))&&Object(U.b)(e,n))}function vi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.scrollTop()&&0===e.scrollBottom())return!1;var n=e.scrollBottom();return n<(t?30+t:30)}function Oi(e,t,n,a,r){var s=domData(r,"msgid"),o=e.get().peer,l=Object(i.m)(e,o,s);l.type===N.i?(n().sendEditMessage(e,l),n().resendMessage(o,s)):e.get().imQueueResend(o,s).then(t=>{e.get().longpoll.push([Object(d.f)(o,t.mess)])})}function ji(e,t,n,s,o,l){var c=intval(domData(l,"peer")),d=intval(domData(gpeByClass("_im_mess",l),"msgid")),u=Object(i.s)(e,c);return e.set(a.jc.bind(null,d,c)).then(r.ad.bind(null,d,c,ti(t))).then(()=>Si(e,n,t)),Object(a.kc)(d,c,u.hash,e.get().gid).then(()=>{d>u.lastmsg&&Object(a.gb)(e,c).then(()=>s().updateState(c,e))}),!1}function yi(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function wi(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function Ci(e,t,n,o){var l=t.get().peer,c=Object(i.s)(t,l);if(Object(r.Sb)(t,l)){var d=Object.keys(c.msgs).find(e=>{var t=c.msgs[e];return!Array.isArray(t)&&Object(s.u)(c,t)});if(!c.skipped)return d?ui(o,n,d,t):o.scrollBottom(-30),_i(t,n),pi(t,n),Ri(t,l,0,n,e),void Object(a.Pb)(c.lastmsg,l,t.get());yi(n,!0),t.set(a.r.bind(null,l,!1,!1)).then(()=>t.set(a.ub.bind(null,l,!0,-1,!1))).then(()=>{yi(n,!1),e().changePeer(t,!1,!1)})}}function ki(e,t,n,r){var s=Object(i.s)(t,t.get().peer),o=fi(t),l=!!o.length&&o[0].messageId;if(!s.skipped)return l&&ui(r,n,l,t,"center"),_i(t,n,!0),pi(t,n),ci(t,l),void Ri(t,t.get().peer,0,n,e);yi(n,!0),t.set(a.r.bind(null,t.get().peer,!1,!1)).then(()=>t.set(a.ub.bind(null,t.get().peer,!0,-1,!1))).then(()=>{yi(n,!1),e().changePeer(t,!1,!1),ci(t,l)})}function Si(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(r.Mb)(e)){var i=t.contHeight(),s=geByClass1("_im_chat_input_w",n),o=geByClass1("_im_chat_resize",n);if(!1!==(a=!1!==a?a:Object(r.ob)())&&a>0){var l=window.clientHeight(),c=geByClass1("_im_chat_audio_input_parent",n),d=Wr(a,n,l),u=hasClass(c,"im-audio-message_recording")||hasClass(c,Fr),m=u?c:geByClass1("_im_chat_input_parent",n),g=d-m.offsetHeight;o.style.height=l-d-15+"px",setStyle(s,{top:g+"px",bottom:"auto"})}else o.style.height="0px",setStyle(s,{top:"auto",bottom:"0px"});var _=geByClass1("_im_peer_history_w",n);return setStyle(_,{borderBottomWidth:s.offsetHeight-15-1}),t.contHeight()-i}var p=t.getScrollHeight();t.update(!1,!0);var b=t.getScrollHeight();return p-b}function Ei(e,t,n,a){var r=t.offsetHeight;a(),e.heightIncreased(t.offsetHeight-r,n)}function Ii(e,t){var n=t.getBoundingClientRect().top;Object(q.c)(t,{className:"im-page--admin-tt",text:getLang("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:n>200})}function Ti(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];hasClass(e,"im-navigation_shown")&&(t&&addClass(e,"im-navigation_fast"),removeClass(e,"im-navigation_shown"),t&&(e.offsetHeight,removeClass(e,"im-navigation_fast")))}function Mi(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.querySelector("._im_to_end");e.set(a.od.bind(null,[!1,0])),Ti(r,n)}function Li(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.querySelector("._im_to_mention");e.set(a.pd.bind(null,[!1,0])),Ti(r,n)}function xi(e,t,n){bt.a.isFullscreen||0===t.get().peer||Object(r.Mb)(t)||e().restoreScroll(t,t.get().peer)}function Pi(e,t){var n=e.get(),o=n.peer,l=domClosest("_im_mess_srv",t.target),c=intval(domData(l,"msgid")),d=Object(i.m)(e,o,c),u=d&&Object(s.s)(d)&&d.kludges.source_act;if(u===r.o||u===r.r){var m=l.querySelector(".im_srv_mess_link");if(m&&"A"!==m.tagName){var g=d.kludges.source_chat_local_id;if(!g||qr[g])return;qr[g]=Object(a.Q)(o,g,n).then(e=>{var t=Nr(e,1)[0];if(t){var n=`/im?sel=${Object(r.ab)(o)}&msgid=${t}`,a=m.innerHTML;domReplaceEl(m,Object(r.dd)(n,a,!0,"im_srv_mess_link")),delete qr[g]}})}}}function Bi(e,t,n){var a=e.get(),s=a.peer,o=n.target.href&&n.target.href.match(/msgid=([\d]+)/),l=o&&o[1];"A"!==n.target.tagName||!l||Object(r.Ib)(e,s,l)||checkEvent(n)||(Object(i.m)(e,s,l)?(e.setState({msgid:l}),Object(wr.b)({msgid:l}),t().focusOnMessage()):a.longpoll.push([Object(d.a)(s,l)]));cancelEvent(n)}function Di(e){var t=Object(H.b)(e);Object(r.Lb)(t.peerId)&&(t.pinHideId=cur.imDb.select(Cr.a,t.peerId))}function Ai(e,t,n,a,r){e.setState({isEditing:!1}),removeClass(a,"im-mess_is_editing"),removeClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackFilter("cancel_edit"),n.setDraft(e,Object(_t.e)(e)?Object(i.t)(Object(H.b)(e)):null),n.toggleStickers(e,!0),n.restoreKeyboard(),Ni(t)}function Ni(e){Object(l.q)(geByClass("_im_history_tooltip",e)).forEach(hide)}function Ri(e,t,n,r,s){var o=Object(i.s)(e,t);if(!(Date.now()-(o.lastReset||0)<1e3)&&(o&&o.msgs&&o.history&&!Hr&&o.offset>300&&0==o.skipped&&n<50&&n>=0&&0===(e.get().selectedMessages||[]).length)){var l=Object.keys(o.msgs).filter(e=>e>0).sort((e,t)=>e-t).slice(0,-50),c=l.slice(-1)[0];e.mutate(a.gc.bind(null,t)),e.set(a.Yb.bind(null,l,t)).then(()=>s().removeStartingFromMessage(c,t,e))}}function Fi(e,t,n,a){var i=a.target,s=domClosest("_im_replied_message",i),o=Number(s.getAttribute("data-msgid")),l=domClosest("im-mess",i),c=Number(l.getAttribute("data-msgid")),d=e.get().peer;o&&!Object(r.Ib)(e,d,o)?(e.setState({msgid:o}),Object(wr.b)({msgid:o}),Object(r.eb)(e,t().focusOnMessage,d,o)):c&&Object(r.xd)(e,c,a)}function Hi(e){checkEvent(e)||cancelEvent(e)}function qi(e,t){var n=domClosest("_im_mess",t);if(n){var r=Number(n.getAttribute("data-msgid")),o=e.get().peer,l=Object(i.m)(e,o,r);r&&l&&!Object(s.r)(l)&&Object(a.xb)(o,r,e.get())}}function Ui(e,t,n){var a=n.target.closest("."+r.A),i=n.target.closest("."+r.C);if(a){var s=e.sendMessageFromKeyboard.bind(null,()=>e),o=Object(pt.c)(a),l=i?i.dataset.peer:void 0,c=n.target.closest("._im_mess");return Object(pt.g)(o,s,t,{keyboardAuthorId:l,messageElement:c,buttonElement:a})}}function Ki(e,t){var n=t.target.closest("._im-call-snippet"),a=n.closest("._im_mess_callsnippet"),i=n.dataset.type,s=n.dataset.participants,o=s&&s.split(",").reduce((t,n)=>(+n!==e.get().id&&Object(r.nc)(+n)&&t.push(+n),t),[]),l=+a.dataset.peer;Object(r.Kb)(e,l)&&Object(r.Fd)(e,l,"video"===i,o,r.g)}function zi(e,t,n){Vi(e,t,n.target.closest("._im_mess_pinned"))}function Vi(e,t,n){var a=+n.dataset.msgid,s=Object(i.m)(e,e.get().peer,a),o=Object(Wn.a)(e,s);o!==n.classList.contains("im-mess_editable")&&(n.classList.toggle("im-mess_editable",o),Object(r.Od)(e,t,n))}function Wi(e,t,n,o,u,m,g,p,b,h,f,v,O,j,y,w,C,k){var S,E=Object(l.o)((function(){n.smoothScroll(...arguments)}),300);return{fixKeyboard(){u.fixKeyboard()},removeUnpinnedMessageEditable(e,n){var a=t.querySelector("._im_mess_pinned:not(._im_mess_"+n);a&&(a.classList.remove("_im_mess_pinned"),Vi(e,t,a))},changePeer(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e.get().peer;if(revertLastInlineVideo(t),0===c)return y.disable(),u.setDraft(e,null),function(e){addClass(e,"im-page--history_empty"),ti(e).innerHTML=""}(t);if(Object(r.Sb)(e.get(),e.get().peer)){removeClass(t,"im-page--history_search"),e.set(a.G),o.changeActions(e),o.showActions(e);var d=e.get().prevPeer;removeClass(t,"im-page--history_loading"),toggleClass(t,"im-page--history_vkcomgroup",Object(r.Tb)(e,c)),s?u.setDraft(e,Object(i.t)(Object(H.b)(e))):u.updateState(e),_i(e,t),pi(e,t),m().updateTyping(c,e),mi(e,0,o),Object(r.fc)(d)&&!Object(r.fc)(c)?function(e,t,n,a,r,i,s,o,l,c,d){removeClass(e,"im-page--history_empty"),ai(e,t,n,a,r,i,s,o,l,c,d)}(t,e,c,n,m,o,p,w,k,l,y):Object(r.fc)(d)||Object(r.fc)(c)||ai(t,e,c,n,m,o,p,w,k,l,y),Object(i.x)(e,c)||(y.enable(),y.toggle(!0),y.reset(n)),Object(r.fc)(c)||setTimeout(()=>{li(e,m,ti(t),O,y,t,0,n)}),Object(r.db)(t),Object(_t.e)(e)===gt.d&&Object(Ar.d)(e.get().viewer_id)}},preparePeer(e){var n=Object(_t.e)(e);Di(e),u.setDraft(e,Object(i.t)(Object(i.s)(e,n)),!1),m().updateTyping(n,e),m().hideError(),o.renderPeer(e),w.renderPeer(e),o.hideActions(e),p.changePeer(n,e),mi(e,0,o),y.toggle(!1),Mi(e,t,!0),Li(e,t,!0)},saveScroll:e=>ri(e,n),loadingPeer(e){Object(a.Z)(e.get())||(removeClass(t,"im-page--history_empty"),addClass(t,"im-page--history_loading"))},stopLoading(e){removeClass(t,"im-page--history_loading")},deselectDialog(e){g().removeSelection(e)},replaceMessageAttrs(e,n){Object(r.Yc)(n.get(),ti(t),e)},cleanSelection(e){h.cleanSelection(e)},updateDialogFilters(e){g().updateDialogFilters(e)},getSearchResulstModule:()=>S,showSearchResults(e){e?(removeClass(t,"im-page--history_search-empty"),ti(t).innerHTML=e):(addClass(t,"im-page--history_search-empty"),ti(t).innerHTML=Object(r.Jc)())},insertSearch(e,a){S||(o.deselectAll(a),S=_(t,a)),addClass(t,"im-page--history_search"),m().showSearchResults(e),Si(a,n,t),n.scrollBottom(0),_i(a,t),pi(a,t),y.reset(n)},updateChatTopic(e,t){g().updateDialog(e,t),e===t.get().peer&&(o.renderPeer(t),o.renderActions(t),w.renderPeer(t))},updateActions(e){o.changeActions(e)},updateChatPhoto(e,a,i){if(Object(r.bc)(e.peerId,i.get())){o.renderPeer(i),w.renderPeer(i);var s=vi(n);Object(r.L)(e,a,i.get(),ti(t)),s&&n.scrollBottom(-30)}},markImportant(e,n,a){Xr(t,e)&&(o.changedMessageSelection(a),b.markImportant(e,n,a))},isNewMessagesVisible:e=>function(e,t){return Object(i.v)(e)>=intval(t.scrollBottom())}(e,n),loadHistory(e,a,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i.get();if(Object(r.bc)(e,o)){var l=s||o.tabs[e].historyToAppend;if(!l)return;var c=geByClass1("_im_peer_history",t),d=domFC(c),u=n.scrollBottom(),m=a.reversed?e=>c.appendChild(e):e=>c.insertBefore(e,d),g=0;a.reversed&&(g=c.offsetHeight);var _=sech(l),p=document.createDocumentFragment();_.forEach(e=>p.appendChild(e)),m(p),a.reversed&&y.heightIncreased(c.offsetHeight-g,n),a.reversed||n.scrollBottomFixSave(u),n.update(!1,!0);var b=_.filter(e=>hasClass(e,"_im_bar_date"));y.parseMore(b,n),Object(r.db)(t)}},sendMessage(e){0!==e.get().peer&&u.sendMessage()},editMessage(e,a){if(Object(r.Sb)(e,a.peerId)&&Object(r.bc)(a.peerId,e.get())){if(!Xr(t,a.messageId))return;ri(e,n),Object(r.cb)(e.get(),a,t),ni(Object(i.s)(e,a.peerId),n),o.reRenderPinned(e),y.reset(n)}},addMessage(e,o){if(!Object(a.cb)(o.peerId,e.get())&&Object(r.Sb)(e,o.peerId)&&Object(r.bc)(o.peerId,e.get())){if(Xr(t,o.messageId))return;var l=ti(t);Ei(y,l,n,()=>{var a=vi(n),c=geByClass1("_im_unread_bar_row",t),d=Nr(Object(r.Zb)(e,t,n),2),u=d[0],g=d[1];Object(r.M)(e.get(),o,l,!0,!0,!u&&!c),removeClass(t,"im-page--history_empty-hist");var _=Object(i.s)(e,e.get().peer),p=Object(s.s)(o)&&o.userId===vk.id,b=o.kludges&&o.kludges.source_act,h=p&&b!==r.o&&b!==r.r;_.skipped||u||!Object(s.u)(_,o)||Object(s.r)(o)||(_i(e,t,!0,g),pi(e,t,!0,g)),(o.local||a||h)&&n.scrollBottom(0),m().updateTyping(o.peerId,e),bi(t,e),Ni(t)});var c=domPS(domLC(l));if(hasClass(c,"_im_bar_date")){var d=ce("div");d.innerHTML=c.outerHTML,y.parseMore(d,n)}m().hideError(),y.update(n),Object(a.rd)(e.get()),Ri(e,o.peerId,n.scrollBottom(),0,m),this.updateObserver()}},setMessageErrored(e,n,a,i){a&&"string"==typeof a&&m().showError(a),Object(r.hd)(e,n,t)},markMessagesAsRead(e,n){e.get().peer===n.peerId&&Object(r.tc)(e.get(),n.peerId,t)},compensateHistoryHeightChange(e){n.scrollTop(n.scrollTop()+e*Vr(v))},updateTyping(e,n){if(!Object(a.cb)(e,n.get())){var s=n.get();if(s.peer===e&&Object(r.Sb)(s,e)){var o=Object(r.hb)(Object(i.s)(n,e).activity,e,!1,s),l=geByClass1(r.K,t);if(l||o){if(!l){var c=geByClass1("_im_typer_c",t);val(c,getTemplate("im_typing",{cls:Object(r.Mb)(n)?"im-activity_classic":""})),l=geByClass1(r.K,t)}val(geByClass1("_im_typing_name",l),o);var d=Object(r.rc)(Object(i.s)(n,e).activity||{})===a.c;l.setAttribute("data-activity-type",d?"recording":"typing"),o?(addClass(l,"im-page--typing_vis"),m().hideError()):removeClass(l,"im-page--typing_vis")}}}},scrollFix(e,t,a){y.heightIncreased(a,n),y.update(n),Object(r.bc)(t,e.get())&&vi(n,a)&&n.scrollBottom(-30)},goToEnd(){Ci(()=>this,v,t,n)},updateGoToEnd(e,a){var r=Object(i.s)(e,e.get().peer);r&&(r.skipped||r.unread)?_i(e,t):Mi(e,t,a),f(0,n,!1);var s=e.get().peer;setTimeout(()=>{e.get().peer===s&&ri(e,n)})},updateGoToMention(e,a){var r=Object(i.s)(e,e.get().peer),s=fi(e),o=s.length>0&&s[0].messageId;r&&o?pi(e,t):Li(e,t,a),f(0,n,!1);var l=e.get().peer;setTimeout(()=>{e.get().peer===l&&ri(e,n)})},newMessage(e){g().newMessage(e),Mi(e,t,!0),Li(e,t,!0)},scroll(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==e.get().peer){var i=a?n.getScrollHeight():40;!0===r&&(i=n.contHeight()),i="up"===t?-i:i,a||r?E(i,()=>{f(i,n)}):(n.scrollTop(n.scrollTop()+i),f(i,n))}},showCreation(e,t){g().showCreation(e,t)},updateScroll:()=>Si(v,n,t),toggleBarDate(e){y.toggle(e)},changedMessageSelection(e){o.changedMessageSelection(e)},updateOnline(e,t){Object(r.ic)(t.get(),e)&&e===t.get().peer&&o.renderPeer(t)},isEmpty:e=>u.isEmpty(e),replaceAttachmentPlaceholders(e,a){if(Object(r.bc)(a.peerId,e.get()))Ei(y,ti(t),n,()=>{var s=vi(n);Object(r.Uc)(t,a,e.get());var l=Object(i.s)(e,a.peerId);if(l.mediacontent[a.messageId].length>=3&&l.mediacontent[a.messageId][2].pinned){var c=Object(i.W)(l.pinned);c&&c.messageId==a.messageId&&(l.pinned=l.mediacontent[a.messageId][2].pinned,o.reRenderPinned(e))}s&&n.scrollBottom(0)}),y.update(n);else if(Object(s.q)(a)){var l=Object(i.s)(e,a.peerId);if(l.mediacontent[a.messageId].length>=3&&l.mediacontent[a.messageId][2].pinned){var c=Object(i.W)(l.pinned);c&&c.messageId==a.messageId&&(l.pinned=l.mediacontent[a.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,a){var i=e.get();Object(r.bc)(a.peerId,i)&&(Ei(y,ti(t),n,()=>{var e=vi(n);Object(r.Vc)(t,a,i),e&&n.scrollBottom(0)}),y.update(n))},removeMessages(e,a,i){i.get().peer===a&&(Object(r.Ac)(e,ti(t)),Object(r.zc)(e,ti(t)),Si(i,n,t),o.changedMessageSelection(i),this.updateObserver())},removeStartingFromMessage(e,a,i){if(i.get().peer===a){var s=ti(t),l=geByClass1("_im_mess_"+e,s);Object(r.Cc)(l,s),Si(i,n,t),o.changedMessageSelection(i)}},hideGoToEnd(e){Mi(v,t,e)},hideGoToMention(e){Li(v,t,e)},removeMessagesRestore(e,n,a,i){i.get().peer===n&&Object(r.Bc)(e,n,a,ti(t))},removeExpiredFailedMessages(e){v.get().peer===e&&v.set(a.Ub.bind(null,ti(t),e))},handleMessageExpiration(e){Object(r.Sb)(v.get(),e.peerId)&&(Object(r.Wc)(v,t,e),Object(r.Xc)(t,e),u.detachMessages(e))},updateState(e,t){g().updateState(e,t)},updateBanner(e){w.renderPeer(e)},updateHeader(e){o.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(o.changeActions(e),o.renderPeer(e),o.renderActions(e),w.renderPeer(e),u.updateState(e),Object(a.rd)(e.get()))},focustTxt(e){u.focusOn(e)},startSearch(e){e.get().peer&&(m().showSearch(e),p.changePeer(e.get().peer,e),p.search())},showSearch(e){addClass(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),Kr(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout(()=>p.focus(e),10)},cancelSearch(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.get().searchShown&&(removeClass(t,"im-page--hisory_search-open"),removeClass(t,"im-page--history_search"),removeClass(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),Kr(e)&&this.updateChatTopic(e.get().peer,e),o.changedMessageSelection(e)),i&&!Object(r.fc)(e.get().peer)&&S){var s=e.get().tabs[e.get().peer],l=Object(a.Qc)(s.history);l?ti(t).innerHTML=l:m().showEmptyScreen(),Si(e,n,t),n.scrollBottom(0),e.get().msgid&&(ui(n,t,e.get().msgid,e),_i(e,t),pi(e,t)),O(n),y.reset(n)}S&&(S.unmount(),S=!1,Object(r.db)(t))},showEmptyScreen(){var e=geByClass1("_im_peer_history",t);addClass(t,"im-page--history_empty-hist");var n=Object(i.x)(v,v.get().peer)?getTemplate("sImEmptyCasper"):getLang("mail_im_here_history");val(e,n)},updateHistory(e){0!==v.get().peer&&e(t)},focusOnMessage(){ui(n,t,v.get().msgid,v)},sendEditMessage(e,t){e.set(a.E.bind(null,Object(i.s)(e,t.peerId),t)).catch(n=>e.get().longpoll.push([Object(d.e)(t.peerId,t,n)]))},unmount(){Object(c.c)(e),n.destroy(),clearInterval(j),u.unmount(),o.unmount(),b.unmount(),h.unmount(),p.unmount(),y.unmount(),cancelStackFilter("forward"),$r("_im_chat_resize_track",t),k.destroy()},removePeer(e,t){g().removePeer(e,t)},restoreScroll(e,t){var a=e.get().tabs[t];a.scrollBottom?ni(a,n):n.scrollBottom(-30)},resendMessage(e,n){e===v.get().peer&&Object(r.Gd)(e,n,t)},resendPeer(){u.resendPeer()},resendAll(){u.resendAll()},respond(e,t){u.attachMessages(e,t),u.focusOn(e);var a=Object(i.s)(e,t);a&&!a.skipped&&(n.scrollBottom(-30),O(n))},cancelRecording(){u.cancelRecording()},flushDraft(e){u.saveText(e)},hideError(){geByClass1("_im_error",t).classList.remove("im-page--error--visible")},showError(e){var a=geByClass1("_im_error",t);a.innerHTML=e,a.classList.add("im-page--error--visible"),n.scrollBottom(-30)},startEditing(e){if(Object(a.Z)(v.get()))Object(r.Cd)();else{e=Object(i.W)(e);var n=Object(r.wb)(v);if(!(u.isBlocked()||n&&n.messageId==e.messageId)){n&&this.cancelEditing(),Ni(t),v.get().searchShown&&this.cancelSearch(v);var s=Xr(t,e.messageId);s&&(this.cancelRecording(),function(e,t,n,a,r){e.setState({isEditing:!0}),n.saveText(e),addClass(a,"im-mess_is_editing"),addClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackPush("cancel_edit",()=>Ai(e,t,n,a,r));var i=new Gn.a;i.dData.txt=Object(Wn.b)(r.text),i.dData.attaches=Object(K.b)(r.kludges,r.messageId),n.toggleStickers(e,!1),n.setDraft(e,i),setTimeout(()=>n.focusOn(e),0)}(v,t,u,s,e),u.hideKeyboard(),o.deselectAll(v))}}},cancelEditing(){var e=Object(r.wb)(v);e&&Ai(v,t,u,Xr(t,e.messageId))},messageKeyboardButtonClick:e=>Ui(u,v,e),getEditingMessage:()=>Object(r.wb)(v),focusEditingMessage(){var e=Object(r.wb)(v);e&&ui(n,t,e.messageId,v),u.focusOn(v)},setNetworkWaitingStatus(e){o.setNetworkWaitingStatus(e)},setNetworkReconnectingStatus(){o.setNetworkReconnectingStatus()},clearNetworkStatus(){o.clearNetworkStatus()},updateCasperMessageStatus(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(r.Sb)(v.get(),e.peerId)&&v.set(a.hd.bind(null,e,n)).then(()=>{v.get().peer===e.peerId&&Object(r.ed)(t,n,e.messageId)})},updateObserver(){C.update()},renderPeerProfile(e){k.render(e)},destroyPeerProfile(){k.destroy()}}}function Gi(e,t,n,o,u){var m=geByClass1("_im_peer_history_w",e);Object(Ln.a)()&&addClass(m,"history_a11y");var g,_,p,f=Object(c.b)(Wi),v=f.callMutations,O=f.bindMutations,j=(g=ri.bind(null,t),_=Object(G.a)(g,100),p=Object(l.o)(g,100),e=>{_(e),p(e)}),y=yr(t,e),w=li.bind(null,t,v,m,j,y,e),C=Object(h.a)(geByClass1("_im_chat_body_abs",e),{onScroll:w,nativeScroll:Object(r.Mb)(t),shadows:!1}),k=Object(r.Mb)(t)?void 0:C.scroll.container,S=function(e,t,n){var a=Object(b.a)({observer:new IntersectionObserver(n,{root:t}),targets:[]});lr(e,t,a);var r=Object(c.a)({handlers:(e,t)=>{}});return{update(){lr(e,t,a)},unmount(){var e=a.get(),t=e.observer;e.targets.forEach(t.unobserve.bind(t)),Object(c.c)(r)}}}(t,k,e=>function(e,t,n){var r=Object(H.b)(e);if(r){var o=n.reduce((t,n)=>{if(n.isIntersecting){var a=+n.target.getAttribute("data-msgid"),o=Object(i.m)(e,r.peerId,a);a&&o&&!Object(s.r)(o)&&t.push(a)}return t},[]);if(o.length){var l=Math.max(...o);ci(e,l).then(()=>{l===r.lastmsg&&e.set(e=>Object(a.Bc)(e)).then(()=>t().updateActions(e))})}}}(t,v,e));setTimeout((function(){var n=t.get().peer;if(n){if(Di(t),(Object(H.b)(t).pinned||Object(H.b)(t).top_banner)&&(v().updateChatTopic(n,t),t.set(a.Bc),E.changeActions(t)),Object(H.b)(t).callInProgress&&v().updateBanner(t),t.get().msgid)ui(C,e,t.get().msgid,t);else if(!di(C,e,v,t,y)){C.scrollBottom(-30);var s=Object(H.b)(t);Object(r.kc)(s)&&t.set(e=>Object(a.zb)(s.peerId,e))}t.get().history_init=!1,Object(i.x)(t,n)?y.disable():y.reset(C),_i(t,e),pi(t,e),li(t,v,m,j,y,e,0,C),Object(r.db)(e),nav.objLoc.st&&(t.mutate(a.Jc.bind(null,nav.objLoc.st,n)),v().startSearch(t))}else y.disable()}),15);var E=Object(ht.b)(geByClass1("_im_dialog_actions",e),t,v),I=Fa(geByClass1("_im_text_input",e),t,Object(r.Mb)(t)?o.updateMenu:void 0,(e,t)=>{n.removeDialog(e,t),n.restoreDialogs(e,!0)},v),T=Xa(geByClass1("_im_dialog_actions",e),t,v),M=ir(e,t,v),L=or(e,t,()=>({changedMessageSelection:E.changedMessageSelection})),x=Object(cr.b)(m);Object(dr.b)(e,t,v);var P=Pr(e,t,()=>({hidePinned(){Object(dr.c)(t,t.get().peer,v,!1)},compensateHistoryHeightChange(e){v().compensateHistoryHeightChange(e)},showPinned(){Object(dr.d)(t,t.get().peer,v,!1)}}));Object(r.fc)(t.get().peer)||t.set(a.ic.bind(null,t.get().peer)).then(()=>{Object(r.bd)(t.get().peer,t.get(),ti(e)),Zr(e,t,t.get().peer)}),AudioMessagePlayer.events.on("listened",qi.bind(null,t)),Qr("_im_chat_resize_track",e,u);var B=Oi.bind(null,t,e,v),D=ji.bind(null,t,e,C,v),A=e=>{cancelEvent(e),function(e,t){e().showCreation(t)}(u,t)},N=Ci.bind(null,v,t,e,C),R=ki.bind(null,v,t,e,C),F=ei.bind(null,t,e),U=r.nd.bind(null,t),K=r.ud.bind(null,t),z=gi.bind(null,t,B,e,v),V=Jr.bind(null,t,e,C),W=xi.bind(null,v,t,C),X=Pi.bind(null,t),Q=Bi.bind(null,t,v),$=Fi.bind(null,t,v,e),Y=Ui.bind(null,I,t),J=Yr.bind(null,v),Z=r.kd.bind(null,t,e),ee=()=>showWiki({w:"expired_messages"}),te=Ki.bind(null,t),ne=e=>function(e,t){var n=t.target.closest("._im_call_snippet_join_btn"),a=n.closest("._im_mess_callsnippet"),i=n.dataset.link,s=+a.dataset.peer;Object(r.Kb)(e,s)&&Object(r.qc)(e,s,i,!1,r.e)}(t,e),ae=zi.bind(null,t,e),re=Object(c.a)({handlers:(n,s)=>{s(e,"click",r.H,D),s(e,"mouseover click",r.v,F),s(e,"mouseover","_im_edit_time",U),s(e,"mouseover","_im_page_info",K),s(e,"click","_im_mess_susp",Gr.bind(null,e)),s(e,"click","_im_failed_action",z),s(e,"click","_im_mess_link",V),s(e,"mouseover","_im_admin_name",Ii),s(e,"mouseover","_im_mess_srv",X),s(e,"mouseover","im-mess-stack--bomb",Z),s(e,"mouseover","mem_pseudolink",e=>function(e,t){var n=e.target.dataset.mention,a=null;switch(!0){case gt.a.all.includes(n):a=getLang("mail_im_mention_all");break;case gt.a.online.includes(n):a=getLang("mail_im_mention_online")}a&&(window.tooltips&&window.tooltips.destroy(e.target),Object(q.c)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>Object(r.qb)(t)+37,text:a,noZIndex:!0}))}(e,t)),s(e,"mouseover","_im_mess_pinned",ae),s(e,"click","im_srv_mess_link",Q),s(e,"click","_im_error",J),s(e,"click","_im_replied_message",$),s(e,"click","_im_replied_author_link",Hi),s(e,"click","_chat_invitation",(e,n)=>{if(checkEvent(e))return!0;if(!gpeByClass("wall_postlink_preview_btn",e.target)&&!hasClass(e.target,"wall_postlink_preview_btn"))return!0;var i=geByClass1("flat_button",n),s={invite_chat_id:domData(i,"inv-id"),invite_hash:domData(i,"hash")};Object(r.sd)(t,s,a.fb),cancelEvent(e)}),s(e,"click","_im_join_call_by_link",r.Bb),s(e,"click","_im_join_cancel",()=>t.get().longpoll.push([Object(d.g)()])),s(e,"click","_im_retry_media",e=>function(e,t,n){var s=e.get(),o=domClosest("_im_mess",n.target),l=domData(o,"msgid"),c=Object(i.m)(s,s.peer,l),d=e=>t().replaceAttachmentPlaceholders(e,c);c&&(Object(mt.j)("retry_attach"),e.set(a.g.bind(null,c,[Object(r.Mc)(e,c)])).then(d),e.set(a.rb.bind(null,c)).then(d))}(t,v,e)),s(e,"click",r.A,Y),s(e,"click","_im-call-snippet",te),s(e,"click","_im_call_snippet_join_btn",ne),n(geByClass1("_im_peer_history_w",e),"mousemove",y.show),n(geByClass1("_im_start_new",e),"click",A),n(e.querySelector("._im_to_end"),"click",N),n(e.querySelector("._im_to_mention"),"click",R),n(geByClass1("_im_cancel_edit",e),"click",()=>(v().cancelEditing(),!1)),n(geByClass1("_im_edit_focus_cur",e),"click",()=>(v().focusEditingMessage(),!1)),bt.a.raw&&n(document,bt.a.raw.fullscreenchange,W),n(window,"im_goToMessage",e=>{var n=intval(e.msgid);if(n)return window.statlogsValueEvent("im_links_to_attachments",1,"to_message"),t.set(a.r.bind(null,e.sel,n,!1)).then(()=>Object(r.eb)(t,v().focusOnMessage,t.get().peer,n))}),s(e,"click","im-expired-message--in",ee)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?Object(dr.c)(t,e.peer,v,!1):Object(dr.d)(t,e.peer,v,!1)}],window.showForwardBox=e=>function(e,t){Object(r.P)(showBox("al_im.php",t,{dark:1},{}),e)}(t,e);var ie=setInterval(mi.bind(null,t,e,E),1e4);return Object(_t.e)(t)===gt.d&&Object(Ar.d)(t.get().viewer_id),O(re,e,C,E,I,v,u,T,M,L,w,t,j,ie,y,P,S,x)}function Xi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var $i=[],Yi=0,Ji=!1;function Zi(e){$i=$i.reduce((t,n)=>{var a=Xi(n,2),r=a[0],i=a[1];return i(e)?t:t.concat([[r,i]])},[])}function es(e,t){!1===Ji&&(Ji=!0,document.body.addEventListener("click",Zi,!0)),$i=$i.concat([[e,t]])}function ts(e){$i=$i.filter(t=>Xi(t,1)[0]!==e),0===Yi&&(document.body.removeEventListener("click",Zi,!0),Ji=!1)}function ns(e,t){$i=$i.map(n=>{var a=Xi(n,2),r=a[0],i=a[1];return r===e?[e,t]:[r,i]})}function as(e,t){return 0===t.length?t=>(e(t),!0):n=>{var a=t.reduce((e,t)=>e&&!domClosest(t,n.target),!0);return a&&e(n),a}}var rs=n("XzvV"),is=n("e87a"),ss=n("GSQL"),os=n("CGHU"),cs=n("8tCR"),ds=n("p9ed"),us=n("RdBX"),ms=n("Aegd"),gs=n("85vT"),_s=n("6krn"),ps=n("5R8M"),bs=n("xt6h"),hs=function(e){var t=e.onClose,n=e.contacts,a=e.selectPeer,i=Object(Ut.useState)(""),s=i[0],o=i[1],l=Object(Ut.useState)(n),c=l[0],d=l[1],u=Object(Ut.useMemo)((function(){return new us.a(n,(function(e){return[e.name,e.user&&e.user.full_name].filter(Boolean).join(" ")}))}),[n]);Object(Ut.useEffect)((function(){if(0!==s.length){var e=u.search(s);d(e)}else d(n)}),[s]);return Kt.a.createElement("div",{className:"ContactsListContent"},Kt.a.createElement(os.a,{onChange:function(e){return t=e.target.value,void o(t);var t},placeholder:Object(_s.b)("mail_top_search"),autoFocus:!0,key:"search",value:s}),0===c.length?Kt.a.createElement(cs.default,{className:"ContactsListContent__stub",key:"no-results"},Object(_s.b)("mail_im_search_empty_contacts")):Kt.a.createElement(Wt.a,{className:"ContactsListContent__scroll"},Kt.a.createElement(ds.a,{className:"ContactsListContent__list"},c.map((function(e){var n=e.user&&e.user.user_id?e.user.user_id:Object(z.a)(e.id),i=Object(r.xc)(e.name),s=e.can_write,o=Object(bs.a)("ContactsListContent__item",{"ContactsListContent__item--disabled":!s});return Kt.a.createElement(ps.default,{key:e.id,onClick:s?function(){return function(e){a(e),t()}(n)}:void 0,className:o,selectable:s},Kt.a.createElement("div",{className:"ContactsListContent__contactAvatar"},e.photo?Kt.a.createElement("img",{className:"ContactsListContent__contactAvatarImage",src:e.photo,alt:e.name}):Kt.a.createElement(ms.a,{text:Object(r.Ab)(e.name),size:"34",id:n,specificType:7,key:e.id})),Kt.a.createElement("div",{className:"ContactsListContent__contactName"},Kt.a.createElement(gs.default,null,i)))})))))},fs=n("QDnf"),vs=function(e){var t=e.onClose,n=e.selectPeer,a=e.getContactsList,r=Kt.a.useState({kind:"loading"}),i=r[0],s=r[1];switch(Kt.a.useEffect((function(){a().then((function(e){s({kind:"loaded",contactsList:e})})).catch((function(e){Object(l.m)(Object(_s.b)("global_error")),s({kind:"failed",error:e}),t()}))}),[]),i.kind){case"failed":return Kt.a.createElement(Kt.a.Fragment,null);case"loading":return Kt.a.createElement(fs.a,null);case"loaded":return Kt.a.createElement(is.default,{onClose:t,disableBodyScroll:!0,className:"ContactsList"},Kt.a.createElement(ss.default.Header,{title:Object(_s.b)("mail_contacts_list"),onClose:t,appearance:"blue"}),Kt.a.createElement("div",{className:"ContactsList__body"},Kt.a.createElement(hs,{contacts:i.contactsList,onClose:t,selectPeer:n})))}};function Os(e,t){var n=js();zt.render(Ut.createElement(vs,{onClose:t.closeContactList,getContactsList:()=>function(e){return Object(ht.a)(e).then(e=>{var t=e.get().contactsList;return Promise.resolve(t)})}(e),selectPeer:t=>function(e,t){e.get().longpoll.push([Object(d.a)(t,!1,!0,!0,"contacts_list")])}(e,t)}),n)}function js(){var e=document.getElementById("_im_contacts_list");if(e)return e;var t=document.createElement("section");return t.setAttribute("id","_im_contacts_list"),document.body.appendChild(t),t}function ys(e,t){return{unmount:()=>function(e,t){var n=js();n&&zt.unmountComponentAtNode(n),Object(c.c)(e)}(e),closeContactList(){var e=js();zt.unmountComponentAtNode(e)}}}function ws(e){var t=(0,Object(c.b)(ys).bindMutations)(Object(c.a)({handlers:(e,t)=>{}}),e);return Os(e,t),t}function Cs(){return(Cs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ks(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ss(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ss(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ss(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Es=Object(G.a)(R.b,1e3);function Is(e,t,n,r,s,o,l){var c=trim(o);if(Object(i.S)(e,c)){var d=()=>l.clearSearch(e,t);c?(e.setState({recentSearch:!1}),s.stop()):s.replaceOrAdd(d),cancelStackPush("im_search",d),c&&e.set(e=>Object(a.Fc)(c,!1,e)).then(t),r.classList.add("im-page--dialogs-search_fill","_im_d_search"),Object(i.E)(e)||l.showCancelControl()}else c||(s.stop(),e.set(e=>Object(a.Fc)("",!1,e)).then(t),r.classList.remove("im-page--dialogs-search_fill","_im_d_search"),Object(i.E)(e)||l.hideCancelControl())}function Ts(e,t,n){return function(){var a=Object(i.q)(t);a===e&&n(...arguments)}}function Ms(e,t,n){var r=Object(i.q)(n);return Es(.01,"im_search_stat",1,"search_start"),Object(a.yd)(r),n.setState({recentSearch:!1}),e().toggleSettingsButton(n,!!r),r?(n.get().dialog_search_going=!0,function(e,t,n){var r=Ts(e,n,e=>t().appendFastDialogs(n,e));return Object(a.vc)(e,n.get()).then(e=>(r(e),e))}(r,e,n).then(a=>{var i=a.map(e=>e.peerId);return t(r,e,i,n)}).then(()=>{n.get().dialog_search_going=!1}).catch(()=>{})):(e().restoreDialogs(n,!1,!0),Object(rs.s)("messages"),Promise.resolve(!1))}function Ls(e,t,n,i){var s=i.get(),o=Ts(e,i,e=>t().appendDialogs(i,e)),l=Ts(e,i,t().appendSearch);return Object(r.ec)(i)?Object(a.pc)(e,n,"all",{},s).then(o):Promise.all([Object(a.pc)(e,n,"all",{},s).then(o),Object(a.tc)(e,s)]).then(e=>{var t=ks(e,2),n=ks(t[1],2),a=n[0],r=n[1];l(i,a,r,!0)})}function xs(e,t,n){var r=n.target;e.set(e=>Object(a.Wc)(t,e)).then(()=>{r.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&Ps(e,{target:r})})}function Ps(e,t){var n=t.target;return Object(q.c)(n,{text:()=>e.get().mute?Object(Mn.d)("mail_im_sound_off"):Object(Mn.d)("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function Bs(e,t,n,a,r,s,l,d,u){return{focusInput(){uiSearch.focus(a.parentNode)},hideCancelControl(){n.classList.remove("im-page--dialogs-header-controls_hidden"),t.classList.add("im-dialog-select_hidden"),t.classList.remove("im-dialog-select_rotated")},showCancelControl(){n.classList.add("im-page--dialogs-header-controls_hidden"),t.classList.add("im-dialog-select_rotated"),t.classList.remove("im-dialog-select_hidden")},setSearch(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?u:()=>{};a.value=t,Is(e,n,0,a,s,t,d())},clearSearch(e,t){cancelStackFilter("im_search"),Object(i.E)(e)||d().hideCancelControl(),uiSearch.reset(a),e.setState({recentSearch:!1}),Is(e,t||(()=>{}),0,a,s,a.value,d())},initPeerTagsFilter(e){Object(o.c)(e)},unmount(){s.stop(),Object(c.c)(l),uiSearch.destroy(r),cancelStackFilter("im_search")}}}function Ds(e,t,n){var s=Object(c.b)(Bs),l=s.callMutations,u=s.bindMutations,m=geByClass1("_im_dialogs_header_controls",e),g=geByClass1("_im_create_convo",e),_=geByClass1("_im_create_call",e),p=geByClass1("_im_search_cancel",e),b=ge("im_dialogs_search",e),h=geByClass1("_im_gim_mute",e),f=geByClass1("_im_av_time",e),v=geByClass1("_im_peer_tags_filter_control",e),O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Yi++,{stop(){Yi--,ts(e)},replaceOrAdd(n){var a=$i.filter(t=>{var n=Xi(t,1)[0];return e===n}),r=as(n,t);a.length>0?ns(e,r):es(e,r)}}}("im_search",["_im_search_more","_im_create_convo","_im_create_call","_im_page_dcontent","_im_d_search","_im_dialog"]),j=Object(bn.b)(Ls,300),y=e=>Ms(n,j,e),w=e=>Is(t,y,0,b,O,e,l()),C=()=>l().clearSearch(t,y),k=geByClass1("_im_dialogs_search_input",e);uiSearch.init(k,{onChange:w}),b.value&&setTimeout(()=>w(b.value),0);var S=e=>{Object(q.c)(e.target,{text:Object(Mn.d)("mail_admin_av_time"),dir:geByClass1("_im_top_notice")||geByClass1("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},E=()=>{var e;e=0===t.get().peer||Object(r.ec)(t)?"search":"default",Object(i.R)(t)||n().toggleSettingsButton(t,!1),t.get().longpoll.push([Object(d.h)(e)])},I=()=>{Object(i.R)(t)&&n().toggleSettingsButton(t,!0),function(e,t,n,s,o,l){if(!Object(i.R)(e)){var c=cur.imDb.select(Cr.b);if(0!==c.length||Object(i.c)(e)){e.setState({recentSearch:!0}),Is(e,()=>{Object(i.R)(e)||(s.stop(),o().toggleSettingsButton(e,!1),o().restoreDialogs(e,!1,!0))},0,n,s,"",l);var d=c.filter(t=>!Object(r.jc)(e.get(),t)),u=c.filter(t=>Object(r.jc)(e.get(),t)).reduce((t,n)=>(t[n]=Object(i.s)(e,n),t),{});e.get().topConvTree.then(t=>{var n=t.list.filter(e=>d.includes(e[0])).reduce((e,t)=>(e[t[0]]=Object(a.wb)(t),e),{}),r=Cs({},n,{},u);return o().appendFastDialogs(e,c.map(e=>r[e])),n}).then(t=>Object(a.pc)(!1,Object.keys(t),!1,{},e.get())).then(t=>{o().appendDialogs(e,t)})}}}(t,0,b,O,n,l())},T=(e,n)=>{switch(n.dataset.action){case"contacts":ws(t);break;case"favorites":nav.go("/im?box=fav")}},M=Object(c.a)({handlers:(a,s)=>{a(p,"click",C),a(p,"mouseover",()=>function(e,t){return Object(q.c)(t,{appendEl:bodyNode,text:Object(Mn.d)("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,p)),a(g,"click",()=>n().showCreation(t)),a(_,"click",()=>Object(r.Fd)(t,null,!1,null,r.f)),s(e,"click","_im_search_more_action",T),f&&a(f,"mouseover",S),Object(i.E)(t)&&h&&(a(h,"click",e=>xs(t,!0,e)),a(h,"mouseover",e=>Ps(t,e))),a(b,"click",I),a(b,"blur",E),a(b,"focus",()=>{t.get().longpoll.push([Object(d.h)("search")])}),Object(i.E)(t)&&v&&(s(e,"change","_im_peer_tags_filter_checkbox",e=>Object(o.i)(e,t)),s(e,"click","_im_peer_tags_filter_pane_item",e=>Object(o.j)(e,t)))}});return Object(i.E)(t)&&(v?Object(o.c)(t):h&&xs(t,!1,{target:h})),u(e,p,m,b,k,O,M,l,y)}function As(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ns(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ns(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Rs(e,t,n,i){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var s=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(r.Rd)(s)(Object(a.vb)(e.offset,i.get().gid).then(t=>{var n=As(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(s,"im-important_all"):e.loading=!1,i.set(a.Db.bind(null,Object(r.Hd)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,s.appendChild(c),Object(r.db)(s)}),"bottom")}}function Fs(e,t){var n=t.get().selectedMessages,a=geByClass1("_im_spam_box",e.bodyNode),i=geByClass1("ui_tab_sel",e.bodyNode);if(n.length>0){var s=getLang("mail_selected",n.length);s=s.replace("{count}",n.length),val(i,s+`<button aria-label="${getLang("mail_deselect_all")}" type="button" class="im-deselect ${r.u}"></button>`)}else val(i,getLang("mail_spam"));0===n.length?removeClass(a,"im-important-box_with-sel"):(addClass(a,"im-important-box_with-sel"),val(geByClass1("_im_spam_not_spam"),getLang("mail_im_mark_notspam",n.length)),val(geByClass1("_im_spam_spam"),getLang("mail_im_mark_delspam",n.length)))}function Hs(e,t,n){var r=e.get().selectedMessages;e.set(a.v).then(n.cleanSelection.bind(null,r)).then(n=>Fs(t,e))}function qs(e,t,n,i){var s=gpeByClass("_im_mess",i,t);if(s){var o=intval(domData(s,"msgid"));s&&(Object(a.Xb)([o],0,e.get().tabs[0].hash,"undel",e.get()),Object(r.ad)(o,0,t))}}function Us(e,t,n){var i=e.get().selectedMessages;Object(a.Xb)(i,0,e.get().tabs[0].hash,"delete",e.get()),Object(r.Bc)(i,0,"delete",t),Hs(e,t,n)}function Ks(e,t,n){var i=e.get().selectedMessages;Object(a.Xb)(i,0,e.get().tabs[0].hash,"nospam",e.get()),i.map(e=>geByClass1("_im_mess_"+e)).filter(e=>e).forEach(e=>{var t=intval(domData(e,"peer")),n=intval(domData(e,"msgid"));val(e,Object(r.Lc)(t,n)),addClass(e,"im-mess_light")}),Hs(e,t,n)}function zs(e,t,n,a,r){var i=gpeByClass("_im_mess",r,t.bodyNode),s=intval(domData(i,"peer")),o=intval(domData(i,"msgid"));return t.hide(),n().unmount(),e.get().longpoll.push([Object(d.a)(s,o)]),Object(Yt.j)(a),cancelEvent(a),!1}function Vs(e,t,n,r){var i=Object(vt.d)({title:getLang("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},getLang("mail_delete_all_spam"),getLang("mail_delete"),()=>{Object(a.L)(e,r).then(e=>{var t=As(e,2),n=(t[0],t[1]);showDoneBox(n)}),i.hide(),t.hide(),n().unmount()},getLang("mail_close"),()=>i.hide())}function Ws(e,t){return{unmount(){t.unmount(),Object(c.c)(e)}}}function Gs(e,t,n){var a=ge("box_layer_wrap"),i=Object(c.b)(Ws),s=i.callMutations,o=i.bindMutations,l=Object(b.a)({peer:0,oCache:{},tabs:Object(r.Hd)(n.msgs,n.hash),gid:t.get().gid}),d=Rs.bind(null,{all:n.all,loading:!1,offset:n.offset},e,a,l),u=qs.bind(null,l,e.bodyNode),m=zs.bind(null,t,e,s),g=Vs.bind(null,n.hash,e,s,t.get().gid),_=or(e.bodyNode,l,t=>({changedMessageSelection:Fs.bind(null,e)})),p=Us.bind(null,l,e.bodyNode,_),h=Ks.bind(null,l,e.bodyNode,_),f=Hs.bind(null,l,e,_);return Object(r.db)(e.bodyNode),o(Object(c.a)({handlers:(t,n)=>{t(a,"scroll",d),t(geByClass1("_im_spam_spam",e.bodyNode),"click",p),t(geByClass1("_im_spam_not_spam",e.bodyNode),"click",h),t(geByClass1("_im_spam_flush",e.bodyNode),"click",g),n(e.bodyNode,"click","_im_mess_restore",u),n(e.bodyNode,"click","_im_go_to",m),n(e.bodyNode,"click",r.u,f)}}),_)}var Xs=n("8/qD"),Qs=n("4edV"),$s=n("Iqrf"),Ys=Object(G.a)(Xs.b,400);function Js(e,t,n,a){void 0===a&&(a=!0);var r,i=t.toString();return a?(Ys(e,i),r=Promise.resolve(t)):r=Object(Xs.b)(e,i),r.then((function(){return Object(Qs.d)(e,t,n)}))}var Zs=Object(bn.b)($s.d,3e3);function eo(e){return e.isRecommendationListNeedUpdate=!1,e.isRecommendationListEnabled?Zs().then((function(t){var n=t[0];return n&&(e.recommendationList=n,e.isRecommendationListNeedUpdate=!0),e})).catch((function(t){if("debounce"===t)return e;throw t})):Promise.resolve(e)}var to=n("MNOG");function no(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"im_settings",n={sound:ls.get("sound_notify_off")?getLang("mail_im_sound_off"):getLang("mail_im_sound_on"),showOnlyNotMuted:Object(_t.d)(e,"show_only_not_muted_messages")?getLang("mail_show_only_not_muted_off"):getLang("mail_show_only_not_muted_on")};return window.pushNotifier&&window.pushNotifier.loadEndpoint()||Object(Dr.b)("push_notifier")&&ls.get("im_ui_notify_off")?n.browser=getLang("mail_notification_settings"):n.browser=io()?getLang("mail_im_notifications_on"):getLang("mail_im_notifications_off"),n.showRecommendationBlock=Object(_t.d)(e,"messages_recommendation_list_hidden")?getLang("mail_show_recommendation_block"):getLang("mail_hide_recommendation_block"),getTemplate(t,n)}function ao(e){return hasClass(e,"_im_settings_popup")?"im_settings_pop":"im_settings"}function ro(e,t){Object(q.c)(t.target,{content:no(e,"im_settings_pop"),dir:"down",shift:[220,9],hasover:!0,showdt:10})}function io(){return DesktopNotifications.supported()&&!DesktopNotifications.checkPermission()&&!ls.get("im_ui_notify_off")}function so(e,t,n,a,i){var s=domData(i,"action"),o=gpeByClass("_im_settings_menu",i),l=ao(o);switch(s){case"spam":Object(r.yd)(e,Gs,a);break;case"sound":ls.set("sound_notify_off",ls.get("sound_notify_off")?0:1),o.outerHTML=no(e,l);break;case"browser":io()?(ls.set("im_ui_notify_off",1),o.outerHTML=no(e,l),Object(mt.a)()):DesktopNotifications.checkPermission()?DesktopNotifications.requestPermission(()=>{o.parentNode&&(o.outerHTML=no(e,l))}):Object(Dr.b)("push_notifier")?nav.go("/settings?act=notify"):(ls.set("im_ui_notify_off",0),o.outerHTML=no(e,l),Object(mt.b)());break;case"showOnlyNotMuted":var c=Object(_t.d)(e,"show_only_not_muted_messages")?0:1;e.set(e=>Js("show_only_not_muted_messages",c,e,!0)).then(t=>{o.outerHTML=no(e,l),Object(to.a)(t)});break;case"recommendation":var d=Object(_t.d)(e,"messages_recommendation_list_hidden")?0:1;e.set(e=>Js("messages_recommendation_list_hidden",d,e,!!d)).then(()=>{o.outerHTML=no(e,l),d?t().setRecommendationListVisibility(!1):nav.reload()})}}function oo(e,t,n){var s=ro.bind(null,t),o=so.bind(null,t,n,e),l=function(e,i){Object(r.Ad)(t,n,a.q).then(e=>{if(e){var a=t.get().active_tab===p.n;val(i,getTemplate("im_filter",{filter:a?getLang("mail_to_all_dialogs"):getLang("mail_to_unread")})),t.get().active_tab===p.g&&n().updateRecommendationList(t)}})},d=Object(c.a)({handlers:(t,n)=>{n(e,"mouseover","_im_dialogs_cog_settings",s),n(e,"click","_im_settings_action",o),n(e,"click","_im_to_unread",l)}});return function(e,t){return{updateFilter(t){var n,a=t.get().active_tab===p.n,r=[];Object(i.R)(t)&&r.push("im-page--dialogs-filter_hidden"),Object(_t.i)(t)>0?n=a?getLang("mail_to_all_dialogs"):getLang("mail_to_unread"):(n=getLang("mail_all_dialogs"),r.push("im-page--dialogs-filter_disabled")),val(geByClass1("_im_to_unread",e),getTemplate("im_filter",{filter:n,cls:r.join(" ")}))},toggleButton(t,n){var a=geByClass1("im-page--dialogs-filter",e);toggleClass(a,"im-page--dialogs-filter_hidden",n)},toggleLoader(t,n){var a=geByClass1("_im_dialogs_cog_settings",e);toggleClass(a,"im-page--dialogs-settings_loading",n)},updateSettings(t){var n=geByClass1("_im_settings_menu",e),a=ao(n);n.outerHTML=no(t,a)},unmount(){Object(c.c)(t)}}}(e,d)}var lo=n("iukX"),co=n("amDN");function uo(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function mo(e){return e.selection=[],Promise.resolve(e)}function go(e,t){return t.selection=t.selection.filter(t=>t.id!==e),Promise.resolve(t)}function _o(e,t,n,a,r,i,s){var o=intval(domData(s,"peer"));tooltips.hide(s),t.set(go.bind(null,o)).then(i=>{bo(e,a,t,r),n().selectionDeleted(t,o)})}function po(e,t,n,r){e.set(a.Fc.bind(null,n,!1)).then(t().onChange)}function bo(e,t,n,a){var r=n.get().selection,i=uiSearch.getFieldEl(e);uiSearch.focus(e),r.length>0?attr(i,"placeholder",""):attr(i,"placeholder",unclean(Object(Mn.d)("mail_search_creation"))),t.innerHTML=r.map(e=>`<div class="token">\n      <div class="token_title">${e.name}</div>\n      <div data-peer="${e.id}" class="token_del _ui_multiselect_cancel"></div>\n    </div>`).join(""),toggleClass(e,"ui_multiselect_has_selection",r.length>0),domFC(e).scrollTop+=50,a()}function ho(e,t){return Object(q.c)(t,{text:Object(Mn.d)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function fo(e,t,n){uiSearch.init(e,{onChange:po.bind(null,t,n)});var a=uiSearch.getFieldEl(e),r=ce("div",{className:"_ui_multiselection ui_multiselect_cnt"});a&&a.parentNode.insertBefore(r,a);var i,s,o=(i=a,s=0,function(){var e=i.offsetWidth;setStyle(i,{width:1});var t=i.offsetLeft;s!==t?(s=t,e=i.parentNode.offsetWidth,setStyle(i,{width:Math.max(30,e-t-20)})):setStyle(i,{width:e})});t.set(mo);var l=_o.bind(null,e,t,n,r,o),d=t=>{document.activeElement!==a&&uiSearch.focus(e)},u=Object(c.a)({handlers:(t,n)=>{n(e,"click","_ui_multiselect_cancel",l),n(e,"mouseover","_ui_multiselect_cancel",ho),t(e,"click",d)}});return{addSelection:(n,a)=>t.set(uo.bind(null,{id:n,name:a})).then(bo.bind(null,e,r,t,o)),removeSelection:n=>t.set(go.bind(null,n)).then(bo.bind(null,e,r,t,o)),resetSelection(){!function(e,t,n,a){e.set(mo).then(bo.bind(null,t,n,e,a))}(t,e,r,o)},focus(){uiSearch.focus(e)},save(){t.stash(),bo(e,r,t,o)},restore(){t.pop(),bo(e,r,t,o)},unmount(){uiSearch.destroy(e),Object(c.c)(u)}}}var vo=n("v+DW"),Oo=n("zjLC"),jo="_im_dialogs_creation_name",yo="_im_create_select",wo=["im-creation--item_hovered"],Co=0;function ko(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),n=So.bind(null,t);zt.render(Ut.createElement(is.default,{onClose:n,className:"im-creation--modal-settings"},Ut.createElement(co.a,{title:Object(Mn.d)("mail_chat_creation_settings"),onCloseClick:n}),Ut.createElement(lo.a,{flags:Co,back:n,isChatCreation:!0,onSave:Eo,afterSave:Io.bind(null,t),onCancel:n})),t)}(e)}function So(e){e&&zt.unmountComponentAtNode(e)}function Eo(e){return Co=e,Promise.resolve()}function Io(e){So(e)}function To(e){return Object(q.c)(e,{text:Object(Mn.d)("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function Mo(e,t,n,r,i,s){Object(a.Xc)(!1),removeClass(t,"im-create_shown"),removeClass(t,"im-create_photo-attached"),setTimeout(xo.bind(null,t,!1),100),No(s).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>{removeClass(e,"olist_item_wrap_on")}),n().createCanceled(e),i.resetSelection(),"add_member"===e.get().creationType&&e.set(a.Ec.bind(null,"chat",[])),e.set(a.Mb.bind(null,!1));var o=geByClass1("_im_avatar_img",t);Po(e,s,t),uiSearch.reset(geByClass1(jo,t)),uiSearch.reset(geByClass1(yo,t)),o&&o.parentNode.removeChild(o),Po(e,s,t),cancelStackFilter("im_search");var l=0===e.get().peer?"search":"default";e.get().longpoll.push([Object(d.h)(l)]),attr(t,"aria-hidden","true")}function Lo(e,t,n){return t&&(n.current_create_peer_ids={},n.current_create_peers=[]),n.current_create_peer_ids||(n.current_create_peer_ids={}),n.current_create_peers||(n.current_create_peers=[]),e.forEach(e=>{e.then(e=>{e=e.filter(e=>!n.current_create_peer_ids[e.peerId]),n.current_create_peer_ids=e.reduce((e,t)=>(e[t.peerId]=!0,e),n.current_create_peer_ids),n.current_create_peers=n.current_create_peers.concat(e)})}),Promise.resolve(n)}function xo(e,t){toggleClass(e,"im-create_material",t)}function Po(e,t,n){var a=geByClass1("_im_confirm_creation",n),r=t.get().selection.length,i="add_member"===e.get().creationType,s=uiSearch.getFieldEl(geByClass1(jo,n)),o=r>0,l=(s?s.value.trim():"").length>0,c=!o&&(i||!l),d=i?1===r?Object(Mn.d)("mail_append_chat"):Object(Mn.d)("mail_im_create_chat_with"):l||r>1?Object(Mn.d)("mail_im_create_chat"):Object(Mn.d)("mail_im_go_to_dialog");val(a,d),toggleClass(a,"button_disabled",c)}function Bo(e,t,n,a,r,i,s){if(s){var o,l=intval(domData(s,"list-id")),c=No(i),d=trim(s.textContent),u=geByClass1(yo,t),m=getSize(u)[1];inArray(l,c)?(o=a.removeSelection(l,d),removeClass(s,"olist_item_wrap_on")):(o=a.addSelection(l,d),addClass(s,"olist_item_wrap_on")),o.then(()=>{var e=m-getSize(u)[1],t=r.scrollTop();r.scrollTop(t-e)}),Po(e,i,t);var g=geByClass1(yo,t);uiSearch.reset(g)}}function Do(e,t){var n=No(e),a=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],r=[];return t.online&&r.push("online"),mobPlatforms[t.online]&&r.push("mobile"),inArray(t.peerId,n)&&a.push("olist_item_wrap_on"),getTemplate("im_owner_item",{owner_id:t.peerId,cls:" "+a.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:r.join(" ")})}function Ao(e){return Object(i.q)(e)||!1}function No(e){return e.get().selection.map(e=>e.id)}function Ro(e,t,n){return e.then(e=>e.filter(e=>e.is_friend&&!inArray(e.peerId,n.get().creationFilter)))}function Fo(e,t,n,r,i){var s,o,l=geByClass1(yo,e),c=Object(a.sc)(r,t.get()),d=n.hoverFirstElement.bind(n,wo,Vo(t));t.get().creation_shown_all=!1,n.reset(),n.pipe(Ro(c,0,t),r),n.toTop(),r?(o=Object(a.vc)(r,t.get()),s=Object(a.qc)(r,[],"friends",t.get()),n.pipe(Ro(s,0,t),r).then(d),n.pipe(Ro(o,0,t),r).then(d)):(s=Promise.resolve([]),o=Promise.resolve([])),t.set(Lo.bind(null,[c,o,s],!0)),uiSearch.showProgress(l),Promise.all([c,s,o]).then(()=>uiSearch.hideProgress(l))}function Ho(e,t,n,r){var i=2e9+Math.round(rand(1e6,2e6));cur.recieveCropResult=n=>{cur.recieveCropResult=!1,curBox()&&curBox().hide(),e.set(a.Mb.bind(null,n)),Object(a.S)(n,i).then(e=>{geByClass1("_im_create_avatar",t).appendChild(ce("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))}),addClass(t,"im-create_photo-attached")},Page.ownerPhoto(i)}function qo(e,t){geByClass1("_im_create_avatar",t).innerHTML="",e.set(a.Mb.bind(null,!1)),removeClass(t,"im-create_photo-attached")}function Uo(e,t,n,a,r,i){No(t).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>removeClass(e,"olist_item_wrap_on")),t.reset(),Fo(n,e,a,!1,No(t)),r.resetSelection(),Mo(e,n,i,0,r,t)}function Ko(e,t,n,r,s,o,l){var c=No(t),u=e.get(),m=geByClass1("_im_confirm_creation",n),g=uiSearch.getFieldEl(geByClass1(jo,n)).value,_="add_member"===e.get().creationType,p=!_&&(g.length||c.length>1),b=geByClass1("_im_creation_show_history_input",n).checked;if(_)return e.set(a.k.bind(null,u.peer,c,b)).catch(e=>Object(vt.d)(Object(Mn.d)("global_error"),e)),Mo(e,n,o,0,s,t);if(Object(vo.o)(m),!p)return h(c[0]);function h(a){Co=0,Uo(e,t,n,r,s,o),function(e,t,n,a,r,i){Mo(e,t,n,0,r,i),e.get().longpoll.push([Object(d.a)(a,!1,!1,!1,"create_conversation")])}(e,n,o,a,s,t),Object(vo.w)(m),Object(i.R)(e)?o().cancelSearch(e):o().restoreDialogs(e)}e.set(e=>Object(Oo.c)(e,u.next_chat_avatar,c,g,Co)).then(()=>h(u.next_peer)).catch(e=>{Object(vo.w)(m),topMsg(Object(Mn.d)("global_unknown_error"),2,"#FFB4A3")})}function zo(e,t){return Object(q.c)(e,{text:Object(Mn.d)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function Vo(e,t){var n=t&&t.get().selection.length;return{top:-1,bottom:Object(r.Mb)(e)?n>0?69:0:-1}}function Wo(e,t,n){Po(e,t,n)}function Go(e,t,n,a,r,i,s,o){return{show(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.setState({shown:!0}),xo(e,!0),cancelStackPush("im_create",s),addClass(e,"im-create_shown");var o=a.get().selection.reduce((e,t)=>(e[t.id]=!0,e),{});i&&i.forEach(t=>{if(!o[t[0]]){var n=e.querySelector("._im_dialog"+t[0]);r.addSelection(t[0],t[1]),n&&!n.classList.contains("olist_item_wrap_on")&&n.classList.add("olist_item_wrap_on")}}),function(e,t,n,a){toggleClass(e,"im-create_chat","chat"===a.get().creationType),toggleClass(e,"im-create_invite","add_member"===a.get().creationType);var r="chat"===a.get().creationType?Object(Mn.d)("mail_im_group_dialog"):Object(Mn.d)("mail_im_friends_tab"),i=geByClass1("_im_create_title",e);val(i,r),val(geByClass1("_im_confirm_creation",e),"add_member"===a.get().creationType?Object(Mn.d)("mail_im_create_chat_with"):Object(Mn.d)("mail_im_create_chat")),Fo(e,a,t,!1,n.get().selection.map(e=>e.id))}(e,n,a,t),setTimeout(()=>{t.get().longpoll.push([Object(d.h)("create")]),attr(e,"aria-hidden","false"),r.focus()},1)},focusSearch(e){r.focus()},confirmCreate(e){o()},hide(n){n.get().shown=!1,Mo(n,e,t,0,r,a)},scroll(e){n.scrollPage(e,!0)},updateScroll(){n.updateScroll()},selectElement(t){Bo(t,e,0,r,n,a,n.getHoveredElement())},hoverPrevElement(e){n.hoverPrevElement(wo,null,Vo(e,a))},hoverNextElement(e){n.hoverNextElement(wo,null,Vo(e,a))},unmount(){Object(c.c)(i),n.unmount(),r.unmount(),cancelStackFilter("im_create"),cur.recieveCropResult=void 0}}}function Xo(e,t,n){var r=Object(b.a)({selection:[]}),i=A(geByClass1("_im_create_list",e),Object(b.a)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),()=>({idFn:e=>intval(e.peerId),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:Do.bind(null,r),more(e,n){var i;return t.get().shown?(t.get().creation_shown_all||!1!==Ao(r)?i=Promise.resolve([]):(t.get().creation_shown_all=!0,i=Object(a.vc)(Ao(r),t.get())),t.set(Lo.bind(null,[i],!1)),Ro(i,Ao(r),t)):Promise.resolve(!1)},onClick(n,a){checkEvent(n)||(Bo(t,e,0,d,i,r,a),cancelEvent(n))}}));t.get().creationQuery=!1,t.get().creationType="chat";var s=geByClass1(yo,e),o=Object(bn.b)(n=>function(e,t,n,a){var r=a.get(),i=Ao(r);r.selection.map(e=>e.id),n.unhoverElements(wo),e.get().creationQuery=i,Fo(t,e,n,i)}(t,e,i,n),300),d=fo(s,r,()=>({selectionDeleted(n,a){Po(t,n,e),removeClass(geByClass1("_im_dialog"+a),"olist_item_wrap_on")},onChange:o})),u=Mo.bind(null,t,e,n,"cross",d,r),m=Ho.bind(null,t,e),g=qo.bind(null,t,e),_=Uo.bind(null,t,r,e,i,d,n),p=Ko.bind(null,t,r,e,i,d,n),h=Wo.bind(null,t,r,e),f=ko.bind(null,e),v=geByClass1("_im_create_cancel",e),O=geByClass1(jo,e),j=geByClass1("_im_creation_settings",e),y=O.querySelector(".ui_search_reset"),w=Object(c.a)({handlers:(t,n)=>{t(v,"click",u),t(v,"mouseover",zo.bind(null,v)),t(geByClass1("_im_create_avatar",e),"click",m),t(geByClass1("_im_create_remove_avatar",e),"click",g),t(geByClass1("_im_cancel_creation",e),"click",_),t(O,"change",h),t(O,"input",h),t(O,"paste",h),t(y,"click",h),t(geByClass1("_im_confirm_creation",e),"click",p),t(j,"click",f),t(j,"mouseenter",To.bind(null,j)),t(e,"mouseover",Object(l.o)(i.unhoverElements.bind(i,wo),100))}});return Go(e,n,i,r,d,w,u,p)}var Qo=n("1MUc"),$o=n("hGJG");function Yo(){var e="_im_create_chat_container",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.id=e,document.body.appendChild(n),n}function Jo(e,t,n){return{show:n,unmount:function(){var e=Yo();e&&Vt.a.unmountComponentAtNode(e),Object(c.c)(t)},closeCreateConvoPopup:function(){var e=Yo();Vt.a.unmountComponentAtNode(e),Object(a.Xc)(!1)}}}function Zo(e){var t=Object(c.a)({handlers:function(){}}),n=(0,Object(c.b)(Jo).bindMutations)(t,e),a=function(t){var a;null===(a=e.get().longpoll)||void 0===a||a.push([Object(d.a)(t,!1,!1,!1,"create_conversation")]),n.closeCreateConvoPopup()},r=function(t){var a;null===(a=e.get().longpoll)||void 0===a||a.push([Object(d.a)(t,!1,!0,!0)]),n.closeCreateConvoPopup()},i=n.closeCreateConvoPopup;return Jo(0,t,(function(){return function(e,t,n,a){var r=Yo();Vt.a.render(Kt.a.createElement(Qo.a,{store:e,uploadAvatar:$o.a,onClose:t,onCreateChat:n,onGoToConvo:a}),r)}(e,i,a,r)}))}var el=n("9KdC");function tl(e,t){return t.state=e,Promise.resolve(t)}function nl(e,t,n,a,i){switch(t){case p.b:Object(r.Qb)()||(a.scroll(i,"up"),cancelEvent(n));break;case p.a:Object(r.Qb)()||(a.scroll(i,"down"),cancelEvent(n));break;case p.x:n.ctrlKey||Object(r.Mb)(i)||(a.scroll(i,"up",!0),cancelEvent(n));break;case p.w:n.ctrlKey||Object(r.Mb)(i)||(a.scroll(i,"down",!0),cancelEvent(n));break;case p.p:Object(r.Qb)()||(a.scroll(i,"up",!1,!0),cancelEvent(n));break;case p.d:Object(r.Qb)()||(a.scroll(i,"down",!1,!0),cancelEvent(n));break;case p.y:a.focustTxt(e)}}function al(e,t,n,a,i,s){var o=Object(b.a)({state:t||"default"});return{signal(t,l){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(o.get().state){case"default":return nl(o,t,l,a,e);case"fwd":case"search":return function(e,t,n,a,i,s){switch(t){case p.a:a&&a.hoverNextDialog(s),cancelEvent(n);break;case p.b:a&&a.hoverPrevDialog(s),cancelEvent(n);break;case p.e:Object(r.Qb)()&&!gpeByClass("_im_dialogs_search_input",document.activeElement)||a&&a.selectHoveredDialog(s);break;case p.y:i.focusInput()}}(0,t,l,n,i,e);case"create":return function(e,t,n,a,i){switch(t){case p.x:!n.ctrlKey&&Object(r.Mb)(i)&&(a.scroll("up"),cancelEvent(n));break;case p.w:!n.ctrlKey&&Object(r.Mb)(i)&&(a.scroll("down"),cancelEvent(n));break;case p.a:a.hoverNextElement(i);break;case p.b:a.hoverPrevElement(i);break;case p.e:gpeByClass("_im_dialogs_creation_name",document.activeElement)?a.confirmCreate(i):gpeByClass("im-create--search",document.activeElement)&&a.selectElement(i);break;case p.y:a.focusSearch(i)}}(0,t,l,s,e);case"message":return function(e,t,n,a,r){switch(t){case p.p:case p.d:a.isEmpty(r)&&nl(e,t,n,a,r);break;case p.x:case p.w:nl(e,t,n,a,r)}}(o,t,l,a,e);default:throw new Error("Unknown state: "+o.get().state)}},transition:e=>o.set(tl.bind(null,e))}}var rl=n("ER42"),il=n("nJdr"),sl=n("V1Nw"),ol=n("ERyv");function ll(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var dl={},ul=Date.now();function ml(e,t){var n=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&statlogsValueEvent("im_longpoll",1,n+"0x",t.getResponseHeader("x-frontend")),dl[n]=dl[n]?dl[n]+1:1,Date.now()-ul>=3e4&&(Object.keys(dl).forEach(e=>{statlogsValueEvent("im_longpoll",dl[e],e+"0x",t.getResponseHeader("x-frontend"))}),dl={},ul=Date.now()))}function gl(e,t){return Promise.resolve(extend({},t,{timeout:e<64?2*e:e}))}function _l(e,t){return Promise.resolve(extend({},t,{imTs:e}))}function pl(e){e.set(e=>Promise.resolve(extend({},e,{stopped:!0}))).then(()=>{e.get().cancelToken()})}function bl(e,t){return t.cancelToken=e,Promise.resolve(t)}function hl(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function fl(e){return e.pauses||(e.pauses=[]),Object(l.i)("Aborting all pauses","error"),e.pauses.forEach(e=>e()),e.pauses=[],Promise.resolve(e)}function vl(e,t,n,r){var i=r.failed?Object(bn.a)(4,e):{},s=i.abort,o=i.pause;switch(r.failed){case 1:return Object(l.i)("Old timestamp, init resync","error"),e.set(hl.bind(null,s)),n([N.qb()]),e.set(a.qb).then(o).then(Ol.bind(null,e,t,n));case 2:return Object(l.i)("Key is incorrect","error"),e.set(hl.bind(null,s)),e.set(a.pb).then(o).then(Ol.bind(null,e,t,n));case 3:throw Object(ol.b)("im_longpoll_force_reload",r,!1),nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(_l.bind(null,r.ts)).then(()=>r)}}function Ol(e,t,n){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var a=e.get(),r=`${a.imUrl}/${a.imPart}`,i=Object(rl.a)(r,{act:"a_check",key:a.imKey,version:14,ts:a.imTs,wait:25,mode:a.mode}),s=i.request,o=i.cancel;return e.set(bl.bind(null,o)).then(()=>s).then(t=>{var n=ll(t,2),r=n[0],i=n[1];return i&&ml(a,i),e.set(gl.bind(null,1)),JSON.parse(r)}).catch(e=>{var t=ll(e,2),n=(t[0],t[1]);return n&&ml(a,n),Promise.reject(new Error(""))}).then(vl.bind(null,e,t,n))}function jl(e){var t=e.id,n=e.gid,a=e.key,r=e.ts,i=e.url,s=e.lhost,o=e.lpstat,c=new EventEmitter,d=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,u=In((function(e,t){return d&&window.longpollTesting_onImEvents(t),c.trigger("data",t),Promise.resolve({})})),m=u.pause,g=u.resume,_=u.pushMessage,p=u.isPaused,h=u.reset,f=Object(b.a)({id:t,gid:n,mode:202,timeout:1,imKey:a,imTs:r,imPart:i,imUrl:s,pause:!1,stat:o});return function e(t,n,a){t.get().stopped||(Object(l.i)("New request"),Ol(t,a,n).then(e=>e.map(N.mb)).then(e=>(Object(l.i)("Request success","success"),e)).then(n).catch(e=>{if(!t.get().stopped)return Object(l.i)("Error, waiting: "+(e.message||"no message (probably browser reset)"),"error"),t.set(gl.bind(null,a()?2:t.get().timeout)).then(()=>{var e=Object(bn.a)(t.get().timeout,t),n=e.abort,a=e.pause;return t.set(hl.bind(null,n)).then(a)});Object(l.i)("Stopped longpoll")}).then(e.bind(null,t,n,a)))}(f,_.bind(null,"main"),p.bind(null,"main")),{onData:e=>c.on("data",e),offData:e=>c.off("data",e),abortWaiting:()=>f.set(fl),stop:pl.bind(null,f),pause:m.bind(null,"main"),resume:g.bind(null,"main"),reset:h.bind(null,"main"),push:e=>c.trigger("data",e),isEnabled:()=>!f.get().pause&&!f.get().stopped}}var yl=new Map,wl=!1;function Cl(e){return e.queue||e.key}function kl(){yl.forEach((e,t)=>{var n=e.onData,a=e.onUpdateKey,r=e.ts;(function(e){return!!window.curNotifier&&!curNotifier.addQueues[Cl(e)]})(t)&&Notifier.addKey(extend(t,{ts:r}),Il.bind(null,n,a,t))})}function Sl(){wl||(wl=setInterval(kl,3e3))}function El(e){!function(e){if(!window.curNotifier)return!1;delete curNotifier.addQueues[Cl(e)]}(e),yl.delete(e),0===yl.size&&(clearInterval(wl),wl=!1)}function Il(e,t,n,a,r){if(r.failed)return El(n),void function(e,t,n,a){var r;switch(e){case 1:case 2:case 3:case 5:r=a(t,e);break;case 4:r=Object(bn.c)(1).then(()=>t);break;default:throw new Error("Unkonwn error from queue: "+e)}Object(bn.c)(3).then(()=>r).then(e=>{yl.set(e,{onUpdateKey:a,onData:n,ts:e.ts}),kl(),Sl()})}(r.err,n,e,t);yl.set(n,{onData:e,onUpdateKey:t,ts:intval(r.ts)}),r.events.map(e=>e.split("<!>")).forEach(e)}var Tl=n("PEW9"),Ml=Object.values(Tl.c);function Ll(e){var t=e.get().tabbedPeers.map(t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer]).filter(e=>e).filter(e=>!e.deletedDialog).map(e=>({type:"peer",peer:e.peerId}));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function xl(e,t){if("sep"===t.type)return getTemplate("im_right_menu_sep",{});var n=`${Object(r.lb)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,a=Object(r.kb)(t.peer,e),i=Object(r.Pb)(t.peer)?Object(r.xc)(a.tab):a.tab,s="";switch(!0){case a.unread>0:s=a.unread;break;case Object(r.kc)(a):s=1}return i=getTemplate("im_right_menu_ct",{name:i,count:s}),getTemplate("im_right_menu_tpl",{href:n,label:i,peer:t.peer,attrs:`title="${stripHTML(a.tab)}"`,cls:a.unread>0?"im-right-menu--unread":""})}function Pl(e,t,n,r){var i=gpeByClass("_im_peer_tab",r),s=intval(domData(i,"list-id")),o=e.get().tabbedPeers.filter(e=>e.peer!==s);return e.set(a.zd.bind(null,o,!0)).then(()=>{if(Bl(t,e),s===e.get().peer)e.get().longpoll.push([Object(d.g)()]);else if(0!==e.get().peer){var n=gpeByClass("_im_right_menu",r);uiRightMenu.hideSliding(n)}}),cancelEvent(n),!1}function Bl(e,t){return e.pipeReplace(Promise.resolve(Ll(t)))}function Dl(e,t,n,a){return{updateMenu(t){!function(e,t){geByClass("_im_peer_tab",e).forEach(e=>{var n=Object(Br.fromQueryString)(attr(e,"href").split("?")[1]);n.tab!==t.get().active_tab&&attr(e,"href",`${Object(r.lb)(t)}?sel=${n.sel}&tab=${t.get().active_tab}`)})}(e,t);var a=gpeByClass("_im_right_menu",e);Bl(n,t).then(()=>{var e;(e=t.get().peer?ge("ui_rmenu_peer_"+t.get().peer):ge("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(a)})},updateName(e,t){var n=ge("ui_rmenu_peer_"+e);if(n){var a=geByClass1("_im_r_tx",n),r=t.get().tabs[e].tab;val(a,r)}},updateCounter(e,t){var n=ge("ui_rmenu_peer_"+t);if(n){var a=geByClass1("_im_r_ct",n),i=Object(r.zb)(e,t),s="";switch(!0){case i.unread>0:s=i.unread;break;case Object(r.kc)(i):s=1}val(a,s),n.classList.toggle("im-right-menu--unread",i.unread>0||Object(r.kc)(i))}},unmount(){Object(c.c)(a),n.unmount()}}}function Al(e,t,n){1===n.which&&(e.get().peer&&e.get().longpoll.push([Object(d.g)()]),e.get().longpoll.push([Object(d.b)(t)]),cancelEvent(n))}function Nl(e){Object(q.c)(e.currentTarget,{text:Object(Mn.d)("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function Rl(e,t,n){e.set(e=>Object(a.Wc)(!t,e)).then(()=>n.classList.toggle("RightMenuBlockInfo__mute--muted",e.get().mute))}function Fl(e,t,n){var a=A(e,Object(b.a)({limit:50,offset:0,noScroll:!0,elements:Ll(t)}),()=>({idFn:e=>e.peer||"000",renderFn:xl.bind(null,t)})),i=Pl.bind(null,t,a),s=geByClass1("RightMenuBlockInfo"),o=geByClass1("RightMenuBlockInfo__averageTimeHint",s),u=geByClass1("RightMenuBlockInfo__mute",s),m=Object(c.a)({handlers:(n,a)=>{a(e,"click","_im_r_cl",i),a(e,"click","_im_peer_tab",(e,n)=>{if(!checkEvent(e)){var a=intval(domData(n,"list-id"));Object(l.s)(t).longpoll.push([Object(d.a)(a,!1,!0,!0)]),cancelEvent(e)}}),Ml.forEach(a=>{n(geByClass1("_ui_item_"+a,e.parentNode),"mousedown",Al.bind(null,t,a))}),n(geByClass1("_im_contact_list_menu_item",e.parentNode),"click",()=>ws(t)),o&&n(o,"mouseover",Nl),Object(r.Nb)(t)&&u&&n(u,"click",e=>Rl(t,!1,e.currentTarget))}});return Object(r.Nb)(t)&&u&&(Rl(t,!0,u),u.classList.remove("RightMenuBlockInfo__mute--hidden")),Dl(e,0,a,m)}function Hl(e){var t=e.get().tabs,n=e.get().peer,i=Object.keys(t).filter(t=>Object(r.Sb)(e,t)&&intval(t)!==n).map(e=>t[e]);i.filter(e=>Date.now()-e.last_visited>54e6).forEach(t=>e.set(a.w.bind(null,t.peerId))),i.filter(t=>Object(r.Sb)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5).forEach(t=>e.set(a.Rc.bind(null,t.peerId)))}function ql(e){var t=setInterval(Hl.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}function Ul(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Kl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Kl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function zl(e,t,n,i){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var s=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(r.Rd)(s)(Object(a.mb)(e.offset).then(t=>{var n=Ul(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(s,"im-important_all"):e.loading=!1,i.set(a.Db.bind(null,Object(r.Hd)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,s.appendChild(c),Object(r.db)(s)}),"bottom")}}function Vl(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];i.filter(e=>inArray(e.type,[N.gb,N.cb,N.b])).forEach(r=>{if(r.type!==N.b){if(r.flags===N.o){var i=r.type===N.gb;e.set(a.ld.bind(null,[r.messageId],0,i)).then(n=>{t.markImportant(r.messageId,i,e)})}}else n.hide()})}function Wl(e,t,n,a){var i=ge("box_layer_wrap"),s=t.get().longpoll,o=Object(b.a)({peer:0,longpoll:s,oCache:{},tabs:Object(r.Hd)(a.msgs,a.hash)}),l=ir(e.bodyNode,o,()=>({})),d=_(e.bodyNode,t);Object(r.db)(e.bodyNode);var u=Vl.bind(null,t,l,e);s.onData(u);var m=zl.bind(null,{all:!1,loading:a.all,offset:a.offset},e,i,o),g=Object(c.a)({handlers:(e,t)=>{e(i,"scroll",m)}});return{unmount(){Object(c.c)(g),d.unmount(),l.unmount(),s.offData(u)}}}function Gl(e){return e.which||e.keyCode}function Xl(e,t,n){!n||inArray(Gl(n),p.B)||Object(a.cb)(e.get().peer,e.get())||Object(r.Qb)()||n.ctrlKey||browser.mac&&n.metaKey||n.key&&1!==n.key.length||t.signal("printable",n)}function Ql(e,t,n){Gl(n)===p.e&&e.signal(Gl(n),n)}function $l(e,t,n,a){var i=Gl(a);if(!layers.visible){if(i>=49&&i<=57&&(a.ctrlKey||a.metaKey&&browser.mac)&&Object(r.Mb)(t))return function(e,t){var n=e.get().tabbedPeers[t];n&&e.get().longpoll.push([Object(d.a)(n.peer,!1,!0,!0)])}(t,i-49),cancelEvent(a);inArray(i,p.C)&&e.signal(i,a)}}function Yl(e,t){var n=browser.mozilla?"keydown":"keypress",a=Object(b.a)({signalTimer:!1}),r=Xl.bind(null,e,t),i=$l.bind(null,t,e,a),s=Ql.bind(null,t,a),o=Object(c.a)({handlers:(e,t)=>{e(document,"keydown",i),e(document,"keyup",s),e(document,n,r)}});return{unmount(){Object(c.c)(o)}}}function Jl(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function Zl(e,t){var n=e?e.indexOf(t):-1;return-1!==n&&(e.splice(n,1),!0)}function ec(e,t,n,s,o,l){var c=Object(i.s)(e,t);switch(n){case N.x:case N.y:return n===N.x?Jl(c.adminIds,s):Zl(c.adminIds,s),e.set(e=>Object(a.Dc)(t,e)).then(()=>{tc(e,t,o),nc(e,t,o,l)}),!0;case N.D:return c.data.flags=s,e.set(e=>Object(a.Dc)(t,e)).then(()=>{tc(e,t,o),nc(e,t,o,l)}),!0;case N.G:delete c.pinHideId,cur.imDb.update(Cr.a,[c.peerId,void 0]);var d=c&&c.pinned&&Object(r.wc)(c.pinned).messageId;return o.removeUnpinnedMessageEditable(e,d),!1;case N.I:var u=s===vk.id;return function(e,t,n){if(Object(r.ic)(n.get(),e)){var s=Object(i.s)(n,e);Jl(s.memberIds,t)&&s.membersCount++,-1===s.data.active.indexOf(t)&&s.data.active.push(t),t===vk.id&&(s.data.kicked=0,s.data.closed=0)}return n.set(n=>Object(a.jb)({[e]:[t]},n))}(t,s,e).then(()=>{if(u&&e.get().peer===t)return e.set(e=>Object(a.U)(t,e))}).then(()=>nc(e,t,o,l)).then(()=>{if(u&&e.get().peer===t)return Promise.all([e.set(e=>Object(a.T)(t,e)),e.set(e=>Object(a.nb)(t,e))])}).then(()=>(e.get().peer===t&&c.callInProgress&&(o.updateBanner(e),o.updateHeader(e)),o.fixKeyboard())),!0;case N.K:case N.J:return function(e,t,n,s,o){if(Object(r.ic)(s.get(),e)){var l=Object(i.s)(s,e);Zl(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter(e=>e!==t),t===vk.id&&(n?l.data.kicked=1:l.data.closed=1,s.set(t=>Object(a.bc)(e,t)))}return t===vk.id&&s.get().peer===e?(o.cancelEditing(),s.set(t=>Object(a.ed)(e,t))):Promise.resolve()}(t,s,n===N.J,e,o).then(()=>nc(e,t,o,l)),e.get().id!==s&&(Object(i.j)(e,t)||{}).author_id!==s||e.set(e=>Object(a.B)(t,e)).then(()=>o.fixKeyboard()),!0;case N.A:return e.set(e=>Object(a.hb)(t,e)).then(()=>o.updateBanner(e)),!0;case N.E:case N.F:return!0;case N.B:var m=s?e=>Object(a.T)(t,e):e=>Object(a.bc)(t,e);return e.set(m).then(()=>{e.get().peer===t&&(o.updateBanner(e),o.updateHeader(e)),l.updateDialog(t,e)}),!0;default:return!1}}function tc(e,t,n){e.get().peer===t&&(Object(a.Bc)(e.get()),n.updateActions(e))}function nc(e,t,n,r){e.get().peer===t&&(Object(a.Bc)(e.get()),n.updateChat(e,t),r.updateDialog(t,e))}var ac=n("gF8j"),rc=n("ambf"),ic=n("pdqG");function sc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||oc(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oc(e,t){if(e){if("string"==typeof e)return lc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lc(e,t):void 0}}function lc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function cc(e,t,n,s,o){var l,c=new Map,d=new Map,u=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=oc(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,i=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,r=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw r}}}}(o);try{for(u.s();!(l=u.n()).done;){var m=l.value;c.has(m.peerId)||c.set(m.peerId,new Set),c.get(m.peerId).add(m.messageId),d.set(m.messageId,m)}}catch(e){u.e(e)}finally{u.f()}c.forEach((o,l)=>{var c=[...o],u=Object(i.s)(e,l),m=u&&!u.offset,g=u&&u.inplaceSearch&&!!u.searchOffset;e.set(a.Yb.bind(null,c,l)).then(()=>e.set(a.Zb.bind(null,c,l))).then(()=>{if(e.get().peer===+l&&Object(r.Sb)(e.get(),l)){var n=Object(i.s)(e,l);t.removeMessages(c,+l,e);var s=n.inplaceSearch;if(!n.offset&&!m&&(Object(a.Bc)(e.get()),t.updateActions(e),s||t.showEmptyScreen()),s&&g&&!n.searchOffset&&(t.showSearchResults(),browser.safari)){var o=geByClass1("_im_peer_history_w");o.style.display="none",setTimeout(()=>o.style.display="",0)}}}).then(()=>{var r=Object(i.s)(e,l);if(r){var o=c.some(e=>e>=r.lastmsg),u=c.filter(e=>e>r.in_up_to&&!(d.get(e).flags&N.p));o?Object(a.gb)(e,+l).then(()=>{n.promoteDialog(e,l),s&&s.updateCounter(e,l),t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0)}):u&&Object(ic.b)(l,u,e.get()).then(()=>n.updateDialog(l,e))}})})}function dc(e,t){"spam"===t?Object(r.yd)(e,Gs,{}):"fav"===t&&Object(r.od)(e,{},Wl,{})}function uc(e,t,n,i,s){e.forEach(e=>{switch(e.kludges.source_act){case r.m:case r.n:!function(e,t,n,r){t.set(a.id.bind(null,e)).then(()=>{var a=e.kludges.source_act;n.updateDialog(e.peerId,t),r.updateChatPhoto(e,a,t)})}(e,t,n,i)}})}function mc(e,t){var n=e.get().longpoll.push.bind(null,[Object(d.g)()]),a=()=>{var r=e.get().selectedMessages;r&&r.length?(e.setState({selectedMessages:[]}).then(()=>{t.changedMessageSelection(e),t.cleanSelection(r)}),setTimeout(()=>cancelStackPush("im_peer",a),0)):n()};cancelStackPush("im_peer",a)}function gc(e){var t=e.attaches.filter(e=>"sticker"!==e.type&&"call"!==e.type);return Object(s.s)(e)||0===t.length}function _c(e,t,n){addClass(n,"im-page_history-show"),t.loadingPeer(e)}function pc(e,t){var n=Object(r.yb)(e,t.offsetHeight);if(e.get().tabbedPeers.length>n){var i=e.get().tabbedPeers.filter(t=>{var n=t.peer;return intval(n)!==e.get().peer}).map(t=>{var n=t.peer;return e.get().tabs[n]}).sort((e,t)=>t.last_touched-e.last_touched),s=[];0!==e.get().peer&&s.push(e.get().tabs[e.get().peer]);var o=s.concat(i).slice(n).map(e=>e.peerId),l=e.get().tabbedPeers.filter(e=>!inArray(e.peer,o));return e.set(a.zd.bind(null,l,!0))}return Promise.resolve(e)}function bc(){for(var e=curBox();e;)e.hide(),e=curBox()}function hc(e,t,n,s,o,l,c,d,u){e.get().audio_msg.isRecording&&e.set(a.n).then(()=>{s.cancelRecording()}),AudioMessagePlayer.detachPlayer(),Object(i.w)(e)&&s.cancelEditing(),Object(i.R)(e)&&t.cancelSearch&&(o.clearSearch(e),n.restoreDialogs(e),u().toggleSettingsButton(e,!1)),fc(e,d,u),_c(e,s,l);var m=e.get().peer;Object(a.rd)(e.get()),Object(a.Cd)(),Object(r.Sb)(e,t.peerId)&&(t.msgid&&!Object(i.m)(e,t.peerId,t.msgid)||!t.msgid&&!Object(i.m)(e,t.peerId,Object(i.s)(e,t.peerId).lastmsg)||Object(i.s)(e,t.peerId).skipped)&&e.mutate(e=>Object(i.V)(e,t.peerId));var g=e.set(a.r.bind(null,t.peerId,t.msgid,t.entryPoint)).then(e=>{var n=e.get(),r=a.ub.bind(null,t.peerId,!1,t.msgid,!1,n);return n.tabs[t.peerId]?Promise.resolve(n):e.set(r)}).then(()=>{if(n.selectPeer(t.msgid,e),function(e,t){Object(r.ec)(e)&&(cancelStackFilter("forward"),e.set(a.M.bind(null,e.get().pendingForward,Object(i.t)(Object(i.s)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),bc(),s.preparePeer(e),mc(e,s),Object(r.Mb)(e)&&(n.deactivate(),pc(e,l).then(()=>c.updateMenu(e)),Object(r.Pd)(e)),!Object(r.Mb)(e)&&Object(H.q)(e,t.peerId)&&Object(K.j)(t.peerId)&&!Object(K.e)(t.peerId)){var o=(Object(i.s)(e,t.peerId)||{}).online||0,d=Object(r.Z)(o),u=d.is_online,m=d.is_mobile;e.set(e=>Object(ic.g)(e,t.peerId,u,m)).then(e=>{n.updateRecommendedOnline(t.peerId,e)})}});return(g=t.msgid?g.then(()=>e.set(a.xc.bind(null,t.peerId===m,m))):g.then(()=>e.set(a.wc.bind(null,!0)))).then(()=>e.set(a.Kb.bind(null,t.peerId))).then(()=>{if(e.get().peer===t.peerId){if(t.forward){var n=e.get().tabs[e.get().peer];if(!n.scrollBottom&&n.unread)(Object(Dr.b)("mail_history_unread_counter_observer")?Promise.resolve():e.set(a.Ob.bind(null,e.get().peer))).then(()=>e.set(a.Bc)).then(()=>s.updateActions(e));else!n.unread&&Object(i.U)(n)&&e.set(e=>Object(a.zb)(t.peerId,e))}Object(r.Mb)(e)&&c.updateMenu(e),s.changePeer(e,!1),s.updateTyping(t.peerId,e),s.removeExpiredFailedMessages(t.peerId),Object(Dr.b)("mail_history_unread_counter_observer")&&s.updateObserver(),Object(a.rd)(e.get())}}).catch(e=>Object(ol.a)("applyNewPeer",e))}function fc(e,t,n){t&&e.get().shown&&(t.hide(e),n().createCanceled(e))}function vc(e,t,n){Object(i.R)(e)&&(t.clearSearch(e),n.restoreDialogs(e))}function Oc(e,t,n,i,s,o,l){e.setState({isCreating:!0}),Object(Dr.b)("messages_chat_creation_new_interface")?Zo(e).show():(Object(r.Mb)(e)&&(s.saveScroll(e),o.saveScroll(e)),i.showCancelControl(),addClass(l,"im-page_creating"),n&&n.show(e,t),Object(r.Mb)(e)&&(setStyle(l,{height:Ec(l,e).page}),setTimeout((function(){addClass(l,"im-page_cropped")}),200))),Object(a.Xc)(!0)}function jc(e,t,n,a){Object(r.ic)(e.get(),a)&&(t.updateTyping(a,e),n.updateTyping(a,e))}function yc(e,t,n,i,s){i.activityType||(i.activityType=s);var o=e=>jc(e,t,n,i.peerId);Object(r.hc)(i.peerId,e.get().gid)||(e.set(a.Cc.bind(null,i,s)).then(o),e.set(a.Dd.bind(null,i,s)).then(o))}function wc(e,t){t?e.classList.add("im-page_reconnecting"):e.classList.remove("im-page_reconnecting")}function Cc(e,t,n){var r=null;if(n.kludges.keyboard&&!n.kludges.keyboard.inline){var o=Object.assign(n.kludges.keyboard,{author_id:n.userId});r=e.set(a.Kc.bind(null,n.peerId,o))}else{var l=Object(i.j)(e,n.peerId);l&&l.one_time&&l.author_id!==Object(s.b)(e,n)&&(r=e.set(a.B.bind(null,n.peerId)))}n.peerId===Object(_t.e)(e)&&r&&r.then(t.fixKeyboard)}function kc(e,t,n,l,u,m,g,_,b,h,f,v,O,j,y,w,C,k,S,E,I,T,M){var L=!1;return{changePeer(e,n){t.selectPeer(e,n)},cancelSearch(e){vc(e,l,t)},loadingPeer(e){_c(e,n,u)},restoreDialogs(e,n,a){t.restoreDialogs(e,n,a)},showChatInvitationBox(e,n){Object(r.ld)(e,n,b,t)},toggleSettingsButton(e,t){f.toggleButton(e,t)},focusSearch(e){l.focusInput()},appendSearch(e,n,a,r){t.appendSearch(e,n,a,r)},appendDialogs(e,n){t.appendDialogs(e,n)},showCreation(e,a){Oc(e,a,h,l,t,n,u)},showCreationNew(){Zo(v).show()},updateState(e,a){t.updateDialog(e,a),a.get().peer===e&&n.updateChat(a,e)},updateConvoInList(e,n){t.promoteDialog(n,e)},appendFastDialogs(e,n){t.appendFastDialogs(e,n,!0)},createCanceled(e){l.hideCancelControl(),Object(r.Mb)(e)?(setStyle(u,{height:"auto"}),removeClass(u,"im-page_cropped"),setTimeout(()=>l.focusInput(),0),0===e.get().peer?t.restoreScroll(e):n.restoreScroll(e,e.get().peer)):setTimeout(()=>{0===e.get().peer?l.focusInput():n.focustTxt(e)},0),removeClass(u,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){w&&w.updateMenu(e)},goToHistoryEnd(){n.goToEnd()},updateDialog(e,n){t.updateDialog(e,n)},updateRecommendationList(e){e.set(eo).then(e=>{Object(_t.l)(e)&&t.updateRecommendationList(e)})},setRecommendationListVisibility(e){t.setRecommendationListVisibility(e)},focusTxt(e){n.focustTxt(e)},resync(e){Object(i.R)(e)&&l.clearSearch(e),t.restoreDialogs(e,!0,!0).then(()=>{Object(r.Mb)(e)||t.focusOnSelected(e)}),h&&h.hide(e),Object(r.Nb)(e)&&e.get().tabbedPeers.forEach(t=>{var n=t.peer;w.updateCounter(e,n)}),Object(r.Mb)(e)&&(e.get().tabbedPeers.forEach(t=>{var n=t.peer;w.updateCounter(e,n),w.updateName(n,e)}),Object(r.Pd)(e)),n.cleanSelection(e.get().selectedMessages||[]),n.cancelSearch(e,!0),Object(r.fc)(e.get().peer)||n.changePeer(e,!1),Object(to.a)(e)},toggleSettingsLoader(e,t){f.toggleLoader(e,t)},onUserActions(e,t){if(!Object(a.cb)(e.get().peer,e.get())){var s,o=e.get(),l=o.peer;if(Object(r.Sb)(o,l))if(!m.is_idle)if(Object(i.b)(e.get().peer,e.get())>0)if(!o.tabs[l].skipped&&n.isNewMessagesVisible(e))n.hideGoToEnd(!0),n.hideGoToMention(!0),Object(Dr.b)("mail_history_unread_counter_observer")?(n.updateObserver(),s=Promise.resolve()):s=e.set(a.Ob.bind(null,l)),s.then(()=>e.set(a.Bc)).then(()=>n.updateActions(e))}},removeSelection(e){t.removeSelection(e),l.focusInput()},route(e,i,s,o){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var c=!1;return!!(e.mr||e.invite_chat_id&&s.invite_hash)||(o&&o.params&&"left_nav"===o.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach(e=>{switch(e){case"sel":s.q||(c=!0);var m=s.sel?Object(r.Md)(s.sel):0,g=o.back;0===m?v.get().longpoll.push([Object(d.g)(!1,g)]):m!==v.get().peer&&v.get().longpoll.push([Object(d.a)(m,s.msgid||!1)]);break;case"invite_chat_id":case"invite_hash":!function(e){e.set(a.fb).then(()=>{e.get().longpoll.push([Object(d.g)(!1,!1)])})}(v);break;case"tab":fc(v,h,b),c=!0;var _=s.tab||p.g;v.get().longpoll.push([Object(d.b)(_)]);break;case"act":s.act&&"create"===s.act?Oc(v,[],h,l,t,n,u):function(e,t,n,a){n&&n.hide(e,t)}(v,[],h);break;case"st":s.st&&s.sel?(curBox()&&curBox().hide(),v.mutate(a.Jc.bind(null,unescape(s.st),s.sel)),n.startSearch(v)):(v.mutate(a.o.bind(null,i.sel)),n.cancelSearch(v,!0));break;case"q":s.q?(curBox()&&curBox().hide(),l.setSearch(v,s.q,!0)):l.clearSearch(v);break;case"box":dc(v,s.box)}}),s.msgid&&(v.get().msgid=s.msgid,n.focusOnMessage()),Object(r.Mb)(v)&&void 0===e.sel&&w.updateMenu(v),c&&vc(v,l,t),!1)},updateDialogFilters(e){Object(i.R)(e)||t.restoreDialogs(e),f.updateFilter(e)},removePeer(e,n){t.removeDialog(e,n),t.saveScroll(e),e.get().peer===n&&e.get().longpoll.push([Object(d.g)()]),Object(r.Mb)(e)&&w.updateMenu(e)},newMessage(e){Object(r.Mb)(e)||t.scrollUp(!0)},onQueueEvent(e,i){switch(i.entity_type){case el.a.Online:e.set(e=>Object(a.td)(i.data.user_id,!!i.data.online&&i.data.platform,i.data.last_seen,e)).then(e=>{Object(r.ic)(e.get(),i.data.user_id)&&(t.updateOnline(i.data.user_id,e),n.updateOnline(i.data.user_id,e)),Object(H.q)(e,i.data.user_id)&&t.updateRecommendedOnline(i.data.user_id,e)})}},onEvents(e,c){var v=Object(d.c)(c),j=c.filter(s.s),y=c.filter(e=>e.type===N.a);uc(j,e,t,n);var C=Object(a.u)(j,y,e),k=Promise.resolve();C.shouldLoad&&(k=e.set(a.tb.bind(null,C,g))),k.then(()=>{v.forEach(c=>{switch(c.type){case N.a:var g=c.peerId,v=Object(i.s)(e,g),j=!v||!v.msgs||0===v.msgs.length,y=Object(r.vb)(c,e.get()),C=Object(i.C)(e,c.peerId),k=v&&!v.lastmsg;switch(Cc(e,n,c),Object(s.i)(c)&&rc.g.add(c),y){case r.F:e.set(a.j.bind(null,c)),pc(e,u),function(e,t){var n=e.get().tabs[t.peerId],r=e.get().active_tab;return r===p.g||(r===p.m?Object(o.a)(e.get(),n):Object(a.J)(r)(n))}(e,c)&&(Object(i.Y)(v)||(c.flags&N.p||e.set(a.kd.bind(null,c.peerId,!0)),function(e,t){var n=t.flags&N.p,a=inArray(t.peerId,e.get().mutedPeers),i=t.flags&N.l,s=e.get().gid;if(!n&&!a&&!i){var o,l,c=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",d=(c?c+" ":"")+t.text||"",u=t.userId,m=t.peerId,g=e.get().tabs[m];if(t.kludges&&t.kludges.source_act&&(d=stripHTML(Object(r.Sc)(e,t,g.peerId,!1))),(!e.get().notify_msg&&!Object(r.Lb)(m)||s&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:m}),!Object(r.Lb)(m))return;d=trim(replaceEntities(stripHTML(d.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),d=Object(kr.f)(d,(e,t,n,a,r)=>r),Object(r.Lb)(m)?(o=Object(F.c)(e,u).name,g.tab&&(o+=" » "+g.tab),l=Object(F.c)(e,u).photo):(o=g.tab,l=g.photo);var _=t.attaches[0];if(_&&"mail"===_.type)d+="\n["+getLang("mail_added_msgs")+"]";else if(_){var p="doc"===_.type&&"graffiti"===_.kind?"graffiti":_.type;d+="\n["+getLang("mail_added_"+p)+"]"}o=trim(replaceEntities(stripHTML((o||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:d,author_id:m,title:o,author_photo:l})}}(e,c)),t.updateTyping(c.peerId,e),Object(i.R)(e)?t.updateDialog(c.peerId,e):t.promoteDialog(e,c.peerId));var S=Object(i.C)(e,c.peerId),I=v&&!v.offset;(C&&!S||k&&!I)&&n.updateActions(e),Object(r.Mb)(e)?(w.updateCounter(e,c.peerId),w.updateMenu(e)):f.updateFilter(e),e.set(a.fd.bind(null,c)).then(jc.bind(null,e,n,t,c.peerId)),n.addMessage(e,c),gc(c)||!Object(r.Sb)(e,c.peerId)||c.local||e.set(a.rb.bind(null,c)).then(e=>{n.replaceAttachmentPlaceholders(e,c),Object(a.Cd)()}),c.kludges.has_template&&e.set(e=>Object(a.h)(c,e)).then(e=>{n.replaceBotCarouselPlaceholder(e,c)}),Object(mt.m)(e,c,"send","opt_to_lp");break;case r.E:gc(c)||e.set(a.rb.bind(null,c)).then(e=>{n.replaceAttachmentPlaceholders(e,c)}),e.set(a.cc.bind(null,c)),n.replaceMessageAttrs(c,e),t.updateDialog(c.peerId,e),e.get().active_tab===p.g&&Object(H.q)(e,c.peerId)&&this.updateRecommendationList(e),c.randomId&&Object(mt.l)(e,c,"send","opt_to_lp");break;case r.D:Object(i.R)(e)||t.promoteDialog(e,c.peerId)}Object(i.Y)(v)&&Object(r.V)(e,t.update);var T=y===r.E&&1===v.offset||y===r.F&&k&&!c.local;Object(Dr.b)("messenger_empty_pinned_support")&&T&&e.set(t=>Object(a.ub)(g,0,0,0,t).then(t=>(Object(ic.f)(t,Object(i.s)(t,g),!1,a.i.bind(null,g),a.Oc.bind(null,t)),g===e.get().peer?Object(a.Bc)(t):t))).then(e=>t.promoteDialog(e,g)),v&&j&&v.peerId===Object(_t.e)(e)&&E();break;case N.i:case N.Z:e.set(a.H.bind(null,c)).then(e=>{if(Cc(e,n,c),c.kludges.is_expired)return Object(r.yc)(c,n.handleMessageExpiration),void t.updateDialog(c.peerId,e);t.updateDialog(c.peerId,e),n.updateTyping(c.peerId,e),n.editMessage(e,c),gc(c)||!Object(r.Sb)(e,c.peerId)||c.local||e.set(a.rb.bind(null,c)).then(e=>n.replaceAttachmentPlaceholders(e,c)),c.kludges.has_template&&e.set(e=>Object(a.h)(c,e)).then(e=>{n.replaceBotCarouselPlaceholder(e,c)})});break;case N.v:Object(a.Sb)(c.messageId,e.get()).then(t=>{var n=Object(U.a)(t);return e.set(e=>Object(a.H)(n,e)).then(()=>n)}).then(i=>{n.editMessage(e,i),t.updateDialog(i.peerId,e),!gc(i)&&Object(r.Sb)(e,i.peerId)&&e.set(e=>Object(a.rb)(i,e)).then(e=>n.replaceAttachmentPlaceholders(e,i))});break;case N.R:e.set(a.Bb.bind(null,c)).then(e=>{t.updateCounter(e,c.peerId),n.updateGoToEnd(e,!0),n.updateGoToMention(e,!0),n.updateObserver(),Object(r.Mb)(e)&&w.updateCounter(e,c.peerId),Object(i.R)(e)||t.restoreDialogs(e),f.updateFilter(e)});break;case N.S:e.set(a.Cb.bind(null,c)).then(e=>{t.updateCounter(e,c.peerId),n.markMessagesAsRead(e,c)});break;case N.jb:e.set(e=>Object(Qs.f)(c,e)).then(()=>{f.updateFilter(e);var t=c.showOnlyNotMuted;t!==Object(_t.d)(e,"show_only_not_muted_messages")&&e.set(e=>Object(Qs.d)("show_only_not_muted_messages",t,e)).then(f.updateSettings),Object(Dr.b)("mail_longpoll_unread_counter")||Object(to.a)(e),Object(r.Mb)(e)&&e.get().tabbedPeers.forEach(t=>{var n=t.peer;w.updateCounter(e,n)})});break;case N.gb:case N.Y:case N.cb:if(!(c.flags&N.l||c.flags&N.q)||c.type!==N.gb||Object(r.Ib)(e,c.peerId,c.messageId)||e.get().blockedFlagUpdates[c.peerId]||_(c),c.flags===N.o){var M=c.type===N.gb;e.set(a.qd.bind(null,M?1:-1,c.messageId)),e.set(a.ld.bind(null,[c.messageId],c.peerId,M)).then(()=>{n.markImportant(c.messageId,M,e)})}break;case N.V:yc(e,n,t,c,a.c);break;case N.ib:yc(e,n,t,c,a.d);break;case N.O:!function(e,t,n,r){e.set(a.Mc.bind(null,n,r)).then(t().updateState.bind(null,n))}(e,b,c.peerId,!c.sound);break;case N.f:e.set(e=>{var t=c.peerId,n=c.majorId,r=Object(i.s)(e,t);return(n&&r?Promise.resolve(e):Object(a.ub)(t,0,0,0,e)).then(e=>{var r=Object(i.s)(e,t);return r.major_sort_id=n,Object(ic.f)(e,r,!1,a.i.bind(null,t),a.Oc.bind(null,e)),Object(a.Bc)(e),Promise.resolve(e)})}).then(e=>{var a=c.peerId;Object(i.s)(e,a)&&!Object(i.R)(e)&&t.promoteDialog(e,a),a===e.get().peer&&n.updateActions(e)});break;case N.g:e.set(e=>{var t=c.peerId,n=c.minorId,a=Object(i.s)(e,t);return a?(a.minor_sort_id=n,Promise.resolve(e)):Promise.resolve(e)}).then(e=>{var n=c.peerId;Object(i.s)(e,n)&&!Object(i.R)(e)&&t.promoteDialog(e,n)});break;case N.eb:e.get().longpoll.pause(),e.set(a.lc).then(b().resync).then(()=>e.get().longpoll.resume());break;case N.hb:O.transition(c.state);break;case N.db:if(c.removeActivePeer){var x=e.get().tabbedPeers.filter(t=>{var n=t.peer,a=t.type;return n!==e.get().peer&&"perm"===a});e.setState({tabbedPeers:x})}!function(e,t,n,s){e.set(a.n).then(()=>{n.cancelRecording()}),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),removeClass(s,"im-page_history-show"),t.updateStarPosition(),n.flushDraft(e),n.stopLoading(),n.destroyPeerProfile(),Object(i.w)(e)&&n.cancelEditing();var o=e.get().peer;e.set(a.r.bind(null,0,!1,!1)).then(()=>{window.tooltips&&window.tooltips.hideAll(),bc(),Object(r.Mb)(e)&&t.activate(),n.changePeer(e),Object(r.Mb)(e)&&t.restoreScroll(e),setTimeout(()=>{e.get().longpoll.push([Object(d.h)("search")])},13),Object(r.Xb)(e)&&Object(r.dc)(o,e)&&e.set(a.Rb.bind(null,o))})}(e,t,n,u),c.cancelSearch&&vc(e,l,t),Object(r.Mb)(e)&&w.updateMenu(e),Object(r.Mb)(e)&&e.get().active_tab===p.g&&this.updateRecommendationList(e),l.focusInput(),Object(r.Nb)(e)&&(l.initPeerTagsFilter(e),t.renderPeerTags(e));break;case N.c:Object(i.R)(e)&&l.clearSearch(e);var P=e.get().active_tab;Object(r.U)(c.tab,e,b,a.q).then(e=>{f.updateFilter(e),c.tab===p.m&&P!==c.tab&&l.initPeerTagsFilter(e),c.tab===p.g&&this.updateRecommendationList(e)});break;case N.bb:case N.fb:case N.X:var B=c.type,D=c.peerId,A=c.mask;if(A===N.t)break;var R=A===N.s;e.set(a.nd.bind(null,D,A,B,c.local,R)).then(e=>{Object(i.R)(e)||B===N.bb&&A===p.j[p.h]||B===N.bb&&A===p.j[p.k]||B===N.fb&&A===p.j[p.l]||B===N.X||t.restoreDialogs(e),t.updateDialog(D,e),Object(r.Mb)(e)&&w.updateCounter(e,D),e.get().peer===D&&n.changedMessageSelection(e)});break;case N.h:e.set(a.D.bind(null,c.peerId,Promise.resolve([]))).then(()=>{b().removePeer(e,c.peerId),b().updateDialogFilters(e)});break;case N.b:hc(e,c,t,n,l,u,w,h,b);break;case N.N:var q={[c.peerId]:c},K=Object(r.cc)(c.peerId,e);e.set(a.gd.bind(null,q)).then(()=>{t.updateDialog(c.peerId,e);var a=Object(r.cc)(c.peerId,e);Object(r.Sb)(e.get(),c.peerId)&&K!==a&&n.updateChat(e,c.peerId)});break;case N.k:e.set(a.Lc.bind(null,c.peerId,c.message)).then(()=>{n.setMessageErrored(c.peerId,c.message,c.error,e),t.setDialogFailed(c.peerId,c.message.messageId,e)});break;case N.ab:var z=c.message.messageId;e.set(a.dc.bind(null,c.peerId,z,c.message)).then(()=>{n.resendMessage(c.peerId,z),t.promoteDialog(e,c.peerId)});break;case N.Q:Object(o.g)(e,t,c);break;case N.P:Object(o.f)(e,t);break;case N.e:if(Object(i.L)(c)){var V=Promise.resolve(),W=Object(H.b)(e);switch(c.updateType){case N.C:W&&W.peerId===c.updateArg&&e.get().longpoll.push([Object(d.a)(c.peerId)]),V=e.set(a.D.bind(null,c.updateArg,Promise.resolve([]))).then(()=>{b().removePeer(e,c.updateArg),b().updateDialogFilters(e)});break;case N.F:V.then(()=>e.set(a.sd.bind(null,c))).then(()=>{Object(r.Pd)(e),Object(r.V)(e,t.update),c.updateArg===N.L&&Object(r.Mb)(e)&&w.updateMenu(e)})}}else{if(Object(r.ic)(e.get(),c.peerId))ec(e,c.peerId,c.updateType,c.updateArg,n,t)||b().reloadChatInfo(c.peerId)}break;case N.lb:setTimeout(()=>{wc(u,!0),n.setNetworkWaitingStatus(c.timeout-1)},1e3);break;case N.U:wc(u,!0),n.setNetworkReconnectingStatus();break;case N.T:wc(u,!1),setTimeout(n.clearNetworkStatus,0),browser.chrome&&!Object(r.Mb)(e)&&e.get().peer&&(m.is_idle?L||(m.once("unidle",()=>{L=!1,t.forceScrollReinit()}),L=!0):t.forceScrollReinit());break;case N.w:var G=Object(_t.f)(c.event_id,e);G&&e.set(e=>Object(Qs.h)({peerId:c.peer_id,eventId:c.event_id},e));var X=Object(r.rb)(u,G.messageId,G.index);X&&Object(r.gd)(X,!1),Object(pt.h)(c,e)}})})},updateHistory:e=>n.updateHistory(e),reloadChatInfo(e){Object(r.ic)(v.get(),e)&&v.set(a.ib.bind(null,e)).then(()=>function(e,t,n,i,s){i.updateChatTopic(t,e),Object(r.Mb)(e)&&s.updateName(t,e),e.get().peer==t&&(Object(a.Bc)(e.get()),i.updateActions(e))}(v,e,0,n,w))},cancelRecording:()=>v.set(a.n).then(()=>n.cancelRecording()),fixHeight(){E()},unmount(){Object(c.c)(e),clearInterval(v.get().update_title_to),m.stop(),I(),T(),rc.g.destroy(),t.unmount();var i=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_logo"+i+".ico"),n.unmount(),l.unmount(),cancelStackFilter("im_peer"),f.unmount(),h&&h.unmount(),w&&w.unmount(),C&&C(),j&&j(),Object(r.Xb)(v)&&v.get().peer&&v.set(a.Rb.bind(null,v.get().peer)),k.unmount(),M.unmount(),w&&w.unmount(),S.unmount(),clearInterval(y),cur.imDb.unmount(),cur.imDb=!1}}}function Sc(e,t,n,i){var s=t.get();Object(r.fc)(s.peer)||e().onUserActions(t,i),s.update_old_title&&t.set(a.kd.bind(null,!1,!1))}function Ec(e,t){var n=ge("page_header"),a=geByClass1("_im_page_history",e),i=window.clientHeight()-n.offsetHeight-30-2,s=Object(r.Mb)(t)?250:400,o={page:Math.max(i,s)};if(Object(r.Mb)(t)){var l=Object(r.ob)();l=l>0?Math.min(l-n.offsetHeight-30-2,i):i;var c=hasClass(a,"im-page--history_empty-hist")?l:i;o.history=Math.max(l,s),o.chat=Math.max(c,s)}return o}function Ic(e,t,n,i,s){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!Object(l.h)()){var d=Ec(e,t);if(setStyle(e,{minHeight:d.page}),Object(r.Mb)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(a.Y),setStyle(e,{height:t.get().isCreating?d.page:"auto"}),setStyle(geByClass1("_im_page_dialogs",e),{minHeight:d.page,position:"static",top:0}),setStyle(geByClass1("_im_page_history",e),{minHeight:d.history,position:"relative",top:0}),setStyle(geByClass1("_im_chat_body_abs",e),{minHeight:d.chat,height:d.chat,position:"relative",top:0})),browser.safari&&c&&"function"==typeof c&&c(),i&&i.updateScroll(),s&&s.updateScroll&&s.updateScroll(),n){var u=n.updateScroll();n.scrollFix(t,t.get().peer,u)}o&&setTimeout(()=>Ic(e,t,n,i,s,!1),100)}}function Tc(e,t){e.get().resendAllOnOnline&&t()}function Mc(){!function(e){var t="safari-repaint";e.forEach((function(e){hasClass(e,t)&&removeClass(e,t),addClass(e,t)})),setTimeout((function(){e.forEach((function(e){removeClass(e,t)}))}),100)}([geByClass1("_im_dialog_actions"),geByClass1("_im_chat_input_w"),ge("side_bar"),geByClass1("_im_right_menu"),geByClass1("_im_dialogs_settings"),geByClass1("_im_dialogs_search")])}function Lc(e){var t,n,i,s=e.get();return Object(r.Xb)(e)?(t=s.mutex_key,n=function(e){s.longpoll.push([N.nb(e)])},i=function(e,t){return Object(a.R)(s.gid).then(e=>sc(e,1)[0])},Notifier.addKey(t,Il.bind(null,n,i,t)),yl.set(t,{onData:n,onUpdateKey:i,ts:t.ts}),Sl(),{stop:El.bind(null,t)}).stop:null}function xc(e,t){var n,s=t.get(),o=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_im"+o+".ico"),Ic(e,t,!1,!1,!1,!0),Object(mt.c)();var d=Object(c.b)(kc),u=d.callMutations,m=d.bindMutations,g=s.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),_=g?Notifier.getLpInstance():t.get().gid?function(e){Object(ol.b)("im_start_longpoll_group",{},!1);var t=Object(sl.a)(e.ts,e=>{a.trigger("data",e)}),n=Object(il.a)(e,t.onLp),a=new window.EventEmitter;return{onData:e=>a.on("data",e),offData:e=>a.off("data",e),push:e=>a.trigger("data",e),pause:t.pause.bind(t),resume:t.resume.bind(t),abortWaiting:n.abortWaiting.bind(n),onLp:t.onLp.bind(t),stop:n.stopConnection.bind(n),isEnabled:()=>!(!n||n.isStopped())}}(s.lpConfig):jl(s);_.onData(f);var p=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),b=p?p.subscribe(e=>u().onQueueEvent(t,e)):()=>{};function f(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];u().onEvents(t,n)}g&&Object(ol.b)("im_use_fc_longpoll",{},!1);var v=geByClass1("_im_dialogs_search",e),O=geByClass1("_im_dialogs_settings",e),j=$e(geByClass1("_im_page_dcontent",e),t,u,v);j.updateStarPosition(),j.renderPeerTags(t);var y,w,C=Ds(v,t,u),k=oo(O,t,u),S=ql(t),E=function(e,t){return(0,Object(c.b)(ee).bindMutations)(Object(c.a)({handlers:function(e,n){n(t,"click","_im_carousel_control",$),n(t,"mouseover","_im_carousel",J),n(t,"mouseout","_im_carousel",Z)}}),e)}(t,document.body);(cur.imDb=Object(Cr.c)(t.get().gid?-t.get().gid:vk.id),t.set(a.Jb.bind(null,cur.imDb)),Object(r.Mb)(t)&&k.updateSettings(t),Object(r.Mb)(t))&&(y=Fl(geByClass1("_im_ui_peers_list",e.parentNode),t),w=function(e,t,n,a){if(browser.mobile)return!1;var r=[t,n,geByClass1("_im_chat_input_w",a),geByClass1("_im_dialog_actions",a)],i=null,s=hasClass(e,"im-page--header_static"),o=ge("im-group-online-disabled-notice");function l(){var t=Object(h.b)("scrollLeft"),n=hasClass(e,"im-page--header_static"),a=[];i!==t?a=r.slice().concat([e]):n!==s&&(a=[e]),i=t,s=n,a.length>0&&a.forEach(a=>{var r=e===a&&n?0:-t;setStyle(a,{[cssTransformProp]:0===r?"unset":"translateX("+r+"px)"})})}return o&&r.push(o),r=r.concat(geByClass("_im_aside_notice"),geByClass("_im_aside_promo_block")),addEvent(window,"scroll",l),l(),()=>{removeEvent(window,"scroll",l)}}(v,O,geByClass1("_im_right_menu",e.parentNode),e));Object(r.Mb)(t)&&s.peer&&j.deactivate(),s.gid||(n=Object(Dr.b)("messages_chat_creation_new_interface")?Zo(t):Xo(geByClass1("_im_dialogs_creation",e),t,u));var I=Gi(geByClass1("_im_page_history",e),t,j,y,u),T=s.isCreating,M=T?"create":0===s.peer?"search":"default";T&&n.show(t,[]);var L=al(t,M,j,I,C,n),x=Yl(t,L);I.renderPeerProfile(t),I.updateScroll();var P=Sc.bind(null,u,t,L);s.peer&&t.set(a.Kb.bind(null,s.peer)),Object(r.fc)(s.peer)||setTimeout(()=>mc(t,I),10);var B=new ac.a({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),D=Object(G.a)(Mc,300),A=Ic.bind(null,e,t,I,j,n,!1,D),N=Tc.bind(null,t,I.resendAll);t.setState({longpoll:_}),t.set(a.Ic.bind(null,[])),B.on("unidle",(function(){_.abortWaiting(),P()})),B.start(),nav.objLoc.box&&(dc(t,nav.objLoc.box),Object(wr.b)({box:null})),nav.objLoc.mr&&Object(r.Lb)(Number(nav.objLoc.mr))&&Object(r.ld)(t,nav.objLoc.mr,u,j);var R,F=Lc(t);if(Object(r.Xb)(t)&&(R=setInterval(r.O.bind(null,t,s.longpoll),2e3)),t.get().invitation&&Object(r.sd)(t,t.get().invitation,a.fb),Object(r.Mb)(t)&&Object(i.d)(t)){var H=document.getElementById("ui_rmenu_mr");H&&H.classList.remove("unshown")}var q=Object(l.p)(cc.bind(null,t,I,j,y),200),U=r.Fb.bind(null,t),K=r.Db.bind(null,t);return rc.g.subscribe(e=>function(e,t,n,a,r){var s=r.type,o=r.message;switch(s){case rc.b:return t.updateCasperMessageStatus(o);case rc.c:return t.updateCasperMessageStatus(o,!0);case rc.a:Object(i.x)(e,o.peerId)?a(o):(t.handleMessageExpiration(o),n.updateDialog(o.peerId,e))}}(t,I,j,q,e)),rc.g.setTimeshift(s.timeshift),m(Object(c.a)({handlers:(t,n)=>{t(document,"mousemove mousedown keypress",P),t(window,"resize",A),t(window,"online",N),n(e,"click",r.y,U),n(gpeByClass("_im-page-wrap",e),"click",r.w,K),n(gpeByClass("_im-page-wrap",e),"click",r.x,r.Eb),n(gpeByClass("_im-page-wrap",e),"click",r.z,r.Gb),browser.safari&&t(document,"visibilitychange",Mc)}}),j,I,C,e,B,_,q,u,n,k,t,L,F,R,y,w,S,x,A,(function(){g?_.offData(f):_.stop()}),b,E)}var Pc,Bc;function Dc(e){var t=ge("page_header"),n=window.clientHeight()-t.offsetHeight-30-2;setStyle(e,{height:Math.max(n,400)})}function Ac(e){var t=Object(r.gb)(Math.floor(Math.max(e,0)/1e3),!0);return t?getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function Nc(){nav.reload({force:!0})}function Rc(e){return{unmount(){clearInterval(Bc),clearTimeout(Pc),Object(c.c)(e)}}}function Fc(e,t,n){Dc(e);var a,r,i=(0,Object(c.b)(Rc).bindMutations)(Object(c.a)({handlers:(t,n)=>{t(e.querySelector("._im_sick_reload"),"click",Nc),t(window,"resize",Dc.bind(null,e))}})),s=(a=localStorage.getItem("im_sick_timer"),r=a?Math.min(2*parseInt(a),6e5):5e3,localStorage.setItem("im_sick_timer",r),r),o=e.querySelector("._im_sick_timer"),l=+new Date;return o.innerHTML=Ac(s),Bc=setInterval(()=>{o.innerHTML=Ac(l+s-new Date)},500),Pc=setTimeout(Nc,s),i}var Hc=n("f4YT"),qc=n.n(Hc),Uc=function(){return(Uc=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};window.IM={init:function(e){var t,n;if(window.imwl=e.imwl,Object(ol.d)(),Object(Sr.a)(qc.a),window.cur.lang.dont_attach=Object(Mn.d)("mail_dont_add_media"),e.failed)return Fc(Object(W.L)("im-sick",Object(W.J)("page_body")));localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=e.ctrl_submit,window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash};var i=-10800-60*(new Date).getTimezoneOffset(),s=e.timeshift,o=Uc(Uc({},e),{owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((function(e){return{peer:e,type:"perm"}})),blockedFlagUpdates:{},msgid:Object(Sr.r)(window.nav.objLoc.msgid),timeshift:s-i,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((function(){})),hintsTree:new Promise((function(){})),imTopConvList:new Promise((function(){})),keyboardCallbackEventButtons:new Map}),l=Object(b.a)(o);null===(t=e.owners)||void 0===t||t.forEach((function(e){return Object(F.a)(l,e)})),Object(r.vc)(l,l.get().tabs),window.cur.imClassicInterface=Object(r.Mb)(l);var c=xc(Object(W.L)("js-im-page",Object(W.J)("page_body")),l);Object(a.rd)(l.get()),e.group_calls_feature_tt_hash&&Object(r.rd)(l.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&Object(r.qd)(l.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved:function(e){window.curBox()&&window.curBox().hide();var t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||l.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory:function(){l.set((function(e){return Object(a.Sc)(e)})).then((function(){}),(function(){}))},activateTab:function(e){l.get().gid||l.get().longpoll.push([Object(d.a)(Object(Sr.r)(e),!1,!1,!0)])}},Object(Dr.b)("debug_messenger")&&(window.IMBRIDGE.store=l);var u=!1;window.cur.nav.push((function(){var e;return!!u||((null===(e=l.get().audio_msg)||void 0===e?void 0:e.isRecording)&&c.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),c.route.apply(null,arguments))})),null===(n=window.cur.destroy)||void 0===n||n.push((function(){if(u)return!0;c.unmount(),window.IMBRIDGE=void 0,l.unmount(),window.store=void 0,u=!0,e=!1,l=!1,c=!1,Object(ol.e)()}))}};try{window.stManager.done("imn.js")}catch(e){}},V1lx:function(e,t,n){"use strict";n.d(t,"b",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI");n("17x9");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s(e,t){var n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var r=n.getRangeAt(0);a=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}for(var i=a;i&&i!==e;)i=i.parentNode;window.Emoji&&(i||window.Emoji.editableFocus(e,!1,!0),window.Emoji.insertHTML(t))}class o extends a.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&window.Emoji&&this.props.onChange(window.Emoji.val(this.container))},this.containerRef=a.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;window.Emoji&&(window.Emoji.val(this.container,window.Emoji.emojiToHTML(e)),window.Emoji.init(this.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,onChange:this.onChange,noLineBreaks:!this.props.isMultiLine}))}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,n=e.isMultiLine,s=(e.initialValue,i(e,["tabIndex","isMultiLine","initialValue"]));return a.createElement("div",r({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":n},s))}}o.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""},t.a=o},XLJO:function(e,t,n){"use strict";n.d(t,"a",(function(){return W})),n.d(t,"b",(function(){return ce}));n("Vd3H"),n("rGqo"),n("pIFo"),n("VRzm"),n("Btvt");var a=n("EasH"),r=n("FWc3"),i=n("4+be"),s=n("ofcU"),o=n("vT4u"),l=n("P13b"),c=n("eaP7"),d=n("rDjD"),u=n("rHUl"),m=n("ZxpX"),g=n("MhhX"),_=n("86+7"),p=n("Wu9C"),b=n("ZoqV"),h=n("t7TG"),f=n("q1tI"),v=n.n(f),O=n("i8i4"),j=n("e87a"),y=n("GSQL"),w=function(e){var t=e.icon,n=e.children,a=Object(m.a)("ContactIconRow__icon","ContactIconRow__icon--"+t);return v.a.createElement("div",{className:"ContactIconRow"},v.a.createElement("div",{className:a}),v.a.createElement("div",{className:"ContactIconRow__text"},n))},C=n("Aegd"),k=n("85vT"),S=n("6krn"),E=n("6x51"),I=function(e){var t=e.contact,n=Object(E.a)(t.id);return v.a.createElement("div",{className:"ContactPopupContent"},v.a.createElement("header",{className:"ContactPopupContent__header"},v.a.createElement("div",{className:"ContactPopupContent__photo"},t.photo?v.a.createElement("img",{className:"ContactPopupContent__contactAvatarImage",src:t.photo,alt:t.name}):v.a.createElement(C.a,{text:Object(l.Ab)(t.name),size:"80",id:n,specificType:7,key:t.id})),v.a.createElement("h3",{className:"ContactPopupContent__title"},v.a.createElement(k.default,null,Object(l.xc)(t.name))),v.a.createElement("div",{className:"ContactPopupContent__meta"},Object(S.b)("mail_from_contacts_list"))),v.a.createElement("div",{className:"ContactPopupContent__info"},t.main_phone&&v.a.createElement(w,{icon:"phone"},Object(l.fb)(t.main_phone)),t.emails[0]&&v.a.createElement(w,{icon:"mail"},v.a.createElement("a",{href:"mailto:"+t.emails[0]},t.emails[0]))),t.sync_date&&v.a.createElement("div",{className:"ContactPopupContent__info"},v.a.createElement(w,{icon:"sync"},t.sync_date)))},T=n("QDnf"),M=n("aong"),L=function(e){var t=e.getContactInfo,n=e.onClose,a=Object(f.useState)({kind:"loading"}),r=a[0],i=a[1];switch(Object(f.useEffect)((function(){var e=function(e){Object(M.m)(e),i({kind:"failed"}),n()};t().then((function(t){t?i({kind:"loaded",contact:t}):e(Object(S.b)("mail_contact_was_removed"))})).catch((function(){e(Object(S.b)("global_error"))}))}),[]),r.kind){case"failed":return v.a.createElement(v.a.Fragment,null);case"loading":return v.a.createElement(T.a,null);case"loaded":return v.a.createElement(j.default,{onClose:n,className:"ContactPopup"},v.a.createElement(y.default.Header,{title:Object(S.b)("mail_contact"),onClose:n,appearance:"blue"}),v.a.createElement(I,{contact:r.contact}))}};function x(e,t,n){var a=P();if(a){var r=t-19e8;O.render(f.createElement(L,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return W(e).then(e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find(e=>e.id===t):null}(e,t);return Promise.resolve(n)})}(e,r)}),a)}}function P(){return document.querySelector("._im_contact_popup_container")}function B(e,t){return{unmount:()=>function(e,t){var n=P();n&&O.unmountComponentAtNode(n),Object(s.c)(e)}(e),closeContactPopup(){var e=P();O.unmountComponentAtNode(e)}}}var D=n("q2pz");var A=n("cYwl"),N=n("shih"),R=n("W9Tc"),F=n("kxld"),H=n("ftTi"),q=n("zxIV"),U=n("PEW9"),K="im-page--header-action_loading";function z(e,t,n){return!e.map(e=>{var a=Object(u.m)(t,n,e);return Object(g.m)(a)}).reduce((e,t)=>e&&t,!0)}function V(e,t){var n=t.get(),a=n.peer,r=n.tabs[a].pinned;return 1===e.length&&r&&e[0]===Object(u.W)(r).messageId}function W(e){return e.get().contactsList?Promise.resolve(e):e.set(o.O)}function G(e,t,n){var a=Object(i.d)("mail_selected_shorted",t.length);Y({actions:!0},"im-page--chat-header"),Object(q.Cb)(Object(q.L)("im-page--selected-messages"),getTemplate("im_selected_messages",{label:a.replace("{count}",t.length),tip:Object(i.d)("mail_deselect_all")}));var r=Object(u.s)(n,n.get().peer),s=e.querySelector("._im_mess_actions"),o=z(t,n,n.get().peer),c=V(t,n),d=t.length>1,g=!d&&Object(l.Lb)(r.peerId)&&Object(l.T)(n,t[0]),_=Object(l.Q)(n,t),p=e.querySelector('._im_page_action[data-action="respond"]'),b=e.querySelector('._im_page_action[data-action="forward"]'),h=Boolean(Object(u.ab)(r)),f=Boolean(Object(u.Y)(r));s.className=Object(m.a)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!o,"im-page--mess-actions_pinned":c,"im-page--mess-actions_channel":Object(u.z)(r)&&!n.get().gid,"im-page--mess-actions_multiple-selection":d,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":h,"im-page--mess-actions_in-mr":f,"im-page--mess-actions_no-important-btn":!Object(l.R)(n,t)}),t.length>1?p.innerHTML=Object(i.d)("mail_forward_here"):p.innerHTML=Object(i.d)("mail_im_mark_reply"),_?(b.removeAttribute("disabled"),b.classList.remove("button_disabled")):(b.setAttribute("disabled","disabled"),b.classList.add("button_disabled")),d&&!_?(p.setAttribute("disabled","disabled"),p.classList.add("button_disabled")):(p.removeAttribute("disabled"),p.classList.remove("button_disabled"));var v=o?Object(i.d)("mail_im_toggle_important"):Object(i.d)("mail_im_toggle_important_off"),O=c?Object(i.d)("mail_unpin"):Object(i.d)("mail_pin");attr(Object(q.L)("im-page-action_star",e),"aria-label",v),attr(Object(q.L)("im-page-action_pin",e),"aria-label",O)}function X(e,t,n){var a=t.get(),r=a.peer,i=a.tabs[r],s=Object(q.L)("_im_chat_verified",e),c=Object(q.L)(l.G,e),d=Object(l.Lb)(r),m=d&&Object(u.z)(i),g=a.selectedMessages&&!!a.selectedMessages.length;s.tt=!1;var b=Object(l.Oc)(t,i,!1),h=getTemplate("im_simple_link",{href:m?"/club"+-i.ownerId:i.href,content:getTemplate("im_peer_photo",{online_class:"",owner_photo:b,modifier_class:"nim-peer_smaller"})});Object(q.Cb)(Object(q.L)("im-page--aside-photo",e),h);var f=d&&Object(u.A)(i),v={muted:inArray(r,a.mutedPeers),verified:!!i.verified,chat:d,vkcomgroup:m,actions:g,derelict:d&&!f&&!m,pinned:!1};if(d){var O=Object(u.o)(t),j=function(e){var t=Object(u.o)(e);if(!t||Object(_.c)(e,t.userId))return!1;return t.userId}(t);O&&Object(p.a)(t,r)&&(j?t.set(o.jb.bind(null,{[r]:[j]})).then(X.bind(null,e,t,n)):v.pinned=!0)}Q(t,i,e);var y=!i.top_banner&&c.innerHTML,w=!i.top_banner&&$(t,e,c),C=Object(q.L)("_im_page_peer_name",e);Object(q.mb)(C,l.u),function(e,t,n){var a=n.length>0;Object(q.K)("_im_header_icon",e).forEach(e=>{if("star"===e.dataset.type&&Object(l.Rb)(t)&&(Object(q.zb)(e,"im-page--header-icon_shown",!a),Object(q.zb)(e,"im-page--header-icon_star-active",Object(l.Vb)(t))),"answer"===e.dataset.type&&Object(l.Rb)(t)&&Object(q.zb)(e,"im-page--header-icon_shown",!a&&Object(l.lc)(t)),"search"===e.dataset.type&&!Object(l.Nb)(t)){var n=t.get().peer,r=!a&&Object(l.Sb)(t,n)&&Object(u.s)(t,n).offset&&!Object(l.Nb)(t)&&(!Object(l.Kb)(t,n)||!Object(l.Mb)(t));Object(q.zb)(e,"im-page--header-icon_shown",r)}})}(e,t,[]);var k=e.querySelector("._im_dialog_call_action_wrapper"),S=e.querySelector("._im_header_icon[data-type=call]");if(k&&k.classList.toggle("im-page--header-call-is-hidden",!Object(l.Kb)(t,r)||!!i.callInProgress),S&&(S.classList.toggle("im-page--header-icon_shown",Object(l.Kb)(t,r)&&!!i.callInProgress),S.classList.toggle("im-page--header-icon_call-active",!!i.callInProgress&&i.callInProgress.participants.count>0)),Object(l.Mb)(t)){var E=Object(q.L)("_im_page_back",e);attr(E,"href",`${Object(l.lb)(t)}?tab=${a.active_tab}`)}Y(v,"im-page--chat-header"),Object(l.Y)(t,w,y,n)}function Q(e,t,n){var a=Object(l.Lb)(t.peerId),r=a&&Object(u.z)(t),s=a&&Object(u.A)(t),o=a&&Object(u.y)(t),c=Object(l.Pb)(t.peerId),d=t.name,m="";a?m=r?getTemplate("im_vkcomgroup_members",{name:Object(i.d)("mail_im_n_vkcomgroup_members",Object(l.ib)(t))}):s?getTemplate("im_chat_members",{name:Object(i.d)("mail_im_n_chat_members",Object(l.ib)(t))}):"":Object(l.nc)(t.peerId)&&(m=Object(l.tb)(e,t.peerId));var g=[];""===m&&g.push("im-page--title--1line"),o&&g.push("im-page--title--casper"),g=g.join(" ");var _=getTemplate("im_simple_name",{name:c?Object(l.xc)(t.name):t.tab,href:r?"/club"+-t.ownerId:t.href,name_attr:d,ads_union:t.ad_union_ids_attr,online:m,more_cls:g});Object(q.Cb)(Object(q.L)("im-page--title-wrapper",n),_)}function $(e,t,n){var a=Object(u.o)(e),r=n||Object(q.L)(l.G,t);if(Object(q.mb)(r,"im-page--pinned_with-bar"),a&&Object(g.q)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&Object(q.c)(r,"im-page--pinned_with-bar")}var i=Object(l.Pc)(e);return Object(q.Cb)(r,i),!!i}function Y(e,t){var n=Object(q.L)(t);Object.keys(e).forEach(a=>{Object(q.zb)(n,`${t}_${a}`,!!e[a])})}function J(e,t,n,a,r){e.set(o.ac.bind(null,n,r,a)).then(t().removeMessagesRestore.bind(null,n,r,a)),Object(o.Xb)(n,r,null,a,e.get()).then(()=>{var a=Object(u.s)(e,r);n.includes(a.lastmsg)&&Object(o.gb)(e,r).then(()=>{Object(R.b)("messenger_empty_pinned_support")&&t().updateConvoInList(r,e),t().updateState(r,e)})})}function Z(e,t,n,a,r){var i=e.get().selectedMessages,s=domData(r,"action"),d=e.get().peer,m=Object(u.s)(e,d),g=!0;if(!["star","delete"].includes(s)&&Object(u.ab)(m))return te(e,t,n);switch(s){case"delete":var _=!(vk.id==d&&!e.get().gid)&&i.every(t=>Object(l.S)(e,Object(u.m)(e,d,t)));if(_||i.length>1){g=!1;var p=Object(l.vd)(d,i.length,_,a=>{te(e,t,n),p.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?Object(o.Xb)(i,d,null,"deleteforall",e.get()):J(e,t,i,s,d)})}else J(e,t,i,s,d);break;case"spam":J(e,t,i,s,d);break;case"forward":if(!Object(l.Q)(e,i))return;Object(o.Nb)(i,d,e).then(t=>e.set(o.Lb.bind(null,t))).then(()=>n().showForward(e)).catch(e=>console.error(e));break;case"star":var b=z(i,e,d);e.set(o.I.bind(null,i,b,d)),e.get().longpoll.push(i.map(e=>({type:b?c.gb:c.cb,messageId:e,peerId:d,flags:c.o})));break;case"respond":var h=e.get(),f=1===i.length;Object(o.Nb)(i,h.peer,e).then(t=>e.set(o.M.bind(null,t,h.tfdraft,f))).then(()=>{t().respond(e,d)});break;case"pin":var v=Object(u.l)(e,i[0]);if(!Object(l.T)(e,v))return;var O=V(i,e),j=O?o.ed.bind(null,d):o.Ib.bind(null,v,d),y=O?o.dd.bind(null,d):o.Hb.bind(null,v,d),w=oe.bind(null,t,d);e.set(o.t.bind(null,e,v,d)).then(e=>e.set(j)).then(w).then(e=>e.set(y)).then(w)}g&&te(e,t,n)}function ee(e,t,n,r,s,c){var m=domData(c,"action"),g=r.querySelector("._im_dialog_action_wrapper ._ui_menu").parentNode,b=e.get().peer;switch(m){case U.b.CLEAR:var h=Object(u.s)(e,b),f=Object(l.pd)(h,b,()=>{Object(l.X)(e,f,t,o.K,e.get().peer)});break;case U.b.MEDIA:showWiki({w:"history"+Object(l.ab)(b)+"_photo"},null,{});break;case U.b.CALL_AUDIO:case U.b.CALL_VIDEO:Object(l.Kb)(e,b)&&Object(l.Fd)(e,b,m===U.b.CALL_VIDEO,[],l.b);break;case U.b.CALL_APP:if(Object(l.Kb)(e,b)){var v=`https://${window.location.hostname}/video-calls/join/${b}`;window.open(v,"_blank").focus()}break;case U.b.SEARCH:t().showSearch(e);break;case U.b.BLOCK_NOTIFY:case U.b.BLOCK_COMMUNITY:e.set(o.Vc.bind(null,!1,b)).then(()=>{e.get().longpoll.push([Object(d.g)()]),showDoneBox(Object(i.d)("mail_community_was_blocked"))});break;case U.b.ALLOW_COMMUNITY:e.set(o.Vc.bind(null,!0,b)).then(()=>{n().changeActions(e)});break;case U.b.BLOCK:Object(l.id)(b,e).once("success",t=>{t.delta&&(showDoneBox(t.msg),e.get().longpoll.push([Object(d.g)()]))});break;case U.b.LEAVE:var O=Object(l.td)(e,b,n=>{var a=e.set(o.eb.bind(null,b)).then(()=>e.set(o.ed.bind(null,b)));n&&a.then(()=>Object(l.X)(e,O,t,o.K,b)),O.hide(),e.get().longpoll.push([Object(d.g)()])});break;case U.b.UNREAD:var j=e.get();Object(o.Ab)(j.peer,j);break;case U.b.RETURN:e.set(o.mc.bind(null,b)).then(e=>e.set(o.U.bind(null,b))).then(t().updateChatTopic.bind(null,b)).catch(e=>{Object(a.d)(Object(i.d)("global_error"),e)});break;case U.b.MUTE:case U.b.UNMUTE:e.set(o.bd.bind(null,b,m===U.b.MUTE,-1)).then(t().updateState.bind(null,b));break;case U.b.PIN_CONVO:Object(N.b)(e.get(),b).catch(e=>{Object(M.m)(e)});break;case U.b.UNPIN_CONVO:Object(N.d)(e.get(),b).catch(e=>{Object(M.m)(e)});break;case U.b.CHAT_INVITE:Object(l.Hb)(e,b,t,o.Ec);break;case U.b.USER_INVITE:var y=Object(u.s)(e,b);if(Object(l.nc)(b)&&y.canBeAddedToChat){Object(A.b)(A.a.DIALOG_ACTIONS,b);var w=Object(l.Pb)(b)?function(e){return{id:e.peerId,link:e.href,name:e.name,first_name:"",short_name:"",inv_name:"",kick_name:"",sex:e.sex,photo:e.photo||""}}(y):Object(_.c)(e,b);Object(D.a)(e,w,t=>{var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([Object(d.a)(t,!1)]))},t=>{var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([Object(d.a)(t,!1,!0,!0)])})}break;case U.b.CREATE_CHAT:var C=Object(u.s)(e,b),k=[[b,C.tab]];e.set(o.Ec.bind(null,"chat",[])).then(()=>t().showCreation(e,k));break;case U.b.PIN_HIDE:Object(p.c)(e,Object(H.e)(e),t);break;case U.b.PIN_UNHIDE:Object(p.d)(e,Object(H.e)(e),t);break;case U.b.UNPIN:Object(p.e)(e,Object(H.e)(e),t);break;case U.b.SETTINGS:n().showSettings(e)}uiActionsMenu.toggle(g,!1),t().cancelEditing()}function te(e,t,n){var a=e.get().selectedMessages;e.set(o.v).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function ne(e,t,n,a){var s,o,c=Object(l.Mb)(e);switch(domData(a,"type")){case"star":o=[4,6],s=()=>Object(l.Vb)(e)?Object(i.d)("mail_im_toggle_important_off"):Object(i.d)("mail_im_toggle_important");break;case"answer":o=[4,6],s=Object(i.d)("mail_end_conversation");break;case"search":o=c?[5,6]:[4,-9],s=Object(i.d)("mail_search_in_peer")}Object(r.c)(a,{text:s||"",black:1,shift:o,forcetoup:!0,appendParentCls:c?"_im_dialog_actions":"_im_mess_actions"})}function ae(e,t,n){var a=Object(l.Mb)(e),i=domData(n.target,"action");"respond"!==i&&"forward"!==i&&Object(r.c)(n.target,{text:re.bind(null,e,i)||"",black:1,shift:[2,a?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function re(e,t){var n=e.get(),a=n.selectedMessages,r=n.peer;switch(t){case"pin":return V(a,e)?Object(i.d)("mail_unpin"):Object(i.d)("mail_pin");case"star":return z(a,e,r)?Object(i.d)("mail_im_toggle_important"):Object(i.d)("mail_im_toggle_important_off");case"delete":return Object(i.d)("mail_delete");case"spam":return Object(i.d)("mail_im_mark_spam")}}function ie(e,t,n,a,r){var s=domData(r,"type"),c=e.get().peer;switch(s){case"star":e.set(o.Yc.bind(null,c)).then(()=>{setTimeout(()=>ne(e,0,0,r),40)});break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(r,{fasthide:!0});break;case"answer":var m=Object(u.s)(e,c);m&&(e.set(o.yb.bind(null,e.get().peer,m.lastmsg)),showDoneBox(Object(i.d)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([Object(d.g)()]));break;case"call":if(Object(l.Kb)(e,c)){var g=Object(u.s)(e,c).callInProgress;g&&Object(l.qc)(e,c,g.join_link,!1,l.d)}}}function se(e,t){var n=Number(t),a=Object(l.gb)(n,!0),r=Object(i.d)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector("._im_page_status").innerHTML=r}function oe(e,t,n){return e().updateChatTopic(t,n),n}function le(e,t,n,a){var r={};return{changeActions(t){var n=e.querySelector("._im_dialog_action_wrapper ._ui_menu"),a=e.querySelector("._im_dialog_action_wrapper"),r=t.get().curActions||{},i=Object.keys(r).sort((e,t)=>o.a[e]-o.a[t]);if(0!==i.length){for(var s=getTemplate("sUiActionsMenuSeparator"),l="",c=0,d=0;d<i.length;d++){var u=i[d];d>0&&(c/10|0)!=(o.a[u]/10|0)&&(l+=s),l+=getTemplate("sImUiActionMenuItem",{action:u,name:r[u].name,icon:r[u].icon,classes:"_im_action"}),c=o.a[u]}n.innerHTML=l,a.classList.remove(K)}else a.classList.add(K)},setNetworkWaitingStatus(t){r.interval&&clearInterval(r.interval),se(e,t),r.timeout=t,r.interval=setInterval(()=>{r.timeout>1?(r.timeout--,se(e,r.timeout)):(clearInterval(r.interval),r={})},1e3)},setNetworkReconnectingStatus(){var t,n;r.interval&&clearInterval(r.interval),r={},t=e.querySelector("._im_page_status"),n=Object(i.d)("mail_network_reconnecting"),t&&(t.innerHTML=n)},clearNetworkStatus(){r.interval&&clearInterval(r.interval),r={},e.querySelector("._im_page_status").innerHTML=""},showSettings(t){var n=t.get(),r=Object(u.s)(t,n.peer);Object(u.A)(r)&&Object(b.a)(e,t,a)},showForward(t){Object(h.a)(e,t,a)},renderPeer(n){X(e,n,t)},reRenderPinned(t){var n=Object(F.b)(t);n&&n.pinned&&$(t,e)},reRenderTitle(t){var n=Object(F.b)(t);n&&Q(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&G(e,n,t)},hideActions(t){if(!Object(l.Sb)(t,t.get().peer)){Object(q.K)("_im_header_icon",e).forEach(e=>{Object(q.c)(e,K)});var n=Object(q.L)("_im_dialog_action_wrapper",e);Object(q.c)(n,K);var a=Object(q.L)("_im_dialog_call_action_wrapper",e);Object(q.c)(a,K)}},showActions(t){if(Object(l.Sb)(t,t.get().peer)){Object(q.K)("_im_header_icon",e).forEach(e=>{Object(q.mb)(e,K)});var n=Object(q.L)("_im_dialog_action_wrapper",e);Object(q.mb)(n,K);var a=Object(q.L)("_im_dialog_call_action_wrapper",e);Object(q.mb)(a,K)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?G(e,a,n):X(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=Object(q.L)("_im_page_peer_online",t);a&&Object(l.nc)(n)&&Object(u.s)(e,n)&&Object(l.N)(a,Object(l.tb)(e,n))}(t,e)},deselectAll(e){te(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){Object(s.c)(n),cancelStackFilter("fowrward")}}}function ce(e,t,n){var a=Object(s.b)(le),r=a.callMutations,i=a.bindMutations,c=Z.bind(null,t,n,r),u=ee.bind(null,t,n,r,e),m=te.bind(null,t,n,r),g=(e,n)=>Object(l.Bd)(n,t.get().peer),_=ne.bind(null,t,e),p=ae.bind(null,t,e),b=ie.bind(null,t,e,n),h=()=>r().showSettings(t),f=n=>{var a=t.get().peer;Object(l.Pb)(a)&&(!function(e,t,n,a){var r=(0,Object(s.b)(B).bindMutations)(Object(s.a)({handlers:(e,t)=>{}}),e);x(e,t,r)}(t,a),cancelEvent(n)),!gpeByClass("im-page--chat-header_chat",n.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",n.target,e)||checkEvent(n)||(h(),cancelEvent(n))},v=()=>function(e,t){var n=()=>{t&&(t.classList.remove("im-page--chat-header_reconnected"),t.removeEventListener("mouseleave",n))};t&&(t.classList.add("im-page--chat-header_reconnected"),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),O=Object(s.a)({handlers:(n,a)=>{a(e,"click","_im_page_action",c),a(e,"click","_im_action",u),a(e,"click",l.u,m),a(e,"mouseover","_im_chat_verified",g),a(e,"mouseover","_im_header_icon",_),a(e,"mouseover","_im_page_action",p),a(e,"click","_im_header_icon",b),a(e,"click","_im_header_link",f),a(e,"click","_im_page_peer_name",f),a(e,"click","_im_chat_members",h),a(e,"click","_im_page_reconnect",v),a(e,"click","_im_page_back",e=>{checkEvent(e)||(t.get().longpoll.push([Object(d.g)()]),cancelEvent(e))})}});return Object(l.fc)(t.get().peer)||setTimeout(()=>{t.set(o.Bc).then(r().changeActions)}),i(e,n,O,r)}},XuPN:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("1nu5"),r=n("q1tI"),i=function(e,t,n){var i=Object(r.useRef)(null);i.current=i.current?i.current:new a.a(e,t);var s=i.current,o=Object(r.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),l=Object(r.useState)(e),c=l[0],d=l[1],u=Object(r.useState)(o(e)),m=u[0],g=u[1];return Object(r.useEffect)((function(){var t=o(e),a=e.filter((function(e){return!m[n(e)]})),r=c.filter((function(e){return!t[n(e)]}));(a.length||r.length)&&(a.forEach((function(e){s.add(e)})),r.forEach((function(e){s.remove(e)})),d(e),g(t))}),[e]),s}},ZVxX:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("VRzm"),n("Btvt");function a(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(n,a){e?e.call(navigator,t,n,a):a(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}},bP5l:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return m}));var a=n("ERyv"),r=function(e,t){for(var n=0,a=t.length,r=e.length;n<a;n++,r++)e[r]=t[n];return e};function i(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(window.vk.lpConfig.debug){var i="background: "+e+"; color: white",s=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,r(["%c "+s.getHours()+":"+o(s.getMinutes())+":"+o(s.getSeconds())+":"+s.getMilliseconds()+" "+t+" ",i],n))}}function s(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function o(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function l(e,t){var n;window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:!!(null===(n=window.curNotifier)||void 0===n?void 0:n.is_server)}),setTimeout(c,1e4)}function c(){window.lpWeird&&window.lpWeird.length&&(Object(a.b)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function d(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function u(){var e;d()&&(o().forEach((function(e){!s().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev),Object(a.c)()&&l("im not fc",e.ev))})),s().forEach((function(e){var t=o().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev),Object(a.c)()&&l("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=s().filter((function(t){return t.time>e})),window.lpBufferIm=o().filter((function(t){return t.time>e}))}function m(e){var t;d()&&((t=s()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,0)),i.apply(void 0,r(["green","fc"],e))}window.longpollTestingOnImEvents=function(e){var t;d()&&((t=o()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,1100)),i.apply(void 0,r(["blue","im"],e))}},f4YT:function(e,t){e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%"%attrs%>\n  <span>%label%</span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:'<div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> </div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> %msg%</li>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="%list_id%"> %msg%</li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice"> %msg% </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody%</span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span></span> <span class="im-fwd--close _im_fwd_close"></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date _im_dialog_date">%date%</div> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <button type="button" class="nim-dialog--markre _im_dialog_markre"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--mute"></span> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"></span> </div> <div class="im-mess--check fl_l"></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes%> <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message %id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="_im_top_banner_button _im_call_banner_join_btn im-top-banner--button flat_button button_small secondary" data-link="%call_link%">'+getLang("mail_join_chat")+"</button>"},sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M5.77 8l3.37 3.36a.9.9 0 01-1.28 1.28l-4-4a.9.9 0 010-1.28l4-4a.9.9 0 011.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg"><g id="chevron_16__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="chevron_16__chevron_16"><path id="chevron_16__Bounds" d="M0 0h12v16H0z"/><path d="M7.23 8L3.86 4.64a.9.9 0 111.28-1.28l4 4a.9.9 0 010 1.28l-4 4a.9.9 0 11-1.28-1.28L7.23 8z" id="chevron_16__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:' <%tag_name% class="BotCarousel__slideButton BotCarousel__slideButton--%modifier% Button Button--size-m Button--wide Button--overflow Button--%appearance% _im_mess_btn" %attributes% > <span class="BotCarousel__slideButtonLabel"> %label% </span> </%tag_name%>',sImConvoRecommendListUser:'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog" data-peer="%id%"> <div class="ConvoRecommendList__img">%photo%</div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>',sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__img ConvoRecommendList__icon" aria-hidden="true">%icon%</span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>'}},"fD+e":function(e,t,n){"use strict";n.r(t),n.d(t,"TemplatesDropDown",(function(){return d}));var a=n("q1tI"),r=(n("17x9"),n("1Ot2")),i=n("6krn"),s=n("Jbbb"),o=n("n3cE"),l=n("ZxpX"),c=i.a.getLang;class d extends a.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,n=e.showSettingsPopup,i=e.showCreatingTemplatePopup,s=e.isNeededRendering,d=this.state.isShowDropDown;if(!s())return null;var u=t();return a.createElement("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1)},a.createElement("div",{className:Object(l.a)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":d}),"aria-hidden":d},a.createElement("div",{className:"TemplatesDropDown__container"},a.createElement(r.a,{className:"TemplatesDropDown__scroll-wrapper"},a.createElement("div",null," ",a.createElement("header",{className:"TemplatesDropDown__header"},a.createElement("h2",{className:"TemplatesDropDown__title"},c("mail_community_templates")),a.createElement("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:n},c("mail_settings_configure"))),u.length?a.createElement("ul",{className:"TemplatesDropDown__list"},u.map(e=>a.createElement("li",{key:e.id,className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id)},a.createElement("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})))):a.createElement("div",{className:"TemplatesDropDown__not-found-container"},a.createElement("span",null,c("mail_community_templates_not_found")),a.createElement(o.a,{onClick:i},c("mail_add_community_template"))))))),a.createElement("button",{className:"TemplatesDropDown__icon"}))}}t.default=Object(s.a)(d)},gF8j:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("uQjJ"),r=n("PU8N"),i=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}()),s=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function l(e,t,n){Object(r.c)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function c(e,t,n){Object(r.c)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function d(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,a.a.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(r.c)()&&this._isTopLevel()&&u()&&c(document,u(),this.onVisiblityChange),Object(r.c)()&&s||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(r.c)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(r.c)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),Object(r.c)()&&s||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(i.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===d()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=d();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},hGJG:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("jE6c"),r=n("kcIO"),i=n("Iqrf");function s(){var e=2e9+Math.round(Object(a.p)(1e6,2e6));return new Promise((function(t){window.cur.recieveCropResult=function(n){window.cur.recieveCropResult=!1,Object(i.h)(JSON.parse(n).data[0],e).then((function(e){var a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),Object(r.b)()&&Object(r.b)().hide(!0)}),(function(){}))},window.Page.ownerPhoto(e),Object(r.b)().setOptions({onHideAttempt:function(e){return e||t({}),!0}})}))}},hOuX:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("tuSo");function a(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((e,t)=>e+t))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}},m5nf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIN",(function(){return p})),n.d(t,"EDIT",(function(){return b}));n("pIFo"),n("91GP"),n("VRzm"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("6krn")),i=n("amDN"),s=n("Jbbb"),o=n("BiHW"),l=n("1Ot2"),c=n("n3cE"),d=n("V1lx"),u=n("LYnS"),m=n("vT4u"),g=n("nAFc"),_=n("EasH"),p="main",b="edit";class h extends a.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,n=e.name,a=e.text;return new Promise(e=>this.setState({editableMessage:{id:t,name:n,text:a}},e))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:Object(g.b)(t)})),this.deleteTemplate=e=>Promise.resolve().then(()=>this.state.section!==p?this.go(p):Promise.resolve()).then(()=>this.props.store.set(m.C.bind(null,e))).catch(()=>{Object(_.d)(Object(r.b)("mail_error"),Object(r.b)("mail_community_templates_delete_error"))}),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,n=t.name,a=t.text;n.length>200||n.length<2||n.length>2e3||a.length<5?Object(_.d)(Object(r.b)("mail_error"),Object(r.b)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch(()=>{Object(_.d)(Object(r.b)("mail_error"),Object(r.b)("mail_community_templates_save_error"))}).then(()=>this.go(p))},this.addHint=(e,t)=>{t.preventDefault();var n=this.state.editableMessage,a=n.id,r=void 0===a?null:a,i=n.name,s=n.text;return Object(d.b)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:r,name:i,text:`${s}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.id,a=void 0===n?null:n,r=t.name,i=void 0===r?"":r,s=t.text,o=void 0===s?"":s;return new Promise(t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:a,name:i,text:o}},()=>{this.props.popup.updateBoxCoords(),t()}):t()})}render(){var e=this.props,t=e.getTemplates,n=e.closePopup,s=this.state,m=s.section,g=s.editableMessage,_=t();return a.createElement("section",{className:"TemplatesSettings"},a.createElement(i.a,{title:a.createElement("span",{className:"TemplatesSettings__title"},m===p&&Object(r.b)("mail_community_templates"),m===b&&Object(r.b)("mail_add_community_template")),onCloseClick:n}),a.createElement("main",{className:"TemplatesSettings__content"},m===p&&(_.length?a.createElement(l.a,{className:"TemplatesSettings__scroll-wrapper"},a.createElement("div",{className:"TemplatesSettings__list"},_.map(e=>a.createElement("section",{key:e.id,className:"TemplatesSettings__item"},a.createElement("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),a.createElement("div",{className:"TemplatesSettings__buttons-row"},a.createElement(c.a,{onClick:()=>this.go(b,e),className:"TemplatesSettings__item-button"},Object(r.b)("mail_settings_edit")),a.createElement("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true"}," ","·"," "),a.createElement(c.a,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button"},Object(r.b)("mail_delete"))))))):a.createElement("div",{className:"TemplatesSettings__not-found-container"},a.createElement("span",null,Object(r.b)("mail_community_templates_not_found")),a.createElement(c.a,{onClick:()=>this.go(b)},Object(r.b)("mail_add_community_template")))),m===b&&a.createElement("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate},a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"name"},Object(r.b)("mail_name"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.a,{id:"name",type:"text",initialValue:g.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.b)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"text"},Object(r.b)("mail_text"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.a,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:g.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.b)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label"},Object(r.b)("mail_hints"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},Object(u.a)().map(e=>a.createElement(o.a,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",key:e.id},e.label)))))),a.createElement("footer",{className:"TemplatesSettings__footer"},m===p&&a.createElement(a.Fragment,null,a.createElement(c.a,{onClick:()=>this.go(b)},Object(r.b)("mail_add_community_template")),a.createElement(o.a,{onClick:n},Object(r.b)("mail_close"))),m===b&&a.createElement(a.Fragment,null,a.createElement("div",null,g.id&&a.createElement(c.a,{onClick:this.deleteTemplate.bind(null,g.id)},Object(r.b)("mail_delete_community_template"))),a.createElement("div",null,a.createElement(o.a,{appearance:"tertiary",onClick:()=>this.go(p)},Object(r.b)("mail_cancel")),a.createElement(o.a,{onClick:this.saveTemplate,form:"create_template_form",type:"submit"},Object(r.b)("mail_save"))))))}}h.defaultProps={section:p},t.default=Object(s.a)(h)},nJdr:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n("DM26"),r=n("ER42"),i=n("eaP7"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function o(e,t){e.waitAbortFns.push(t)}function l(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=Object(r.a)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],a=t[1];return window.lpDebug&&(window.lpDebug=s(s({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,a),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=s(s({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?Object(a.a)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},r=n.abort,i=n.pause;switch(t.failed){case 1:return o(e,r),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(i).then((function(){return l(e)}));case 2:return o(e,r),e.onKeyExpired(e,t).then((function(t){var n=t[0],a=t[1],r=t[2],i=t[3];return e.onResult({ts:+i,updates:[[-2,n,a+"/"+r],[-1]]})})).then(i).then((function(){return l(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function c(e){e.isStoppedFn()||l(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&d(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),d(e,-3);var n=Object(a.a)(e.waitTimeout,null),r=n.abort,i=n.pause;return o(e,r),i().then((function(){return d(e,-4)}))}(e,t)})).then((function(){return c(e)}))}function d(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function u(e){return e||function(){}}function m(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}var g=n("bP5l"),_=n("vT4u"),p=n("XzvV");function b(e,t){return function(e,t){var n=!!e.stopped,a={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||14,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&s(a.ts,e.ts,e.updates.map(i.mb))},onData:u(t.onData),onRequestError:u(t.onRequestError),onHistoryLost:m(t.onHistoryLost),onKeyExpired:m(t.onKeyExpired),onLpBroken:m(t.onHistoryLost)},r=t.onEvents;function s(e,t,n){a.ts=t;for(var s=0;s<n.length;++s)n[s].type===i.W&&(a.key=n[s].key||"",a.url=n[s].url||"");r(e,t,n)}var o={options:a,isStopped:function(){return n},stopConnection:function(){n=!0,a.stopFn&&a.stopFn(),a.stopFn=void 0,document.removeEventListener("resume",l),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",l),d(a,-4),n=!1,c(a)},abortWaiting:function(){a.waitAbortFns.forEach((function(e){return e()})),a.waitAbortFns=[],a.waitTimeout=2},onLp:s};function l(){o.abortWaiting()}return document.addEventListener("resume",l),c(a),o}(e,{onEvents:t,onData:v,onRequestError:O,onHistoryLost:j,onKeyExpired:y,onLpBroken:w})}var h={},f=Date.now();function v(e,t){if(t&&t.status&&e.lpstat){var n=t.status.toString();t.status>=500&&t.status<600&&Object(p.bb)("fc_longpoll",1,n,t.getResponseHeader("x-frontend")||""),h[n]=n in h?h[n]+1:1,Date.now()-f>=3e4&&(Object.keys(h).forEach((function(e){Object(p.bb)("fc_longpoll",h[e],e,t.getResponseHeader("x-frontend")||"")})),h={},f=Date.now())}}function O(e){Object(g.b)("red","LP error",e.message||"no message (probably browser reset)")}function j(e,t){Object(g.b)("red","LP failed: old timestamp; resync, next ts",t.ts)}function y(e){return Object(g.b)("red","LP failed: key is incorrect; refresh key"),Object(r.b)(_.e,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function w(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},q2pz:function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var a,r=n("ofcU"),i=n("q1tI"),s=n.n(i),o=n("i8i4"),l=n.n(o),c=n("e87a"),d=n("6krn"),u=n("euvX"),m=function(e){var t=e.title,n=e.onCloseModal,a=e.footer,r=e.isWithBackButton,i=void 0!==r&&r,o=e.onBackClick,l=e.children;return s.a.createElement(c.default,{className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:n},s.a.createElement(u.a,{title:t,onClose:n,appearance:"blue",backText:i?Object(d.b)("global_back"):void 0,onBack:o,className:"UserConvoInviteModal__header"}),s.a.createElement("div",{className:"UserConvoInviteModal__content"},l),a)},g=n("5PZO"),_=n("wQFj"),p=n("J4gp"),b=n("zjLC");!function(e){e.ALL="all",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}));var h=n("kxld"),f=n("EasH"),v=n("QDnf"),O=n("shih"),j=n("4+be"),y=n("4edV"),w=n("pdqG"),C=n("rudk"),k=n("DM26"),S=n("XuPN"),E=n("6x51"),I=n("Iqrf"),T=Object(k.b)(O.c,300),M=function(){return!0};var L,x=n("ErRf"),P=n("1MUc"),B=n("hGJG"),D=d.a.getLang;!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(L||(L={}));var A=function(e){var t=e.user,n=e.store,r=e.onClose,o=e.onInviteSent,l=e.onGoToConvo,c=Object(i.useState)(L.PICKER),d=c[0],u=c[1],k=Object(i.useState)(!function(e){var t,n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(n)),A=k[0],N=k[1],R=Object(i.useState)(!0),F=R[0],H=R[1],q=Object(i.useState)(!1),U=q[0],K=q[1],z=Object(i.useState)(function(e){var t,n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(C.c);if(a&&a.length>0)return a.map((function(t){return Object(h.e)(e,t)}));return[]}(n)),V=z[0],W=z[1],G=Object(i.useState)(""),X=G[0],Q=G[1],$=Object(i.useCallback)((function(e){Q(e.target.value)}),[X]),Y=Object(i.useCallback)((function(){}),[]),J=Object(i.useRef)(null),Z=function(e,t,n,a){var r=Object(i.useState)(t),s=r[0],o=r[1],l=Object(i.useState)(!1),c=l[0],d=l[1],u=Object(i.useRef)(n),m=Object(i.useCallback)((function(e){return e.name}),[]),g=Object(i.useCallback)((function(e){return e.peerId}),[]),_=Object(S.a)(t,m,g),p=Object(i.useCallback)((function(e){return a.filterFn?e.filter(a.filterFn):e}),[a.filterFn]);return Object(i.useEffect)((function(){if(u.current=n,n){var r=_.search(n),i=r.map((function(e){return e.peerId}));o(p(r)),d(!0),T(n,i,a.queryType||I.a.ALL,a,e.get()).then((function(e){u.current===n&&(o(Object(E.f)(r,e,a.filterFn||M)),d(!1))})).catch((function(){}))}else o(p(t)),d(!1)}),[n,t]),[s,c]}(n,V,X,{queryType:I.a.ALL,filterFn:function(e){return Object(C.c)(e.peerId)}}),ee=Z[0],te=Z[1];Object(i.useEffect)((function(){return Object(O.a)(n.get(),a.CHATS,200).then((function(e){var t=e.items;return W(Object(E.f)(V,t)),t})).then((function(e){var t=e.reduce((function(e,t){return e[t.peerId]=t,e}),{});return n.set((function(n){return Object(w.a)(t,n).then((function(t){return Object(y.c)(t,e.map((function(e){return e.peerId})))}))}))})).finally((function(){return N(!1)})),Object(x.c)("convo_invite",(function(){})),function(){setTimeout((function(){return Object(x.a)("convo_invite")}),0)}}),[]);var ne=t.inv_name?Object(j.l)(Object(j.k)(t.sex,D("mail_im_invite_user",!0)),"user",t.inv_name):D("mail_convo_invite_title");return s.a.createElement(s.a.Fragment,null,d===L.PICKER&&s.a.createElement(m,{title:ne,onCloseModal:r,footer:s.a.createElement(g.a,null,s.a.createElement(_.default,{checked:F,onChange:function(e,t){return H(t)}},D("mail_im_chat_add_members_show_history")))},s.a.createElement(p.a,{convos:ee.map((function(e){return Object(h.e)(n,e.peerId)||e})),searchValue:X,onSearchValueChange:$,onSearchInputKeydown:Y,onConvoSelect:function(e){K(!0),Promise.resolve().then((function(){return n.set((function(n){return Object(b.a)(e,[t.id],F,n)}))})).then((function(){return o(e)})).then((function(){r(),K(!1)})).catch((function(e){K(!1),Object(f.d)(D("global_error"),e)}))},checkDisabled:function(e){return!e.canInvite},searchInputGetter:function(e){return J.current=e},isLoading:A||te&&0===ee.length,style:{height:410},onAddClick:function(){return u(L.CREATION)}})),d===L.CREATION&&s.a.createElement(P.a,{store:n,uploadAvatar:B.a,onClose:r,onBack:function(){return u(L.PICKER)},onCreateChat:function(e){o(e).then((function(){}),(function(){})),r()},onGoToConvo:function(e){l(e),r()},preselectedUsers:[{id:t.id,peerId:t.id,name:t.name,photo:t.photo}]}),U&&s.a.createElement(v.a,null))};function N(){var e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function R(e){return{unmount:function(){var t=N();t&&l.a.unmountComponentAtNode(t),Object(r.c)(e)}}}function F(e,t,n,a){var i=(0,Object(r.b)(R).bindMutations)(Object(r.a)({handlers:function(){}}));return function(e,t,n,a,r){var i=N();l.a.render(s.a.createElement(A,{user:n,store:e,onClose:t.unmount,onInviteSent:a,onGoToConvo:r}),i)}(e,i,t,n,a),i}},rCUf:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return l}));n("91GP"),n("pIFo");var a=n("EasH"),r=n("8h6g");function i(e){var t=r.b.slice(0,r.b.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+r.b.join(",."):""}function s(e){if(!cur.leaving){var t=getLang("video_upload_changed"),n=!1;if(each(window.cur.videoUploaders,(e,t)=>{Upload.isSomethingUploading(t)&&(n=!0)}),1===e){if(!n)return!0;var r=Object(a.d)({title:getLang("global_warning"),dark:!0},t,getLang("global_continue"),(function(){cur.leaving=!0,r.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){r.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return n?winToUtf(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function o(e,t,n,o,c){if(n){o=o||cur,(c=c||{}).onUploadStart||(c.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,n){if(!1===s(1))return cur.onContinueCb=nav.go.pbind(n),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=s,c.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),c.onUploadStartDone&&c.onUploadStartDone()}),c.onUploadComplete||(c.onUploadComplete=(e,t)=>{var n=window.parseJSON(t);n.video_id?l(e,n,o):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);c.onUploadCompleteDone&&c.onUploadCompleteDone(),setTimeout(()=>{c.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&c.onUploadAllCompleteDone()})}),c.onUploadProgress||(c.onUploadProgress=(e,t,n)=>{var a=void 0!==e.ind?e.ind:e;show("_im_media_preview"),o.showMediaProgress&&o.showMediaProgress("video",a,function(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,n))}),c.onUploadError||(c.onUploadError=(e,t)=>{statlogsValueEvent("upload_video_fails",1,n.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,n=e.fileName?t+"_"+e.fileName:e;if(re("upload"+n+"_progress_wrap"),!geByClass1("popup_box_container")){var r=getLang("video_upload_error");setTimeout(Object(a.d)({title:getLang("global_error")},r).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var d=cur.maxFiles-(cur.savedVideos||[]).length,u=browser.safari?"":"video/*,"+i("accept");n.lang&&(cur.lang=extend(cur.lang||{},n.lang));var m={accept:u,file_input:null,file_name:"video_file",file_size_limit:1024*(n.options.file_size_limit_in_GB||r.c)*1024*1024,file_types_description:"Video files",file_types:i("types"),chooseBox:1,chunked:1,chunkSize:r.a,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:n.vars.from,lang:n.lang,max_attempts:3,max_files:d,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!n.options.hasOwnProperty("visible_dropbox")||n.options.visible_dropbox},g=Upload.init(e,"",{},Object.assign(m,c));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(g),g}}function l(e,t,n,r){n=n||cur;var i=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),o=s?i+"_"+s:e,l=t.owner_id+"_"+t.video_id,c=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,d=ge("upload"+o+"_progress_wrap");d&&hide(geByClass1("progress_x",d)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:l},{onDone:e=>{c||n.chooseMedia("video",l,extend(e[l],{upload_ind:o,upload_new:!0}));var i=t.owner_id,s=t.video_id,d=t.video_hash,u=0,m=()=>{ajax.post("al_video.php?act=encode_progress",{oid:i,vid:s,hash:d,need_thumb:1},{onDone:t=>{var d,u=!0;if(t){if(t.error)return d=getLang("video_upload_encode_error"),void setTimeout(Object(a.d)({title:getLang("global_error")},d).hide,2e3);t.thumb&&(u=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:i,vid:s},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(l,t),void re("upload"+o+"_progress_wrap");n.hasChosenMedia("video",l)?n.updateChosenMedia("video",l,extend(t,{upload_ind:o,upload_new:!0})):r&&r(e,l)}}))}u&&(c||n.hasChosenMedia("video",l))&&setTimeout(m,1e3)},onFail:()=>{++u<3&&setTimeout(m,2e3*u)}})};m()}})}t.a={getUploadModule:(e,t,n,a,r)=>o(e,t,n,a,r),initModalVideoUploader(e){var t=cur.videoUploadParams,n=ge("choose_video_upload");if(!n)return!1;this.initDragEvents();var a={};return"article"===e&&(a.onUploadProgress=()=>{}),o(n,boxLayerWrap,t,null,a)},initDragEvents(){var e,t=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=ge("video_choose_upload_area_wrap");if(!hasClass(t,"video_choose_upload_area_enter")){addClass(t,"video_choose_upload_area_enter");var n=ge("video_choose_wrap"),a=getXY(n)[1],r=getSize(t)[1];return hide("video_choose_wrap"),setStyle(t,"height",scrollGetY()+window.clientHeight()-a+r),cancelEvent(e)}},n=e=>cancelEvent(e),a=e=>{if(n(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},r=()=>{addEvent(boxLayerWrap,"dragenter dragover",t),addEvent(boxLayerWrap,"dragleave",n),addEvent(boxLayerWrap,"drop",a)};r();var i=null===(e=curBox().getOptions())||void 0===e?void 0:e.onHide;setTimeout(curBox().setOptions.pbind({onHide:()=>{if(removeEvent(boxLayerWrap,"dragenter dragover",t),removeEvent(boxLayerWrap,"dragleave",n),removeEvent(boxLayerWrap,"drop",a),"function"==typeof i)return i()},onShow:()=>{Video.initChooseBox(),r()}}),0)}}},t7TG:function(e,t,n){"use strict";n.d(t,"a",(function(){return B}));n("VRzm"),n("Btvt");var a=n("ofcU"),r=n("q1tI"),i=n("i8i4"),s=n("Jbbb"),o=(n("91GP"),n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("Vd3H"),n("17x9"),n("amDN")),l=n("3blr"),c=n("J4gp"),d=n("vT4u"),u=n("DM26"),m=n("P13b"),g=n("rHUl"),_=n("kxld"),p=n("rDjD"),b=n("6krn"),h=n("O8ze"),f=n("ZxpX"),v=n("rjmT"),O=n("EasH"),j=n("6x51");function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var k=Object(u.b)(d.pc,300),S=b.a.getLang;class E extends r.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if(Object(g.E)(e)){var t=0===this.state.mode?1:0,n=0===t?d.rc:d.vc;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},()=>n("",e.get()).then(e=>this.setSearchResults(this.filterResults(e))).then(()=>this.searchInput.focus()).catch(e=>console.error(e)))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=Object(g.E)(this.props.store)&&1===this.state.mode;return e.filter(e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!Object(_.a)(e,1024))&&!(!t&&n>2e9&&Object(_.a)(e,1024)))})},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=Object(g.E)(t)&&0===this.state.mode,r=a?d.rc:d.vc;return 1===this.state.mode&&""===e?this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}):r(e,n).then(t=>{var r=t.map(e=>e.peerId);return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?k(e,r,"all",{hidegid:a},n):Promise.resolve([])}).then(t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)}).catch(()=>{})},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},r={};return Object(d.vc)("",t).then(i=>(i.forEach(e=>{r[e.peerId]=e}),[t.peer].concat(n.filter(e=>e!==t.peer)).map(t=>{var n=Object(g.s)(e,t);return a[t]=!0,{name:r[t]&&r[t].tab||n.tab,photo:r[t]&&r[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}}).concat(i.filter(e=>!a[e.peerId])).sort((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:Object(j.i)(e,n,a))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([Object(p.a)(e,!1,!0,!0,"forward_messages_popup")]),Object(h.e)(t),Object(g.E)(t)&&Object(h.g)(t,!1)):this.setState({selected:e,error:null},()=>{Emoji.focus(this.input)})},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var r=e.filter(e=>!t.found[e.peerId]);r.forEach(e=>{t.found[e.peerId]=!0}),t.setState({found:[].concat(t.state.found,r),loading:a})}else t.found=e.reduce((e,t)=>(e[t.peerId]=!0,e),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new v.a({},0),r=e.get().pendingForward;if(t&&!Object(m.Yb)(val)){this.setState({sending:!0});var i=Object(g.E)(e)&&0===this.state.mode;i||a.addAttach("mail",r.msgIds.join(";"),r.object||null);var s={message:n,attaches:a.dData.attaches.map(e=>[e.type,e.id])||[]},o={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:i?r.msgIds.join(";"):void 0}};new Promise(n=>{Object(d.lb)([t],{hidegid:!0},e.get()).then(e=>{var a=w(e,1)[0];return n(a[t])})}).then(n=>e.set(d.yc.bind(null,t,s,y({hash:n},o)))).then(()=>{Object(h.g)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(S("mail_send3"))}).catch(e=>{this.unmounted||this.setState({sending:!1},()=>{Object(O.d)(S("mail_error"),e)})})}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}).catch(e=>console.error(e))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,a=this.state,i=a.mode,s=a.loading,d=a.selected,u=a.found,m=a.sending,_=Object(f.a)("MessageForward",{"MessageForward--form":0===i&&!!d});return r.createElement("section",{className:_},r.createElement(o.a,{title:r.createElement(r.Fragment,null,r.createElement("span",{className:"MessageForward__title"},S("mail_forward_messages")),Object(g.E)(t)&&r.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},S(0===i?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),r.createElement("div",{className:"MessageForward__content"},r.createElement(c.a,{searchValue:this.state.value,isLoading:s,convos:u.map(e=>e||Object(g.s)(t,e.peerId)),mode:1===i?c.b.DEFAULT:c.b.RADIO,selectedConvos:[d],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),r.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},r.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},r.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:S("mail_im_enter_msg")}),r.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},r.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:S("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},r.createElement("div",{className:"emoji_smile_icon_vector emoji_smile_icon"})))),m?r.createElement("div",{className:"MessageForward__send-spinner"},r.createElement(l.default,null)):r.createElement("button",{className:"MessageForward__send",onClick:this.send}))))}}var I,T=Object(s.a)(E);function M(){I&&I.hide()}function L(){I&&I.updateBoxCoords()}function x(){return document.querySelector("#MessageForward")}function P(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),r=isVisible(t);return{unmount(){var t=x();t&&i.unmountComponentAtNode(t),Object(a.c)(e)},showLoader(){boxRefreshCoords(n),show(n),r||show(t)},hideLoader(){hide(n),r||hide(t)}}}function B(e,t,n){var o=(0,Object(a.b)(P).bindMutations)(Object(a.a)({handlers:(e,t)=>{}})),l={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=x();t&&i.render(r.createElement(s.b,{value:e},r.createElement(T,{closePopup:M,updatePopup:L})),t)}(t),requestAnimationFrame(()=>I.updateBoxCoords())},onHideAttempt:()=>(t.set(d.Lb.bind(null,null)),o.unmount(),!0)};return o.showLoader(),Promise.resolve().then(e=>{o.hideLoader(),I=new MessageBox(l).content('<div id="MessageForward"></div>').show()}),o}}});