!function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={"web/calls":0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(){return Promise.resolve()},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([174,"common","palette","vendors","7ed9e4d544bccc8a5ada0a712a9cf1ad","29ce115e24facf4cb9fb345ec7c74430","39b5edcd62db621884b02bf68c03155b"]),n()}({"/oKx":function(e,t,n){"use strict";var r=n("zMZw"),i=n("LQSR");function a(e){"number"==typeof e.mid&&(e.mid=e.mid.toString())}function o(){this.cache={mlB2UMap:{},mlU2BMap:{}}}e.exports=o,o.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},o.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},o.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=r.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},o.prototype.toPlanB=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Unified Plan."),e;for(var o=e.sdp,c=!1,u=0;u<n.media.length;u++){n.media[u].rtp.forEach((function(e){if("NULL"===e.codec){c=!0;var n=r.parse(t.cache.offer);e.codec=n.media[u].rtp[0].codec}}))}c&&(o=r.write(n)),this.cache[e.type]=o;var l=n.media;n.media=[];var d={},p=[],h={};l.forEach((function(e){if(a(e),("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction&&"application"!==e.type)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==d[e.type]&&"inactive"!==d[e.type].direction||(d[e.type]=e)})),l.forEach((function(e){var t=e.type;if("application"===t)return e.mid="data",n.media.push(e),void p.push(e.mid);"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(n){"object"!=typeof d[t].sources&&(d[t].sources={}),d[t].sources[n]=e.sources[n],void 0!==e.msid&&(d[t].sources[n].msid=e.msid)})),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==d[t].ssrcGroups&&Array.isArray(d[t].ssrcGroups)||(d[t].ssrcGroups=[]),i.apply(d[t].ssrcGroups,[e.ssrcGroups])||(d[t].ssrcGroups=d[t].ssrcGroups.concat(e.ssrcGroups)));var r=e.direction;h[t]=(h[t]||0)|s[r||"inactive"],d[t]===e&&(e.mid=t,delete e.bundleOnly,delete e.msid,"inactive"!==r&&p.push(t),n.media.push(e))})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=p.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var f=r.write(n);return new RTCSessionDescription({type:e.type,sdp:f})},o.prototype.toUnifiedPlan=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Plan B."),e;var o=[];n.media.forEach((function(e){o.push(e.mid)}));var s,c=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(c=n.groups.every((function(e){return"BUNDLE"!==e.type||i.apply(e.mids.sort(),[o.sort()])}))),!c)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");void 0!==this.cache[e.type]&&(s=r.parse(this.cache[e.type]));var u={audio:{},video:{}},l={},d=0,p=0;if(n.media.forEach((function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction&&"application"!==n.type)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===n.type){var r=null;return s&&s.media&&(r=s.media.find((function(e){return"application"===e.type}))),void(r?l[r.mid]=r:l[n.mid]=n)}var i=n.sources,o=n.ssrcGroups,c=n.candidates,h=n.iceUfrag,f=n.icePwd,m=n.fingerprint,v=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var _={};void 0!==o&&Array.isArray(o)&&o.forEach((function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(t){void 0===_[t]&&(_[t]=[]),_[t].push(e)}))}));var g={};"object"==typeof i&&Object.keys(i).forEach((function(r){var o;if("offer"!==e.type||i[r].msid)if(void 0!==_[r]&&Array.isArray(_[r])&&_[r].some((function(e){return e.ssrcs.some((function(e){if("object"==typeof g[e])return o=g[e],!0}))})),"object"==typeof o)o.sources[r]=i[r],delete i[r].msid;else{if(o=Object.create(n),g[r]=o,void 0!==i[r].msid&&(o.msid=i[r].msid,delete i[r].msid),o.sources={},o.sources[r]=i[r],o.ssrcGroups=_[r],void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(t){t===r&&(o.mid=e.mid)}))})),a(o),void 0===o.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");o.mid=[n.type,"-",r].join("")}o.candidates=c,o.iceUfrag=h,o.icePwd=f,o.fingerprint=m,o.port=v,l[o.mid]=o,t.cache.mlU2BMap[p]=d,void 0===t.cache.mlB2UMap[d]&&(t.cache.mlB2UMap[d]=p),p++}else u[n.type][r]=i[r]})),d++})),n.media=[],o=[],"answer"===e.type)for(var h=0;h<s.media.length;h++){var f=s.media[h];a(f),void 0===l[f.mid]&&(delete f.msid,delete f.sources,delete f.ssrcGroups,f.direction&&"sendrecv"!==f.direction?"sendonly"===f.direction&&(f.direction="inactive"):f.direction="recvonly"),n.media.push(f),"string"==typeof f.mid&&o.push(f.mid)}else void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){a(e),o.push(e.mid),void 0!==l[e.mid]?n.media.push(l[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))})),Object.keys(l).forEach((function(e){-1===o.indexOf(e)&&(o.push(e),"recvonly"===l[e].direction?n.media.some((function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===l[e].type)return Object.keys(l[e].sources).forEach((function(n){t.sources[n]=l[e].sources[n]})),!0})):n.media.push(l[e]))}));["audio","video"].forEach((function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(u[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var a=n.media[r];Object.keys(u[e]).forEach((function(t){a.sources&&a.sources[t]&&console.warn("Replacing an existing SSRC."),a.sources||(a.sources={}),a.sources[t]=u[e][t]}))}}})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=o.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var m=r.write(n);return this.cache[e.type]=m,new RTCSessionDescription({type:e.type,sdp:m})};var s={inactive:0,recvonly:1,sendonly:2,sendrecv:3}},174:function(e,t,n){e.exports=n("7ylw")},"1nu5":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},r=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=r.length;i--;){var a=r[i],o="";if(a){for(var s=0;s<6;s++){var c=a.charCodeAt(s);if(c){var u=this.toTranslit[c],l=a.substr(s,1);o+=null!=u?u:l}}n[o]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),r=n.length;r--;){var i={},a=n[r],o="",s="",c="",u=a.length>1;if(a){for(var l=0;l<6;l++){var d=a.charCodeAt(l);if(d){var p=this.toTranslit[d],h=a.substr(l,1);if(o+=null!=p?p:h,u){var f=this.toLocalCase[h],m=this.toLocalTranslit[d];s+=null!=f?f:h,c+=null!=m?m:h}}}i[o]=1,u&&(i[s]=2,i[c]=3),t.push(i)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,r=0;r<6;r++){var i=e.substr(r,1)||-1;n=n[i]?n[i]:n[i]=5==r?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)if(n.hasOwnProperty(r)){for(var i=this.index,a=0;a<6;a++){var o=r.substr(a,1)||-1;if(!i[o])break;i=i[o]}if(i.length)for(var a in i)if(this.equals(i[a],e)){i.splice(a,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(i(e[0])||i(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var r=e.shift();r&&n.push(r)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)n.hasOwnProperty(r)&&this.toIndexTree(r,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),r=[],i=!1;for(var a in n)if(n.hasOwnProperty(a)){if(i&&!r)break;var o=this.localSearch(n[a],0,t);o.sort((function(e,t){return e._order-t._order})),r=i?this.intersect(r,o):o,i=!0}for(var s=r[0],c=r.length+1,u=[],l=1;l<c;l++){var d=r[l];d!=s&&(u.push(s),s=d)}return u},e.prototype.localSearch=function(e,t,n){if(!n)return[];var r={};for(var i in e)e.hasOwnProperty(i)&&(r[o=i.substr(t,1)||-1]||(r[o]={}),r[o][i]=1);if(6==t++)return n;var a=[];for(var o in r)if("-1"===o)for(var s in n)n.hasOwnProperty(s)&&a.push.apply(a,this.localSearch(r[o],t,n[s]));else{var c=this.localSearch(r[o],t,n[o]);a.push.apply(a,c)}return a},e}();function i(e){return!isNaN(e)}},"7pkf":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));var r=null,i=null,a=function(e,t){r=e,i=t},o=function(e){return void 0===e&&(e=!0),e?r:i}},"7ylw":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shimGetUserMedia",(function(){return T})),n.d(r,"shimGetDisplayMedia",(function(){return I})),n.d(r,"shimMediaStream",(function(){return P})),n.d(r,"shimOnTrack",(function(){return R})),n.d(r,"shimGetSendersWithDtmf",(function(){return D})),n.d(r,"shimGetStats",(function(){return k})),n.d(r,"shimSenderReceiverGetStats",(function(){return N})),n.d(r,"shimAddTrackRemoveTrackWithNative",(function(){return F})),n.d(r,"shimAddTrackRemoveTrack",(function(){return L})),n.d(r,"shimPeerConnection",(function(){return M})),n.d(r,"fixNegotiationNeeded",(function(){return j}));var i={};n.r(i),n.d(i,"shimGetUserMedia",(function(){return U})),n.d(i,"shimGetDisplayMedia",(function(){return V})),n.d(i,"shimPeerConnection",(function(){return G})),n.d(i,"shimReplaceTrack",(function(){return H}));var a={};n.r(a),n.d(a,"shimGetUserMedia",(function(){return W})),n.d(a,"shimGetDisplayMedia",(function(){return z})),n.d(a,"shimOnTrack",(function(){return K})),n.d(a,"shimPeerConnection",(function(){return Q})),n.d(a,"shimSenderGetStats",(function(){return q})),n.d(a,"shimReceiverGetStats",(function(){return J})),n.d(a,"shimRemoveStream",(function(){return Y})),n.d(a,"shimRTCDataChannel",(function(){return $})),n.d(a,"shimAddTransceiver",(function(){return Z})),n.d(a,"shimGetParameters",(function(){return X})),n.d(a,"shimCreateOffer",(function(){return ee})),n.d(a,"shimCreateAnswer",(function(){return te}));var o={};n.r(o),n.d(o,"shimLocalStreamsAPI",(function(){return ne})),n.d(o,"shimRemoteStreamsAPI",(function(){return re})),n.d(o,"shimCallbacksAPI",(function(){return ie})),n.d(o,"shimGetUserMedia",(function(){return ae})),n.d(o,"shimConstraints",(function(){return oe})),n.d(o,"shimRTCIceServerUrls",(function(){return se})),n.d(o,"shimTrackEventTransceiver",(function(){return ce})),n.d(o,"shimCreateOfferLegacy",(function(){return ue})),n.d(o,"shimAudioContext",(function(){return le}));var s={};n.r(s),n.d(s,"shimRTCIceCandidate",(function(){return he})),n.d(s,"shimMaxMessageSize",(function(){return fe})),n.d(s,"shimSendThrowTypeError",(function(){return me})),n.d(s,"shimConnectionState",(function(){return ve})),n.d(s,"removeAllowExtmapMixed",(function(){return _e}));var c={};n.r(c),n.d(c,"Api",(function(){return kr})),n.d(c,"BaseApi",(function(){return at})),n.d(c,"BaseLogger",(function(){return ot})),n.d(c,"BaseSignaling",(function(){return ct})),n.d(c,"CallType",(function(){return lt})),n.d(c,"ConversationOption",(function(){return pt})),n.d(c,"DebugMessageType",(function(){return zt})),n.d(c,"ExternalIdType",(function(){return Fn})),n.d(c,"HangupReason",(function(){return Wn})),n.d(c,"HangupType",(function(){return vt})),n.d(c,"ParticipantStatus",(function(){return xt})),n.d(c,"Signaling",(function(){return Mr})),n.d(c,"SignalingCommandType",(function(){return Lr})),n.d(c,"SignalingConnectionType",(function(){return yt})),n.d(c,"Utils",(function(){return $t})),n.d(c,"acceptCall",(function(){return Yr})),n.d(c,"addParticipant",(function(){return ni})),n.d(c,"addParticipantInternal",(function(){return ri})),n.d(c,"authorize",(function(){return Jr})),n.d(c,"browser",(function(){return xr})),n.d(c,"call",(function(){return zr})),n.d(c,"callInternal",(function(){return Kr})),n.d(c,"callTo",(function(){return Wr})),n.d(c,"captureScreen",(function(){return si})),n.d(c,"changeConversationOptions",(function(){return Ci})),n.d(c,"changeDevice",(function(){return oi})),n.d(c,"changeParticipantState",(function(){return hi})),n.d(c,"changePriorities",(function(){return pi})),n.d(c,"changeVideoEffect",(function(){return Gi})),n.d(c,"chatHistory",(function(){return Ti})),n.d(c,"chatMessage",(function(){return wi})),n.d(c,"chatMessageInternal",(function(){return Oi})),n.d(c,"createJoinLink",(function(){return Di})),n.d(c,"customData",(function(){return Ii})),n.d(c,"customDataInternal",(function(){return Pi})),n.d(c,"debug",(function(){return Ui})),n.d(c,"debugMessage",(function(){return Vi})),n.d(c,"declineCall",(function(){return $r})),n.d(c,"forceRelayPolicy",(function(){return Li})),n.d(c,"getAnonymTokenByLink",(function(){return Ni})),n.d(c,"getStreamInfo",(function(){return xi})),n.d(c,"grantRoles",(function(){return mi})),n.d(c,"grantRolesInternal",(function(){return vi})),n.d(c,"hangup",(function(){return ti})),n.d(c,"init",(function(){return Hr})),n.d(c,"joinCall",(function(){return Zr})),n.d(c,"joinCallByLink",(function(){return ei})),n.d(c,"joinCallInternal",(function(){return Xr})),n.d(c,"muteParticipant",(function(){return _i})),n.d(c,"muteParticipantInternal",(function(){return gi})),n.d(c,"pinParticipant",(function(){return Ei})),n.d(c,"pinParticipantInternal",(function(){return Si})),n.d(c,"processPush",(function(){return Qr})),n.d(c,"processPushInternal",(function(){return qr})),n.d(c,"removeJoinLink",(function(){return ki})),n.d(c,"removeParticipant",(function(){return ii})),n.d(c,"removeParticipantInternal",(function(){return ai})),n.d(c,"setApi",(function(){return Br})),n.d(c,"setLocalResolution",(function(){return di})),n.d(c,"setLogger",(function(){return Vr})),n.d(c,"setMediaModifiers",(function(){return bi})),n.d(c,"setSignalingFactory",(function(){return Ur})),n.d(c,"setStatisticsInterval",(function(){return Bi})),n.d(c,"setVideoEffects",(function(){return Gr})),n.d(c,"setVideoStream",(function(){return ci})),n.d(c,"setVolume",(function(){return Fi})),n.d(c,"startConversation",(function(){return Ri})),n.d(c,"startStream",(function(){return Mi})),n.d(c,"stopStream",(function(){return ji})),n.d(c,"toggleLocalAudio",(function(){return li})),n.d(c,"toggleLocalVideo",(function(){return ui})),n.d(c,"unmuteRequest",(function(){return Ai})),n.d(c,"unmuteRequestInternal",(function(){return yi})),n.d(c,"updateDisplayLayout",(function(){return fi}));n("91GP"),n("CX2u"),n("VRzm"),n("Btvt");var u=n("q1tI"),l=n.n(u),d=n("i8i4"),p=n("xt6h"),h=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("/MKj"));let f=!0,m=!0;function v(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function _(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const a=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};const a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function g(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(f=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function A(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(m=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function y(){if("object"==typeof window){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function E(e,t){m&&console.warn(e+" is deprecated, please use "+t+" instead.")}function S(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=v(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=v(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=v(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=v(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function b(e){return"[object Object]"===Object.prototype.toString.call(e)}function C(e){return b(e)?Object.keys(e).reduce((function(t,n){const r=b(e[n]),i=r?C(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[n]:i})}),{}):e}function w(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const a=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const O=y;function T(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=S(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const o=n.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||o)){let n;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?n=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{let o=(t=t.filter(e=>"videoinput"===e.kind)).find(e=>n.some(t=>e.label.toLowerCase().includes(t)));return!o&&t.length&&n.includes("back")&&(o=t[t.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),O("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return O("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(a(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(a(e))))}}}function I(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function P(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function R(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else _(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function D(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function k(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(a(i(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(a(i(t)))},n])}).then(n,r)}}function N(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>w(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),_(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>w(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function F(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function L(e){if(!e.RTCPeerConnection)return;const t=S(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return F(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function M(e){const t=S(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function j(e){const t=S(e);_(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var x=n("8D0k"),B=n.n(x);function U(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function V(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function G(e){const t=S(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=B()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&E("RTCIceServer.url","RTCIceServer.urls");const r="string"==typeof t;return r&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers,t.version),y("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function H(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function W(e){const t=S(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){E("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function z(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function K(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Q(e){const t=S(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,a]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,a)}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function J(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),_(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Y(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){E("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function $(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Z(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function X(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ee(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function te(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ne(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function re(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function ie(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function ae(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(oe(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function oe(e){return e&&void 0!==e.video?Object.assign({},e,{video:C(e.video)}):e}function se(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(E("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ce(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ue(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function le(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var de=n("KCt4"),pe=n.n(de);function he(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=pe.a.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,_(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function fe(e){if(!e.RTCPeerConnection)return;const t=S(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=pe.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=pe.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=pe.a.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=a(arguments[0],e);let o;o=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>o}),this._sctp=s}return o.apply(this,arguments)}}function me(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},_(e,"datachannel",e=>(t(e.channel,e.target),e))}function ve(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function _e(e){if(!e.RTCPeerConnection)return;const t=S(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n")),n.apply(this,arguments)}}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=y,c=S(e),u={browserDetails:c,commonShim:s,extractVersion:v,disableLog:g,disableWarnings:A};switch(c.browser){case"chrome":if(!r||!M||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),u;if(null===c.version)return n("Chrome shim can not determine version, not shimming."),u;n("adapter.js shimming chrome."),u.browserShim=r,T(e),P(e),M(e),R(e),L(e),D(e),k(e),N(e),j(e),he(e),ve(e),fe(e),me(e),_e(e);break;case"firefox":if(!a||!Q||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),u;n("adapter.js shimming firefox."),u.browserShim=a,W(e),Q(e),K(e),Y(e),q(e),J(e),$(e),Z(e),X(e),ee(e),te(e),he(e),ve(e),fe(e),me(e);break;case"edge":if(!i||!G||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),u;n("adapter.js shimming edge."),u.browserShim=i,U(e),V(e),G(e),H(e),fe(e),me(e);break;case"safari":if(!o||!t.shimSafari)return n("Safari shim is not included in this adapter release."),u;n("adapter.js shimming safari."),u.browserShim=o,se(e),ue(e),ie(e),ne(e),re(e),ce(e),ae(e),le(e),he(e),fe(e),me(e),_e(e);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var ge=n("dAlA"),Ae=n.n(ge),ye=n("9XzT");function Ee(e,t){throw new TypeError(`unexpected tag 0x${e.toString(16)} (${t} expected)`)}function Se(e){return 127&e}function be(e){return 0==(128&e)}function Ce(e){return 224==(224&e)}function we(e){return 160==(224&e)}function Oe(e){return 144==(240&e)}function Te(e){return 128==(240&e)}function Ie(e,t,n){const r=t.byteLength;if(r<=255)e.putUi8(n),e.putUi8(r);else if(r<=65535)e.putUi8(n+1),e.putUi16(r);else{if(!(r<=4294967295))throw new RangeError("length limit exceeded");e.putUi8(n+2),e.putUi32(r)}e.put(t)}function Pe(e){const t=e.getUi8();let n;switch(t){case 192:n=0;break;case 196:case 217:n=e.getUi8();break;case 197:case 218:n=e.getUi16();break;case 198:case 219:n=e.getUi32();break;default:we(t)||Ee(t,"bytes or string"),n=function(e){return 31&e}(t)}return e.get(n)}function Re(e,t){t<16?e.putUi8(144|15&t):Fe(e,220,t)}function De(e,t){const n=e.getUi8(),r=Oe(n)?function(e){return 15&e}(n):Le(e,n,220,"array");if(null!=t&&r!==t)throw new Error("invalid array header size "+r);return r}function ke(e,t){t<16?e.putUi8(128|15&t):Fe(e,222,t)}function Ne(e,t){const n=e.getUi8(),r=Te(n)?function(e){return 15&e}(n):Le(e,n,222,"map");if(null!=t&&r!==t)throw new Error("invalid map header size "+r);return r}function Fe(e,t,n){if(n<=65535)e.putUi8(t),e.putUi16(n);else{if(!(n<=4294967295))throw new RangeError("length limit exceeded");e.putUi8(t+1),e.putUi32(n)}}function Le(e,t,n,r){switch(t){case 192:return 0;case n:return e.getUi16();case n+1:return e.getUi32();default:Ee(t,r)}}const Me={enc(e,t){(function(e){switch(typeof e){case"undefined":return je;case"boolean":return xe;case"number":return isFinite(e)&&Math.floor(e)===e?e<0?Be:Ue:Ve;case"string":return He;case"object":return null===e?je:Array.isArray(e)?ze:e instanceof Uint8Array||e instanceof ArrayBuffer?Ge:e instanceof Date?We:Qe;default:throw new TypeError("unsupported type "+typeof e)}})(t).enc(e,t)},dec:e=>function(e){switch(e){case 192:return je;case 194:case 195:return xe;case 208:case 209:case 210:case 211:return Be;case 204:case 205:case 206:case 207:return Ue;case 202:case 203:return Ve;case 196:case 197:case 198:return Ge;case 217:case 218:case 219:return He;case 220:case 221:return ze;case 222:case 223:return Qe;case 214:case 215:case 199:return We;default:if(be(e)||Ce(e))return Be;if(we(e))return He;if(Oe(e))return ze;if(Te(e))return Qe;throw new TypeError("unsupported tag "+e)}}(e.peek()).dec(e)},je={enc(e,t){e.putUi8(192)},dec(e){const t=e.getUi8();return 192!==t&&Ee(t,"nil"),null}},xe={enc(e,t){e.putUi8(t?195:194)},dec(e){const t=e.getUi8();switch(t){case 192:case 194:return!1;case 195:return!0;default:Ee(t,"bool")}}},Be={enc(e,t){-128<=t&&t<=127?t>=0?e.putUi8(Se(t)):t>-32?e.putUi8(224|31&t):(e.putUi8(208),e.putUi8(t)):-32768<=t&&t<=32767?(e.putI8(209),e.putI16(t)):-2147483648<=t&&t<=2147483647?(e.putI8(210),e.putI32(t)):(e.putI8(211),e.putI64(t))},dec(e){const t=e.getUi8();if(be(t))return function(e){return 127&e}(t);if(Ce(t))return function(e){return e-256}(t);switch(t){case 192:return 0;case 208:return e.getI8();case 209:return e.getI16();case 210:return e.getI32();case 211:return e.getI64();case 204:return e.getUi8();case 205:return e.getUi16();case 206:return e.getUi32();case 207:return e.getUi64();default:Ee(t,"int")}}},Ue={enc(e,t){if(t<0)throw new Error("not an uint: "+t);t<=127?e.putUi8(Se(t)):t<=255?(e.putUi8(204),e.putUi8(t)):t<=65535?(e.putUi8(205),e.putUi16(t)):t<=4294967295?(e.putUi8(206),e.putUi32(t)):(e.putUi8(207),e.putUi64(t))},dec(e){const t=Be.dec(e);if(t<0)throw new RangeError("uint underflow");return t}},Ve={enc(e,t){e.putUi8(203),e.putF(t)},dec(e){const t=e.getUi8();switch(t){case 192:return 0;case 202:return e.getF32();case 203:return e.getF64();default:Ee(t,"float")}}},Ge={enc(e,t){Ie(e,t,196)},dec:Pe},He={enc(e,t){const n=function(e){const t=e.length,n=new Uint8Array(4*t);let r,i=0,a=0;for(;a<t;)r=e.charCodeAt(a++),55296==(64512&r)&&(r=(r<<10)+e.charCodeAt(a++)-56613888),r<128?n[i++]=r:r<2048?(n[i++]=192+(r>>6),n[i++]=128+(63&r)):r<65536?(n[i++]=224+(r>>12),n[i++]=128+(r>>6&63),n[i++]=128+(63&r)):(n[i++]=240+(r>>18),n[i++]=128+(r>>12&63),n[i++]=128+(r>>6&63),n[i++]=128+(63&r));return n.buffer.slice(0,i)}(t);n.byteLength<32?(e.putUi8(160|31&n.byteLength),e.put(n)):Ie(e,n,217)},dec:e=>function(e){return new TextDecoder("utf-8").decode(e)}(Pe(e))},We={enc(e,t){const n=t.getTime();e.putUi8(199),e.putUi8(12),e.putI8(-1),e.putUi32(n%1e3*1e6),e.putI64(n/1e3)},dec(e){const t=e.getUi8();switch(t){case 214:if(-1===e.getI8())return new Date(1e3*e.getUi32());break;case 215:if(-1===e.getI8()){const t=e.getUi32(),n=e.getUi32();return new Date(1e3*(n+4294967296*(3&t))+t/4e6)}break;case 199:if(12===e.getUi8()&&-1===e.getI8()){const t=e.getUi32(),n=e.getI64();return new Date(1e3*n+t/1e6)}}Ee(t,"time")}},ze=(Ke=Me,{encHeader:Re,decHeader:De,enc(e,t){Re(e,t.length),t.forEach(t=>Ke.enc(e,t))},dec(e){const t=[];for(let n=De(e);n>0;--n)t.push(Ke.dec(e));return t}});var Ke;const Qe=function(e,t){return{encHeader:ke,decHeader:Ne,enc(n,r){const i=Object.keys(r);ke(n,i.length),i.forEach(i=>{e.enc(n,i),t.enc(n,r[i])})},dec(n){const r={};for(let i=Ne(n);i>0;--i){r[e.dec(n)]=t.dec(n)}return r}}}(Me,Me);function qe(e,t){return(t||Me).dec(function(e){let t=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),n=0;return{peek:()=>t.getUint8(n),get(e){n+=e;const r=t.byteOffset;return t.buffer.slice(r+n-e,r+n)},getI8:()=>t.getInt8(n++),getI16:()=>(n+=2,t.getInt16(n-2)),getI32:()=>(n+=4,t.getInt32(n-4)),getI64:()=>(n+=8,4294967296*t.getInt32(n-8)+t.getUint32(n-4)),getUi8:()=>t.getUint8(n++),getUi16:()=>(n+=2,t.getUint16(n-2)),getUi32:()=>(n+=4,t.getUint32(n-4)),getUi64:()=>(n+=8,4294967296*t.getUint32(n-8)+t.getUint32(n-4)),getF32:()=>(n+=4,t.getFloat32(n-4)),getF64:()=>(n+=8,t.getFloat64(n-8))}}(e))}var Je=n("zvoO"),Ye=n.n(Je),$e=function(e,t){return($e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Ze(e,t){function n(){this.constructor=e}$e(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Xe=function(){return(Xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function et(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function tt(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function nt(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var rt,it,at=function(){function e(){}return e.prototype.createJoinLink=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,{join_link:"nop"}]}))}))},e.prototype.removeJoinLink=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,{success:!0}]}))}))},e.prototype.getAnonymTokenByLink=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,""]}))}))},e.prototype.log=function(e){},e.prototype.prepareUserIds=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2]}))}))},e.prototype.hangupConversation=function(e){},e.prototype.cleanup=function(){},e}(),ot=function(){function e(){}return e.prototype.log=function(e,t,n){},e.prototype.destroy=function(){},e}(),st=function(){function e(){this._handlers={},this._listeners=[]}return e.prototype._triggerEvent=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._handlers.hasOwnProperty(e)&&this._handlers[e].slice().forEach((function(e){e.apply(t,n)}))},e.prototype.addEventListener=function(e,t){if("function"!=typeof t)throw new Error("Listener should be a function");return this._handlers.hasOwnProperty(e)||(this._handlers[e]=[]),this._handlers[e].push(t),{dispose:this.removeEventListener.bind(this,e,t)}},e.prototype.removeEventListener=function(e,t){if(this._handlers.hasOwnProperty(e)){t||delete this._handlers[e];var n=this._handlers[e].indexOf(t);n>=0&&this._handlers[e].splice(n,1)}},e.prototype.subscribe=function(e,t,n){var r=e.addEventListener(t,n);this._listeners.push(r)},e.prototype.unsubscribe=function(){this._listeners.forEach((function(e){e.dispose()}))},e}(),ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ze(t,e),t.prototype.setParticipantIdRegistry=function(e){},t.prototype.requestRealloc=function(e){},t.prototype.setEndpoint=function(e){},t.prototype.setConversationId=function(e){},t.prototype.readyToSend=function(){},t.prototype.cleanup=function(){},t}(st);(it=rt||(rt={})).USER="USER",it.GROUP="GROUP",it.CHAT="CHAT";var ut,lt=rt;!function(e){e.REQUIRE_AUTH_TO_JOIN="REQUIRE_AUTH_TO_JOIN"}(ut||(ut={}));var dt,pt=ut;!function(e){e.CAMERA_PERMISSION="camera",e.MIC_PERMISSION="mic",e.CAMERA_ACCESS="cameralock",e.MIC_ACCESS="miclock",e.MIC_NOT_FOUND="nomic",e.SCREEN_PERMISSION="screenpermission",e.SCREEN_ACCESS="screenlock",e.CONNECTION="connection",e.NETWORK="network",e.UNKNOWN="unknown",e.UNSUPPORTED="unsupported",e.SIGNALING_FAILED="signalingfailed",e.API="api",e.AUTH="auth"}(dt||(dt={}));var ht,ft=dt;!function(e){e.CANCELED="CANCELED",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.BUSY="BUSY",e.FAILED="FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.NOT_FRIENDS="NOT_FRIENDS",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED",e.OLD_VERSION="OLD_VERSION",e.SERVICE_DISABLED="SERVICE_DISABLED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.SOCKET_CLOSED="SOCKET_CLOSED"}(ht||(ht={}));var mt,vt=ht;!function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO"}(mt||(mt={}));var _t,gt=mt;!function(e){e.START="start",e.ACCEPT="accept",e.JOIN="join",e.RETRY="retry"}(_t||(_t={}));var At,yt=_t;!function(e){e.NO_AVAILABLE_TRACKS="no-available-tracks",e.UNKNOWN_ERROR="unknown-error"}(At||(At={}));var Et,St=At;function bt(e){switch(e){case 1:return At.NO_AVAILABLE_TRACKS;default:return At.UNKNOWN_ERROR}}!function(e){e.CREATOR="CREATOR",e.ADMIN="ADMIN"}(Et||(Et={}));var Ct=Et;function wt(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.includes(i))return!1}return!0}var Ot,Tt,It,Pt=function(){function e(){this._items=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this._items.push(e)},e.prototype.shift=function(){return this._items.shift()||null},e.prototype.bisect=function(){var e=this.length>1?Math.floor(this.length/2):1;this._items=this._items.slice(e)},e.prototype.clear=function(){this._items=[]},e.prototype.toString=function(){return this._items.length?JSON.stringify(this._items,(function(e,t){return t instanceof Error?String(t):t})):""},e}(),Rt=function(){function e(){this._items=[],this._itemsSize=0,this._storageSize=2097152;try{for(var e=window.localStorage,t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if(0===r.indexOf("_okcls_logs_session_")){var i=e.getItem(r);if(i){var a=kt(i);this.add(r,a)}else Nt(r)}}}catch(e){console.error("Storage is blocked",e),this._storageSize=0}this._items.sort((function(e,t){return e.date-t.date})),this.cleanup(102400)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._itemsSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return Math.max(this._storageSize-this._itemsSize,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storageSize",{set:function(e){this._storageSize=e},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t){var n=parseInt(e.replace("_okcls_logs_session_",""),10);this._itemsSize+=t,this._items.push({key:e,size:t,date:n})},e.prototype.deleteOldestItem=function(){var e=this._items.shift();e&&(Nt(e.key),this._itemsSize-=e.size)},e.prototype.cleanup=function(e){for(;this.length&&(this.size>2097152||this.length>4||this.size+e>this.available);)this.deleteOldestItem()},e}();function Dt(){return"_okcls_logs_session_"+Date.now()}function kt(e){return new Blob([e]).size}function Nt(e){try{window.localStorage.removeItem(e)}catch(e){console.error("Failed to remove log from storage",e)}}function Ft(){Ot.available&&Tt.length&&function e(){var t=Tt.toString();if(Ot.available&&t){var n=kt(t);Ot.cleanup(n);try{window.localStorage.setItem(It,t)}catch(t){return console.warn("Failed to write log to storage",t),Ot.storageSize=Ot.size+n,Ot.cleanup(102400+n),Ot.available>=102400+n?void e():n>102400?(Tt.bisect(),void e()):void(Ot.storageSize=0)}n>524288&&(Ot.add(It,n),It=Dt(),Tt.clear(),Ot.cleanup(102400))}}()}function Lt(e,t){Ot.available&&(Tt.push({t:Date.now(),l:e,d:t}),jt||(jt=window.setTimeout((function(){jt=null,Ft()}),3e4)))}function Mt(){Ot||(Ot=new Rt,Tt=new Pt,It=Dt(),window.addEventListener("beforeunload",Ft))}var jt=null;window.__OKCallsSDKLogs__=function(){Ot||Mt(),Ft(),function(){var e,t,n,r,i=[];try{for(var a=window.localStorage,o=0,s=Ot.items;o<s.length;o++){var c=s[o],u=a.getItem(c.key);i.push(u)}var l=Tt.toString();l&&i.push(l)}catch(i){console.error("Storage is blocked",i)}e="["+i.join(",")+"]",t="logs_"+Date.now()+".json",n=document.createElement("a"),r=new Blob([e],{type:"text/json"}),n.href=URL.createObjectURL(r),n.download=t,n.click()}()};var xt,Bt,Ut=function(){function e(){}return Object.defineProperty(e,"sessionKey",{get:function(){return e._sessionKey},set:function(t){e._sessionKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sessionSecretKey",{get:function(){return e._sessionSecretKey},set:function(t){e._sessionSecretKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"accessToken",{get:function(){return e._accessToken},set:function(t){e._accessToken=t},enumerable:!1,configurable:!0}),e.isEmpty=function(){return!e._sessionKey||!e._sessionSecretKey},e}(),Vt=function(){function e(){}return e.set=function(t){t.hasOwnProperty("voiceParams")&&(Object.assign(e._params.voiceParams,t.voiceParams),delete t.voiceParams),t.hasOwnProperty("specListenerParams")&&(Object.assign(e._params.specListenerParams,t.specListenerParams),delete t.specListenerParams),t.hasOwnProperty("unifiedPlanBrowsers")&&(Object.assign(e._params.unifiedPlanBrowsers,t.unifiedPlanBrowsers),delete t.unifiedPlanBrowsers),t.hasOwnProperty("apiAuth")&&(Ut.accessToken=t.apiAuth.accessToken,Ut.sessionKey=t.apiAuth.sessionKey,Ut.sessionSecretKey=t.apiAuth.sessionSecretKey),Object.assign(e._params,t)},e.get=function(t){return e._params[t]},Object.defineProperty(e,"appName",{get:function(){return e._params.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e,"appVersion",{get:function(){return e._params.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"protocolVersion",{get:function(){return e._params.protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){return e._params.platform},set:function(t){e._params.platform=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"clientType",{get:function(){return e._params.clientType},set:function(t){e._params.clientType=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"device",{get:function(){return e._params.device},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiAppId",{get:function(){return e._params.apiAppId},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiKey",{get:function(){return e._params.apiKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiEnv",{get:function(){switch(e._params.apiEnv){case"TEST":return{api:"https://apitest.ok.ru/api/",connect:"https://test.ok.ru/"};case"VIDEOTEST":return{api:"https://videotestapi.ok.ru/api/",connect:"https://test.ok.ru/"};case"DEV":return{api:"https://1.api.an-eremeev.devdc.odkl.ru/api/",connect:"https://1.web.an-eremeev.devdc.odkl.ru/"};default:return{api:"https://api.ok.ru/",connect:"https://connect.ok.ru/"}}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"authToken",{get:function(){return e._params.authToken},set:function(t){e._params.authToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"anonymToken",{get:function(){return e._params.anonymToken},set:function(t){e._params.anonymToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"domain",{get:function(){return e._params.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceServers",{get:function(){return e._params.iceServers},set:function(t){e._params.iceServers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssBase",{get:function(){return e._params.wssBase},set:function(t){e._params.wssBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssToken",{get:function(){return e._params.wssToken},set:function(t){e._params.wssToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectDelay",{get:function(){return e._params.signalingReconnectDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxDelay",{get:function(){return e._params.signalingReconnectMaxDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxCount",{get:function(){return e._params.signalingReconnectMaxCount},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitConnectionDelay",{get:function(){return e._params.waitConnectionDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitResponseDelay",{get:function(){return e._params.waitResponseDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitMessageDelay",{get:function(){return e._params.waitMessageDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugLog",{get:function(){return e._params.debugLog},enumerable:!1,configurable:!0}),Object.defineProperty(e,"forceRelayPolicy",{get:function(){return e._params.forceRelayPolicy},set:function(t){e._params.forceRelayPolicy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinWidth",{get:function(){return e._params.videoMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxWidth",{get:function(){return e._params.videoMaxWidth},set:function(t){e._params.videoMaxWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinHeight",{get:function(){return e._params.videoMinHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxHeight",{get:function(){return e._params.videoMaxHeight},set:function(t){e._params.videoMaxHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoAspectRatio",{get:function(){return e._params.videoAspectRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFrameRate",{get:function(){return e._params.videoFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFacingMode",{get:function(){return e._params.videoFacingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"screenFrameRate",{get:function(){return e._params.screenFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffects",{get:function(){return e._params.videoEffects},set:function(t){e._params.videoEffects=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffectMaxWidth",{get:function(){return e._params.videoEffectMaxWidth},set:function(t){e._params.videoEffectMaxWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffectMaxHeight",{get:function(){return e._params.videoEffectMaxHeight},set:function(t){e._params.videoEffectMaxHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"voiceParams",{get:function(){return e._params.voiceParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"specListenerParams",{get:function(){return e._params.specListenerParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceRestartWaitTime",{get:function(){return e._params.iceRestartWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"transportConnectionWaitTime",{get:function(){return e._params.transportConnectionWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"statisticsInterval",{get:function(){return e._params.statisticsInterval},set:function(t){e._params.statisticsInterval=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"perfStatReportEnabled",{get:function(){return e._params.perfStatReportEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"allowMissingMic",{get:function(){return e._params.allowMissingMic},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerNotificationDataChannel",{get:function(){return e._params.producerNotificationDataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerCommandDataChannel",{get:function(){return e._params.producerCommandDataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(e,"consumerScreenDataChannel",{get:function(){return e._params.consumerScreenDataChannel},set:function(t){e._params.consumerScreenDataChannel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerScreenDataChannel",{get:function(){return e._params.producerScreenDataChannel&&e._params.producerNotificationDataChannel},set:function(t){e._params.producerScreenDataChannel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionRating",{get:function(){return e._params.badConnectionRating},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseSuppression",{get:function(){return e._params.noiseSuppression},set:function(t){e._params.noiseSuppression=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"preferH264",{get:function(){return e._params.preferH264},enumerable:!1,configurable:!0}),Object.defineProperty(e,"preferVP9",{get:function(){return e._params.preferVP9},enumerable:!1,configurable:!0}),e.isUnifiedPlanSupported=function(t,n){var r=e._params.unifiedPlanBrowsers;return!!r.hasOwnProperty(t)&&n>=r[t]},Object.defineProperty(e,"unifiedPlanInterop",{get:function(){return e._params.unifiedPlanInterop},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onDemandTracks",{get:function(){return e._params.onDemandTracks},enumerable:!1,configurable:!0}),Object.defineProperty(e,"singleSession",{get:function(){return e._params.singleSession},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoTracksCount",{get:function(){return e._params.videoTracksCount},enumerable:!1,configurable:!0}),e._params={appName:"ok.calls.sdk.js",appVersion:1.1,protocolVersion:3,platform:"WEB",clientType:"PORTAL",device:"browser",apiAppId:42,apiKey:"",authToken:"",anonymToken:"",apiEnv:"PROD",domain:"",iceServers:[],wssBase:"",wssToken:"",signalingReconnectDelay:1e3,signalingReconnectMaxDelay:5e3,signalingReconnectMaxCount:20,waitConnectionDelay:1e4,waitResponseDelay:1e4,waitMessageDelay:15e3,debugLog:!1,forceRelayPolicy:!1,videoMinWidth:428,videoMinHeight:240,videoMaxWidth:1280,videoMaxHeight:720,videoAspectRatio:16/9,videoFrameRate:25,screenFrameRate:15,videoEffects:null,videoEffectMaxWidth:640,videoEffectMaxHeight:360,iceRestartWaitTime:2e4,transportConnectionWaitTime:5e3,statisticsInterval:5e3,perfStatReportEnabled:!0,voiceParams:{smoothing:.8,minFreq:200,maxFreq:5e3,interval:500,threshold:.35,speakerLevelMultiplier:1.8},specListenerParams:{connectionTimeout:1e4,volumeTimeout:1e4},unifiedPlanBrowsers:{Firefox:10,Chrome:76,Safari:12},unifiedPlanInterop:!1,allowMissingMic:!1,producerNotificationDataChannel:!0,producerCommandDataChannel:!0,consumerScreenDataChannel:!0,producerScreenDataChannel:!0,badConnectionRating:.65,noiseSuppression:!0,preferH264:!1,preferVP9:!0,onDemandTracks:!1,singleSession:!0,videoTracksCount:0},e}();function Gt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Vt.get(e);r&&r.apply(null,t)}function Ht(e){return Object.assign({},e)}function Wt(e){return e.slice()}!function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(xt||(xt={})),function(e){e.onLocalStream=function(e,t){Gt("onLocalStream",e,Ht(t))},e.onLocalStreamUpdate=function(e,t){Gt("onLocalStreamUpdate",Ht(e),t)},e.onLocalStatus=function(e){Gt("onLocalStatus",e)},e.onRemoteStream=function(e,t){Gt("onRemoteStream",e,t)},e.onConversation=function(e,t){Gt("onConversation",e,Ht(t))},e.onRemoteMediaSettings=function(e,t){Gt("onRemoteMediaSettings",e,Ht(t))},e.onRemoteParticipantState=function(e,t){Gt("onRemoteParticipantState",e,Ht(t))},e.onParticipantStatus=function(e,t,n){void 0===n&&(n=null),Gt("onParticipantStatus",e,t,n)},e.onPermissionsRequested=function(){Gt("onPermissionsRequested")},e.onPermissionsError=function(e){Gt("onPermissionsError",e)},e.onRemoteRemoved=function(e){Gt("onRemoteRemoved",e)},e.onCallState=function(e,t,n){Gt("onCallState",e,t,Ht(n))},e.onDeviceSwitched=function(e,t){Gt("onDeviceSwitched",e,t)},e.onUnmuteRequest=function(e){Gt("onUnmuteRequest",e)},e.onUnmutePermission=function(e){Gt("onUnmutePermission",e)},e.onRolesChanged=function(e,t){Gt("onRolesChanged",e,Wt(t))},e.onLocalRolesChanged=function(e){Gt("onLocalRolesChanged",Wt(e))},e.onPinnedParticipant=function(e,t){Gt("onPinnedParticipant",e,t)},e.onLocalPin=function(e){Gt("onLocalPin",e)},e.onOptionsChanged=function(e){Gt("onOptionsChanged",Wt(e))},e.onCallAccepted=function(){Gt("onCallAccepted")},e.onRateNeeded=function(){Gt("onRateNeeded")},e.onSpeakerChanged=function(e){Gt("onSpeakerChanged",e)},e.onVolumesDetected=function(e){Gt("onVolumesDetected",Wt(e))},e.onLocalVolume=function(e,t){Gt("onLocalVolume",e,t)},e.onJoinStatus=function(e,t){Gt("onJoinStatus",e,t)},e.onHangup=function(e,t){Gt("onHangup",e,t)},e.onMultipartyChatCreated=function(e){Gt("onMultipartyChatCreated",Ht(e))},e.onDeviceChange=function(){Gt("onDeviceChange")},e.onFingerprintChange=function(e){Gt("onFingerprintChange",e)},e.onTokenExpired=function(){Gt("onTokenExpired")},e.onChatMessage=function(e,t,n){void 0===n&&(n=!1),Gt("onChatMessage",e,t,n)},e.onCustomData=function(e,t,n){void 0===n&&(n=!1),Gt("onCustomData",e,t,n)},e.onRecordStarted=function(e,t,n,r,i,a){Gt("onRecordStarted",e,t,n,r,i,a)},e.onRecordStopped=function(){Gt("onRecordStopped")},e.onNetworkStatus=function(e){Gt("onNetworkStatus",e)},e.onLocalNetworkStatusChanged=function(e){Gt("onLocalNetworkStatusChanged",e)},e.onNetworkStatusChanged=function(e){Gt("onNetworkStatusChanged",e)},e.onDebugMessage=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Gt.apply(void 0,nt(["onDebugMessage",e],t))},e.onStatistics=function(e,t){Gt("onStatistics",Object.assign({},e,{memory:t}))},e.onAutoplayError=function(){Gt("onAutoplayError")}}(Bt||(Bt={}));var zt,Kt,Qt=Bt;!function(e){e.DEBUG="DEBUG",e.LOG="LOG",e.WARN="WARN",e.ERROR="ERROR"}(zt||(zt={})),function(e){var t="📞",n=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Qt.onDebugMessage.apply(Qt,nt([e],t))},r=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.apply(void 0,n),Lt(t,n)}},i=console.debug.bind(console,t),a=console.log.bind(console,t),o=console.warn.bind(console,t),s=console.error.bind(console,t),c=n.bind(null,zt.DEBUG),u=n.bind(null,zt.LOG),l=n.bind(null,zt.WARN),d=n.bind(null,zt.ERROR);e.debug=c,e.log=u,e.warn=l,e.error=d,e.toggle=function(t){Vt.debugLog&&Mt(),t?(e.debug=Vt.debugLog?r(i,zt.DEBUG):i,e.log=Vt.debugLog?r(a,zt.LOG):a,e.warn=Vt.debugLog?r(o,zt.WARN):o,e.error=Vt.debugLog?r(s,zt.ERROR):s):(e.debug=Vt.debugLog?r(c,zt.DEBUG):c,e.log=Vt.debugLog?r(u,zt.LOG):u,e.warn=Vt.debugLog?r(l,zt.WARN):l,e.error=Vt.debugLog?r(d,zt.ERROR):d)},e.send=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];switch(t){case zt.DEBUG:e.debug.apply(void 0,n);break;case zt.LOG:e.log.apply(void 0,n);break;case zt.WARN:e.warn.apply(void 0,n);break;case zt.ERROR:e.error.apply(void 0,n)}}}(Kt||(Kt={}));var qt,Jt=Kt;!function(e){e.patchSDP=function(e,t,n,r){if(!t&&!n&&!r)return e;var i=new RegExp("[\r\n]+");function a(e,t,n){var r,i=e.split(" "),a=i.slice(0,3);for(r=3;r<i.length;r++)n.includes(i[r])&&a.push(i[r]);for(r=3;r<i.length;r++)n.includes(i[r])||t.includes(i[r])||a.push(i[r]);return a.join(" ")}function o(e,t){var n,r=new RegExp("a=rtpmap:(\\d+) ([a-zA-Z0-9-]+)\\/\\d+"),i=[];for(n=0;n<e.length;++n){var a=e[n].match(r);a&&3===a.length&&a[2]===t&&i.push(a[1])}return i}function s(e,t,n,r){var i,o="m="+t;for(i=0;i<e.length;++i)if(e[i].startsWith(o)){e[i]=a(e[i],n,r);break}}var c=[],u=e.split(i);(n||t)&&(c=o(u,"H264"));var l=[];if(r&&(l=o(u,"VP9")),n){var d=c.slice(0),p=new RegExp("a=fmtp:(\\d+) apt=(\\d+)"),h=void 0;for(h=0;h<u.length;++h)(m=u[h].match(p))&&3===m.length&&d.includes(m[2])&&d.push(m[1]);var f=new RegExp("a=(rtpmap|rtcp-fb|fmtp):(\\d+) .*");for(h=u.length;h--;){var m;(m=u[h].match(f))&&3===m.length&&d.includes(m[2])&&u.splice(h,1)}s(u,"video",d,[])}else t&&s(u,"video",[],c);return r&&s(u,"video",[],l),u.join("\r\n")},e.getPeerIdString=function(e){return e?e.type+"_"+e.id:"_"},e.getPeerConnectionHostInfo=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return e&&e.getStats?[2,e.getStats(null).then((function(e){var t=null,n=null;if(e.forEach((function(t){"transport"===t.type&&t.selectedCandidatePairId?n=e.get(t.selectedCandidatePairId):"candidate-pair"!==t.type||"succeeded"!==t.state||n||t.hasOwnProperty("selected")&&!t.selected||(n=t)})),n&&n.localCandidateId){var r=e.get(n.localCandidateId);r&&(t={type:r.candidateType,ip:r.ip||r.ipAddress,port:r.port||r.portNumber})}return t})).catch((function(){return null}))]:[2,Promise.resolve(null)]}))}))};var t=/^[0-9]+$/,n=/^([gu])([0-9]+)$/;function r(e,r){var i=String(e);return n.test(i)?(Jt.warn("Already composite id ["+e+"] type supplied ["+r+"]"),i):"GROUP"===r?"g"+i:"USER"===r?"u"+i:(Jt.warn("Unknown type ["+r+"] for id ["+e+"]"),i.match(t)?"u"+i:i)}function i(e){return r(e.id,e.idType)}function a(e,t,n,r,i){if(e&&n&&"video"===n.kind){var a=n.getSettings();if(a){var o=e.maxBitrateK?1024*e.maxBitrateK:null,s=a.width,c=a.height,u=s&&c&&e.maxDimension?Math.max(1,Math.max(s,c)/e.maxDimension):null,l=e.maxFramerate?e.maxFramerate:null,d=e.degradationPreference?e.degradationPreference:"balanced",p=r[n.id];if(p&&p.bitrate===o&&p.scaleResolutionDownBy===u&&p.maxFramerate===l&&p.degradationPreference===d)return void(i[n.id]=p);i[n.id]={bitrate:o,scaleResolutionDownBy:u,maxFramerate:l,degradationPreference:d};var h=t.getParameters();h.encodings||(h.encodings=[{}]),h.encodings.forEach((function(e){o?e.maxBitrate=o:delete e.maxBitrate,u?e.scaleResolutionDownBy=u:delete e.scaleResolutionDownBy,l?e.maxFramerate=l:delete e.maxFramerate})),h.degradationPreference=d,t.setParameters(h)}}}e.composeId=r,e.composeParticipantId=i,e.composeMessageId=function(e){return e.participant?i(e.participant):r(e.participantId,e.participantType)},e.decomposeId=function(e){var r=String(e),i=r.match(n);return i?{id:String(i[2]),type:"g"===i[1]?"GROUP":"USER"}:(Jt.warn("Unsupported compositeId ["+e+"]"),{id:t.test(r)?r:e,type:"USER"})},e.uuid=function(){var e,t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[t]=n[19===t?3&e|8:e]);return r.join("")},e.throttle=function(e,t){var n;return function(){var r=this,i=arguments;n&&window.clearTimeout(n),n=window.setTimeout((function(){e.apply(r,i)}),t)}},e.sdpFingerprint=function(e){for(var t="",n=0,r=e.split("\n");n<r.length;n++){var i=r[n];if(i.startsWith("a=fingerprint")){var a=i.split(" ");if(2===a.length){t=a[1];break}}}if(!t)return Ae.a.minusOne;for(var o=t.split(":"),s=Ae.a.zero,c=Math.min(7,o.length-1);c>=0;c--){var u=Ae()(o[c],16);s=s.shiftLeft(8).or(u)}return function(e,t){var n=t.value;if("bigint"==typeof n)return Ae()(BigInt.asIntN(64,n));var r=Ae.a.one.shiftLeft(64),i=t.and(r.subtract(1));return i.greaterOrEquals(r.subtract(i))?i.subtract(r):i}(0,s)},e.delay=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,new Promise((function(t){return window.setTimeout(t,e)}))]}))}))},e.comparePlainObjects=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!t.hasOwnProperty(o))return!1;if(t[o]!==e[o])return!1}return!0},e.applySettings=function(e,t,n){var r=[];return e.getSenders().forEach((function(e){return a(t,e,e.track,n,r)})),r},e.applyVideoTrackSettings=a,e.includesOneOf=function(e,t){Array.isArray(t)||(t=[t]);for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e.includes(i))return!0}return!1},e.iterateInTriplets=function(e,t){for(var n=0;n<e.length;n+=3)t(e[n],n+1<e.length?e[n+1]:null,n+2<e.length?e[n+2]:null)}}(qt||(qt={}));var Yt,$t=qt,Zt=function(){try{var e,t=Date.now().toString(),n=window.localStorage;return n.setItem(t,t),e=n.getItem(t)===t,n.removeItem(t),e?n:null}catch(e){return null}}();!function(e){e.get=function(e){return function(e){var t=Zt?Zt.getItem("_okcls_"+e):null;if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}}(e)||null},e.set=function(e,t){!function(e,t){try{Zt&&Zt.setItem("_okcls_"+e,JSON.stringify(t))}catch(e){}}(e,t)},e.remove=function(e){!function(e){Zt&&Zt.removeItem("_okcls_"+e)}(e)}}(Yt||(Yt={}));var Xt,en,tn,nn,rn=Yt,an=null,on=null,sn=[],cn=[],un=[],ln=null,dn=null,pn=null,hn=!1,fn=!1,mn=!1,vn=!1,_n=null,gn="",An=[],yn=null,En=navigator.appVersion,Sn=navigator.appName,bn=navigator.userAgent;!function(e){e.USER="user",e.ENVIRONMENT="environment",e.LEFT="left",e.RIGHT="right"}(nn||(nn={}));var Cn,wn=function(){function e(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=Vt.videoMaxWidth),void 0===r&&(r=Vt.videoMaxHeight);var i=!1;if(e){i={noiseSuppression:Vt.noiseSuppression,echoCancellation:!0,autoGainControl:!0};var a=void 0;dn&&(a=dn.deviceId),"string"==typeof e&&(a=e),a&&(i.deviceId={exact:a})}var o=!1;if(t){o={width:{min:Vt.videoMinWidth,max:n,ideal:n},height:{min:Vt.videoMinHeight,max:r,ideal:r},aspectRatio:{ideal:Vt.videoAspectRatio},frameRate:{ideal:Vt.videoFrameRate}};var s=void 0;ln&&(s=ln.deviceId),"string"==typeof t&&(s=t),s&&(o.deviceId={exact:s}),Vt.videoFacingMode&&(o.facingMode={exact:Vt.videoFacingMode})}this.audio=i,this.video=o,this.needVideo=!!o}return e.prototype.getNative=function(){return Object.assign({},{audio:this.audio,video:this.video})},e.prototype.simplify=function(){return"object"==typeof this.video&&(this.video.width||this.video.height?(delete this.video.width,delete this.video.height):this.video.aspectRatio?delete this.video.aspectRatio:this.video.frameRate?delete this.video.frameRate:(this.video.deviceId||this.video.facingMode)&&(delete this.video.deviceId,delete this.video.facingMode)),"object"==typeof this.audio&&(this.audio.echoCancellation||this.audio.autoGainControl||this.audio.noiseSuppression?(delete this.audio.echoCancellation,delete this.audio.autoGainControl,delete this.audio.noiseSuppression):this.audio.deviceId&&delete this.audio.deviceId),!0===this.video&&!0===this.audio?this.video=!1:!1===this.video&&!0===this.audio&&Vt.allowMissingMic?(this.audio=!1,this.video=this.needVideo):!0===this.video&&!1===this.audio&&(this.video=!1),this.video&&!Object.keys(this.video).length&&(this.video=!0),this.audio&&!Object.keys(this.audio).length&&(this.audio=!0),this},e.prototype.canSimplify=function(){var e="object"==typeof this.video&&(this.video.width||this.video.height||this.video.aspectRatio||this.video.frameRate||this.video.facingMode||this.video.deviceId)||this.video;return!!("object"==typeof this.audio&&(this.audio.deviceId||this.audio.noiseSuppression||this.audio.echoCancellation||this.audio.autoGainControl)||Vt.allowMissingMic&&this.audio||e)},e.prototype.isVideo=function(){return!!this.video},e.prototype.isAudio=function(){return!!this.audio},e}(),On=function(e){function t(t,n){var r=e.call(this,!1,!0)||this;return"object"==typeof r.video?(delete r.video.deviceId,delete r.video.aspectRatio,delete r.video.frameRate,delete r.video.facingMode):r.video={},r.video.cursor="motion",r.video.width=t,r.video.height=n,r.video.frameRate=Vt.screenFrameRate,r}return Ze(t,e),t}(wn);function Tn(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){switch(e.label){case 0:return an=null,[4,Pn()];case 1:return e.sent(),[2]}}))}))}function In(){an=null,Pn().then((function(){return Qt.onDeviceChange()}))}function Pn(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return an?[2,an]:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(!on&&navigator.mediaDevices.addEventListener&&(on=$t.throttle(In,1e3),navigator.mediaDevices.addEventListener("devicechange",on)),[2,an=navigator.mediaDevices.enumerateDevices().then((function(e){sn=e.filter((function(e){return"videoinput"===e.kind&&(e.label&&(hn=!0),!0)})),cn=e.filter((function(e){return"audioinput"===e.kind&&(e.label?fn=!0:Cn.isMobile()&&"Firefox"===Cn.browserName()&&(fn=hn),!0)})),un=e.filter((function(e){return"audiooutput"===e.kind}));var t=rn.get("videoinput"),n=rn.get("audioinput"),r=rn.get("audiooutput");return ln=sn.find((function(e){return e.deviceId===t}))||null,dn=cn.find((function(e){return e.deviceId===n}))||null,pn=un.find((function(e){return e.deviceId===r}))||null,an=Promise.resolve(e),e})).catch((function(){return an=null,[]}))]):[2,[]]}))}))}function Rn(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return Cn.isBrowserSupported()?[2,new Promise((function(e){(new window.RTCPeerConnection).createOffer({offerToReceiveVideo:!0}).then((function(t){/^a=rtpmap:\d+ VP8\/\d+$/m.test(t.sdp)&&(mn=!0),/^a=mid:0$/m.test(t.sdp)&&(vn=!0),e()})).catch(e)}))]:[2,Promise.resolve()]}))}))}function Dn(e,t){return et(this,void 0,void 0,(function(){var n,r,i;return tt(this,(function(a){switch(a.label){case 0:Jt.debug("Try to get media",e.getNative()),(n=Cn.hasPermissions(e.isVideo()))||t||Qt.onPermissionsRequested(),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,navigator.mediaDevices.getUserMedia(e.getNative())];case 2:return r=a.sent(),n?[3,4]:[4,Tn()];case 3:a.sent(),a.label=4;case 4:return[2,r];case 5:switch(a.sent().name){case"PermissionDeniedError":case"PermissionDismissedError":case"NotAllowedError":case"SecurityError":case"DOMException":t=e.isVideo()?ft.CAMERA_PERMISSION:ft.MIC_PERMISSION;break;case"OverconstrainedError":case"TypeError":case"NotFoundError":break;case"AbortError":case"NotReadableError":t=e.isVideo()?ft.CAMERA_ACCESS:ft.MIC_ACCESS}if(e.canSimplify())return[2,Dn(e.simplify(),t)];throw i=t||ft.UNKNOWN,Qt.onPermissionsError(i),i;case 6:return[2]}}))}))}function kn(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:Jt.debug("Try to get screen",e.getNative()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getDisplayMedia(e.getNative())];case 2:return t=r.sent(),(n=null==t?void 0:t.getVideoTracks()[0])&&(n.contentHint="text"),[2,t];case 3:switch(r.sent().name){case"PermissionDeniedError":case"NotAllowedError":case"SecurityError":throw ft.SCREEN_PERMISSION;default:throw ft.SCREEN_ACCESS}return[3,4];case 4:return[2]}}))}))}function Nn(){return An.length?An:An=function(){var e,t=!1,n=0,r=bn.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return["IE",(e=/\brv[ :]+(\d+)/g.exec(bn))&&e[1]||"Unknown",t,n];if("Safari"===r[1]){if(e=bn.match(/\bEdge\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(e=bn.match(/\bCriOS\/(\d+)/))return["Chrome",e[1],!0,e[1]];if(e=bn.match(/\bFxiOS\/(\d+)/))return["Firefox",e[1],!1,n];if(e=bn.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1],!1,n];if(e=bn.match(/\bOPT\/(\d+)/))return["Opera",e[1],!1,n]}if("Chrome"===r[1]){if(t=!0,n=Number(r[2]),e=bn.match(/\bOPR\/(\d+)/))return["Opera",e[1]||"Unknown",t,n];if(e=bn.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1]||"Unknown",t,n];if(e=bn.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return["Sferum",e[1]||"Unknown",t,n];if(e=bn.match(/\bEdge?\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return["Opera","Hidden",t,n]}return e=bn.match(/version\/(\d+)/i),[r[2]?r[1]:Sn,e&&e[1]||r[2]||En,t,n]}()}!function(e){function t(){return sn.length>0}function n(){return hn}function r(){return fn}function i(){if(!tn||"ended"===tn.readyState){var e=c(),t=e.createMediaStreamDestination(),n=e.createGain();n.gain.value=1e-5,n.connect(t),n.connect(e.destination);var r=e.createOscillator();r.type="sine",r.frequency.value=0,r.connect(n),r.start(),tn=t.stream.getAudioTracks()[0]}return Object.assign(tn.clone(),{enabled:!1})}function a(e,t){if(void 0===e&&(e=Vt.videoMinWidth),void 0===t&&(t=Vt.videoMinHeight),en||(en=document.createElement("canvas")).getContext("2d"),en.width=e,en.height=t,!Xt||"ended"===Xt.readyState){var n=en.captureStream(Vt.videoFrameRate);Xt=n.getVideoTracks()[0]}return Object.assign(Xt.clone(),{enabled:!1})}function o(){return Nn()[0]}function s(){return Nn()[1]}function c(){return yn||(yn=new(window.AudioContext||window.webkitAudioContext)),yn}e.init=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){switch(e.label){case 0:return[4,Rn()];case 1:return e.sent(),[2,Pn()]}}))}))},e.getCameras=function(){return sn},e.getMicrophones=function(){return cn},e.getOutput=function(){return un},e.hasCamera=t,e.hasMicrophone=function(){return cn.length>0},e.getSavedCamera=function(){return ln},e.getSavedMicrophone=function(){return dn},e.getSavedOutput=function(){return pn},e.hasCameraPermission=n,e.hasMicrophonePermission=r,e.hasPermissions=function(e){return void 0===e&&(e=!1),!!r()&&(!t()||!e||n())},e.getUserMedia=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),et(this,void 0,void 0,(function(){var r,o,s,c;return tt(this,(function(u){switch(u.label){case 0:r=n,o=t()&&e,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,Dn(new wn(r,o))];case 2:return s=u.sent(),[3,4];case 3:if(c=u.sent(),!Vt.allowMissingMic)throw c;return s=new MediaStream,[3,4];case 4:return s.getVideoTracks().length||s.addTrack(a()),s.getAudioTracks().length||s.addTrack(i()),[2,s]}}))}))},e.getScreenMedia=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,kn(new On(window.screen.width,window.screen.height))]}))}))},e.getUserVideo=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){return n=t?Vt.videoEffectMaxWidth:Vt.videoMaxWidth,r=t?Vt.videoEffectMaxHeight:Vt.videoMaxHeight,[2,Dn(new wn(!1,e||!0,n,r))]}))}))},e.getUserAudio=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,Dn(new wn(e||!0,!1))]}))}))},e.saveDeviceId=function(e,t){return et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return[4,Pn()];case 1:return n=i.sent(),(r=n.find((function(n){return n.kind===e&&n.deviceId===t})))?("videoinput"===e?ln=r:"audioinput"===e?dn=r:"audiooutput"===e&&(pn=r),rn.set(e,t),[2,r]):[2,null]}}))}))},e.getSilentMediaTrack=i,e.getBlackMediaTrack=a,e.isBrowserSupported=function(){if("Edge"===o()&&s()<70)return!1;try{var e=window;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&e.RTCPeerConnection&&e.RTCIceCandidate&&e.RTCSessionDescription&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.RTCRtpSender&&e.RTCRtpSender.prototype.replaceTrack&&navigator.sendBeacon&&!0}catch(e){return!1}},e.isScreenCapturingSupported=function(){return!!navigator.mediaDevices.getDisplayMedia},e.canVP8=function(){return mn},e.isUnifiedPlan=function(){return vn},e.isBrokenH264=function(){return"Opera"===e.browserName()&&"Windows"===e.os()},e.canPreferH264=function(){return!(e.baseChromeVersion()&&e.isMobile())},e.os=function(){return gn||(gn=function(){var e={Windows:/Win/,Android:/Android/,OpenBSD:/OpenBSD/,SunOS:/SunOS/,Linux:/(Linux|X11)/,iPad:/(iPad)/,iPhone:/(iPhone)/,iPod:/(iPod)/,MacOS:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/,QNX:/QNX/,UNIX:/UNIX/,BeOS:/BeOS/,OS2:/OS\/2/,Bot:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/};for(var t in e)if(e.hasOwnProperty(t)&&e[t].test(bn))return t;return"Unknown"}()),gn},e.isMobile=function(){return null===_n&&(_n=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(En)),_n},e.browserName=o,e.browserVersion=s,e.baseChromeVersion=function(){return Nn()[3]},e.getAudioContext=c}(Cn||(Cn={}));var Fn,Ln,Mn=Cn;function jn(e,t){return null===e||null===t?null===e&&null===t:e.maxDimension===t.maxDimension&&e.maxBitrateK===t.maxBitrateK&&e.maxFramerate===t.maxFramerate&&e.degradationPreference===t.degradationPreference}function xn(e,t){return!!jn(e.camera,t.camera)&&!!jn(e.screenSharing,t.screenSharing)}function Bn(e,t){return{camera:Object.assign({},e.camera,t.camera),screenSharing:Object.assign({},e.screenSharing,t.screenSharing)}}!function(e){e.USER="USER",e.ANONYM="ANONYM",e.GROUP="GROUP"}(Fn||(Fn={})),function(e){function t(e,t){return void 0===t&&(t=Fn.USER),{id:e,type:t}}function n(e){return'{"id":"'+e.id+'","type":"'+e.type+'"}'}e.fromIds=function(e){return e.length?"object"==typeof e[0]?e:e.map((function(e){return t(e)})):[]},e.fromId=t,e.toString=n,e.fromIdToString=function(e,r){return void 0===r&&(r=Fn.USER),n(t(e,r))},e.fromString=function(e){try{return JSON.parse(e)}catch(t){throw new Error("Failed to parse ExternalId from string '"+e+"'")}},e.compare=function(e,t){return e.id===t.id&&e.type===t.type}}(Ln||(Ln={}));var Un=function(e){function t(t,n){var r=e.call(this)||this;return r._batchInterval=3e3,r._batch=[],r._batchTimeout=null,r._api=t,r._externalLogger=n,r}return Ze(t,e),t.prototype._send=function(e){this._api.log(e)},t.prototype._sendBatch=function(){this._stopTimeout(),this._batch.length>0&&(this._send(this._batch),this._batch=[],this._startTimeout())},t.prototype._startTimeout=function(){var e=this;this._batchTimeout=window.setTimeout((function(){return e._sendBatch()}),this._batchInterval)},t.prototype._stopTimeout=function(){this._batchTimeout&&(clearTimeout(this._batchTimeout),this._batchTimeout=null)},t.prototype._onUnload=function(){this._sendBatch(),this._stopTimeout()},t.prototype.log=function(e,t,n){void 0===n&&(n=!1);var r={type:1,time:0,operation:e,timestamp:Date.now(),custom:{},uid:this._api.getUserId()};void 0!==t&&(r.custom.param=t),this._batch.push(r),!n&&this._batchTimeout||this._sendBatch(),this._externalLogger&&this._externalLogger.log(e,t,n)},t.prototype.destroy=function(){this._sendBatch(),this._stopTimeout(),this._externalLogger&&this._externalLogger.destroy()},t.create=function(e,n){t._instance||(t._instance=new t(e,n))},t.log=function(e,n,r){void 0===r&&(r=!1),t._instance&&t._instance.log(e,n,r)},t.destroy=function(){t._instance&&t._instance.destroy(),t._instance=null},t}(ot),Vn=function(){function e(e){this._fixNoPacketsApplied=!1,this._fixNoPacketsChecked=!1,this._fixTooManyPacketsApplied=!1,this._fixTooManyPacketsSucceeded=!1,this._fixTooManyPacketsFailed=!1,this._mediaSource=e}return e.prototype._fixAudioDeviceNoPackets=function(e){if(!this._fixNoPacketsApplied||!this._fixNoPacketsChecked)return this._fixNoPacketsApplied&&!this._fixNoPacketsChecked?(this._fixNoPacketsChecked=!0,void Un.log("callError","audio_device_recover_"+(e.bandwidth?"success":"fail"))):void(this._fixNoPacketsApplied||e.bandwidth||(this._fixNoPacketsApplied=!0,Un.log("callError","audio_device_recover"),this._mediaSource.toggleAudio(!0)))},e.prototype._fixAudioDeviceTooManyPackets=function(e){if(!this._fixTooManyPacketsSucceeded&&!this._fixTooManyPacketsFailed){var t=Date.now();if(this._lastPacketsSentTime){if(t-this._lastPacketsSentTime>500){var n=1e3*(e.packetsSent-this._lastPacketsSent)/(t-this._lastPacketsSentTime);this._lastPacketsSentTime=t,this._lastPacketsSent=e.packetsSent,this._fixTooManyPacketsApplied?n>75?(Jt.log("Failed to fix RV"),Un.log("callError","audio_device_recover_rv_fail"),this._fixTooManyPacketsFailed=!0):t-this._fixTooManyPacketsTime>6e4&&(Jt.log("Fixed RV"),Un.log("callError","audio_device_recover_rv_success"),this._fixTooManyPacketsSucceeded=!0):n>75&&(this._fixTooManyPacketsApplied=!0,Jt.log("Trying to fix RV"),this._mediaSource.toggleAudio(!0),this._fixTooManyPacketsTime=t)}}else e.packetsSent>0&&(this._lastPacketsSentTime=t,this._lastPacketsSent=e.packetsSent)}},e.prototype.fix=function(e){if(this._mediaSource){var t=e.find((function(e){return"audio"===e.kind}));t&&(this._fixAudioDeviceNoPackets(t),this._fixAudioDeviceTooManyPackets(t))}},e}(),Gn=function(){function e(){this._output=null,this._volume=1}return e.prototype.add=function(e){this.remove(),this._output={},this._output.audioTrack=e,this._initAudioElement()},e.prototype.remove=function(){this._output&&(this._stopAudioElement(),this._output=null)},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=Math.max(0,Math.min(1,e)),this._output&&this._output.audioElement&&(this._output.audioElement.volume=this._volume)},enumerable:!1,configurable:!0}),e.prototype._initAudioElement=function(){var e,t=this;if(null===(e=this._output)||void 0===e?void 0:e.audioTrack){var n=new Audio;n.muted=!1,n.volume=this._volume,n.preload="auto";var r=function(){Jt.warn("Error on play audio"),Qt.onAutoplayError()},i=function(e){n.srcObject=new MediaStream([e]),n.load();var t=n.play();t?t.catch(r):r()},a=function(){var e;Jt.debug("Recover audio playback");var n=null===(e=t._output)||void 0===e?void 0:e.audioTrack;n?i(n):Jt.warn("Broken audio track")};n.onpause=a,n.onstalled=a,n.onerror=a,i(this._output.audioTrack),this._output.audioElement=n}},e.prototype._stopAudioElement=function(){var e,t,n;(null===(e=this._output)||void 0===e?void 0:e.audioElement)&&(this._output.audioElement.pause(),this._output.audioElement.srcObject=null),null===(n=null===(t=this._output)||void 0===t?void 0:t.audioTrack)||void 0===n||n.stop()},e.prototype.destroy=function(){this.remove()},e}(),Hn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastMemoryStat={percent:0,bytes:0},t}return Ze(t,e),t.prototype.onRemoteDataStats=function(e,t,n){var r;this._calcMemory(),n&&(null===(r=e.inbound.rtps)||void 0===r||r.map((function(e){var n=t[e.userId];e.userId=null==n?void 0:n.externalId})),Qt.onStatistics(e,this._lastMemoryStat))},t.prototype._calcMemory=function(){var e=window.performance&&window.performance.memory;if(e&&e.usedJSHeapSize&&e.jsHeapSizeLimit){var t=Number((100*e.usedJSHeapSize/e.jsHeapSizeLimit).toFixed(2)),n=Number((e.usedJSHeapSize/1024/1024).toFixed(1));t>90?Jt.warn("High memory usage: "+t+"% ("+n+" MiB)"):(!this._lastMemoryStat.percent||Math.abs(t-this._lastMemoryStat.percent)>=3)&&(Jt.debug("Memory usage: "+t+"% ("+n+" MiB)"),this._lastMemoryStat.percent=t,this._lastMemoryStat.bytes=e.usedJSHeapSize)}},t}(st),Wn=function(e){function t(n,r){var i=e.call(this)||this;i.name="HangupReason",i.code=r&&r.code||0,i.remote=r&&r.remote||!1,Object.values(vt).indexOf(n)>-1?i.hangup=n:i.error=n;var a=[];return i.error&&a.push("error"),i.remote&&a.push("remote"),i.code&&a.push("code: "+i.code),r&&r.message&&a.push("message: '"+r.message+"'"),i.message=n+(a.length?" ("+a.join(", ")+")":""),Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return Ze(t,e),t}(Error),zn=function(){function e(e,t){this._analyser=null,this._gainNode=null,this._fftBins=null,this._mediaStreamSource=null,this._lastSmoothedLevel=0,this._trackId=e,this._stream=t;try{var n=Mn.getAudioContext();this._gainNode=n.createGain(),this._gainNode.gain.value=1e-5,this._gainNode.connect(n.destination),this._analyser=n.createAnalyser(),this._analyser.fftSize=1024,this._analyser.smoothingTimeConstant=0,this._analyser.connect(this._gainNode),this._fftBins=new Uint8Array(this._analyser.frequencyBinCount),this._mediaStreamSource=n.createMediaStreamSource(t),this._mediaStreamSource.connect(this._analyser)}catch(e){}}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trackId",{get:function(){return this._trackId},enumerable:!1,configurable:!0}),e.prototype._getBins=function(){if(!this._fftBins||!this._analyser)return new Uint8Array;this._analyser.getByteFrequencyData(this._fftBins);var e=44100/this._fftBins.length,t=Math.ceil(Vt.voiceParams.minFreq/e),n=Math.floor(Vt.voiceParams.maxFreq/e);return this._fftBins.subarray(t,n)},e.prototype.getLevel=function(){var e=this._getBins(),t=e.reduce((function(e,t){return e+t}),0)/e.length/255,n=this._lastSmoothedLevel*Vt.voiceParams.smoothing+t*(1-Vt.voiceParams.smoothing);return this._lastSmoothedLevel=n,{real:t,smoothed:n}},e.prototype.destroy=function(){this._mediaStreamSource&&(this._mediaStreamSource.disconnect(),this._mediaStreamSource=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._analyser&&(this._analyser.disconnect(),this._analyser=null,this._fftBins=null,this._lastSmoothedLevel=0)},e}(),Kn=function(e){function t(t){var n=e.call(this)||this;n._detector=null,n._track=null,n._interval=null;var r=function(){n._detector&&Qt.onLocalVolume(n._detector.getLevel().real,t.getMediaSettings().isAudioEnabled),n._interval=window.setTimeout(r,Vt.voiceParams.interval)};n._interval=window.setTimeout(r,Vt.voiceParams.interval);var i=function(){var e=t.getStream();e&&n.init(e)};return n.subscribe(t,"SOURCE_CHANGED",(function(e){"audio"===e.kind&&e.mediaSettings.isAudioEnabled&&i()})),i(),n}return Ze(t,e),t.prototype.init=function(e){this._stopDetector();var t=e.getAudioTracks();t.length&&(this._track=t[0].clone(),this._detector=new zn("local",new MediaStream([this._track])))},t.prototype._stopDetector=function(){this._detector&&(this._detector.destroy(),this._detector=null),this._track&&(this._track.stop(),this._track=null)},t.prototype.destroy=function(){this.unsubscribe(),this._interval&&(window.clearTimeout(this._interval),this._interval=null),this._stopDetector()},t}(st),Qn=function(e){function t(){var t=e.call(this)||this;return t._stream=null,t._sendVideoTrack=null,t._mediaSettings={isAudioEnabled:!0,isVideoEnabled:!0,isDataEnabled:!1,isScreenSharingEnabled:!1,audioBitrateBps:0,videoBitrateBps:0},t._videoStatusOnScreenCapturingEnabled=!1,t._effect=null,t._initDeviceChangeListener(),t}return Ze(t,e),t.prototype.request=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!0),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:if(this._stream)return[2];if(!Mn.isBrowserSupported())throw new Wn(ft.UNSUPPORTED);if(!Mn.hasMicrophone()&&!Vt.allowMissingMic)throw new Wn(ft.MIC_NOT_FOUND);i.label=1;case 1:return i.trys.push([1,3,,4]),n=this,[4,Mn.getUserMedia(e,t)];case 2:return n._stream=i.sent(),this._mediaSettings.isVideoEnabled=e&&this._stream.getVideoTracks().filter((function(e){return e.enabled})).length>0||!1,this._mediaSettings.isAudioEnabled=this._stream.getAudioTracks().filter((function(e){return e.enabled})).length>0||!1,[3,4];case 3:throw r=i.sent(),new Wn(r);case 4:return[2]}}))}))},t.prototype.getStream=function(){return this._stream},t.prototype.getSendVideoTrack=function(e){return void 0===e&&(e=!1),this._sendVideoTrack&&!e?this._sendVideoTrack:this._stream?this._stream.getVideoTracks()[0]:null},t.prototype._getSendAudioTrack=function(){var e;return(null===(e=this._stream)||void 0===e?void 0:e.getAudioTracks()[0])||null},t.prototype.addTrackToPeerConnection=function(e,t){void 0===t&&(t=!1);var n=this.getStream(),r=this._getSendAudioTrack(),i=this.getSendVideoTrack(t);if(!n||!r&&!i)throw new Error("No local stream found");r&&e.addTrack(r,n),i&&e.addTrack(i,n)},t.prototype.getMediaSettings=function(){return this._mediaSettings},t.prototype.changeDevice=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(e){case"videoinput":return[2,this._changeVideoInput()];case"audioinput":return[2,this._changeAudioInput()];default:return[2,Promise.reject()]}}))}))},t.prototype.setVideoStream=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,t?this._changeScreen(e):this._changeVideoInput(e)]}))}))},t.prototype._initDeviceChangeListener=function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.addEventListener){var t=!1,n=!1,r=$t.throttle((function(){n&&e._changeVideoInput().catch((function(){})),t&&e._changeAudioInput().catch((function(){})),t=!1,n=!1}),1e3);navigator.mediaDevices.addEventListener("devicechange",(function(){return et(e,void 0,void 0,(function(){var e,i,a,o,s,c,u;return tt(this,(function(l){switch(l.label){case 0:return this._stream?(e=this._stream.getAudioTracks()[0],i=e&&e.enabled&&e.getSettings(),a=i&&i.groupId,o=this._stream.getVideoTracks()[0],s=o&&o.enabled&&o.getSettings(),c=s&&s.groupId,a||c?[4,navigator.mediaDevices.enumerateDevices()]:[2]):[2];case 1:return u=l.sent(),!t&&a&&(t=!u.find((function(e){return e.groupId===a}))),!n&&c&&(n=!u.find((function(e){return e.groupId===c}))),r(),[2]}}))}))}))}},t.prototype._changeVideoInput=function(e){return void 0===e&&(e=null),et(this,void 0,void 0,(function(){var t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:return a.trys.push([0,7,,8]),t=e?"stream":"video",(n=e)?[3,2]:[4,Mn.getUserVideo(void 0,!!this._effect)];case 1:n=a.sent(),a.label=2;case 2:return e=n,this._stream?[3,3]:(e.getTracks().forEach((function(e){return e.stop()})),[3,6]);case 3:return this._disableScreenCapture(),[4,this._videoEffect(this._effect,e.getVideoTracks()[0])];case 4:return r=a.sent(),this._stopLocalTrack("video"),Un.log("callDeviceChanged",t),Jt.log("Video stream changed"),[4,this._replaceLocalTrack(r)];case 5:a.sent(),this._mediaSettings.isVideoEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),a.label=6;case 6:return[3,8];case 7:throw i=a.sent(),Un.log("callError","change_video"),Jt.warn("Camera change failed",i),i;case 8:return[2]}}))}))},t.prototype._changeAudioInput=function(){return et(this,void 0,void 0,(function(){var e,t,n;return tt(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[4,Mn.getUserAudio()];case 1:return e=r.sent(),this._stream?[3,2]:(e.getTracks().forEach((function(e){return e.stop()})),[3,4]);case 2:return t=e.getAudioTracks()[0],this._stopLocalTrack("audio"),Un.log("callDeviceChanged","audio"),Jt.log("Audio stream changed"),[4,this._replaceLocalTrack(t)];case 3:r.sent(),this._mediaSettings.isAudioEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),r.label=4;case 4:return[3,6];case 5:throw n=r.sent(),Un.log("callError","change_audio"),Jt.error("Microphone change failed",n),n;case 6:return[2]}}))}))},t.prototype._changeScreen=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i=this;return tt(this,(function(a){switch(a.label){case 0:return a.trys.push([0,7,,8]),(t=e)?[3,2]:[4,Mn.getScreenMedia()];case 1:t=a.sent(),a.label=2;case 2:return(e=t).addEventListener("inactive",(function(){i._mediaSettings.isScreenSharingEnabled&&i.toggleScreenCapturing(!1)}),!1),this._stream?[3,3]:(e.getTracks().forEach((function(e){return e.stop()})),[3,6]);case 3:return[4,this._videoEffect(null,e.getVideoTracks()[0])];case 4:return n=a.sent(),Un.log("callDeviceChanged","screen"),Jt.log("Screen capturing started"),this._stopLocalTrack("video"),this._videoStatusOnScreenCapturingEnabled=this._mediaSettings.isVideoEnabled,this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!0,this._sendVideoTrack=this._enableScreenCapture(n),[4,this._replaceLocalTrack(n,this._sendVideoTrack)];case 5:a.sent(),this._triggerEvent("SOURCE_CHANGED",{kind:"screen",mediaSettings:this._mediaSettings}),a.label=6;case 6:return[3,8];case 7:throw r=a.sent(),Un.log("callError","screen"),Jt.warn("Screen capturing failed",r),r;case 8:return[2]}}))}))},t.prototype._enableScreenCapture=function(e){return this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!0,this._triggerEvent("SCREEN_STATUS",{track:e,mediaSettings:this._mediaSettings}),Vt.consumerScreenDataChannel?Mn.getBlackMediaTrack(Vt.videoMinWidth,Vt.videoMinHeight):e},t.prototype._disableScreenCapture=function(){this._sendVideoTrack&&(this._sendVideoTrack.stop(),this._sendVideoTrack=null),this._mediaSettings.isScreenSharingEnabled&&(this._mediaSettings.isScreenSharingEnabled=!1,this._triggerEvent("SCREEN_STATUS",{mediaSettings:this._mediaSettings}))},t.prototype._replaceLocalTrack=function(e,t){return et(this,void 0,void 0,(function(){var n=this;return tt(this,(function(r){return this._stream?(this._stream.getTracks().forEach((function(r){var i,a;r.kind===e.kind&&(null===(i=n._stream)||void 0===i||i.removeTrack(r),null===(a=n._stream)||void 0===a||a.addTrack(e),n._triggerEvent("TRACK_REPLACED",e,t))})),[2]):[2]}))}))},t.prototype._stopLocalTrack=function(e){this._stream&&this._stream.getTracks().forEach((function(t){t.kind===e&&t.stop()}))},t.prototype._videoEffect=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){if(!Vt.videoEffects)return[2,t];try{return Un.log("callDeviceChanged","effect_"+e),[2,Vt.videoEffects.setEffect(e,t)]}catch(e){return Jt.warn("Video effect failed",e),[2,t]}return[2]}))}))},t.prototype.destroy=function(){Vt.videoEffects&&(this._effect=null,Vt.videoEffects.stopEffect()),this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null),this._sendVideoTrack&&(this._sendVideoTrack.stop(),this._sendVideoTrack=null),this._disableScreenCapture()},t.prototype.toggleScreenCapturing=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return e?[2,this._changeScreen()]:this._videoStatusOnScreenCapturingEnabled?[2,this._changeVideoInput()]:[2,this.toggleVideo(!1)]}))}))},t.prototype.toggleVideo=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return this._stream?(this._disableScreenCapture(),e?[4,Mn.getUserVideo(void 0,!!this._effect)]:[3,3]):[2];case 1:return n=r.sent(),t=n.getVideoTracks()[0],[4,this._videoEffect(this._effect,t)];case 2:return t=r.sent(),[3,5];case 3:return t=Mn.getBlackMediaTrack(Vt.videoMinWidth,Vt.videoMinHeight),[4,this._videoEffect(null,t)];case 4:t=r.sent(),r.label=5;case 5:return this._stopLocalTrack("video"),[4,this._replaceLocalTrack(t)];case 6:return r.sent(),this._mediaSettings.isVideoEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.toggleAudio=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return this._stream?e?[4,Mn.getUserAudio()]:[3,2]:[2];case 1:return n=r.sent(),t=n.getAudioTracks()[0],[3,3];case 2:t=Mn.getSilentMediaTrack(),r.label=3;case 3:return this._stopLocalTrack("audio"),[4,this._replaceLocalTrack(t)];case 4:return r.sent(),this._mediaSettings.isAudioEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.setResolution=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){if(this._mediaSettings.isScreenSharingEnabled)return[2];if(!this._stream)throw new Error("Local stream not found");if(!(n=this._stream.getVideoTracks()[0]))throw new Error("Local video track not found");return n.enabled?[2,n.applyConstraints({width:{ideal:e},height:{ideal:t}})]:[2]}))}))},t.prototype.updateNoiseSuppression=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){if(!this._stream||!this._mediaSettings.isAudioEnabled)return[2];if(!(e=this._stream.getAudioTracks()[0]))throw new Error("Local audio track not found");return e.enabled?[2,e.applyConstraints({noiseSuppression:Vt.noiseSuppression})]:[2]}))}))},t.prototype.videoEffect=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){if(!Vt.videoEffects)throw new Error("Video Effects library is not set");if(this._mediaSettings.isScreenSharingEnabled)throw new Error("Can't apply effect to screensharing");return this._mediaSettings.isVideoEnabled?this._stream&&e!==this._effect?(this._effect=e,[2,this._changeVideoInput()]):[2]:(this._effect=e,[2])}))}))},t}(st),qn=function(e){function t(t,n){var r=e.call(this)||this;return r._speakerId=null,r._serverAudioActivityAvailable=!1,r.subscribe(t,"VOLUMES_DETECTED",r._onVolumesDetected.bind(r)),r.subscribe(n,"SIGNALLED_SPEAKER_CHANGED",r._onServerSpeakerChanged.bind(r)),r.subscribe(n,"SIGNALLED_ACTIVE_PARTICIPANTS",r._onReceivedServerAudioActivity.bind(r)),r.subscribe(n,"ACTIVE_PARTICIPANTS_NO_SIGNAL",r._onStoppedReceivingServerAudioActivity.bind(r)),r}return Ze(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.prototype._onVolumesDetected=function(e){if(!this._serverAudioActivityAvailable){var t=0,n=null;if(Object.keys(e).forEach((function(r){var i=e[r].smoothed;i>t&&i>Vt.voiceParams.threshold&&(t=i,n=r)})),n&&n!==this._speakerId){var r=this._speakerId&&e.hasOwnProperty(this._speakerId)?e[this._speakerId].smoothed:0;t>r*Vt.voiceParams.speakerLevelMultiplier&&(this._speakerId=n,this._triggerEvent("SPEAKER_CHANGED",n))}}},t.prototype._onServerSpeakerChanged=function(e){this._serverAudioActivityAvailable&&this._triggerEvent("SPEAKER_CHANGED",e)},t.prototype._onReceivedServerAudioActivity=function(){this._serverAudioActivityAvailable=!0},t.prototype._onStoppedReceivingServerAudioActivity=function(){this._serverAudioActivityAvailable=!1},t}(st),Jn=function(e){function t(t,n,r){var i=e.call(this)||this;return i._states={},i._volumes={},i._participants={},i._connectionTimeout=0,i._volumeTimeout=0,i._transport=t,i._participants=r,i.subscribe(t,"STATE_CHANGED",i._onTransportStateChanged.bind(i)),i.subscribe(n,"VOLUMES_DETECTED",i._onVolumesDetected.bind(i)),i}return Ze(t,e),t.prototype.destroy=function(){this.unsubscribe(),this._connectionTimeout&&window.clearTimeout(this._connectionTimeout),this._volumeTimeout&&window.clearTimeout(this._volumeTimeout)},t.prototype.onChangeRemoteMediaSettings=function(e,t){t.isAudioEnabled||(this._volumes[e]=1),t.isAudioEnabled&&(this._volumes[e]=0)},t.prototype._onTransportStateChanged=function(e,t){this._states[e]=t,"OPENED"===t&&(this._connectionTimeout||(this._connectionTimeout=window.setTimeout(this._onConnectionTimeout.bind(this),Vt.specListenerParams.connectionTimeout)),this._volumeTimeout||(this._volumeTimeout=window.setTimeout(this._onVolumeTimeout.bind(this),Vt.specListenerParams.volumeTimeout))),"FAILED"===t&&this._connectionTimeout&&(Jt.warn("Transport failed, send callSpecError"),Un.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT"))},t.prototype._onVolumesDetected=function(e){var t=this;Object.keys(e).forEach((function(n){t._volumes[n]=Math.max(e[n].real,t._volumes[n]||0)}))},t.prototype._onConnectionTimeout=function(){Object.values(this._states).filter((function(e){return"CONNECTED"!==e})).length>0&&(Jt.warn("There is not connected transport, send callSpecError"),Un.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT")),this._connectionTimeout=0},t.prototype._onVolumeTimeout=function(){var e=this,t=[];Object.keys(this._volumes).forEach((function(n){if(!(e._volumes[n]>0)){var r="UNKNOWN",i=e._participants[n];i&&i.platform&&(r=i.platform),t.indexOf(r)<0&&(t.push(r),Un.log("callSpecError",e._transport.getTopology()+"_VOLUME_TIMEOUT_"+r))}})),t.length&&Jt.warn("There is silent participant, send callSpecError"),this._volumeTimeout=0},t}(st);function Yn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){for(var n=0,r=e;n<r.length;n++)if((0,r[n])(t))return!0;return!1}}function $n(e,t){return function(n){return n[e]===t}}function Zn(e,t){return t.reduce((function(t,n){return t[n[e]]=n,t}),{})}function Xn(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})).reduce((function(e,t){return e[t[0]]=function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}(t[1])?Xn(t[1]):t[1],e}),{})}function er(e){for(var t=[],n=0,r=e;n<r.length;n++)r[n].forEach((function(e){return t.push(e)}));return t}function tr(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){return t=[],RTCRtpReceiver.prototype.getStats?(t.push.apply(t,e.getReceivers().map((function(e){return e.getStats()}))),t.push.apply(t,e.getSenders().map((function(e){return e.getStats()})))):t.push(e.getStats()),[2,Promise.all(t).then(er).then((function(e){return function(e,t){for(var n={},r=[],i=0,a=t;i<a.length;i++){var o=a[i],s=o.id;!0!==n[s]&&(n[s]=!0,r.push(o))}return r}(0,e)}))]}))}))}function nr(e){var t,n=e.filter($n("type","candidate-pair")).sort((t="priority",function(e,n){return e[t]-n[t]})).find(Yn($n("nominated",!0),$n("selected",!0)));if(!n)return{};var r={totalRoundTripTime:n.totalRoundTripTime,currentRoundTripTime:n.currentRoundTripTime,bytesSent:n.bytesSent,bytesReceived:n.bytesReceived},i=e.find($n("id",n.remoteCandidateId));i&&(r=Object.assign({},r,{remote:{type:i.candidateType,address:i.ip||i.address,port:i.port,protocol:i.protocol}}));var a=e.find($n("id",n.localCandidateId));return a&&(r=Object.assign({},r,{local:{type:a.candidateType,address:a.ip||a.address,port:a.port,protocol:a.protocol,relayProtocol:a.relayProtocol,networkType:a.networkType}})),Xn(r)}function rr(e,t){t=t||{};var n=Zn("id",e),r=e.filter(Yn($n("type","inbound-rtp"),$n("type","outbound-rtp")));"Firefox"===Mn.browserName()&&(r=Object.values(r.reduce((function(e,t){if(e[t.ssrc]){var n=Object.assign({},e[t.ssrc],t),r=e[t.ssrc].isRemote?t:e[t.ssrc];n.id=r.id,n.type=r.type,delete n.isRemote,delete n.remoteId,e[n.ssrc]=n}else e[t.ssrc]=t;return e}),{})));var i={};return"Safari"===Mn.browserName()&&(i=Zn("trackIdentifier",e.filter($n("type","track")))),r.map((function(e){var r=e.ssrc,a=e.mediaType||e.kind,o=e.trackId,s=e.type,c=e.codecId;if("Safari"===Mn.browserName()){var u=/^.+_([\d]+)$/.exec(e.id);if(u&&(r=parseInt(u[1],10)),a=e.id.indexOf("Audio")>0?"audio":"video",t[r]){var l=a+"-"+t[r];i[l]&&(o=i[l].id)}}if(!s||!r||!a)return null;var d={ssrc:r,type:s,kind:a,bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,jitter:e.jitter,packetsLost:e.packetsLost,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent,fractionLost:e.fractionLost,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,userId:t[r]};if(c&&n[c]){var p=n[c];d.clockRate=p.clockRate,d.mimeType=p.mimeType}if(o&&n[o]){var h=n[o];d.frameHeight=h.frameHeight,d.frameWidth=h.frameWidth,d.framesDecoded=h.framesDecoded,d.framesReceived=h.framesReceived,d.framesDropped=h.framesDropped}return Xn(d)})).filter((function(e){return!!e}))}function ir(e,t){if(!t)return e;if(!t.rtps||!e.rtps)return e;var n=Zn("ssrc",e.rtps),r=Zn("ssrc",t.rtps),i=(e.timestamp-t.timestamp)/1e3;return n&&r?(Object.keys(n).forEach((function(e){var t=n[e],a=r[e];t&&a&&(t.bytesReceived&&t.bytesReceived>a.bytesReceived&&(t.bandwidth=Math.round((t.bytesReceived-a.bytesReceived)/i)),t.bytesSent&&t.bytesSent>a.bytesSent&&(t.bandwidth=Math.round((t.bytesSent-a.bytesSent)/i)),t.packetsReceived>a.packetsReceived&&(t.packetLoss=parseFloat((100*(t.packetsLost-a.packetsLost)/(t.packetsReceived-a.packetsReceived)/i).toFixed(2))),t.framesDropped>a.framesDropped&&(t.framesDroppedDelta=parseFloat(((t.framesDropped-a.framesDropped)/i).toFixed(0))))})),e):e}function ar(e,t,n){return et(this,void 0,void 0,(function(){var r,i;return tt(this,(function(a){switch(a.label){case 0:return[4,tr(e)];case 1:return r=a.sent(),i={timestamp:Date.now(),transport:nr(r),rtps:rr(r,n)},t?[3,3]:[4,$t.delay(1e3)];case 2:return a.sent(),[2,ar(e,i,n)];case 3:return[2,ir(i,t)]}}))}))}var or=function(e){function t(t,n,r,i,a){var o=e.call(this)||this;if(o._remoteSDP={},o._remoteCandidates={},o._state="IDLE",o._isOpen=!1,o._remotePeerId=null,o._statInterval=null,o._settingsInterval=null,o._failedOnCreate=null,o._remoteStream=null,o._iceRestartTimeout=null,o._reconnectionTimeout=null,o._reconnectionPrevented=!1,o._fingerprint=null,o._neverConnected=!0,o._prevConsumerSettings={},o._signaling=r,o._mediaSource=i,o._participantId=t,o._isMaster=n,o._serverSettings=a,o.subscribe(o._signaling,"NOTIFICATION",o._onSignalingNotification.bind(o)),o.subscribe(o._mediaSource,"TRACK_REPLACED",o._onReplacedTrack.bind(o)),o.subscribe(o._mediaSource,"SOURCE_CHANGED",o._applySettings.bind(o)),o._pc=new RTCPeerConnection({iceServers:Vt.iceServers,iceTransportPolicy:Vt.forceRelayPolicy?"relay":"all"},{optional:[{googSuspendBelowMinBitrate:!1}]}),o._pc.onicecandidate=o._handleIceCandidate.bind(o),o._pc.ontrack=o._onAddTrack.bind(o),o._pc.oniceconnectionstatechange=o._onIceConnectionStateChange.bind(o),o._pc.onconnectionstatechange=o._onConnectionStateChange.bind(o),o._pc.onsignalingstatechange=o._onSignalingStateChange.bind(o),o._prevConsumerSettings={},o._isMaster){try{o._mediaSource.addTrackToPeerConnection(o._pc,!0),o._applySettings()}catch(e){return Un.log("callError","addTrack-direct"),Jt.error("Unable to add media source tracks",e,{participantId:o._participantId}),o._failedOnCreate=e,o}o._createOffer(!1).catch((function(e){"IDLE"===o._state?o._failedOnCreate=e:o.close(e)}))}return o._startSettingsInterval(),o._startStatInterval(),o}return Ze(t,e),t.prototype.getState=function(){return this._state},t.prototype.updateStatisticsInterval=function(){this._stopStatInterval();var e=this.getState();"IDLE"!==e&&"CLOSED"!==e&&"FAILED"!==e&&this._startStatInterval()},t.prototype.open=function(e){return void 0===e&&(e=null),et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:if(this._isOpen)return Jt.warn("DirectTransport: Already opened",{participantId:this._participantId}),[2];if(this._failedOnCreate&&this.close(this._failedOnCreate),Jt.debug("DirectTransport: Open transport",{participantId:this._participantId}),this._isOpen=!0,this._remotePeerId=e,!this._isMaster)try{this._mediaSource.addTrackToPeerConnection(this._pc,!0),this._applySettings()}catch(e){Un.log("callError","addTrack-direct"),Jt.error("DirectTransport: Unable to add media source tracks",e,{participantId:this._participantId}),this.close(e)}if(t=e,e||(n=Object.keys(this._remoteSDP),t=n[n.length-1]),!t||!this._remoteSDP[t])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._setRemoteDescription(t,this._remoteSDP[t])];case 2:return r.sent(),[3,4];case 3:return r.sent(),this.close(),[3,4];case 4:return this._remoteSDP={},this._remoteCandidates={},this._setState("OPENED"),this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL"),[2]}}))}))},t.prototype.updateSettings=function(e){xn(e,this._serverSettings)||(this._serverSettings=e,this._applySettings())},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.close=function(e){var t=this;this._isOpen=!1,this._stopReconnection(),this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop(),t._triggerEvent("REMOTE_TRACK_REMOVED",t._remoteStream,e)})),this._remoteStream=null),this._stopStatInterval(),this._stopSettingsInterval(),this._pc&&(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.oniceconnectionstatechange=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.close()),this.unsubscribe(),e?(Jt.error("DirectTransport: Closed",e,{participantId:this._participantId}),this._setState("FAILED")):(Jt.debug("DirectTransport: Closed",{participantId:this._participantId}),this._setState("CLOSED"))},t.prototype._setState=function(e){this._state!==e&&(Jt.debug("DirectTransport: State changed to "+e,{participantId:this._participantId}),this._state=e,this._triggerEvent("STATE_CHANGED",e),this._triggerEvent("LOCAL_STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){"transmitted-data"===e.notification&&this._handleTransmittedData(e)},t.prototype._handleTransmittedData=function(e){var t=e.data,n=$t.getPeerIdString(e.peerId);$t.composeMessageId(e)===this._participantId&&(t.candidate&&t.candidate.candidate?this._addIceCandidate(n,t.candidate).catch(this.close.bind(this)):t.sdp&&this._setRemoteDescription(n,t.sdp).catch(this.close.bind(this)))},t.prototype._addIceCandidate=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:if(!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc||!this._pc.remoteDescription)return[3,5];Jt.debug("Add remote ice candidate",{participantId:this._participantId,candidate:t}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._pc.addIceCandidate(new RTCIceCandidate(t))];case 2:return r.sent(),[3,4];case 3:throw n=r.sent(),Un.log("callError","addIceCandidate-direct"),Jt.error("Unable to add remote ice candidate",n,{participantId:this._participantId,candidate:t}),n;case 4:return[3,6];case 5:Jt.debug("Cache remote ice candidate",{participantId:this._participantId,candidate:t}),this._remoteCandidates[e]=this._remoteCandidates[e]||[],this._remoteCandidates[e].push(t),r.label=6;case 6:return[2]}}))}))},t.prototype._setRemoteCandidates=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:if(!this._remoteCandidates[e])return Jt.log("No cached candidates found for peer "+e),[2];t=this._remoteCandidates[e],this._remoteCandidates[e]=[],n=0,r=t,a.label=1;case 1:if(!(n<r.length))return[3,6];i=r[n],a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this._addIceCandidate(e,i)];case 3:case 4:return a.sent(),[3,5];case 5:return n++,[3,1];case 6:return[2]}}))}))},t.prototype._setRemoteDescription=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:if(!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc)return[3,6];Jt.debug("Add remote description",{participantId:this._participantId,sdp:t}),this._calcFingerprint(t.sdp),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this._pc.setRemoteDescription(new RTCSessionDescription(t))];case 2:return r.sent(),[4,this._setRemoteCandidates(e)];case 3:return r.sent(),[3,5];case 4:throw n=r.sent(),Un.log("callError","setRemoteDescription-direct"),Jt.error("Unable to set remote description",n,{participantId:this._participantId,sdp:t}),n;case 5:return[3,7];case 6:this._remoteSDP[e]=t,r.label=7;case 7:return[2]}}))}))},t.prototype._onAddTrack=function(e){var t=this;if(Jt.debug("Added remote track",{participantId:this._participantId}),!this._remoteStream){var n=e.streams[0];n.onremovetrack=function(e){t._triggerEvent("REMOTE_TRACK_REMOVED",n,e.track)},this._remoteStream=n}this._triggerEvent("REMOTE_TRACK_ADDED",this._remoteStream,e.track)},t.prototype._handleIceCandidate=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return e.candidate?(Jt.debug("Local ice candidate",{participantId:this._participantId,candidate:e.candidate}),[4,this._signaling.sendCandidate(this._participantId,e.candidate)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._onSignalingStateChange=function(){var e=this;switch(Jt.debug("DirectTransport: Signaling state changed to "+this._pc.signalingState,{participantId:this._participantId}),this._pc.signalingState){case"have-local-offer":var t=this._pc.localDescription;t?this._signaling.sendSdp(this._participantId,t).catch(this.close.bind(this)):this.close(new Error);break;case"have-remote-offer":this._createAnswer().catch(this.close.bind(this)).then((function(t){return et(e,void 0,void 0,(function(){return tt(this,(function(e){return[2,this._signaling.sendSdp(this._participantId,t)]}))}))})).catch(this.close.bind(this))}},t.prototype._onIceConnectionStateChange=function(){switch(Jt.debug("DirectTransport: Ice Connection state changed to "+this._pc.iceConnectionState,{participantId:this._participantId}),this._pc.iceConnectionState){case"checking":var e=this.getState();"IDLE"===e||"OPENED"===e?this._setState("CONNECTING"):this._setState("RECONNECTING")}},t.prototype._onConnectionStateChange=function(){switch(Jt.debug("DirectTransport: Connection state changed to "+this._pc.connectionState,{participantId:this._participantId}),Un.log("callIceConnectionState",this._pc.connectionState),this._pc.connectionState){case"connected":this._neverConnected=!1,this._setState("CONNECTED"),this._stopReconnection(),$t.getPeerConnectionHostInfo(this._pc).then((function(e){e&&Un.log("callIceConnectionType",e.type)}));break;case"failed":case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection "+this._pc.connectionState)):(this._setState("RECONNECTING"),this._startReconnection());break;case"closed":this.close(new Error("Ice connection closed"))}},t.prototype._startReconnection=function(){var e=this;this._reconnectionTimeout||this._iceRestartTimeout||(Jt.log("Waiting for reconnection...",{participantId:this._participantId}),this._reconnectionTimeout=window.setTimeout((function(){e._reconnectionTimeout=null,e._neverConnected?e._requestTopologySwitch():e._startIceRestart()}),Vt.transportConnectionWaitTime))},t.prototype._requestTopologySwitch=function(){this._isMaster&&(Jt.log("Switch topology DIRECT to SERVER",{participantId:this._participantId}),this._signaling.switchTopology("SERVER"))},t.prototype._stopReconnection=function(){this._reconnectionTimeout&&(clearTimeout(this._reconnectionTimeout),this._reconnectionTimeout=null),this._iceRestartTimeout&&(clearTimeout(this._iceRestartTimeout),this._iceRestartTimeout=null)},t.prototype._startIceRestart=function(){var e=this;this._isMaster?(Un.log("callIceRestart"),Jt.log("Ice restart",{participantId:this._participantId}),this._createOffer(!0).catch(this.close.bind(this))):Jt.debug("Waiting for ice restart...",{participantId:this._participantId}),this._iceRestartTimeout=window.setTimeout((function(){e._iceRestartTimeout=null,Jt.error("Ice restart failed",{participantId:e._participantId}),Un.log("callError","iceRestart-direct"),e._requestTopologySwitch()}),Vt.iceRestartWaitTime)},t.prototype._createOffer=function(e){return et(this,void 0,void 0,(function(){var n,r=this;return tt(this,(function(i){return n={iceRestart:e,offerToReceiveAudio:!0,offerToReceiveVideo:!0},Jt.debug("Create offer",{participantId:this._participantId,options:n}),[2,this._pc.createOffer(n).catch((function(e){throw Jt.error("Unable to create offer",e,{participantId:r._participantId}),Un.log("callError","createOffer-direct"),e})).then((function(e){return et(r,void 0,void 0,(function(){var n=this;return tt(this,(function(r){return Jt.debug("Created offer",{participantId:this._participantId,offer:e}),e=t._patchDescription(e),Jt.debug("Set local description",{participantId:this._participantId,offer:e}),this._calcFingerprint(e.sdp),[2,this._pc.setLocalDescription(e).then((function(){return n._pc.localDescription}))]}))}))})).catch((function(e){throw Jt.error("Unable to set local description",e,{participantId:r._participantId}),Un.log("callError","setLocalDescription-direct"),e}))]}))}))},t.prototype._createAnswer=function(){return et(this,void 0,void 0,(function(){var e=this;return tt(this,(function(n){return Jt.debug("Create answer",{participantId:this._participantId}),[2,this._pc.createAnswer().catch((function(t){throw Jt.error("Unable to create answer",t,{participantId:e._participantId}),Un.log("callError","createAnswer-direct"),t})).then((function(n){return et(e,void 0,void 0,(function(){return tt(this,(function(e){return Jt.debug("Created answer",{participantId:this._participantId,answer:n}),n=t._patchDescription(n),Jt.debug("Set local description",{participantId:this._participantId,answer:n}),this._calcFingerprint(n.sdp),[2,this._pc.setLocalDescription(n)]}))}))})).then((function(){return e._pc.localDescription})).catch((function(t){throw Jt.error("Unable to set local description",t,{participantId:e._participantId}),Un.log("callError","setLocalDescription-direct"),t}))]}))}))},t._patchDescription=function(e){return e.sdp=$t.patchSDP(e.sdp,Vt.preferH264&&Mn.canPreferH264(),Mn.isBrokenH264(),Vt.preferVP9),e},t.prototype._onReplacedTrack=function(e){var t=this;this._pc&&(this._pc.getSenders().forEach((function(n){n.track&&n.track.kind===e.kind&&(n.track.enabled=e.enabled,n.replaceTrack(e).catch((function(e){Jt.error("DirectTransport: Unable to replace track",e,{participantId:t._participantId}),Un.log("callError","replaceTrack-direct")})))})),this._applySettings())},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?ar(e._pc,e._lastStat,{}).then((function(n){e._lastStat=n;var r={inbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(t){return"inbound-rtp"===t.type&&(t.userId=e._participantId,!0)}))},outbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(e){return"outbound-rtp"===e.type}))}};e._triggerEvent("REMOTE_DATA_STATS",r),e._statInterval=window.setTimeout(t,Vt.statisticsInterval)})):e._stopStatInterval()};this._statInterval=window.setTimeout(t,Vt.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null)},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._pc?(e._applySettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._calcFingerprint=function(e){var t=$t.sdpFingerprint(e);null===this._fingerprint?this._fingerprint=t:(Qt.onFingerprintChange(this._fingerprint.xor(t).toString()),this._fingerprint=null)},t.prototype._applySettings=function(){var e=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;e&&this._pc&&(this._prevConsumerSettings=$t.applySettings(this._pc,e,this._prevConsumerSettings))},t}(st),sr=function(){function e(){this.compactedIds=new Map,this.reversedMap=new Map}return e.prototype.getId=function(e){return this.reversedMap.get(e)},e.prototype.getCompactedId=function(e){return this.compactedIds.get(e)},e.prototype.handleMessage=function(e){var t=this,n=new Uint8Array(e),r=n[0],i=n.subarray(1);switch(r){case 1:var a=qe(i);return Object.entries(a).forEach((function(e){var n=e[0],r=e[1];t.compactedIds.set(n,r),t.reversedMap.set(r,n)})),null;case 2:case 4:for(var o=[],s=0,c=qe(i);s<c.length;s++){var u=c[s],l=this.getId(u);l&&o.push(l)}return 2===r?{type:"notification",notification:"audio-activity",activeParticipants:o}:{type:"notification",notification:"stalled-activity",stalledParticipants:o};case 3:var d=qe(i);return{type:"notification",notification:"speaker-changed",speaker:this.getId(d)};case 5:var p=qe(i);return{type:"notification",notification:"video-quality-update",quality:{maxBitrate:p[0],maxDimension:p[1]}};case 6:for(var h=qe(i),f={},m=0,v=Object.entries(h);m<v.length;m++){var _=v[m],g=_[0],A=_[1],y=this.getId(Number(g));y&&(f[y]=A/100)}return{type:"notification",notification:"network-status",statuses:f};case 7:return this._createParticipantSourcesUpdateNotification(i);default:return Jt.debug("unsupported message type: "+r),null}},e.prototype._createParticipantSourcesUpdateNotification=function(e){var t=this,n=qe(e),r=[];return $t.iterateInTriplets(n,(function(e,n,i){if(null!==e){var a=t.getId(e);if(a){var o=null!==n?"pat-"+n:null,s=(null!=i?i:0)>>>0;r.push({participantId:a,streamId:o,rtpTimestamp:s})}else Jt.error("could not uncompress participant ID "+e)}else Jt.error("compressed participant ID is null")})),{type:"notification",notification:"participant-sources-update",participantUpdateInfos:r}},e}();function cr(e){return"https://st.mycdn.me/static/callssdk/libvpx-wasm-static/"+e+"?7e0ad362f1a"}var ur=function(){function e(){this._worker=null}return e.prototype._createWorker=function(e,t,n,r,i){return void 0===n&&(n=[]),void 0===r&&(r={}),void 0===i&&(i=[]),et(this,void 0,void 0,(function(){var a=this;return tt(this,(function(o){return[2,new Promise((function(o,s){var c=n.join(","),u=new Blob(["("+e+")("+c+");"],{type:"application/javascript; charset=utf-8"}),l=window.URL.createObjectURL(u);a._worker=new Worker(l),a._worker.onmessage=function(e){switch(e.data.type){case"ready":o();break;case"error":s(e.data.error);break;case"frame":t(e.data);break;case"debug":Jt.debug(e.data.message)}},a._sendToWorker("init",r,i)}))]}))}))},e.prototype._removeWorker=function(){var e;null===(e=this._worker)||void 0===e||e.terminate(),this._worker=null},e.prototype._sendToWorker=function(e,t,n){var r;void 0===t&&(t={}),void 0===n&&(n=[]),null===(r=this._worker)||void 0===r||r.postMessage(Object.assign({type:e},t),n)},e._workerFunction=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},e.isBrowserSupported=function(){throw new Error("Not implemented")},e}();function lr(e,t){var n=null,r=null,i=!0,a=this;e({locateFile:t}).then((function(e){return r=e})).then((function(){a.onmessage=function(e){switch(e.data.type){case"frame":!function(e,t,o,s){if(!r)return Un.log("callError","decoder-init-fail-libvpx"),void a.postMessage({type:"frame",error:"Fatal initialization error"});if(i!==o&&(i=o,n&&(n=null,a.postMessage({type:"debug",message:"LibVPxDecoder codec changed to "+(o?"VP9":"VP8")+" - reinitialize"}))),!n&&(a.postMessage({type:"debug",message:"LibVPxDecoder codec "+(o?"VP9":"VP8")}),!(n=new r.VpxDecoder).init(o?r.VpxType.VP9:r.VpxType.VP8)))return n=null,void a.postMessage({type:"frame",error:"Decoder failed to create"});try{n.allocateBuffer(t.byteLength).set(new Uint8Array(t))}catch(e){return a.postMessage({type:"debug",message:e}),n=null,void a.postMessage({type:"frame",error:String(e)})}if(n.decode()&&n.nextImage()){var c=n.getImageBuffer();if(c){var u=n.getImageWidth(),l=n.getImageHeight();n.nextImage()&&(Jt.warn("LibVPxDecoder dropped frame"),Un.log("callError","LibVPxDecoder-drop"));var d=new Uint8ClampedArray(c.byteLength);if(d.set(c),s){var p=new ImageData(d,u,l);createImageBitmap(p,0,0,u,l).then((function(e){a.postMessage({type:"frame",data:e},[e]),e.close()}))}else a.postMessage({type:"frame",data:d.buffer,width:u,height:l},[d.buffer])}else a.postMessage({type:"frame",error:"No decoded data"})}else a.postMessage({type:"frame",error:"Decode failed"})}(e.data.timestamp,e.data.data,e.data.isVP9,e.data.useImageBitmap)}},a.postMessage({type:"ready"})})).catch((function(e){a.postMessage({type:"error",error:String(e)})}))}var dr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ze(t,e),t.prototype.init=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return Jt.debug("LibVPxDecoder started"),[4,this._createWorker(lr,(function(t){if(t.error)Jt.warn("LibVPxDecoder",t.error);else if(t.data instanceof ArrayBuffer){var n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);e(n)}else e(t.data)}),[Ye.a,cr])];case 1:return t.sent(),[2]}}))}))},t.prototype.decodeFrame=function(e,t,n,r){var i="ImageBitmap"in window;this._sendToWorker("frame",{timestamp:e,data:t.buffer,isVP9:n,keyFrame:r,useImageBitmap:i},[t.buffer])},t.prototype.destroy=function(){this._removeWorker(),Jt.debug("LibVPxDecoder destroyed")},t.isBrowserSupported=function(){return"WebAssembly"in window&&"Worker"in window},t}(ur),pr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ze(t,e),t.prototype.init=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return Jt.debug("WebCodecsDecoder started"),[4,this._createWorker(t._workerFunction,(function(t){t.error?Jt.warn("WebCodecsDecoder",t.error):e(t.data)}))];case 1:return n.sent(),[2]}}))}))},t._workerFunction=function(){var e=this,t=null,n=!0;e.onmessage=function(r){switch(r.data.type){case"init":e.postMessage({type:"ready"});break;case"frame":!function(r,i,a,o){void 0===o&&(o=!1),t&&n===a||(n=a,t?e.postMessage({type:"debug",message:"WebCodecsDecoder codec changed to "+(a?"VP9":"VP8")}):(e.postMessage({type:"debug",message:"WebCodecsDecoder codec "+(a?"VP9":"VP8")}),t=new VideoDecoder({output:function(t){t.createImageBitmap().then((function(t){e.postMessage({type:"frame",data:t},[t]),t.close()})).finally((function(){return t.close()}))},error:function(n){t&&"closed"!==t.state&&t.close(),t=null,e.postMessage({type:"frame",error:"WebCodecsDecoder failed, reinitialize"})}})),t.configure({codec:a?"vp09.00.50.08":"vp8"}));var s=new EncodedVideoChunk({type:o?"key":"delta",timestamp:r,data:i});t.decode(s)}(r.data.timestamp,r.data.data,r.data.isVP9,r.data.keyFrame)}}},t.prototype.decodeFrame=function(e,t,n,r){void 0===r&&(r=!1),this._sendToWorker("frame",{timestamp:e,data:t.buffer,isVP9:n,keyFrame:r},[t.buffer])},t.prototype.destroy=function(){this._removeWorker(),Jt.debug("WebCodecsDecoder destroyed")},t.isBrowserSupported=function(){return"VideoDecoder"in window&&"Worker"in window&&"VideoFrame"in window&&"ImageBitmap"in window},t}(ur),hr=function(){function e(e,t){var n=this;this._decoderReady=!1,this._decoderQueue=[],this._chunks=[],this._onStream=function(){},this._canvas=null,this._canvasContext=null,this._stream=null,this._track=null,Jt.debug("StreamBuilder started for participant ["+e+"]"),this._participantId=e,this._onStream=t,this._useImageBitmap="ImageBitmap"in window,pr.isBrowserSupported()?this._decoder=new pr:this._decoder=new dr,this._decoder.init((function(e){return n._drawImage(e)})).then((function(){n._decoderReady=!0,n._decodeQueue()}))}return e.prototype._createStream=function(e,t){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.style.bottom="0",this._canvas.style.right="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas),this._useImageBitmap?this._canvasContext=this._canvas.getContext("bitmaprenderer"):this._canvasContext=this._canvas.getContext("2d"),this._stream=this._canvas.captureStream(0),this._track=this._stream.getVideoTracks()[0],this._track.contentHint="text")},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._canvasContext=null;try{this._canvas&&document.body.removeChild(this._canvas)}catch(e){}this._canvas=null},e.prototype._processFrameData=function(){for(var e=new Uint8Array,t=0,n=this._chunks;t<n.length;t++){var r=n[t],i=new Uint8Array(e.byteLength+r.data.byteLength);i.set(new Uint8Array(e),0),i.set(new Uint8Array(r.data),e.byteLength),e=i}return this._chunks=[],e},e.prototype._requestCanvasFrame=function(){this._track&&this._track.requestFrame?this._track.requestFrame():this._stream&&this._stream.requestFrame&&this._stream.requestFrame()},e.prototype._drawImage=function(e){this._track||(this._createStream(e.width,e.height),this._onStream(this._stream));var t,n=this._canvas;n.width=e.width,n.height=e.height,e instanceof ImageData?((t=this._canvasContext).clearRect(0,0,n.width,n.height),t.putImageData(e,0,0)):(t=this._canvasContext).transferFromImageBitmap(e),this._requestCanvasFrame()},e.prototype._decodeFrame=function(e){!this._decoderReady||this._decoderQueue.length?(this._decoderQueue.push(e),this._decodeQueue()):this._decoder.decodeFrame(e.timestamp,e.frameData,e.isVP9,e.keyframe)},e.prototype._decodeQueue=function(){var e=this;if(this._decoderReady){var t=this._decoderQueue;this._decoderQueue=[],t.forEach((function(t){e._decoder.decodeFrame(t.timestamp,t.frameData,t.isVP9,t.keyframe)}))}},e.prototype.appendChunk=function(e){var t=this._chunks.length;if(e.start)t&&(Jt.warn("[FrameBuilder] Cleanup buffer",Array.prototype.slice.call(this._chunks)),this._chunks=[]);else if(!t||(this._chunks[t-1].sequence+1)%65536!==e.sequence)return void Jt.warn("[FrameBuilder] Got incorrect chunk");if(this._chunks.push(e),e.end){var n=this._processFrameData();this._decodeFrame({timestamp:e.timestamp,frameData:n,isVP9:e.isVP9,keyframe:e.keyframe})}},e.prototype.destroy=function(){this._decoder.destroy(),this._removeStream(),this._chunks=[],Jt.debug("StreamBuilder destroyed for participant "+this._participantId)},e}(),fr=function(){function e(e,t,n,r){var i=this;this._participantIdRegistry=null,this._streamBuilders={},this._onStream=function(){},this._onEos=function(){},Jt.debug("ScreenCaptureReceiver started"),this._datachannel=e,this._participantIdRegistry=t,this._onStream=n,this._onEos=r,this._datachannel.onmessage=function(e){return i._onDataChannelMessage(e.data)}}return e.prototype._onDataChannelMessage=function(e){var t,n=this,r=function(e){var t=new DataView(e),n=t.getUint8(0),r=t.getUint16(1),i=t.getUint32(3),a=1===t.getUint8(7),o=t.getUint16(8),s=t.getUint8(10),c=!!(1&s),u=!!(2&s),l=!!(4&s),d=!!(8&s);if(1!==n)throw new Error("Unexpected protocol version. Got "+n+", expected 1");return{timestamp:i,start:c,end:u,keyframe:l,sequence:r,isVP9:a,ssrc:o,eos:d,data:e.slice(11)}}(e),i=null===(t=this._participantIdRegistry)||void 0===t?void 0:t.getId(r.ssrc);if(i){if(r.eos)return this.close(i),void this._onEos(i);var a=this._streamBuilders[i];a||(a=new hr(i,(function(e){return n._onStream(i,e)})),this._streamBuilders[i]=a),a.appendChunk(r)}else Jt.warn("Participant id for ssrc "+r.ssrc+" not found in registry")},e.prototype.close=function(e){var t=this._streamBuilders[e];t&&(t.destroy(),delete this._streamBuilders[e])},e.prototype.destroy=function(){this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null,this._onStream=function(){},Object.values(this._streamBuilders).forEach((function(e){return e.destroy()})),this._streamBuilders={},this._participantIdRegistry=null,Jt.debug("ScreenCaptureReceiver destroyed")},e.isBrowserSupported=function(){return(pr.isBrowserSupported()||dr.isBrowserSupported())&&("CanvasCaptureMediaStream"in window||"CanvasCaptureMediaStreamTrack"in window)},e}(),mr=function(e){function t(t){var n=e.call(this)||this;return n._video=null,n._imageCapture=null,n._canvas=null,n._canvasCtx=null,n._stream=null,n._track=null,n._processing=null,n._sourceTrack=t,n._useImageCapture="ImageCapture"in window&&"ImageBitmap"in window,n}return Ze(t,e),t.prototype._createDom=function(){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.style.bottom="0",this._canvas.style.right="160px",this._canvas.style.zIndex="5000",this._canvasCtx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)),this._video||this._useImageCapture||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},t.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvasCtx=null,this._canvas=null,this._video=null},t.prototype._createStream=function(e){return et(this,void 0,void 0,(function(){var t=this;return tt(this,(function(n){if(!this._canvas)throw new Error("Canvas not found");if(!this._video&&!this._useImageCapture)throw new Error("Video element not found");return this._stream=this._canvas.captureStream(0),this._track=this._stream.getVideoTracks()[0],[2,new Promise((function(n,r){if(t._useImageCapture)t._imageCapture=new ImageCapture(e),n();else{var i=t._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(e){return n()},i.onerror=function(){return r(new Error("Video element error"))};var a=i.play(),o=function(){return r(new Error("Autoplay is disabled"))};a?a.catch(o):o()}}))]}))}))},t.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),this._video.srcObject=null),this._imageCapture&&(this._imageCapture=null)},t.prototype._drawFrameVideo=function(){if(!(this._canvas&&this._canvasCtx&&this._video&&this._track))throw new Error("Fatal error");var e=this._video.videoWidth,t=this._video.videoHeight;return this._canvas.width=this._video.width=e,this._canvas.height=this._video.height=t,this._canvasCtx.clearRect(0,0,e,t),this._canvasCtx.drawImage(this._video,0,0,e,t),this._requestCanvasFrame(),this._canvasCtx.getImageData(0,0,e,t)},t.prototype._drawFrameBitmap=function(){var e;return et(this,void 0,void 0,(function(){var t,n,r;return tt(this,(function(i){switch(i.label){case 0:if(!(this._canvas&&this._canvasCtx&&this._track&&this._imageCapture))throw new Error("Fatal error");return[4,this._imageCapture.grabFrame()];case 1:return t=i.sent(),n=t.width,r=t.height,this._canvas.width=n,this._canvas.height=r,this._canvasCtx.clearRect(0,0,n,r),this._canvasCtx.drawImage(t,0,0,n,r),this._requestCanvasFrame(),[2,null===(e=this._canvasCtx)||void 0===e?void 0:e.getImageData(0,0,n,r)]}}))}))},t.prototype._requestCanvasFrame=function(){this._track&&this._track.requestFrame?this._track.requestFrame():this._stream&&this._stream.requestFrame&&this._stream.requestFrame()},t.prototype.init=function(){return et(this,void 0,void 0,(function(){var e,n,r=this;return tt(this,(function(i){switch(i.label){case 0:return this._createDom(),e=this._sourceTrack.getSettings().width,n=this._sourceTrack.getSettings().height,Jt.debug("LibVPxEncoder started "+e+"x"+n+", codec "+(this.isVP9()?"VP9":"VP8")),[4,this._createStream(this._sourceTrack)];case 1:return i.sent(),[4,this._createWorker(t._workerFunction,(function(e){r._processing&&(e.error?r._processing.reject(e.error):r._processing.resolve({type:e.frameType,timestamp:e.timestamp,duration:e.duration,data:e.data}),r._processing=null)}),[Ye.a,cr],{isVP9:this.isVP9()})];case 2:return i.sent(),[2]}}))}))},t._workerFunction=function(e,t){var n,r=this;r.onmessage=function(i){switch(i.data.type){case"init":(a=i.data.isVP9,e({locateFile:t}).then((function(e){if(!(n=new e.VpxEncoder).init(a?e.VpxType.VP9:e.VpxType.VP8))throw Un.log("callError","encoder-init-fail-libvpx"),new Error("LibVPxEncoder failed to create");n.setMaxQuantizer(10),n.setTargetBitrate(1024)}))).then((function(){return r.postMessage({type:"ready"})})).catch((function(e){return r.postMessage({type:"error",error:String(e)})}));break;case"frame":!function(e,t,i,a){var o=n.allocateImage(e,t);if(o){o.set(new Uint8Array(i));var s=Math.round(performance.now());if(n.encode(s,150,a)){var c=n.readFrame();if(c){n.readFrame()&&(Jt.warn("LibVPxEncoder dropped frame"),Un.log("callError","LibVPxEncoder-drop"));var u=new Uint8Array(c.byteLength);u.set(c),r.postMessage({type:"frame",frameType:a?"key":"delta",timestamp:s,duration:150,data:u.buffer},[u.buffer])}else r.postMessage({type:"frame",error:"No encoded data"})}else r.postMessage({type:"frame",error:"Encode failed"})}else r.postMessage({type:"frame",error:"No buffer data"})}(i.data.width,i.data.height,i.data.imageData,i.data.keyFrame)}var a}},t.prototype.requestFrame=function(e){return void 0===e&&(e=!1),et(this,void 0,void 0,(function(){var t,n,r=this;return tt(this,(function(i){switch(i.label){case 0:if(this._processing)throw new Error("Encoder is busy");return this._useImageCapture?[4,this._drawFrameBitmap()]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n=this._drawFrameVideo(),i.label=3;case 3:return t=n,[2,new Promise((function(n,i){var a=t.data.buffer;r._sendToWorker("frame",{width:t.width,height:t.height,imageData:a,keyFrame:e},[a]),r._processing={resolve:n,reject:i,keyFrame:e}}))]}}))}))},t.prototype.isVP9=function(){return!1},t.prototype.destroy=function(){this._processing=null,this._removeWorker(),this._removeStream(),this._removeDom(),Jt.debug("LibVPxEncoder destroyed")},t.isBrowserSupported=function(){return"WebAssembly"in window&&"Worker"in window&&("CanvasCaptureMediaStream"in window||"CanvasCaptureMediaStreamTrack"in window)},t}(ur),vr=function(e){function t(t){var n=e.call(this)||this;return n._processing=null,n._sourceTrack=t,n._trackProcessor=new MediaStreamTrackProcessor(t),n}return Ze(t,e),t.prototype.init=function(){return et(this,void 0,void 0,(function(){var e,n,r,i=this;return tt(this,(function(a){switch(a.label){case 0:return e=this._sourceTrack.getSettings().width,n=this._sourceTrack.getSettings().height,r=this._trackProcessor.readable,Jt.debug("WebCodecsEncoder started "+e+"x"+n+", codec "+(this.isVP9()?"VP9":"VP8")),[4,this._createWorker(t._workerFunction,(function(e){i._processing&&(e.error?i._processing.reject(e.error):i._processing.resolve({type:e.frameType,timestamp:e.timestamp,duration:e.duration,data:e.data}),i._processing=null)}),[],{readable:r,width:e,height:n,isVP9:this.isVP9(),framerate:Vt.screenFrameRate},[r])];case 1:return a.sent(),[2]}}))}))},t._workerFunction=function(){var e,t,n,r,i,a,o=this,s=!1,c=new VideoEncoder({output:function(e){o.postMessage({type:"frame",frameType:e.type,timestamp:e.timestamp,duration:e.duration,data:e.data},[e.data]),s=!1},error:function(e){o.postMessage({type:"frame",error:String(e)}),s=!1}});o.onmessage=function(u){switch(u.data.type){case"init":d=u.data,e=d.readable,t=e.getReader(),n=d.width,r=d.height,i=d.isVP9,a=d.framerate,c.configure({framerate:a,codec:i?"vp09.00.50.08":"vp8",width:n,height:r}),o.postMessage({type:"ready"});break;case"frame":l=u.data.keyFrame,t.read().then((function(o){var u=o.done,d=o.value;if(!u&&d){if(!c)return t.releaseLock(),e.cancel(),void d.close();s||(s=!0,d.codedWidth===n&&d.codedHeight===r||(n=d.codedWidth,r=d.codedHeight,c.configure({framerate:a,codec:i?"vp09.00.50.08":"vp8",width:n,height:r})),c.encode(d,{keyFrame:l})),d.close()}}))}var l,d}},t.prototype.requestFrame=function(e){return void 0===e&&(e=!1),et(this,void 0,void 0,(function(){var t=this;return tt(this,(function(n){if(this._processing)throw new Error("Encoder is busy");return[2,new Promise((function(n,r){t._sendToWorker("frame",{keyFrame:e}),t._processing={resolve:n,reject:r,keyFrame:e}}))]}))}))},t.prototype.isVP9=function(){return!0},t.prototype.destroy=function(){this._removeWorker(),this._processing=null,Jt.debug("WebCodecsEncoder destroyed")},t.isBrowserSupported=function(){return"VideoEncoder"in window&&"Worker"in window&&"EncodedVideoChunk"in window&&"MediaStreamTrackProcessor"in window},t}(ur),_r=0,gr=function(){function e(e,t){var n=this;this._destroyed=!1,this._needKeyframe=!0,Jt.debug("ScreenCaptureSender started"),this._datachannel=t,vr.isBrowserSupported()?this._encoder=new vr(e):this._encoder=new mr(e),this._datachannel.onmessage=function(e){(function(e){if(!e||!e.byteLength||4!==e.byteLength)return!1;var t=new DataView(e);return 1===t.getUint8(0)&&1===t.getUint8(1)&&0===t.getUint16(2)})(e.data)&&(Jt.debug("["+n._datachannel.label+"] Requested keyframe"),n._needKeyframe=!0)},this._encoder.init().then((function(){return n._loopFn()})).catch((function(e){return Jt.warn("ScreenCaptureSender init failed",e)}))}return e.prototype._loopFn=function(){return et(this,void 0,void 0,(function(){var e,t,n;return tt(this,(function(r){switch(r.label){case 0:if(this._destroyed)return[2];r.label=1;case 1:return r.trys.push([1,4,,6]),e=this._needKeyframe,this._needKeyframe=!1,[4,this._encoder.requestFrame(e)];case 2:return t=r.sent(),[4,this._send(t)];case 3:return r.sent(),[3,6];case 4:return n=r.sent(),Jt.warn("requestFrame failed",n),[4,$t.delay(100)];case 5:return r.sent(),[3,6];case 6:return[2,this._loopFn()]}}))}))},e.prototype._wrapHeader=function(e,t,n,r,i){var a=function(e,t,n,r,i,a,o){var s=0;t&&(s|=1),n&&(s|=2),r&&(s|=4),o||(s|=8);var c=new ArrayBuffer(11),u=new DataView(c);if(u.setUint8(0,1),u.setUint16(1,i),u.setUint32(3,e),u.setUint8(7,a?1:0),u.setUint16(8,0),u.setUint8(10,s),!o)return c;var l=new Uint8Array(c.byteLength+o.byteLength);return l.set(new Uint8Array(c),0),l.set(new Uint8Array(o),c.byteLength),l.buffer}(e,t,n,r,_r,this._encoder.isVP9(),i);return _r=(_r+1)%65536,a},e.prototype._stopPacket=function(){return this._wrapHeader(Date.now(),!1,!1,!1,null)},e.prototype._send=function(e){return et(this,void 0,void 0,(function(){var t=this;return tt(this,(function(n){return[2,new Promise((function(n,r){t._sendChunk(e,0,n,r)}))]}))}))},e.prototype._sendChunk=function(e,t,n,r){var i=this;if(this._datachannel&&"open"===this._datachannel.readyState){var a=e.data.slice(t,t+16373),o=e.data.byteLength<=t+a.byteLength,s=this._wrapHeader(e.timestamp,!t,o,"key"===e.type,a);this._datachannel.onbufferedamountlow=o?function(){i._datachannel.bufferedAmount<=i._datachannel.bufferedAmountLowThreshold&&n()}:null;try{this._datachannel.send(s)}catch(e){return Jt.warn("Error send data to DataChannel",e),void r()}o||setTimeout((function(){return i._sendChunk(e,t+16373,n,r)}),0)}else r()},e.prototype.destroy=function(){this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null,"open"===this._datachannel.readyState&&this._datachannel.send(this._stopPacket()),this._destroyed=!0,this._encoder.destroy(),Jt.debug("ScreenCaptureSender destroyed")},e.isBrowserSupported=function(){return vr.isBrowserSupported()||mr.isBrowserSupported()},e}(),Ar=function(e){function t(t,n){var r=e.call(this)||this;return r._previousTimestamp=0,r._renderDropRate=0,r._signaling=n,r.subscribe(t,"REMOTE_DATA_STATS",r._handleStats.bind(r)),r}return Ze(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.getEstimatedPerformanceIndex=function(){try{var e=parseInt(localStorage.getItem("videochat-epi")||"",10);return isNaN(e)?0:e}catch(e){return 0}},t.prototype._handleStats=function(e){return et(this,void 0,void 0,(function(){var t,n,r;return tt(this,(function(i){switch(i.label){case 0:if(!Vt.perfStatReportEnabled)return[2];if(!e.inbound||!e.inbound.rtps)return[2];if(t=e.inbound.rtps.filter((function(e){return"video"===e.kind})).map((function(e){return{framesDecoded:e.framesDecoded||0,framesReceived:e.framesReceived||0}})).reduce((function(e,t){return e.framesDecoded+=t.framesDecoded,e.framesReceived+=t.framesReceived,e}),{framesDecoded:0,framesReceived:0}),n=Date.now(),this._renderDropRate&&(t.renderDropRate=this._renderDropRate),this._previousTimestamp+5e3>n)return[2];if(!t.framesDecoded&&!t._renderDropRate)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._signaling.reportPerfStat(t)];case 2:return r=i.sent(),localStorage.setItem("videochat-epi",r.estimatedPerformanceIndex),[3,4];case 3:return i.sent(),[3,4];case 4:return this._previousTimestamp=n,[2]}}))}))},t.prototype._onUIPerformanceStatistics=function(e){if(e.decoded){var t=e.dropped/(e.decoded+e.dropped);this._renderDropRate=.2*t+.8*this._renderDropRate}},t}(st),yr={iceRestart:!1,offerToReceiveAudio:!1,offerToReceiveVideo:!1},Er=function(e){function t(t,n,r){var i=e.call(this)||this;return i._consumer=null,i._producer=null,i._producerNotification=null,i._producerCommand=null,i._producerScreen=null,i._consumerScreen=null,i._isOpen=!1,i._reconnectionPrevented=!1,i._state={},i._statInterval=null,i._settingsInterval=null,i._statBytes={},i._ssrcMap={},i._producerOfferIsProcessing=!1,i._producerNextOffer=null,i._prevConsumerSettings={},i._hasAudioMix=!1,i._captureSender=null,i._captureReceiver=null,i._participantIdRegistry=null,i._disabledSenders=new Set,i._signaling=t,i._mediaSource=n,i._state.consumer="IDLE",i._state.producer="IDLE",i._signaling&&i._mediaSource&&(i.subscribe(i._signaling,"NOTIFICATION",i._onSignalingNotification.bind(i)),i.subscribe(i._mediaSource,"TRACK_REPLACED",i._onReplacedTrack.bind(i)),i.subscribe(i._mediaSource,"SOURCE_CHANGED",i._applyConsumerSettings.bind(i)),i.subscribe(i._mediaSource,"SCREEN_STATUS",i._onScreenSharingStatus.bind(i))),i._interop=new ye.Interop,i._perfStatReporter=new Ar(i,t),i._serverSettings=r,Vt.consumerScreenDataChannel&&!gr.isBrowserSupported()&&(Vt.consumerScreenDataChannel=!1),Vt.producerScreenDataChannel&&!fr.isBrowserSupported()&&(Vt.producerScreenDataChannel=!1),Jt.debug("ServerTransport: Created"),i}return Ze(t,e),t.prototype.getState=function(){return this._getState("producer")},t.prototype.getLocalState=function(){return this._getState("consumer")},t.prototype.updateStatisticsInterval=function(){this._stopStatInterval();var e=this._getState("producer");"IDLE"!==e&&"CLOSED"!==e&&"FAILED"!==e&&this._startStatInterval()},t.prototype.open=function(){this._isOpen?Jt.log("ServerTransport: Already opened connections"):(this._isOpen=!0,this._openConnection("producer"),this._openConnection("consumer"))},t.prototype.close=function(e){this._isOpen=!1,this._closeConnection("producer"),this._closeConnection("consumer"),this.unsubscribe(),e?(Jt.error("ServerTransport: Closed",e),this._setState("FAILED","consumer"),this._setState("FAILED","producer")):(Jt.debug("ServerTransport: Closed"),this._setState("CLOSED","consumer"),this._setState("CLOSED","producer"))},t.prototype.removeParticipant=function(e){var t;null===(t=this._captureReceiver)||void 0===t||t.close(e)},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.updateSettings=function(e){xn(e,this._serverSettings)||(this._serverSettings=e,this._applyConsumerSettings())},t.prototype._closeConnection=function(e){this._stopStatInterval(),this._stopSettingsInterval(),"producer"===e&&this._producer&&(this._removeCaptureReceiver(),this._producer.ontrack=null,this._producer.onconnectionstatechange=null,this._producer.onsignalingstatechange=null,t._closeDataChannel(this._producerNotification),this._participantIdRegistry=null,t._closeDataChannel(this._producerCommand),t._closeDataChannel(this._producerScreen),this._producer.close(),this._producer=null,this._producerOfferIsProcessing=!1,this._producerNextOffer=null,this._interop=new ye.Interop),"consumer"===e&&this._consumer&&(this._disabledSenders.forEach((function(e){var t;return null===(t=e.track)||void 0===t?void 0:t.stop()})),this._disabledSenders.clear(),this._removeCaptureSender(),this._consumer.ontrack=null,this._consumer.onconnectionstatechange=null,this._consumer.onsignalingstatechange=null,t._closeDataChannel(this._consumerScreen),this._consumer.close(),this._consumer=null)},t._closeDataChannel=function(e){e&&(e.onopen=null,e.onmessage=null,e.onerror=null,e.close())},t.prototype._createDataChannel=function(e,t,n){Jt.debug("["+t+"] data channel opening");var r=e.createDataChannel(t,{ordered:!0});r.onopen=function(){Jt.debug("["+t+"] data channel opened"),r.onerror=function(e){Jt.error("["+t+"] data channel error",e)},n(r)}},t.prototype._openConnection=function(e){var n,r=this;Jt.debug("ServerTransport: Open connection for "+e);var i={};if(Mn.baseChromeVersion()&&(i.sdpSemantics=t._isUnifiedPlanSupported()?"unified-plan":"plan-b"),"producer"===e&&(this._producer=new RTCPeerConnection(i,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._producer.ontrack=this._onAddTrack.bind(this,this._producer,"producer"),this._producer.onconnectionstatechange=$t.throttle((function(e){r._producer&&r._onConnectionStateChange(r._producer,"producer",e)}),500),this._producer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._producer,"producer"),Vt.producerNotificationDataChannel&&this._createDataChannel(this._producer,"producerNotification",(function(e){r._producerNotification=e,r._producerNotification.binaryType="arraybuffer",r._participantIdRegistry=new sr,r._signaling.setParticipantIdRegistry(r._participantIdRegistry),r._signaling.setProducerNotificationDataChannel(e)})),Vt.producerCommandDataChannel&&this._createDataChannel(this._producer,"producerCommand",(function(e){r._producerCommand=e,r._signaling.setProducerCommandDataChannel(e)})),Vt.producerScreenDataChannel&&this._createDataChannel(this._producer,"producerScreenShare",(function(e){r._producerScreen=e,r._producerScreen.binaryType="arraybuffer",r._createCaptureReceiver()})),this._setState("OPENED","producer")),"consumer"===e){this._consumer=new RTCPeerConnection(i,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._consumer.ontrack=this._onAddTrack.bind(this,this._consumer,"consumer"),this._consumer.onconnectionstatechange=this._onConnectionStateChange.bind(this,this._consumer,"consumer"),this._consumer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._consumer,"consumer");try{this._mediaSource.addTrackToPeerConnection(this._consumer),this._prevConsumerSettings={},this._applyConsumerSettings()}catch(e){return Jt.error("ServerTransport: Unable to add media source tracks",e),Un.log("callError","addTrack-consumer"),void this.close(e)}var a=null===(n=this._mediaSource.getStream())||void 0===n?void 0:n.getVideoTracks()[0];Vt.consumerScreenDataChannel&&a&&this._createDataChannel(this._consumer,"consumerScreenShare",(function(e){r._consumerScreen=e,r._consumerScreen.binaryType="arraybuffer",r._createCaptureSender(a)})),this._allocateConsumer(),this._setState("OPENED","consumer")}this._startStatInterval(),this._startSettingsInterval()},t.prototype._reconnect=function(e){this._setState("RECONNECTING",e),this._closeConnection(e),this._openConnection(e)},t.prototype._signalActiveParticipants=function(e){this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._signalStalledParticipants=function(e){this._triggerEvent("SIGNALLED_STALLED_PARTICIPANTS",e)},t.prototype._signalSpeakerChanged=function(e){this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._signalNetworkStatus=function(e){this._triggerEvent("SIGNALLED_NETWORK_STATUS",e)},t.prototype._updateSSRCMap=function(e){var t=this;e&&e.sdp.split("\n").forEach((function(e){var n=/a=ssrc:([0-9]+) label:(audio|video)-((?:[ug]?[\d]+)|(?:mix))/.exec(e);n&&(t._ssrcMap[n[1]]=n[3])}))},t.prototype._createCaptureSender=function(e){e&&Vt.consumerScreenDataChannel&&this._consumerScreen&&this._mediaSource.getMediaSettings().isScreenSharingEnabled&&(this._captureSender&&this._removeCaptureSender(),this._captureSender=new gr(e,this._consumerScreen))},t.prototype._removeCaptureSender=function(){var e;null===(e=this._captureSender)||void 0===e||e.destroy(),this._captureSender=null},t.prototype._createCaptureReceiver=function(){var e=this;Vt.producerScreenDataChannel&&this._producerScreen&&this._participantIdRegistry&&(this._captureReceiver&&this._removeCaptureReceiver(),this._captureReceiver=new fr(this._producerScreen,this._participantIdRegistry,(function(t,n){e._triggerEvent("REMOTE_STREAM_SECOND",t,n)}),(function(t){e._triggerEvent("REMOTE_STREAM_SECOND",t,null)})))},t.prototype._removeCaptureReceiver=function(){var e;null===(e=this._captureReceiver)||void 0===e||e.destroy(),this._captureReceiver=null},t.prototype._applyConsumerSettings=function(){var e=this,t=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;if(t&&this._consumer){var n=[];this._consumer.getSenders().forEach((function(r){if(r.track&&"video"===r.track.kind){var i=!e._disabledSenders.has(r),a=0!==t.maxDimension;if(i&&!a)return Jt.log("Disabling video upload"),e._disabledSenders.add(r),void r.replaceTrack(Mn.getBlackMediaTrack()).catch((function(e){Jt.error("Could not disable video upload",e)}));var o=e._mediaSource.getSendVideoTrack();if(!i&&a&&o){Jt.log("Enabling video upload"),e._disabledSenders.delete(r);var s=r.track;s.enabled=o.enabled,r.replaceTrack(o).then((function(){return s.stop()})).catch((function(e){Jt.error("Could not enable video upload",e)}))}$t.applyVideoTrackSettings(t,r,null!=o?o:r.track,e._prevConsumerSettings,n)}})),this._prevConsumerSettings=n}},t.prototype._onScreenSharingStatus=function(e){e.track?this._createCaptureSender(e.track):this._removeCaptureSender()},t.prototype._setState=function(e,t){this._state[t]!==e&&(this._state[t]=e,"consumer"===t?this._triggerEvent("LOCAL_STATE_CHANGED",e):this._triggerEvent("STATE_CHANGED",e))},t.prototype._getState=function(e){return this._state[e]||"IDLE"},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._producer?(e._collectStat().then((function(t){e._reportStats(t),e._detectStaleTracks(t)})).catch((function(){})),e._statInterval=window.setTimeout(t,Vt.statisticsInterval)):e._stopStatInterval()};this._statInterval=window.setTimeout(t,Vt.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null),this._statBytes={}},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._consumer?(e._applyConsumerSettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._collectStat=function(){return et(this,void 0,void 0,(function(){var e,t;return tt(this,(function(n){switch(n.label){case 0:return this._producer&&this._consumer?(e=this,[4,ar(this._producer,this._producerLastStat,this._ssrcMap)]):[2,Promise.reject()];case 1:return e._producerLastStat=n.sent(),t=this,[4,ar(this._consumer,this._consumerLastStat,this._ssrcMap)];case 2:return t._consumerLastStat=n.sent(),[2,{producer:this._producerLastStat,consumer:this._consumerLastStat}]}}))}))},t.prototype._reportStats=function(e){var t=e.producer,n=e.consumer;this._triggerEvent("REMOTE_DATA_STATS",{inbound:{topology:"SERVER",transport:t.transport,rtps:t.rtps},outbound:{topology:"SERVER",transport:n.transport,rtps:n.rtps}})},t.prototype._detectStaleTracks=function(e){var t=this,n=e.producer.rtps.find((function(e){return"audio"===e.kind&&"mix"===t._ssrcMap[e.ssrc]}));if(n){var r="audio-mix",i=this._statBytes[r],a=!1;if(i){var o=n.bytesReceived-i.bytesReceived;o>=0&&o<=5&&(a=!0),i.stalled!==a&&this._triggerEvent("REMOTE_ALL_STALL",a)}this._statBytes[r]={bytesReceived:n.bytesReceived,stalled:a}}},t.prototype._allocateConsumer=function(){var e=this,n={estimatedPerformanceIndex:Ar.getEstimatedPerformanceIndex(),audioMix:!0,consumerUpdate:!0,producerNotificationDataChannelVersion:Vt.producerNotificationDataChannel?3:0,producerCommandDataChannelVersion:Vt.producerCommandDataChannel?2:0,consumerScreenDataChannelVersion:Vt.consumerScreenDataChannel?1:0,producerScreenDataChannelVersion:Vt.producerScreenDataChannel?1:0,onDemandTracks:Vt.onDemandTracks,unifiedPlan:!Vt.unifiedPlanInterop&&t._isUnifiedPlanSupported()},r="consumer";Jt.debug("[consumer] create offer"),this._consumer&&this._consumer.createOffer(yr).catch((function(e){throw Jt.error("[consumer] unable to create offer",e),Un.log("callError","createOffer-"+r),e})).then((function(e){return e.sdp=$t.patchSDP(e.sdp,!1,Mn.isBrokenH264(),!1),e})).then((function(t){return et(e,void 0,void 0,(function(){var e=this;return tt(this,(function(n){if(Jt.debug("[consumer] created offer",{offer:t}),!this._consumer)throw new Error("Interrupt allocation");return[2,this._consumer.setLocalDescription(t).then((function(){if(!e._consumer)throw new Error("Interrupt allocation");return e._consumer.localDescription}))]}))}))})).catch((function(e){throw Jt.error("[consumer] unable to set local offer",e),Un.log("callError","setLocalDescription-"+r),e})).then((function(t){return et(e,void 0,void 0,(function(){return tt(this,(function(e){return Jt.debug("[consumer] transmit local offer"),[2,this._signaling.allocateConsumer(t,n)]}))}))})).catch(this.close.bind(this))},t.prototype._acceptConsumerAnswer=function(e){var t;return et(this,void 0,void 0,(function(){var n,r,i,a;return tt(this,(function(o){switch(o.label){case 0:if(!this._consumer)throw new Error("Interrupt allocation");if(n="consumer",r=new RTCSessionDescription({type:"answer",sdp:e}),"stable"!==this._consumer.signalingState)return[3,5];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._consumer.createOffer(yr)];case 2:return i=o.sent(),[4,null===(t=this._consumer)||void 0===t?void 0:t.setLocalDescription(i)];case 3:return o.sent(),[3,5];case 4:return a=o.sent(),Jt.error("["+n+"] unable to create offer for new answer",a),Un.log("callError","createOffer-"+n),[3,5];case 5:return Jt.debug("["+n+"] set remote answer",{answer:r}),[2,this._consumer.setRemoteDescription(r).catch((function(e){throw Jt.error("["+n+"] unable to set remote answer",e),Un.log("callError","setRemoteDescription-"+n),e}))]}}))}))},t.prototype._acceptProducer=function(e){return et(this,void 0,void 0,(function(){var n,r,i=this;return tt(this,(function(a){if(n="producer",r=new RTCSessionDescription({type:"offer",sdp:e}),this._producerOfferIsProcessing)return this._producerNextOffer=e,Jt.debug("[producer] wait until other remote offer is processed"),[2];if(this._producerOfferIsProcessing=!0,Vt.unifiedPlanInterop&&t._isUnifiedPlanSupported()&&(Jt.debug("[producer] alter remote offer to 'unified plan'",{offer:r}),r=this._interop.toUnifiedPlan(r)),Jt.debug("[producer] set remote offer",{offer:r}),!this._producer)throw new Error("Interrupt allocation");return this._producer.setRemoteDescription(r).catch((function(e){throw Jt.error("[producer] unable to set remote offer",e),Un.log("callError","setRemoteDescription-"+n),e})).then((function(){return et(i,void 0,void 0,(function(){return tt(this,(function(e){if(Jt.debug("[producer] create local answer"),!this._producer)throw new Error("Interrupt allocation");return[2,this._producer.createAnswer()]}))}))})).catch((function(e){throw Jt.error("[producer] unable to create answer",e),Un.log("callError","createAnswer-"+n),e})).then((function(e){return e.sdp=$t.patchSDP(e.sdp,!1,Mn.isBrokenH264(),!1),e})).then((function(e){return et(i,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:if(Jt.debug("[producer] set local answer",{answer:e}),!this._producer)throw new Error("Interrupt allocation");return[4,this._producer.setLocalDescription(e)];case 1:return t.sent(),[2,e]}}))}))})).catch((function(e){throw Jt.error("[producer] unable to set local answer",e),Un.log("callError","setLocalDescription-"+n),e})).then((function(e){return et(i,void 0,void 0,(function(){var n;return tt(this,(function(i){switch(i.label){case 0:return n=e,Vt.unifiedPlanInterop&&t._isUnifiedPlanSupported()&&(Jt.log("[producer] alter local answer to 'plan b'",{answer:e}),n=this._interop.toPlanB(e)),Jt.debug("[producer] transmit local answer",{answer:n}),this._updateSSRCMap(r),[4,this._signaling.acceptProducer(n,Object.keys(this._ssrcMap))];case 1:return i.sent(),Jt.debug("[producer] remote offer has been processed"),[2]}}))}))})).catch((function(e){Jt.warn("[producer] unable to send local answer",e),Un.log("callError","acceptProducer")})).then((function(){if(i._producerOfferIsProcessing=!1,i._producerNextOffer){Jt.debug("[producer] there is other unprocessed remote offer, process it");var e=i._producerNextOffer;return i._producerNextOffer=null,i._acceptProducer(e)}})).catch((function(e){return i.close(e)})),[2]}))}))},t.prototype._onSignalingNotification=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:if(!this._isOpen)return[2];switch(e.notification){case"producer-updated":return[3,1];case"consumer-answered":return[3,3];case"realloc-con":return[3,5];case"audio-activity":return[3,6];case"speaker-changed":return[3,7];case"stalled-activity":return[3,8];case"network-status":return[3,9]}return[3,10];case 1:return[4,this._acceptProducer(e.description)];case 2:return n.sent(),[3,10];case 3:return[4,this._acceptConsumerAnswer(e.description)];case 4:return n.sent(),[3,10];case 5:return(t=e.target?e.target.toLowerCase():null)&&"consumer"!==t||this._reconnect("consumer"),this._reconnect("producer"),[3,10];case 6:return this._signalActiveParticipants(e.activeParticipants),[3,10];case 7:return this._signalSpeakerChanged(e.speaker),[3,10];case 8:return this._signalStalledParticipants(e.stalledParticipants),[3,10];case 9:return this._signalNetworkStatus(e.statuses),[3,10];case 10:return[2]}}))}))},t.prototype._onAddTrack=function(e,t,n){var r=this;Jt.debug("["+t+"] remote track (added)",{track:n.track});var i=n.streams[0];i?(i.onremovetrack||(i.onremovetrack=function(e){r._triggerEvent("REMOTE_TRACK_REMOVED",i.id,i,e.track)}),i.getTracks().find((function(e){return e.id===n.track.id}))||i.addTrack(n.track),"audio-mix"===i.id&&(this._hasAudioMix=!0),this._triggerEvent("REMOTE_TRACK_ADDED",i.id,i,n.track)):Jt.error("["+t+"] unable to get media stream from track event")},t._onSignalingStateChange=function(e,t,n){Jt.debug("["+t+"] signaling state changed",{state:e.signalingState},n)},t.prototype._onConnectionStateChange=function(e,t,n){switch(Jt.debug("["+t+"] connection state changed",{state:e.connectionState},n),Un.log("callIceConnectionState",e.connectionState),e.connectionState){case"failed":this._reconnectionPrevented?this.close(new Error("Ice connection failed")):this._signaling.requestRealloc(t);break;case"connecting":var r=this._getState(t);"IDLE"===r||"OPENED"===r?this._setState("CONNECTING",t):"checking"===e.iceConnectionState&&this._setState("RECONNECTING",t);break;case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection disconnected")):this._setState("RECONNECTING",t);break;case"connected":this._setState("CONNECTED",t),$t.getPeerConnectionHostInfo(e).then((function(e){e&&Un.log("callIceConnectionType",e.type)}))}},t.prototype._onReplacedTrack=function(e,t){var n=this;this._consumer&&(Vt.consumerScreenDataChannel&&t&&(e=t),this._consumer.getSenders().forEach((function(t){t.track&&t.track.kind===e.kind&&!n._disabledSenders.has(t)&&(t.track.enabled=e.enabled,t.replaceTrack(e).catch((function(e){Jt.error("ServerTransport: Unable to replace track",e),Un.log("callError","replaceTrack-consumer")})))}))),this._applyConsumerSettings()},t._isUnifiedPlanSupported=function(){var e=Mn.baseChromeVersion();return e?Vt.isUnifiedPlanSupported("Chrome",e):Vt.isUnifiedPlanSupported(Mn.browserName(),Mn.browserVersion())},t.prototype.getStreamWaitingTimeMs=function(e,t){throw new Error("unsupported operation")},t}(st),Sr=function(e){function t(t,n,r){var i=e.call(this)||this;return i._pc=null,i._producerNotification=null,i._producerCommand=null,i._producerScreen=null,i._consumerScreen=null,i._isOpen=!1,i._reconnectionPrevented=!1,i._state="IDLE",i._statInterval=null,i._settingsInterval=null,i._statBytes={},i._ssrcMap={},i._producerOfferIsProcessing=!1,i._producerNextOffer=null,i._prevConsumerSettings={},i._hasAudioMix=!1,i._captureSender=null,i._captureReceiver=null,i._participantIdRegistry=null,i._disabledSenders=new Set,i._rtpReceiversByStreamId={},i._signaling=t,i._mediaSource=n,i._signaling&&i._mediaSource&&(i.subscribe(i._signaling,"NOTIFICATION",i._onSignalingNotification.bind(i)),i.subscribe(i._mediaSource,"TRACK_REPLACED",i._onReplacedTrack.bind(i)),i.subscribe(i._mediaSource,"SOURCE_CHANGED",i._applyConsumerSettings.bind(i)),i.subscribe(i._mediaSource,"SCREEN_STATUS",i._onScreenSharingStatus.bind(i))),i._perfStatReporter=new Ar(i,t),i._serverSettings=r,Vt.consumerScreenDataChannel&&!gr.isBrowserSupported()&&(Vt.consumerScreenDataChannel=!1),Vt.producerScreenDataChannel&&!fr.isBrowserSupported()&&(Vt.producerScreenDataChannel=!1),Jt.debug("ServerTransport: Created"),i}return Ze(t,e),t.prototype.getState=function(){return this._getState()},t.prototype.getLocalState=function(){return this._getState()},t.prototype.updateStatisticsInterval=function(){this._stopStatInterval();var e=this._getState();"IDLE"!==e&&"CLOSED"!==e&&"FAILED"!==e&&this._startStatInterval()},t.prototype.open=function(){this._isOpen?Jt.log("ServerTransport: Already opened connections"):(this._isOpen=!0,this._openConnection())},t.prototype.close=function(e){this._isOpen=!1,this._closeConnection(),this.unsubscribe(),e?(Jt.error("ServerTransport: Closed",e),this._setState("FAILED")):(Jt.debug("ServerTransport: Closed"),this._setState("CLOSED"))},t.prototype.removeParticipant=function(e){var t;null===(t=this._captureReceiver)||void 0===t||t.close(e)},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.updateSettings=function(e){xn(e,this._serverSettings)||(this._serverSettings=e,this._applyConsumerSettings())},t.prototype._closeConnection=function(){this._stopStatInterval(),this._stopSettingsInterval(),this._removeCaptureSender(),this._removeCaptureReceiver(),this._pc&&(this._rtpReceiversByStreamId={},this._disabledSenders.forEach((function(e){var t;return null===(t=e.track)||void 0===t?void 0:t.stop()})),this._disabledSenders.clear(),this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._participantIdRegistry=null,t._closeDataChannel(this._producerNotification),t._closeDataChannel(this._producerCommand),t._closeDataChannel(this._producerScreen),t._closeDataChannel(this._consumerScreen),this._pc.close(),this._pc=null,this._producerOfferIsProcessing=!1,this._producerNextOffer=null)},t._closeDataChannel=function(e){e&&(e.onopen=null,e.onmessage=null,e.onerror=null,e.close())},t.prototype._createDataChannel=function(e,t,n){Jt.debug("["+t+"] data channel opening");var r=e.createDataChannel(t,{ordered:!0});r.onopen=function(){Jt.debug("["+t+"] data channel opened"),r.onerror=function(e){Jt.error("["+t+"] data channel error",e)},n(r)}},t.prototype._openConnection=function(){var e,n=this;Jt.debug("ServerTransport: Open single connection");var r={};Mn.baseChromeVersion()&&(r.sdpSemantics=t._isUnifiedPlanSupported()?"unified-plan":"plan-b"),this._pc=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._pc.ontrack=this._onAddTrack.bind(this,this._pc),this._pc.onconnectionstatechange=$t.throttle((function(e){n._pc&&n._onConnectionStateChange(n._pc,e)}),500),this._pc.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._pc),Vt.producerNotificationDataChannel&&this._createDataChannel(this._pc,"producerNotification",(function(e){n._producerNotification=e,n._producerNotification.binaryType="arraybuffer",n._participantIdRegistry=new sr,n._signaling.setParticipantIdRegistry(n._participantIdRegistry),n._signaling.setProducerNotificationDataChannel(e)})),Vt.producerCommandDataChannel&&this._createDataChannel(this._pc,"producerCommand",(function(e){n._producerCommand=e,n._signaling.setProducerCommandDataChannel(e)})),Vt.producerScreenDataChannel&&this._createDataChannel(this._pc,"producerScreenShare",(function(e){n._producerScreen=e,n._producerScreen.binaryType="arraybuffer",n._createCaptureReceiver()}));try{this._mediaSource.addTrackToPeerConnection(this._pc),this._prevConsumerSettings={},this._applyConsumerSettings()}catch(e){return Jt.error("ServerTransport: Unable to add media source tracks",e),Un.log("callError","addTrack-single"),void this.close(e)}var i=null===(e=this._mediaSource.getStream())||void 0===e?void 0:e.getVideoTracks()[0];Vt.consumerScreenDataChannel&&i&&this._createDataChannel(this._pc,"consumerScreenShare",(function(e){n._consumerScreen=e,n._consumerScreen.binaryType="arraybuffer",n._createCaptureSender(i)})),this._allocateConsumer(),this._setState("OPENED"),this._startStatInterval(),this._startSettingsInterval()},t.prototype._reconnect=function(){this._setState("RECONNECTING"),this._closeConnection(),this._openConnection()},t.prototype._signalActiveParticipants=function(e){this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._signalStalledParticipants=function(e){this._triggerEvent("SIGNALLED_STALLED_PARTICIPANTS",e)},t.prototype._signalSpeakerChanged=function(e){this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._signalNetworkStatus=function(e){this._triggerEvent("SIGNALLED_NETWORK_STATUS",e)},t.prototype._updateSSRCMap=function(e){var t=this;e&&e.sdp.split("\n").forEach((function(e){var n=new RegExp("a=ssrc:([0-9]+) label:(audio|video)-((?:[ug]?[\\d]+)|(?:mix)|(?:pat-[0-9]+))").exec(e);n&&(t._ssrcMap[n[1]]=n[3])}))},t.prototype._createCaptureSender=function(e){e&&Vt.consumerScreenDataChannel&&this._consumerScreen&&this._mediaSource.getMediaSettings().isScreenSharingEnabled&&(this._captureSender&&this._removeCaptureSender(),this._captureSender=new gr(e,this._consumerScreen))},t.prototype._removeCaptureSender=function(){var e;null===(e=this._captureSender)||void 0===e||e.destroy(),this._captureSender=null},t.prototype._createCaptureReceiver=function(){var e=this;Vt.producerScreenDataChannel&&this._producerScreen&&this._participantIdRegistry&&(this._captureReceiver&&this._removeCaptureReceiver(),this._captureReceiver=new fr(this._producerScreen,this._participantIdRegistry,(function(t,n){e._triggerEvent("REMOTE_STREAM_SECOND",t,n)}),(function(t){e._triggerEvent("REMOTE_STREAM_SECOND",t,null)})))},t.prototype._removeCaptureReceiver=function(){var e;null===(e=this._captureReceiver)||void 0===e||e.destroy(),this._captureReceiver=null},t.prototype._applyConsumerSettings=function(){var e=this,t=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;if(t&&this._pc){var n=[];this._pc.getSenders().forEach((function(r){if(r.track&&"video"===r.track.kind){var i=!e._disabledSenders.has(r),a=0!==t.maxDimension;if(i&&!a)return Jt.log("Disabling video upload"),e._disabledSenders.add(r),void r.replaceTrack(Mn.getBlackMediaTrack()).catch((function(e){Jt.error("Could not disable video upload",e)}));var o=e._mediaSource.getSendVideoTrack();if(!i&&a&&o){Jt.log("Enabling video upload"),e._disabledSenders.delete(r);var s=r.track;s.enabled=o.enabled,r.replaceTrack(o).then((function(){return s.stop()})).catch((function(e){Jt.error("Could not enable video upload",e)}))}$t.applyVideoTrackSettings(t,r,null!=o?o:r.track,e._prevConsumerSettings,n)}})),this._prevConsumerSettings=n}},t.prototype._onScreenSharingStatus=function(e){e.track?this._createCaptureSender(e.track):this._removeCaptureSender()},t.prototype._setState=function(e){this._state!==e&&(this._state=e,this._triggerEvent("LOCAL_STATE_CHANGED",e),this._triggerEvent("STATE_CHANGED",e))},t.prototype._getState=function(){return this._state||"IDLE"},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?(e._collectStat().then((function(t){e._reportStats(t),e._detectStaleTracks(t)})).catch((function(){})),e._statInterval=window.setTimeout(t,Vt.statisticsInterval)):e._stopStatInterval()};this._statInterval=window.setTimeout(t,Vt.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null),this._statBytes={}},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._pc?(e._applyConsumerSettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._collectStat=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return this._pc?[4,ar(this._pc,this._lastStat,this._ssrcMap)]:[2,Promise.reject()];case 1:return e=t.sent(),this._lastStat=e,[2,e]}}))}))},t.prototype._reportStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",{inbound:{topology:"SERVER",transport:e.transport,rtps:e.rtps.filter((function(e){return"inbound-rtp"===e.type}))},outbound:{topology:"SERVER",transport:e.transport,rtps:e.rtps.filter((function(e){return"outbound-rtp"===e.type}))}})},t.prototype._detectStaleTracks=function(e){var t=this,n=e.rtps.find((function(e){return"inbound-rtp"===e.type&&"audio"===e.kind&&"mix"===t._ssrcMap[e.ssrc]}));if(n){var r="audio-mix",i=this._statBytes[r],a=!1;if(i){var o=n.bytesReceived-i.bytesReceived;o>=0&&o<=5&&(a=!0),i.stalled!==a&&this._triggerEvent("REMOTE_ALL_STALL",a)}this._statBytes[r]={bytesReceived:n.bytesReceived,stalled:a}}},t.prototype._allocateConsumer=function(){var e={estimatedPerformanceIndex:Ar.getEstimatedPerformanceIndex(),audioMix:!0,consumerUpdate:!0,producerNotificationDataChannelVersion:Vt.producerNotificationDataChannel?4:0,producerCommandDataChannelVersion:Vt.producerCommandDataChannel?2:0,consumerScreenDataChannelVersion:Vt.consumerScreenDataChannel?1:0,producerScreenDataChannelVersion:Vt.producerScreenDataChannel?1:0,onDemandTracks:Vt.onDemandTracks,unifiedPlan:t._isUnifiedPlanSupported(),singleSession:Vt.singleSession,videoTracksCount:Vt.videoTracksCount};this._signaling.allocateConsumer(null,e)},t.prototype._acceptProducer=function(e){return et(this,void 0,void 0,(function(){var t,n=this;return tt(this,(function(r){if(t=new RTCSessionDescription({type:"offer",sdp:e}),this._producerOfferIsProcessing)return this._producerNextOffer=e,Jt.debug("[single] wait until other remote offer is processed"),[2];if(this._producerOfferIsProcessing=!0,Jt.debug("[single] set remote offer",{offer:t}),!this._pc)throw new Error("Interrupt allocation");return this._pc.setRemoteDescription(t).catch((function(e){throw Jt.error("[single] unable to set remote offer",e),Un.log("callError","setRemoteDescription-single"),e})).then((function(){return et(n,void 0,void 0,(function(){return tt(this,(function(e){if(Jt.debug("[single] create local answer"),!this._pc)throw new Error("Interrupt allocation");return[2,this._pc.createAnswer()]}))}))})).catch((function(e){throw Jt.error("[single] unable to create answer",e),Un.log("callError","createAnswer-single"),e})).then((function(e){return e.sdp=$t.patchSDP(e.sdp,!1,Mn.isBrokenH264(),!1),e})).then((function(e){return et(n,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:if(Jt.debug("[single] set local answer",{answer:e}),!this._pc)throw new Error("Interrupt allocation");return[4,this._pc.setLocalDescription(e)];case 1:return t.sent(),[2,e]}}))}))})).catch((function(e){throw Jt.error("[single] unable to set local answer",e),Un.log("callError","setLocalDescription-single"),e})).then((function(e){return et(n,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return Jt.debug("[single] transmit local answer",{answer:e}),this._updateSSRCMap(t),[4,this._signaling.acceptProducer(e,Object.keys(this._ssrcMap))];case 1:return n.sent(),Jt.debug("[single] remote offer has been processed"),[2]}}))}))})).catch((function(e){Jt.warn("[single] unable to send local answer",e),Un.log("callError","acceptProducer")})).then((function(){if(n._producerOfferIsProcessing=!1,n._producerNextOffer){Jt.debug("[single] there is other unprocessed remote offer, process it");var e=n._producerNextOffer;return n._producerNextOffer=null,n._acceptProducer(e)}})).catch((function(e){return n.close(e)})),[2]}))}))},t.prototype._onSignalingNotification=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:if(!this._isOpen)return[2];switch(e.notification){case"producer-updated":return[3,1];case"realloc-con":return[3,3];case"audio-activity":return[3,4];case"speaker-changed":return[3,5];case"stalled-activity":return[3,6];case"network-status":return[3,7]}return[3,8];case 1:return[4,this._acceptProducer(e.description)];case 2:return t.sent(),[3,8];case 3:return this._reconnect(),[3,8];case 4:return this._signalActiveParticipants(e.activeParticipants),[3,8];case 5:return this._signalSpeakerChanged(e.speaker),[3,8];case 6:return this._signalStalledParticipants(e.stalledParticipants),[3,8];case 7:return this._signalNetworkStatus(e.statuses),[3,8];case 8:return[2]}}))}))},t.prototype._onAddTrack=function(e,t){var n=this;Jt.debug("[single] remote track (added)",{track:t.track});var r=t.streams[0];r?(r.onremovetrack||(r.onremovetrack=function(e){n._triggerEvent("REMOTE_TRACK_REMOVED",r.id,r,e.track)}),r.getTracks().find((function(e){return e.id===t.track.id}))||r.addTrack(t.track),"audio-mix"===r.id&&(this._hasAudioMix=!0),this._rtpReceiversByStreamId[r.id]=t.receiver,this._triggerEvent("REMOTE_TRACK_ADDED",r.id,r,t.track)):Jt.error("[single] unable to get media stream from track event")},t._onSignalingStateChange=function(e,t){Jt.debug("[single] signaling state changed",{state:e.signalingState},t)},t.prototype._onConnectionStateChange=function(e,t){switch(Jt.debug("[single] connection state changed",{state:e.connectionState},t),Un.log("callIceConnectionState",e.connectionState),e.connectionState){case"failed":this._reconnectionPrevented?this.close(new Error("Ice connection failed")):(this._signaling.requestRealloc(),this._reconnect());break;case"connecting":var n=this._getState();"IDLE"===n||"OPENED"===n?this._setState("CONNECTING"):"checking"===e.iceConnectionState&&this._setState("RECONNECTING");break;case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection disconnected")):this._setState("RECONNECTING");break;case"connected":this._setState("CONNECTED"),$t.getPeerConnectionHostInfo(e).then((function(e){e&&Un.log("callIceConnectionType",e.type)}))}},t.prototype._onReplacedTrack=function(e,t){var n=this;this._pc&&(Vt.consumerScreenDataChannel&&t&&(e=t),this._pc.getSenders().forEach((function(t){t.track&&t.track.kind===e.kind&&!n._disabledSenders.has(t)&&(t.track.enabled=e.enabled,t.replaceTrack(e).catch((function(e){Jt.error("ServerTransport: Unable to replace track",e),Un.log("callError","replaceTrack-single")})))}))),this._applyConsumerSettings()},t._isUnifiedPlanSupported=function(){var e=Mn.baseChromeVersion();return e?Vt.isUnifiedPlanSupported("Chrome",e):Vt.isUnifiedPlanSupported(Mn.browserName(),Mn.browserVersion())},t.prototype.getStreamWaitingTimeMs=function(e,t){if(!this._pc)return Un.log("patWaitingTimeError","noConnection"),Jt.error("Cannot get stream waiting time, peer connection is not initialized"),0;var n=this._rtpReceiversByStreamId[e];if(!n)return Un.log("patWaitingTimeError","noReceiver"),Jt.error("Cannot get stream waiting time, cannot find RTP receiver by stream ID: "+e),0;var r=n.getSynchronizationSources();if(!r||!r.length)return Jt.log("Cannot get stream waiting time, "+e+" receiver has no synchronization sources"),0;var i=r[0].rtpTimestamp;if(!Number.isInteger(i))return Un.log("patWaitingTimeError","timestampNotInteger"),Jt.error("Cannot get stream waiting time, "+e+" receiver's RTP timestamp is not an integer: "+i),0;var a=t-i&4294967295,o=Math.ceil(a/90);return Math.min(100,Math.max(0,o))},t}(st),br=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a._allocated=[],a._opened=[],a._directTransport=null,a._serverTransport=null,a._dtListeners=[],a._stListeners=[],a._states={},a._localState="IDLE",a._signaling=n,a._mediaSource=r,a._topology=t,a._serverSettings=i,a.subscribe(a._signaling,"NOTIFICATION",a._onSignalingNotification.bind(a)),"SERVER"===t&&(a._serverTransport=a._createServerTransport()),a}return Ze(t,e),t.prototype.updateSettings=function(e){this._serverSettings=e,this._directTransport&&this._directTransport.updateSettings(e),this._serverTransport&&this._serverTransport.updateSettings(e)},t.prototype.updateStatisticsInterval=function(){this._directTransport&&this._directTransport.updateStatisticsInterval(),this._serverTransport&&this._serverTransport.updateStatisticsInterval()},t.prototype.allocate=function(e,t){void 0===t&&(t=!1),-1===this._allocated.indexOf(e)?(this._allocated.push(e),"DIRECT"===this._topology&&(this._directTransport=this._createDirectTransport(e,t)),"SERVER"!==this._topology||this._serverTransport||(this._serverTransport=this._createServerTransport())):Jt.warn("The participant ["+e+"] has already had allocated transport")},t.prototype.open=function(e,t){void 0===t&&(t=null),-1===this._opened.indexOf(e)?-1!==this._allocated.indexOf(e)?(this._opened.push(e),"DIRECT"===this._topology&&this._directTransport&&this._directTransport.open(t),"SERVER"===this._topology&&this._serverTransport&&(this._serverTransport.open(),this._setState(e,this._serverTransport.getState()),this._setLocalState(this._serverTransport.getLocalState())),Jt.debug("The participant ["+e+"] transport opened")):Jt.warn("The participant ["+e+"] has no allocated transport"):Jt.warn("The participant ["+e+"] has already had opened transport")},t.prototype.close=function(e){var t,n=this._allocated.indexOf(e),r=this._opened.indexOf(e);n<0&&Jt.warn("The participant ["+e+"] transport has already deallocated"),"DIRECT"===this._topology&&this._directTransport&&(this._directTransport.close(),this._directTransport=null),"SERVER"===this._topology&&(null===(t=this._serverTransport)||void 0===t||t.removeParticipant(e),this._setState(e,"CLOSED")),r>=0&&this._opened.splice(r,1),n>=0&&this._allocated.splice(n,1)},t.prototype.destroy=function(){this.unsubscribe(),this._dtListeners&&this._dtListeners.forEach((function(e){e.dispose()})),this._stListeners&&this._stListeners.forEach((function(e){e.dispose()})),this._directTransport&&(this._directTransport.close(),this._directTransport=null),this._serverTransport&&(this._serverTransport.close(),this._serverTransport=null),this._allocated=[],this._opened=[]},t.prototype.getTopology=function(){return this._topology},t.prototype.isAllocated=function(e){return this._allocated.indexOf(e)>=0},t.prototype.allocated=function(){return this._allocated.slice()},t.prototype.opened=function(){return this._opened.slice()},t.prototype._setStates=function(e,t){var n=this;e.forEach((function(e){n._setState(e,t)}))},t.prototype._setState=function(e,t){this._states[e]!==t&&(this._states[e]=t,this._triggerEvent("STATE_CHANGED",e,t))},t.prototype._setLocalState=function(e){this._localState!==e&&(this._localState=e,this._triggerEvent("LOCAL_STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){return"topology-changed"===e.notification?this._onTopologyChanged(e):"record-started"===e.notification?this._onRecordStarted(e):void 0},t.prototype._onTopologyChanged=function(e){var t;if(e.topology!==this._topology){if(Jt.log("Topology changed "+this._topology+" -> "+e.topology),Un.log("callTopologyChangeRequested",e.topology),this._topology=e.topology,"SERVER"===this._topology&&(this._serverTransport?this._serverTransport.allowRestart():(this._serverTransport=this._createServerTransport(),this._opened.length>0&&(null===(t=this._directTransport)||void 0===t||t.preventRestart(),this._serverTransport.open()))),"DIRECT"===this._topology){var n=e.offerTo||[],r=e.offerToTypes||[],i=n.length&&r.length?$t.composeId(n[0],r[0]):null;if(this._serverTransport&&this._serverTransport.preventRestart(),!this._allocated||0===this._allocated.length)return void Jt.error("Topology changed to DIRECT, but the list of allocated participants is empty");this._allocated.length>1&&Jt.warn("Topology changed to DIRECT, but the allocated participants count more then one");var a=this._allocated[0];if(this._directTransport)this._directTransport.allowRestart();else{var o=i===a;this._directTransport=this._createDirectTransport(a,o)}this._opened.indexOf(a)>=0&&this._directTransport.open()}this._triggerEvent("TOPOLOGY_CHANGED",this._topology)}},t.prototype._onRecordStarted=function(e){this._serverTransport&&this._serverTransport.open()},t.prototype._createDirectTransport=function(e,t){void 0===t&&(t=!1);var n=new or(e,t,this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!0),this._dtListeners&&this._dtListeners.length>0&&Jt.warn("The list of direct listeners for the participant ["+e+"] is not empty"),this._dtListeners=[],this._dtListeners.push(n.addEventListener("REMOTE_TRACK_ADDED",this._onDirectRemoteTrackAdded.bind(this,e)),n.addEventListener("REMOTE_TRACK_REMOVED",this._onDirectRemoteTrackRemoved.bind(this,e)),n.addEventListener("REMOTE_DATA_STATS",this._onDirectRemoteDataStats.bind(this)),n.addEventListener("STATE_CHANGED",this._onDirectTransportChanged.bind(this,e))),n},t.prototype._createServerTransport=function(){var e=Vt.singleSession?new Sr(this._signaling,this._mediaSource,this._serverSettings):new Er(this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!1),this._stListeners&&this._stListeners.length>0&&Jt.warn("The list of server transport listeners is not empty"),this._stListeners=[],this._stListeners.push(e.addEventListener("REMOTE_TRACK_ADDED",this._onServerRemoteTrackAdded.bind(this)),e.addEventListener("REMOTE_TRACK_REMOVED",this._onServerRemoteTrackRemoved.bind(this)),e.addEventListener("REMOTE_ALL_STALL",this._onServerRemoteAllStall.bind(this)),e.addEventListener("REMOTE_DATA_STATS",this._onServerRemoteDataStats.bind(this)),e.addEventListener("STATE_CHANGED",this._onServerTransportChanged.bind(this)),e.addEventListener("LOCAL_STATE_CHANGED",this._onServerTransportLocalChanged.bind(this)),e.addEventListener("ACTIVE_PARTICIPANTS_NO_SIGNAL",this._onTransportActiveParticipantsNoSignal.bind(this)),e.addEventListener("SIGNALLED_ACTIVE_PARTICIPANTS",this._onTransportActiveParticipants.bind(this)),e.addEventListener("SIGNALLED_SPEAKER_CHANGED",this._onTransportSpeakerChanged.bind(this)),e.addEventListener("SIGNALLED_STALLED_PARTICIPANTS",this._onTransportStalledParticipants.bind(this)),e.addEventListener("SIGNALLED_NETWORK_STATUS",this._onTransportNetworkStatus.bind(this)),e.addEventListener("REMOTE_STREAM_SECOND",this._onRemoteStreamSecond.bind(this))),e},t.prototype._releaseDirectTransport=function(e){this._directTransport&&(e&&this._directTransport.close(),this._directTransport=null),this._dtListeners&&(this._dtListeners.forEach((function(e){e.dispose()})),this._dtListeners=[])},t.prototype._releaseServerTransport=function(e){this._serverTransport&&(e&&this._serverTransport.close(),this._serverTransport=null),this._stListeners&&(this._stListeners.forEach((function(e){e.dispose()})),this._stListeners=[])},t.prototype._setLocalNoiseSuppression=function(e){var t;Vt.noiseSuppression!==e&&(Vt.noiseSuppression=e,null===(t=this._mediaSource)||void 0===t||t.updateNoiseSuppression())},t.prototype._onDirectTransportChanged=function(e,t){if("CONNECTED"===t&&"DIRECT"===this._topology&&this._releaseServerTransport(!0),("CLOSED"===t||"FAILED"===t)&&(this._releaseDirectTransport(!1),"DIRECT"===this._topology)){var n=this._opened.indexOf(e);n>=0&&this._opened.splice(n,1);var r=this._allocated.indexOf(e);r>=0&&this._allocated.splice(r,1)}"DIRECT"===this._topology&&(this._setState(e,t),this._setLocalState(t))},t.prototype._onServerTransportChanged=function(e){var t=this._opened.slice();"CONNECTED"===e&&"SERVER"===this._topology&&this._releaseDirectTransport(!0),"CLOSED"!==e&&"FAILED"!==e||this._releaseServerTransport(!1),"SERVER"===this._topology&&this._setStates(t,e)},t.prototype._onServerTransportLocalChanged=function(e){"SERVER"===this._topology&&("CLOSED"!==e&&"FAILED"!==e||(this._allocated=[],this._opened=[]),this._setLocalState(e))},t.prototype._onTransportActiveParticipantsNoSignal=function(){this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL")},t.prototype._onTransportActiveParticipants=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._onTransportStalledParticipants=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_STALLED_PARTICIPANTS",e)},t.prototype._onTransportSpeakerChanged=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._onTransportNetworkStatus=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_NETWORK_STATUS",e)},t.prototype._onRemoteStreamSecond=function(e,t){this._triggerEvent("REMOTE_STREAM_SECOND",e,t)},t.prototype._onServerRemoteAllStall=function(e){"SERVER"===this._topology&&this._triggerEvent("REMOTE_ALL_STALL",e)},t.prototype._onServerRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onDirectRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onDirectRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onDirectRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onServerRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onServerRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype.getStreamWaitingTimeMs=function(e,t){return"SERVER"!==this._topology?(Un.log("patWaitingTimeError","wrongTopology"),Jt.error("Cannot get stream waiting time, incorrect topology: "+this._topology),0):this._serverTransport?this._serverTransport.getStreamWaitingTimeMs(e,t):(Un.log("patWaitingTimeError","noTransport"),Jt.error("Cannot get stream waiting time, server transport is not initialized"),0)},t}(st),Cr=function(e){function t(t){var n=e.call(this)||this;return n._detector=null,n._interval=null,n.subscribe(t,"REMOTE_TRACK_ADDED",n._onRemoteTrackAdded.bind(n)),n.subscribe(t,"REMOTE_TRACK_REMOVED",n._onRemoteTrackRemoved.bind(n)),n.subscribe(t,"SIGNALLED_ACTIVE_PARTICIPANTS",n._onSignalledActiveParticipants.bind(n)),n.subscribe(t,"ACTIVE_PARTICIPANTS_NO_SIGNAL",n._onActiveParticipantsNoSignal.bind(n)),n}return Ze(t,e),t.prototype.destroy=function(){var e;this._interval&&(window.clearTimeout(this._interval),this._interval=null),this.unsubscribe(),null===(e=this._detector)||void 0===e||e.destroy(),this._detector=null},t.prototype._onRemoteTrackAdded=function(e,t,n){var r,i=this;if("audio"===n.kind&&(null===(r=this._detector)||void 0===r||r.destroy(),this._detector=new zn(e,t),!this._interval)){var a=function(){i._collectVolumes(),i._interval=window.setTimeout(a,Vt.voiceParams.interval)};this._interval=window.setTimeout(a,Vt.voiceParams.interval)}},t.prototype._onRemoteTrackRemoved=function(e,t,n){"audio"===n.kind&&this._detector&&this._detector.stream===t&&(this._detector.destroy(),this._detector=null)},t.prototype._collectVolumes=function(){if(this._detector){var e={},t=this._detector.trackId,n=this._detector.getLevel()||0;if("audio-mix"===t){if(this._activeParticipants)for(var r=0,i=this._activeParticipants;r<i.length;r++)e[i[r]]=n}else e[t]=n;this._triggerEvent("VOLUMES_DETECTED",e)}},t.prototype._onSignalledActiveParticipants=function(e){this._activeParticipants=e},t.prototype._onActiveParticipantsNoSignal=function(){this._activeParticipants=null},t}(st),wr=function(e){function t(t,n,r){var i=e.call(this)||this;return i._mediaSource=null,i._conversation=null,i._state="IDLE",i._participantState="CALLED",i._participants={},i._transport=null,i._debugInfo=null,i._volumesDetector=null,i._speakerDetector=null,i._localVolumeDetector=null,i._specListener=null,i._activeSpeakerId=null,i._lastSignalledActiveSpeakerId=null,i._serverSettings={camera:null,screenSharing:null},i._signalingServerSettings={camera:null,screenSharing:null},i._lastStalled={},i._remoteAllStalled=!1,i._audioFix=null,i._trackDataByStreamId={},i._streamWaitTimerByParticipantId={},Un.create(t,r),i._api=t,i._signaling=n,i._onUnload=function(){i._conversation&&i._api&&i._api.hangupConversation(i._conversation.id),Un.destroy()},window.addEventListener("unload",i._onUnload),i._audioOutput=new Gn,i}return Ze(t,e),t.current=function(){return t._current},t.hangupAfterInit=function(){t._current||(t._delayedHangup=!0)},t.id=function(){var e,n;return(null===(n=null===(e=t._current)||void 0===e?void 0:e._conversation)||void 0===n?void 0:n.id)||null},t.prototype.onStart=function(e,n,r,i,a,o){return void 0===i&&(i=""),void 0===a&&(a=!1),void 0===o&&(o=!1),et(this,void 0,void 0,(function(){var s,c,u,l,d,p;return tt(this,(function(h){switch(h.label){case 0:if(t._activationMutex)throw Un.log("callError","startCall"),Jt.warn("Conversation: there is already running activation"),new Wn(vt.FAILED);t._activationMutex=!0,h.label=1;case 1:return h.trys.push([1,8,,9]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(r)];case 2:return h.sent(),s=this._mediaSource.getMediaSettings().isVideoEnabled,n===lt.CHAT||e.length>1?Un.log("callStartMultiparty",s?"video":"audio"):Un.log("callStart",s?"video":"audio"),[4,this._startConversation(e,n,"OUTGOING",s,i,a,o)];case 3:if(c=h.sent(),!this._conversation||!this._signaling)throw new Wn(vt.UNKNOWN_ERROR);return this._participantState="ACCEPTED",[4,this._registerParticipants()];case 4:if(h.sent(),this._processConnectionData(c),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Jt.debug("Outgoing call",{opponentIds:e,opponentType:n,withVideo:s}),Qt.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Qt.onConversation(this._conversation.externalId,this._conversation.mediaModifiers),Qt.onLocalStatus(xt.WAITING),this._toggleJoinAvailability(),this._changeFeatureSet(),this._changeNeedRate(),t._current=this,t._delayedHangup)throw new Wn(vt.CANCELED);if(this._conversation.concurrent)return[3,5];for(u=0,l=Object.values(this._participants);u<l.length;u++)d=l[u],Qt.onParticipantStatus(d.externalId,xt.WAITING);return[3,7];case 5:return[4,this._acceptConcurrent(s)];case 6:h.sent(),h.label=7;case 7:return t._activationMutex=!1,[2,this._conversation];case 8:throw p=h.sent(),t._activationMutex=!1,this._close(p,"Unable to start conversation"),p;case 9:return[2]}}))}))},t.prototype.onJoin=function(e){return et(this,void 0,void 0,(function(){var n,r,i,a,o,s;return tt(this,(function(c){switch(c.label){case 0:if(t._activationMutex)throw Un.log("callError","joinCall"),Jt.warn("Conversation: there is already running activation"),new Wn(vt.FAILED);t._activationMutex=!0,this._state="PROCESSING",c.label=1;case 1:return c.trys.push([1,5,,6]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(e.needVideo)];case 2:return c.sent(),n=this._mediaSource.getMediaSettings().isVideoEnabled,e.needVideo=n,Un.log("callJoinConversation",n?"video":"audio"),[4,this._joinConversation(e)];case 3:if(r=c.sent(),!this._conversation||!this._signaling)throw new Wn(vt.UNKNOWN_ERROR);return this._participantState="ACCEPTED",[4,this._registerParticipants()];case 4:if(c.sent(),this._processConnectionData(r),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Qt.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Qt.onConversation(this._conversation.externalId,this._conversation.mediaModifiers),Qt.onLocalStatus(xt.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._changeFeatureSet(),t._current=this,t._delayedHangup)throw new Wn(vt.CANCELED);for(i=0,a=Object.values(this._participants);i<a.length;i++)o=a[i],Qt.onParticipantStatus(o.externalId,xt.WAITING),"CALLED"!==o.state&&"ACCEPTED"!==o.state||this._transport&&!this._transport.isAllocated(o.id)&&this._transport.allocate(o.id,!1),this._transport&&"ACCEPTED"===o.state&&this._transport.open(o.id,null);return t._activationMutex=!1,[2,this._conversation];case 5:throw s=c.sent(),t._activationMutex=!1,this._close(s,"Unable to join conversation"),s;case 6:return[2]}}))}))},t.prototype.onPush=function(e,n,r){return void 0===n&&(n="USER"),et(this,void 0,void 0,(function(){var i,a,o=this;return tt(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw Jt.warn("Conversation: there is already running activation"),new Wn(vt.REJECTED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,this._prepareConversation(e,n,r)];case 2:if(i=s.sent(),this._mediaSource=this._createMediaSource(),!this._conversation||!this._signaling)throw new Wn(vt.UNKNOWN_ERROR);if(!this._conversation.participants.find((function(e){return o._conversation&&"CALLED"===e.state&&e.id===o._conversation.userId})))throw Jt.log("Push rejected (there is an active call)"),Un.log("callPush","rejected"),new Wn(vt.REJECTED);return[4,this._registerParticipants()];case 3:if(s.sent(),this._processConnectionData(i),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Un.log("callPush","accepted"),t._current=this,t._delayedHangup)throw new Wn(vt.CANCELED);return t._activationMutex=!1,[3,5];case 4:throw a=s.sent(),t._activationMutex=!1,this._close(a,"Unable to handle inbound call push"),a;case 5:return[2]}}))}))},t.prototype._acceptConcurrent=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:if(!this._mediaSource||!this._signaling||!this._conversation)throw new Wn(vt.UNKNOWN_ERROR);this._state="PROCESSING",Un.log("callAcceptConcurrent",e?"video":"audio"),Jt.debug("Concurrent call",{conversationId:this._conversation.id}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 2:for(a.sent(),Qt.onCallAccepted(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id);return[3,4];case 3:return i=a.sent(),this._close(i,"Unable to accept concurrent call"),[3,4];case 4:return[2]}}))}))},t.prototype.accept=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:if("IDLE"!==this._state)throw Un.log("callError","acceptIncoming"),Jt.error("Unable to accept a call - invalid state"),new Error("Unable to accept a call - invalid state");if(!this._mediaSource||!this._signaling||!this._conversation)throw new Wn(vt.UNKNOWN_ERROR);this._state="PROCESSING",Un.log("callAcceptIncoming",e?"video":"audio"),Jt.debug("Accept incoming call",{withVideo:e}),a.label=1;case 1:return a.trys.push([1,6,,7]),[4,this._mediaSource.request(e)];case 2:return a.sent(),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 3:return a.sent(),this._participantState="ACCEPTED",Qt.onCallAccepted(),Qt.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Qt.onConversation(this._conversation.externalId,this._conversation.mediaModifiers),Qt.onLocalStatus(xt.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),"MUTE"!==this._conversation.muteState&&"MUTE_PERMANENT"!==this._conversation.muteState?[3,5]:[4,this._processMuteState()];case 4:a.sent(),a.label=5;case 5:for(this._state="ACTIVE",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id),Qt.onParticipantStatus(r.externalId,xt.WAITING);return[2,this._conversation];case 6:throw i=a.sent(),this._close(i,"Unable to accept call"),i;case 7:return[2]}}))}))},t.prototype.decline=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){switch(e.label){case 0:if("IDLE"!==this._state)throw Un.log("callError","declineIncoming"),Jt.error("Unable to decline a call - invalid state"),new Error("Unable to decline a call - invalid state");return this._state="PROCESSING",Jt.debug("Decline incoming call"),Un.log("callDeclineIncoming",this._mediaSource&&this._mediaSource.getMediaSettings().isVideoEnabled?"video":"audio"),this._participantState="HUNGUP",this._signaling?[4,this._signaling.hangup(vt.REJECTED)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._close(new Wn(vt.REJECTED)),[2]}}))}))},t.prototype.hangup=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return Jt.debug("Hangup"),e="ACTIVE"===this._state?vt.HUNGUP:vt.CANCELED,Un.log("callHangup",e),this._signaling?[4,this._signaling.hangup(e)]:[3,2];case 1:return t.sent(),this._close(new Wn(e)),[3,3];case 2:Qt.onHangup(new Wn(vt.HUNGUP),this._conversation&&this._conversation.id),t.label=3;case 3:return[2]}}))}))},t.prototype.addParticipant=function(e,t){return et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.addParticipant(e,t)]:(this._close(new Wn(vt.UNKNOWN_ERROR),"Unable to add participant"),[2]);case 1:return n=i.sent(),r=null,"error"===n.type&&(r="call-unfeasible"===n.error?n.status:vt.UNKNOWN_ERROR),[4,this._onAddParticipant(e,r)];case 2:return i.sent(),[2]}}))}))},t.prototype.removeParticipant=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.removeParticipant(e,t)]:[3,2];case 1:n.sent(),this._onRemoveParticipant(e),n.label=2;case 2:return[2]}}))}))},t.prototype.setVolume=function(e){this._audioOutput.volume=e},t.prototype.updateStatisticsInterval=function(){this._transport&&this._transport.updateStatisticsInterval()},t.prototype._close=function(e,n){n&&Jt.error(n,e),Jt.debug("Close conversation",e),e.error?this._signaling&&this._signaling.hangup(vt.FAILED):Un.log("callError",e.hangup),t._activationMutex=!1;var r=this._conversation&&this._conversation.id;return-1!==[vt.CANCELED,vt.NOT_FRIENDS,vt.CALLEE_IS_OFFLINE,vt.CALLER_IS_BLOCKED].indexOf(e.hangup)||e.hangup===vt.REJECTED&&!e.remote?(Qt.onHangup(e,r),void this.destroy()):(e.hangup!==vt.HUNGUP||e.remote&&"CALLED"!==this._participantState)&&(e.hangup!==vt.MISSED||e.remote)?e.hangup===vt.SOCKET_CLOSED&&t._current&&!this._conversation?(this._cleanupSignaling(),void this._cleanupMediaSource()):e.hangup!==vt.BUSY||e.remote?(this._state="CLOSE",this._participantState="HUNGUP",this._changeFeatureSet(),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupParticipantAgnosticStreams(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._api.cleanup(),Un.destroy(),this._conversation=null,t._current=null,t._delayedHangup=!1,void Qt.onHangup(e||new Wn(vt.UNKNOWN_ERROR),r)):(this._cleanupSignaling(),void this._cleanupMediaSource()):(Qt.onHangup(e,r),void this.destroy())},t.prototype.destroy=function(){var e=this._conversation&&this._conversation.id;Jt.debug("Destroy conversation",{conversationId:e}),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupParticipantAgnosticStreams(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._api.cleanup(),this._cleanupListeners(),Un.destroy(),this._conversation=null,t._current=null,t._delayedHangup=!1},t.prototype._getConversationParams=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:return[4,this._api.getConversationParams()];case 1:return e=a.sent(),Jt.debug("Api.getConversationParams",e),t=[],n=e.turn_server,(r=e.stun_server)&&t.push(r),n&&((i=n.urls.filter((function(e,t,n){return n.indexOf(e)===t}))).forEach((function(e){return i.push(e+"?transport=tcp")})),n.urls=i,t.push(n)),Vt.iceServers=t,Vt.wssBase=e.endpoint,Vt.wssToken=e.token,e.client_type&&(Vt.clientType=e.client_type),[2]}}))}))},t.prototype._startConversation=function(e,t,n,r,i,a,o){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),void 0===o&&(o=!1),et(this,void 0,void 0,(function(){var s,c,u;return tt(this,(function(l){switch(l.label){case 0:return s=$t.uuid(),Jt.debug("Conversation: start",{conversationId:s,opponentIds:e,opponentType:t,direction:n,withVideo:r}),[4,this._api.startConversation(s,e,t,r,i,a,o)];case 1:return c=l.sent(),Jt.debug("Api.startConversation",c),[4,this._getConversationParams()];case 2:return l.sent(),[4,this._connectSignaling(yt.START,c)];case 3:return u=l.sent(),[4,this._setConversation(c,u,n)];case 4:return l.sent(),[2,u]}}))}))},t.prototype._joinConversation=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return tt(this,(function(c){switch(c.label){case 0:return t=e.conversationId,n=e.needVideo,r=void 0!==n&&n,i=e.chatId,a=e.joinLink,Jt.debug("Conversation: join",{conversationId:t,joinLink:a,needVideo:r}),t?[4,this._api.joinConversation(t,r,i)]:[3,2];case 1:return o=c.sent(),[3,5];case 2:return a?[4,this._api.joinConversationByLink(a,r)]:[3,4];case 3:return o=c.sent(),[3,5];case 4:throw new Wn(vt.UNKNOWN_ERROR);case 5:return Jt.debug("Api.joinConversation",o),[4,this._getConversationParams()];case 6:return c.sent(),[4,this._connectSignaling(yt.JOIN,o)];case 7:return s=c.sent(),[4,this._setConversation(o,s,"JOINING")];case 8:return c.sent(),[2,s]}}))}))},t.prototype._prepareConversation=function(e,n,r){return void 0===n&&(n="USER"),et(this,void 0,void 0,(function(){var i,a,o;return tt(this,(function(s){switch(s.label){case 0:return Jt.debug("Conversation: push",{conversationId:e,type:n,peerId:r}),[4,this._getConversationParams()];case 1:if(s.sent(),!(i=this._api.getUserId()))throw new Wn(vt.UNKNOWN_ERROR);return a={id:e,peerId:r,endpoint:Vt.wssBase+"?userId="+i+"&entityType="+n+"&conversationId="+e+"&token="+Vt.wssToken,is_concurrent:!1,p2p_forbidden:!1},[4,this._connectSignaling(yt.ACCEPT,a)];case 2:return o=s.sent(),!t._current||"ACCEPTED"!==t._current._participantState&&"CALLED"!==t._current._participantState?(t._current&&(t._current.destroy(),t._current=null),[4,this._setConversation(a,o,"INCOMING",n)]):(Jt.log("Push rejected (busy)"),Un.log("callPush","busy"),this._signaling&&this._signaling.hangup(vt.BUSY),[2,Promise.reject({hangup:vt.BUSY})]);case 3:return s.sent(),[2,o]}}))}))},t.prototype._createParticipant=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return t=Object.assign({id:null,externalId:null,mediaSettings:null,participantState:null,state:null,remoteStream:null,remoteVideoTrack:null,remoteAudioTrack:null,mediaSource:null,platform:null,clientType:null,roles:[],networkRating:1},e),n=t,[4,this._getUserId(t.id)];case 1:return n.externalId=r.sent(),[2,t]}}))}))},t.prototype._getUserId=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._api.userId(e)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),this._close(new Wn(vt.NETWORK_ERROR),t),t;case 3:return[2]}}))}))},t.prototype._setConversation=function(e,t,n,r){var i,a;return void 0===r&&(r="USER"),et(this,void 0,void 0,(function(){var o,s,c,u;return tt(this,(function(l){switch(l.label){case 0:if(!(o=this._api.getUserId())){if(!(s=null===(a=null===(i=t.conversation)||void 0===i?void 0:i.participants)||void 0===a?void 0:a.find((function(e){return e.peerId&&e.peerId.id===t.peerId.id&&e.peerId.type===t.peerId.type}))))throw new Wn(vt.UNKNOWN_ERROR);o=String(s.id),r=s.idType,this._api.setUserId(o)}return c=$t.composeId(o,r),[4,this._getUserId(c)];case 1:return u=l.sent(),this._conversation={userId:o,compositeUserId:c,externalId:u,acceptTime:t.conversation.acceptTime,features:t.conversation.features||[],id:t.conversation.id||e.id,participants:(t.conversation.participants||[]).map((function(e){return e.id=String(e.id),e})),participantsLimit:t.conversation.participantsLimit||30,topology:t.conversation.topology||"DIRECT",direction:n,concurrent:t.isConcurrent||e.is_concurrent||!1,needRate:!1,chatId:t.conversation.multichatId,roles:[],recordInfo:null,joinLink:e.join_link,pinnedParticipantId:null,mediaModifiers:t.mediaModifiers,options:[],muteState:"UNMUTE",muteOptions:[],networkRating:1},this._signaling.setConversationId(e.id),e.p2p_forbidden&&(Vt.forceRelayPolicy=e.p2p_forbidden),Un.log("callForceRelay",Vt.forceRelayPolicy?"1":"0"),this._changeFeatureSet(),this._logDevices(),[2]}}))}))},t.prototype._createMediaSource=function(){var e=new Qn;return this.subscribe(e,"SOURCE_CHANGED",this._onLocalMediaStreamChanged.bind(this)),this.subscribe(e,"SCREEN_STATUS",this._onScreenSharingStatus.bind(this)),this._audioFix=new Vn(e),e},t.prototype._connectSignaling=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return this._signaling.setEndpoint(t.endpoint),this.subscribe(this._signaling,"NOTIFICATION",this._onSignalingNotification.bind(this)),this.subscribe(this._signaling,"FAILED",this._onSignalingFailed.bind(this)),this.subscribe(this._signaling,"RECONNECT",this._onSignalingReconnect.bind(this)),[2,this._signaling.connect(e,t)]}))}))},t.prototype._registerParticipants=function(){var e;return et(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return tt(this,(function(c){switch(c.label){case 0:return this._conversation?(t=this._conversation.participants.map((function(e){return e.id})),[4,this._api.prepareUserIds(t)]):[2];case 1:c.sent(),n=0,r=this._conversation.participants,c.label=2;case 2:return n<r.length?(i=r[n],(a=$t.composeParticipantId(i))===this._conversation.compositeUserId?(this._conversation.roles=i.roles||[],this._conversation.roles.length&&(Jt.debug("Local roles changed: "+i.roles),Qt.onLocalRolesChanged(i.roles)),[3,4]):"HUNGUP"===i.state||"REJECTED"===i.state?(this._removeParticipant(i,vt.HUNGUP),[3,4]):(o=this._participants,s=a,[4,this._createParticipant({id:a,mediaSettings:i.mediaSettings,participantState:null===(e=i.participantState)||void 0===e?void 0:e.state,state:i.state,roles:i.roles||[]})])):[3,5];case 3:o[s]=c.sent(),i.roles&&i.roles.length&&(Jt.debug("Roles for participant ["+a+"] changed: "+i.roles),Qt.onRolesChanged(this._participants[a].externalId,i.roles)),c.label=4;case 4:return n++,[3,2];case 5:return[2]}}))}))},t.prototype._processConnectionData=function(e){"MUTE"!==e.muteState&&"MUTE_PERMANENT"!==e.muteState||this._onMuteParticipant(e.muteOptions,!1,e.muteState),e.conversation.pinnedParticipantId&&this._onPinParticipant(e.conversation.pinnedParticipantId),this._onRecordInfo(e.conversation.recordInfo),this._onOptionsChanged(e.conversation.options)},t.prototype._allocateTransport=function(){if(this._conversation&&this._signaling&&this._mediaSource){this._transport=new br(this._conversation.topology,this._signaling,this._mediaSource,this._serverSettings),this._debugInfo=new Hn,this.subscribe(this._transport,"STATE_CHANGED",this._onTransportStateChanged.bind(this)),this.subscribe(this._transport,"LOCAL_STATE_CHANGED",this._onTransportLocalStateChanged.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_ADDED",this._onRemoteTrackAdded.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_REMOVED",this._onRemoteTrackRemoved.bind(this)),this.subscribe(this._transport,"REMOTE_ALL_STALL",this._onRemoteAllStall.bind(this)),this.subscribe(this._transport,"REMOTE_DATA_STATS",this._onRemoteDataStats.bind(this)),this.subscribe(this._transport,"SIGNALLED_STALLED_PARTICIPANTS",this._onRemoteSignalledStall.bind(this)),this.subscribe(this._transport,"ACTIVE_PARTICIPANTS_NO_SIGNAL",this._onRemoteActivityNoSignal.bind(this)),this.subscribe(this._transport,"TOPOLOGY_CHANGED",this._onTopologyChanged.bind(this)),this.subscribe(this._transport,"SIGNALLED_NETWORK_STATUS",this._onNetworkStatus.bind(this)),this.subscribe(this._transport,"REMOTE_STREAM_SECOND",this._onRemoteStreamSecond.bind(this));for(var e="OUTGOING"===this._conversation.direction&&!this._conversation.concurrent,t=0,n=Object.values(this._participants);t<n.length;t++){var r=n[t];"ACCEPTED"!==r.state&&"CALLED"!==r.state||this._transport.allocate(r.id,e)}}},t.prototype._createSpeakerDetector=function(){this._transport&&(this._volumesDetector=new Cr(this._transport),this.subscribe(this._volumesDetector,"VOLUMES_DETECTED",this._onVolumesDetected.bind(this)),this._speakerDetector=new qn(this._volumesDetector,this._transport),this.subscribe(this._speakerDetector,"SPEAKER_CHANGED",this._onSpeakerChanged.bind(this)),this._localVolumeDetector=new Kn(this._mediaSource))},t.prototype._createSpecListener=function(){this._transport&&this._volumesDetector&&(this._specListener=new Jn(this._transport,this._volumesDetector,this._participants))},t.prototype._logDevices=function(){var e=Mn.getCameras().length,t=Mn.getMicrophones().length;Jt.debug("Cameras: "+e+(Mn.hasCameraPermission()?"✔":"✖")+", Microphones: "+t+(Mn.hasMicrophonePermission()?"✔":"✖")),Un.log("callDevices",e+"_"+t)},t.prototype._removeParticipant=function(e,t){var n,r;if("CALLED"!==e.state&&"ACCEPTED"!==e.state&&"CLOSE"!==this._state&&this._participants[e.id]){t===vt.HUNGUP?Qt.onParticipantStatus(e.externalId,xt.HANGUP):Qt.onParticipantStatus(e.externalId,xt.ERROR,t),null===(n=e.mediaSource)||void 0===n||n.disconnect(),null===(r=e.remoteAudioTrack)||void 0===r||r.stop(),this._conversation&&this._conversation.pinnedParticipantId===e.id&&(this._conversation.pinnedParticipantId=null);var i=this._streamWaitTimerByParticipantId[e.id];i&&(window.clearTimeout(i),delete this._streamWaitTimerByParticipantId[e.id]),delete this._participants[e.id],Qt.onRemoteRemoved(e.externalId)}},t.prototype._cleanupListeners=function(){this.unsubscribe(),window.removeEventListener("unload",this._onUnload)},t.prototype._cleanupMediaSource=function(){this._mediaSource&&(this._mediaSource.destroy(),this._mediaSource=null)},t.prototype._cleanupParticipants=function(){Object.values(this._participants).forEach((function(e){var t,n,r,i,a;null===(t=e.remoteStream)||void 0===t||t.getTracks().forEach((function(e){return e.stop()})),null===(n=e.secondStream)||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),null===(r=e.remoteAudioTrack)||void 0===r||r.stop(),null===(i=e.remoteVideoTrack)||void 0===i||i.stop(),null===(a=e.mediaSource)||void 0===a||a.disconnect()})),this._participants={},this._audioOutput&&this._audioOutput.destroy()},t.prototype._cleanupParticipantAgnosticStreams=function(){Object.values(this._trackDataByStreamId).forEach((function(e){null==e||e.videoStream.getTracks().forEach((function(e){e.stop()}))})),this._trackDataByStreamId={};for(var e=0,t=Object.values(this._streamWaitTimerByParticipantId);e<t.length;e++){var n=t[e];window.clearTimeout(n)}this._streamWaitTimerByParticipantId={}},t.prototype._cleanupTransport=function(){this._transport&&(this._transport.destroy(),this._transport=null),this._debugInfo&&(this._debugInfo=null)},t.prototype._cleanupSpeakerDetector=function(){this._speakerDetector&&(this._speakerDetector.destroy(),this._speakerDetector=null),this._volumesDetector&&(this._volumesDetector.destroy(),this._volumesDetector=null),this._localVolumeDetector&&(this._localVolumeDetector.destroy(),this._localVolumeDetector=null)},t.prototype._cleanupSpecListener=function(){this._specListener&&(this._specListener.destroy(),this._specListener=null)},t.prototype._cleanupSignaling=function(){this._signaling&&(this._signaling.close(),this._signaling.cleanup())},t.prototype._onAddParticipant=function(e,t){return et(this,void 0,void 0,(function(){var n,r,i;return tt(this,(function(a){switch(a.label){case 0:return Jt.debug("Add new participant ["+e+"]"),!(n=this._participants[e])||"ACCEPTED"!==n.state&&"CALLED"!==n.state?n?[3,2]:(r=this._participants,i=e,[4,this._createParticipant({id:e})]):(Jt.warn("Participant ["+n.id+":"+n.state+"] is already in conversation"),[2]);case 1:r[i]=a.sent(),n=this._participants[e],a.label=2;case 2:return Qt.onParticipantStatus(n.externalId,xt.WAITING),t?(n.state="HUNGUP",this._removeParticipant(n,t)):this._transport&&(n.state="CALLED",this._transport.allocate(n.id,!0),Un.log("callAddParticipant")),[2]}}))}))},t.prototype._onRemoveParticipant=function(e){Jt.debug("Remove participant ["+e+"]");var t=this._participants[e];t?(this._transport&&this._transport.close(t.id),Un.log("callRemoveParticipant")):Jt.warn("Participant ["+e+"] isn't in conversation")},t.prototype.changeDevice=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return this._mediaSource?("audioinput"===e&&(this._audioFix=new Vn(this._mediaSource)),[2,this._mediaSource.changeDevice(e)]):[2,Promise.reject(ft.UNKNOWN)]}))}))},t.prototype.toggleScreenCapturing=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleScreenCapturing(e)]:[2,Promise.reject(ft.UNKNOWN)]}))}))},t.prototype.setVideoStream=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){return this._mediaSource?[2,this._mediaSource.setVideoStream(e,t)]:[2]}))}))},t.prototype.toggleLocalVideo=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return this._mediaSource?(Un.log("callMediaStatus",e?"video_1":"video_0"),[2,this._mediaSource.toggleVideo(e)]):[2]}))}))},t.prototype.toggleLocalAudio=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return this._mediaSource?(Un.log("callMediaStatus",e?"audio_1":"audio_0"),[2,this._mediaSource.toggleAudio(e)]):[2]}))}))},t.prototype.changePriorities=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l;return tt(this,(function(d){switch(d.label){case 0:if(e.length<2||!this._signaling)return[2];for(t={},n={},r=0,i=e;r<i.length;r++)a=i[r],o="object"==typeof a.uid?a.uid:Ln.fromId(a.uid),l=Ln.toString(o),n[l]=a.priority;for(s=0,c=Object.values(this._participants);s<c.length;s++)u=c[s],l=Ln.toString(u.externalId),n.hasOwnProperty(l)&&(t[u.id]=n[l]);return[4,this._signaling.changePriorities(t)];case 1:return d.sent(),[2]}}))}))},t.prototype.changeParticipantState=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a;return tt(this,(function(o){switch(o.label){case 0:for(t=0,n=Object.entries(e);t<n.length;t++)if(r=n[t],i=r[0],a=r[1],i.length>5||a.length>5)throw new Error("key/value max length is 5 chars, mappings with empty values (null or empty string) are discarded");return[4,this._signaling.changeParticipantState(e)];case 1:return o.sent(),[2]}}))}))},t.prototype.updateDisplayLayout=function(e){return et(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,p,h,f,m,v,_,g,A,y,E,S,b;return tt(this,(function(C){switch(C.label){case 0:if(e.length<1||!this._signaling)return[2];for(n={},r={},i={},a=0,o=e;a<o.length;a++)s=o[a],c="object"==typeof s.uid?s.uid:Ln.fromId(s.uid),p=Ln.toString(c),r[p]=t._layoutToString(s),s.stopStream&&(i[p]=!0);for(u=0,l=Object.values(this._participants);u<l.length;u++)d=l[u],p=Ln.toString(d.externalId),(h=r[p])&&(d.lastRequestedLayout=h,n[d.id]=h),f=this._streamWaitTimerByParticipantId[d.id],i[p]&&f&&(window.clearTimeout(f),delete this._streamWaitTimerByParticipantId[d.id]);return[4,this._signaling.updateDisplayLayout(n)];case 1:if(!(m=C.sent()))return[2];for(v=[],_=0,g=Object.entries(m.errorCodeByParticipantId||{});_<g.length;_++)A=g[_],y=A[0],E=A[1],(S=this._participants[y])&&(b=void 0,"number"!=typeof E?(Jt.warn("Unexpected error code "+E+" received for participant "+y),b=St.UNKNOWN_ERROR):b=bt(E),v.push({externalId:S.externalId,errorReason:b}));if(v&&v.length)throw new Or("Could not allocate one or more participants",v);return[2]}}))}))},t.prototype._onParticipantSourcesUpdate=function(e){if(this._conversation){Jt.log("Received participant sources update notification",e);for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],a=i.participantId;i.streamId||(t[a]=!0),this._waitForStreamIfNeeded(i)}for(var o=0,s=Object.values(this._trackDataByStreamId);o<s.length;o++){var c=s[o];c&&c.currentParticipant&&t[c.currentParticipant]&&(c.currentParticipant=null)}}},t.prototype._waitForStreamIfNeeded=function(e){var t=e.participantId;this._streamWaitTimerByParticipantId[t]&&(window.clearTimeout(this._streamWaitTimerByParticipantId[t]),delete this._streamWaitTimerByParticipantId[t]);var n=this._participants[t];if(n){var r=e.streamId;if(!r)return Un.log("patDeallocate"),void Qt.onRemoteStream(n.externalId,null);var i=this._getWaitingTime(r,e.rtpTimestamp);if(i<=0){var a=this._trackDataByStreamId[r];if(!a)return Un.log("patError","streamNotFound"),void Jt.error("Could not find track data by stream ID: "+r);Un.log("patAllocate"),a.currentParticipant=t,Qt.onRemoteStream(n.externalId,a.currentStream)}else Jt.debug("Waiting for "+i+" until stream "+r+" is switched"),this._streamWaitTimerByParticipantId[t]=window.setTimeout(this._waitForStreamIfNeeded.bind(this,e),i)}else e.streamId&&(Un.log("patError","participantMissing"),Jt.error("Could not find participant by ID: "+t))},t.prototype._getWaitingTime=function(e,t){if(this._transport)return this._transport.getStreamWaitingTimeMs(e,t);throw new Error("transport is not initialized")},t.prototype._isCallAdmin=function(){return!!this._conversation&&$t.includesOneOf(this._conversation.roles,[Ct.ADMIN,Ct.CREATOR])},t.prototype._checkAdminRole=function(){if(this._conversation&&!$t.includesOneOf(this._conversation.roles,[Ct.ADMIN,Ct.CREATOR]))throw new Error("You don't have the required permission")},t.prototype.grantRoles=function(e,t,n){return et(this,void 0,void 0,(function(){return tt(this,(function(r){switch(r.label){case 0:return this._checkAdminRole(),[4,this._signaling.grantRoles(e,t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.switchParticipantDevice=function(e,t,n,r){return void 0===e&&(e=null),void 0===r&&(r=!1),et(this,void 0,void 0,(function(){return tt(this,(function(i){switch(i.label){case 0:return this._checkAdminRole(),[4,this._signaling.muteParticipant(e,t,n,r)];case 1:return i.sent(),[2]}}))}))},t.prototype.pinParticipant=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return this._checkAdminRole(),[4,this._signaling.pinParticipant(e,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.updateMediaModifiers=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return this._signaling&&this._conversation?(this._conversation.mediaModifiers=e,[4,this._signaling.updateMediaModifiers(e)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.changeOptions=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return this._signaling&&this._conversation?(this._checkAdminRole(),[4,this._signaling.changeOptions(e)]):[3,2];case 1:n.sent(),t=function(e,t){for(var n=new Set(e),r=0,i=Object.entries(t);r<i.length;r++){var a=i[r],o=a[0];a[1]?n.add(o):n.delete(o)}return Array.from(n)}(this._conversation.options,e),this._onOptionsChanged(t),n.label=2;case 2:return[2]}}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.chatMessage(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatHistory=function(e){return et(this,void 0,void 0,(function(){var t,n,r;return tt(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.chatHistory(e)]:[3,5];case 1:t=i.sent(),n=t.messages.length-1,i.label=2;case 2:return n>=0?(r=t.messages[n],[4,this._onChatMessage(r)]):[3,5];case 3:i.sent(),i.label=4;case 4:return n--,[3,2];case 5:return[2]}}))}))},t.prototype.customData=function(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.customData(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.createJoinLink=function(){return et(this,void 0,void 0,(function(){var e,t;return tt(this,(function(n){switch(n.label){case 0:return this._conversation?[4,this._api.createJoinLink(this._conversation.id)]:[3,2];case 1:if(e=n.sent(),t=e.join_link)return this._conversation.joinLink=t,[2,t];n.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.removeJoinLink=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){switch(e.label){case 0:return this._conversation?[4,this._api.removeJoinLink(this._conversation.id)]:[3,2];case 1:if(e.sent().success)return delete this._conversation.joinLink,[2];e.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.startStream=function(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),et(this,void 0,void 0,(function(){var a,o;return tt(this,(function(s){switch(s.label){case 0:return a={movieId:n,name:t,privacy:r,groupId:i,streamMovie:!e},[4,this._signaling.startStream(a)];case 1:return(o=s.sent()).error?[2,Promise.reject(o.message)]:[2,o]}}))}))},t.prototype.stopStream=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return[4,this._signaling.stopStream()];case 1:return(e=t.sent()).error?[2,Promise.reject()]:[2,e]}}))}))},t.prototype.getStreamInfo=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return[4,this._signaling.getRecordStatus()];case 1:return[2,{movieId:(e=t.sent()).recordMovieId,preview:e.recordMoviePreviewUrl}]}}))}))},t.prototype.setLocalResolution=function(e,t){var n;return et(this,void 0,void 0,(function(){return tt(this,(function(r){if(e<Vt.videoMinWidth||t<Vt.videoMinHeight)throw new Error("Sizes received are less than the `videoMinWidth` or `videoMinHeight`");return Vt.videoMaxWidth=e,Vt.videoMaxHeight=t,[2,null===(n=this._mediaSource)||void 0===n?void 0:n.setResolution(e,t)]}))}))},t.prototype.videoEffect=function(e){var t;return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,null===(t=this._mediaSource)||void 0===t?void 0:t.videoEffect(e)]}))}))},t.prototype._onLocalMediaStreamChanged=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return Jt.debug("Local media stream changed",e.mediaSettings),Qt.onLocalStreamUpdate(e.mediaSettings,e.kind),this._signaling?[4,this._signaling.changeMediaSettings(e.mediaSettings)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._onScreenSharingStatus=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return Jt.debug("Screen sharing changed",e.track,e.mediaSettings),[2]}))}))},t._layoutToString=function(e){var t="";return void 0!==e.priority&&(t+="p="+e.priority),void 0!==e.width&&void 0!==e.height&&(""!==t&&(t+=":"),t+="sz="+Math.round(e.width)+"x"+Math.round(e.height)),void 0!==e.fit&&(""!==t&&(t+=":"),t+="fit="+e.fit),e.keyFrame&&(""!==t&&(t+=":"),t+="kf"),e.stopStream&&(""!==t&&(t+=":"),t+="ss"),t},t.prototype._changeRemoteMediaSettings=function(e,t){Jt.debug("Remote media settings changed ["+e+"]",t);var n=this._participants[e];n&&(n.mediaSettings=t,n.remoteStream&&n.remoteVideoTrack&&t.isVideoEnabled&&(n.remoteStream.addTrack(n.remoteVideoTrack),n.remoteVideoTrack=null),"ACTIVE"===this._state&&Qt.onRemoteMediaSettings(n.externalId,t),this._specListener&&this._specListener.onChangeRemoteMediaSettings(e,t))},t.prototype._changeRemoteParticipantState=function(e,t){Jt.debug("Remote participant state changed ["+e+"]",t);var n=this._participants[e];n&&(n.participantState=t||{},"ACTIVE"===this._state&&Qt.onRemoteParticipantState(n.externalId,n.participantState))},t.prototype._onSignalingNotification=function(e){var t;switch(e.notification){case"accepted-call":return this._onAcceptedCall(e);case"hungup":return this._onHungup(e);case"participant-added":return this._onAddedParticipant(e);case"participant-joined":return this._onJoinedParticipant(e);case"closed-conversation":return this._onClosedConversation(e);case"media-settings-changed":return this._onMediaSettingsChanged(e);case"participant-state-changed":return this._onParticipantStateChanged(e);case"rate-call-data":return this._onNeedRate();case"feature-set-changed":return this._onFeatureSetChanged(e);case"multiparty-chat-created":return this._onMultipartyChatCreated(e);case"force-media-settings-change":return this._onForceMediaSettingsChange(e);case"settings-update":return this._onSettingsUpdate(e);case"video-quality-update":return this._onVideoQualityUpdate(e);case"registered-peer":return this._onPeerRegistered(e);case"switch-micro":return this._onMicSwitched(e);case"chat-message":return this._onChatMessage(e);case"custom-data":return this._onCustomData(e);case"record-started":return this._onRecordInfo(e.recordInfo);case"record-stopped":return this._onRecordInfo(null);case"roles-changed":return this._onRolesChanged(e.participantId,e.roles||[]);case"mute-participant":var n=e.unmute?(null===(t=this._conversation)||void 0===t?void 0:t.muteState)||"UNMUTE":e.mutePermanent?"MUTE_PERMANENT":"MUTE";return this._onMuteParticipant(e.mediaOptions||[],e.unmute||!1,n);case"pin-participant":return this._onPinParticipant(e.participantId,e.unpin);case"options-changed":return this._onOptionsChanged(e.options||[]);case"participant-sources-update":return this._onParticipantSourcesUpdate(e.participantUpdateInfos)}},t.prototype._onSignalingReconnect=function(e){var t,n;return et(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d,p,h,f,m,v;return tt(this,(function(_){switch(_.label){case 0:if(!this._conversation)return[2];if(e.conversation.acceptTime&&(this._conversation.acceptTime=e.conversation.acceptTime),e.conversation.participantsLimit&&(this._conversation.participantsLimit=e.conversation.participantsLimit),e.conversation.features&&(this._conversation.features=e.conversation.features,this._changeFeatureSet()),e.conversation.pinnedParticipantId!==this._conversation.pinnedParticipantId&&(e.conversation.pinnedParticipantId?this._onPinParticipant(e.conversation.pinnedParticipantId,!1):this._conversation.pinnedParticipantId&&this._onPinParticipant(this._conversation.pinnedParticipantId,!0)),e.conversation.topology,e.conversation.state,r=null,!e.conversation.participants)return[3,6];i=Object.keys(this._participants),a=[],o=0,s=e.conversation.participants,_.label=1;case 1:return o<s.length?(c=s[o],u=$t.composeParticipantId(c),l=c.roles||[],u===this._conversation.compositeUserId?(r=c.mediaSettings,wt(this._conversation.roles,l)||this._onRolesChanged(u,l),[3,4]):(a.push(u),(d=this._participants[u])?[3,3]:[4,this._onJoinedParticipant({participantId:c.id,participantType:c.idType,mediaSettings:c.mediaSettings,participantState:null===(t=c.participantState)||void 0===t?void 0:t.state,state:c.state,roles:l})])):[3,5];case 2:return _.sent(),[3,4];case 3:g=c.mediaSettings,A=d.mediaSettings,(g.isAudioEnabled!==A.isAudioEnabled||g.isVideoEnabled!==A.isVideoEnabled||g.isScreenSharingEnabled!==A.isScreenSharingEnabled||g.isDataEnabled!==A.isDataEnabled)&&this._changeRemoteMediaSettings(u,c.mediaSettings),p=(null===(n=c.participantState)||void 0===n?void 0:n.state)||{},h=d.participantState||{},$t.comparePlainObjects(p,h)||this._changeRemoteParticipantState(u,p),wt(l,d.roles)||this._onRolesChanged(d.id,l),_.label=4;case 4:return o++,[3,1];case 5:for(f=0,m=i;f<m.length;f++)v=m[f],a.indexOf(v)<0&&this._removeParticipant(this._participants[v],vt.HUNGUP);_.label=6;case 6:return"MUTE"!==e.muteState&&"MUTE_PERMANENT"!==e.muteState||this._onMuteParticipant(e.muteOptions,!1,e.muteState,r),e.unmuteOptions&&e.unmuteOptions.length&&this._onMuteParticipant(e.unmuteOptions,!0,e.muteState,r),this._onRecordInfo(e.conversation.recordInfo),this._onOptionsChanged(e.conversation.options),[2]}var g,A}))}))},t.prototype._onSignalingFailed=function(e){Jt.error("Signaling failed",e),this._close(e)},t.prototype._onAcceptedCall=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a;return tt(this,(function(o){switch(o.label){case 0:return t=$t.composeMessageId(e),n=$t.getPeerIdString(e.peerId),Jt.debug("Participant accepted call ["+t+"]"),this._conversation&&t===this._conversation.compositeUserId?(this._close(new Wn(vt.MISSED),"Call accepted on other device"),[2]):(r=this._participants[t])?[3,2]:(i=this._participants,a=t,[4,this._createParticipant({id:t})]);case 1:i[a]=o.sent(),r=this._participants[t],o.label=2;case 2:return r.state="ACCEPTED",r.mediaSettings=e.mediaSettings,Un.log("callAcceptedOutgoing",r.mediaSettings.isVideoEnabled?"video":"audio"),!this._conversation||"OUTGOING"!==this._conversation.direction||"IDLE"!==this._state&&"PROCESSING"!==this._state||(this._state="ACTIVE",this._changeFeatureSet()),"ACTIVE"===this._state&&this._transport&&this._transport.open(r.id,n),this._changeRemoteMediaSettings(t,e.mediaSettings),this._changeRemoteParticipantState(t,null),[2]}}))}))},t.prototype._onHungup=function(e){Jt.debug("Participant hungup ["+e.participantId+"]",{reason:e.reason});var t=$t.composeMessageId(e);if(this._conversation&&this._conversation.compositeUserId===t)this._close(new Wn(e.reason));else{var n=this._participants[t];n?(this._transport&&this._transport.close(t),n.state=e.reason===vt.REJECTED?"REJECTED":"HUNGUP","CLOSE"!==this._state&&this._removeParticipant(n,vt.HUNGUP)):Jt.warn("Participant ["+t+"] isn't in conversation")}},t.prototype._onAddedParticipant=function(e){var t,n,r,i;return et(this,void 0,void 0,(function(){var a,o,s,c;return tt(this,(function(u){switch(u.label){case 0:return Jt.debug("Participant added ["+e.participantId+"]"),a=$t.composeMessageId(e),(o=this._participants[a])&&"HUNGUP"!==o.state&&"REJECTED"!==o.state?(Jt.debug("Participant ["+a+"] is already in conversation and is active"),[2]):o?[3,2]:(s=this._participants,c=a,[4,this._createParticipant({id:a})]);case 1:s[c]=u.sent(),o=this._participants[a],u.label=2;case 2:return o.state="CALLED",o.mediaSettings=null===(t=e.participant)||void 0===t?void 0:t.mediaSettings,o.participantState=null===(r=null===(n=e.participant)||void 0===n?void 0:n.participantState)||void 0===r?void 0:r.state,o.roles=(null===(i=e.participant)||void 0===i?void 0:i.roles)||[],Qt.onParticipantStatus(o.externalId,xt.WAITING),"ACTIVE"===this._state&&this._transport&&this._transport.allocate(o.id,!0),this._changeRemoteMediaSettings(a,o.mediaSettings),this._changeRemoteParticipantState(a,o.participantState),[2]}}))}))},t.prototype._onJoinedParticipant=function(e){var t,n,r;return et(this,void 0,void 0,(function(){var i,a,o,s;return tt(this,(function(c){switch(c.label){case 0:return Jt.debug("Participant joined ["+e.participantId+"]"),i=$t.composeMessageId(e),(a=this._participants[i])&&"ACCEPTED"===a.state?(Jt.warn("Participant ["+i+"] is already in conversation and is active"),[2]):a?[3,2]:(o=this._participants,s=i,[4,this._createParticipant({id:i})]);case 1:o[s]=c.sent(),a=this._participants[i],c.label=2;case 2:return!this._conversation||"OUTGOING"!==this._conversation.direction||"IDLE"!==this._state&&"PROCESSING"!==this._state||(this._state="ACTIVE",this._changeFeatureSet()),a.state="ACCEPTED",a.mediaSettings=e.mediaSettings,a.participantState=null===(n=null===(t=e.participant)||void 0===t?void 0:t.participantState)||void 0===n?void 0:n.state,a.roles=(null===(r=e.participant)||void 0===r?void 0:r.roles)||[],this._transport&&this._transport.isAllocated(a.id)?Qt.onParticipantStatus(a.externalId,xt.CONNECTED):Qt.onParticipantStatus(a.externalId,xt.WAITING),"ACTIVE"===this._state&&this._transport&&(this._transport.isAllocated(a.id)||this._transport.allocate(a.id,!0),this._transport.open(a.id)),this._changeRemoteMediaSettings(i,a.mediaSettings),this._changeRemoteParticipantState(i,a.participantState),[2]}}))}))},t.prototype._onClosedConversation=function(e){this._toggleJoinAvailability(),this._close(new Wn(e.reason,{remote:!0}))},t.prototype._onMediaSettingsChanged=function(e){var t=$t.composeMessageId(e);this._changeRemoteMediaSettings(t,e.mediaSettings)},t.prototype._onParticipantStateChanged=function(e){var t,n=$t.composeMessageId(e);this._changeRemoteParticipantState(n,null===(t=e.participantState)||void 0===t?void 0:t.state)},t.prototype._onNeedRate=function(){this._conversation&&(this._conversation.needRate=!0,this._changeNeedRate())},t.prototype._onFeatureSetChanged=function(e){this._conversation&&(this._conversation.features=e.features,this._changeFeatureSet())},t.prototype._onMultipartyChatCreated=function(e){this._conversation&&(this._conversation.chatId=e.chatId,this._toggleJoinAvailability(),Qt.onMultipartyChatCreated(this._conversation))},t.prototype._onForceMediaSettingsChange=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return this._mediaSource?(t=this._mediaSource.getMediaSettings()).isAudioEnabled===e.mediaSettings.isAudioEnabled?[3,2]:[4,this._mediaSource.toggleAudio(e.mediaSettings.isAudioEnabled)]:[2];case 1:n.sent(),n.label=2;case 2:return t.isVideoEnabled===e.mediaSettings.isVideoEnabled?[3,4]:[4,this._mediaSource.toggleVideo(e.mediaSettings.isVideoEnabled)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype._onSettingsUpdate=function(e){var t,n={camera:e.camera,screenSharing:e.screenSharing};this._serverSettings=Bn(this._serverSettings,n),this._signalingServerSettings=(t=this._serverSettings,{camera:Object.assign({},t.camera),screenSharing:Object.assign({},t.screenSharing)}),this._transport&&this._transport.updateSettings(this._serverSettings)},t.prototype._onVideoQualityUpdate=function(e){var t=this._serverSettings.camera,n=this._signalingServerSettings.camera;if(t&&n){var r=Math.min(Math.round(e.quality.maxBitrate/1024),n.maxBitrateK),i=Math.min(e.quality.maxDimension,n.maxDimension),a={camera:Object.assign({},t,{maxBitrateK:r,maxDimension:i}),screenSharing:null};this._serverSettings=Bn(this._serverSettings,a),Jt.log("Got video quality update notification",this._serverSettings),this._transport&&this._transport.updateSettings(this._serverSettings)}},t.prototype._onPeerRegistered=function(e){var t=$t.composeMessageId(e);this._participants[t]&&(this._participants[t].clientType=e.clientType,this._participants[t].platform=e.platform)},t.prototype._onMicSwitched=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return Qt.onDeviceSwitched(gt.AUDIO,!e.mute),[4,this.toggleLocalAudio(!e.mute)];case 1:return t.sent(),[2]}}))}))},t.prototype._onChatMessage=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return t=$t.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._getUserId(t)];case 2:n=r.sent(),r.label=3;case 3:return Qt.onChatMessage(e.message,n,e.direct),[2]}}))}))},t.prototype._onCustomData=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return t=$t.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._getUserId(t)];case 2:n=r.sent(),r.label=3;case 3:return Qt.onCustomData(e.data,n,e.direct),[2]}}))}))},t.prototype._onRecordInfo=function(e){return et(this,void 0,void 0,(function(){var t,n;return tt(this,(function(r){switch(r.label){case 0:return this._conversation?(t=!1,!this._conversation.recordInfo!=!e?t=!0:this._conversation.recordInfo&&e&&(t=this._conversation.recordInfo.recordMovieId!==e.recordMovieId),t?e?[4,this._getUserId(e.initiator)]:[3,2]:[3,3]):[2];case 1:return n=r.sent(),Qt.onRecordStarted(n,e.recordMovieId,e.recordStartTime,e.recordType,e.recordExternalMovieId,e.recordExternalOwnerId),[3,3];case 2:Qt.onRecordStopped(),r.label=3;case 3:return this._conversation.recordInfo=e,[2]}}))}))},t.prototype._onRolesChanged=function(e,t){if(this._conversation&&e===this._conversation.compositeUserId&&!wt(this._conversation.roles,t))return Jt.debug("Local roles changed: "+t),this._conversation.roles=t,void Qt.onLocalRolesChanged(t);var n=this._participants[e];n&&!wt(n.roles,t)&&(Jt.debug("Roles for participant ["+e+"] changed: "+t),n.roles=t,Qt.onRolesChanged(n.externalId,t))},t.prototype._onMuteParticipant=function(e,t,n,r){return et(this,void 0,void 0,(function(){return tt(this,(function(i){switch(i.label){case 0:return this._conversation?(this._conversation.muteOptions=e,this._conversation.muteState!==n||t?(this._conversation.muteState=n,[4,this._processMuteState(t,r)]):[2]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype._processMuteState=function(e,t){return void 0===e&&(e=!1),et(this,void 0,void 0,(function(){var n,r,i,a,o,s,c;return tt(this,(function(u){switch(u.label){case 0:if(!this._conversation||!this._mediaSource||"ACCEPTED"!==this._participantState)return[2];if(n=this._conversation.muteState,r=this._conversation.muteOptions,i="MUTE_PERMANENT"===n,a=this._mediaSource.getMediaSettings(),e){for(o=0,s=r;o<s.length;o++)c=s[o],Qt.onUnmuteRequest(c);return[2]}return!r.includes(gt.AUDIO)||!a.isAudioEnabled||t&&t.isAudioEnabled?[3,2]:(Qt.onDeviceSwitched(gt.AUDIO,!1),[4,this.toggleLocalAudio(!1)]);case 1:u.sent(),u.label=2;case 2:return!r.includes(gt.VIDEO)||!a.isVideoEnabled||t&&t.isVideoEnabled?[3,4]:(Qt.onDeviceSwitched(gt.VIDEO,!1),[4,this.toggleLocalVideo(!1)]);case 3:u.sent(),u.label=4;case 4:return Qt.onUnmutePermission(!i||this._isCallAdmin()),[2]}}))}))},t.prototype._onPinParticipant=function(e,t){if(void 0===t&&(t=!1),this._conversation){var n=this._conversation.pinnedParticipantId;n&&n!==e&&(this._participants[n]?Qt.onPinnedParticipant(this._participants[n].externalId,!0):this._conversation.compositeUserId===n&&Qt.onLocalPin(!0)),this._participants[e]?Qt.onPinnedParticipant(this._participants[e].externalId,t):this._conversation.compositeUserId===e&&Qt.onLocalPin(t),this._conversation.pinnedParticipantId=t?null:e}},t.prototype._onOptionsChanged=function(e){this._conversation&&!function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.includes(i))return!1}return!0}(this._conversation.options,e)&&(this._conversation.options=e,Qt.onOptionsChanged(e))},t.prototype._onNetworkStatus=function(e){if(this._conversation){Jt.log("Received network status update: ",e);for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],a=i[0],o=i[1],s=void 0;if(a===this._conversation.compositeUserId)s=this._conversation.networkRating;else{if(!this._participants[a])continue;s=this._participants[a].networkRating}if(s!==o)if(a===this._conversation.compositeUserId){this._conversation.networkRating=o,Qt.onLocalNetworkStatusChanged(o);var c=!s||s>Vt.badConnectionRating,u=o>Vt.badConnectionRating;c!==u&&Qt.onNetworkStatus(u)}else{var l=this._participants[a];l.networkRating=o,t.push({uid:l.externalId,rating:o})}}if(0===t.length)return;Qt.onNetworkStatusChanged(t)}},t.prototype._onRemoteStreamSecond=function(e,t){if(e.startsWith("pat")){Jt.debug("Participant-agnostic stream changed",e,t);var n=this._trackDataByStreamId[e];if(!n)return void Jt.error("Could not find track data by stream ID: "+e);n.currentStream=t||n.videoStream;var r=n.currentParticipant;if(!r)return;if(!(i=this._participants[r]))return;i.secondStream=t,Qt.onRemoteStream(i.externalId,n.currentStream)}else{var i;if(!(i=this._participants[e]))return;i.secondStream=t;var a=t||i.remoteStream;a&&Qt.onRemoteStream(i.externalId,a)}},t.prototype._changeFeatureSet=function(){if(this._conversation){var e="ACTIVE"===this._state,t=this._conversation.features.includes("ADD_PARTICIPANT");Qt.onCallState(e,t,this._conversation)}},t.prototype._changeNeedRate=function(){this._conversation&&this._conversation.needRate&&Qt.onRateNeeded()},t.prototype._onVolumesDetected=function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],a=i[0],o=i[1],s=this._participants[a];s&&s.externalId&&t.push({uid:s.externalId,volume:o.real})}Qt.onVolumesDetected(t)},t.prototype._onSpeakerChanged=function(e){this._activeSpeakerId=e,this._participants[e]&&this._lastSignalledActiveSpeakerId!==e&&(Qt.onSpeakerChanged(this._participants[e].externalId),this._lastSignalledActiveSpeakerId=e)},t.prototype._onTransportStateChanged=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return(n=this._participants[e])?(Jt.debug("Transport state for participant ["+e+"] has changed: "+t),"CONNECTED"===t&&(Qt.onParticipantStatus(n.externalId,xt.CONNECTED),Vt.onDemandTracks&&!n.remoteStream&&(n.mediaSettings&&this._changeRemoteMediaSettings(e,n.mediaSettings),this._changeRemoteParticipantState(e,n.participantState)),this._updateDisplayLayoutFromCache(e)),"CONNECTING"!==t&&"OPENED"!==t||Qt.onParticipantStatus(n.externalId,xt.CONNECTING),"RECONNECTING"===t&&Qt.onParticipantStatus(n.externalId,xt.RECONNECT),[2]):(Jt.warn("Participant ["+e+"] isn't in conversation"),[2])}))}))},t.prototype._onTransportLocalStateChanged=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return Jt.debug("Local transport state has changed: "+e),"CONNECTED"===e&&Qt.onLocalStatus(xt.CONNECTED),"CONNECTING"===e&&Qt.onLocalStatus(xt.CONNECTING),"RECONNECTING"===e&&(this._cleanupParticipantAgnosticStreams(),Qt.onLocalStatus(xt.RECONNECT)),"FAILED"!==e?[3,3]:this._transport&&0===this._transport.allocated().length?this._signaling?[4,this._signaling.hangup(vt.FAILED)]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:this._close(new Wn(vt.FAILED),"Transport failed"),t.label=3;case 3:return[2]}}))}))},t.prototype._onRemoteTrackAdded=function(e,t,n){return et(this,void 0,void 0,(function(){var r,i,a;return tt(this,(function(o){switch(o.label){case 0:return e.endsWith("audio-mix")?(Jt.debug("Remote audio mix track added"),this._audioOutput.add(n),[3,5]):[3,1];case 1:return e.startsWith("pat")?(Jt.debug("Participant-agnostic track added: "+e),this._trackDataByStreamId[e]={videoStream:t,currentStream:t,currentParticipant:null},[3,5]):[3,2];case 2:return Jt.debug("Remote track added on the participant ["+e+"]",{kind:n.kind}),(r=this._participants[e])?[3,4]:(Jt.warn("Conversation: track added before participant ["+e+"]"),i=this._participants,a=e,[4,this._createParticipant({id:e,state:"CALLED"})]);case 3:i[a]=o.sent(),r=this._participants[e],Qt.onParticipantStatus(r.externalId,xt.WAITING),this._activeSpeakerId===e&&this._lastSignalledActiveSpeakerId!==e&&(Qt.onSpeakerChanged(r.externalId),this._lastSignalledActiveSpeakerId=e),o.label=4;case 4:if(this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!1),"audio"===n.kind&&this._audioOutput.add(n),r.remoteStream!==t){if(r.remoteStream=t,r.secondStream)return[2];Qt.onRemoteStream(r.externalId,t)}r.mediaSettings&&(n&&!r.mediaSettings.isVideoEnabled&&"video"===n.kind&&(r.remoteVideoTrack=n,r.remoteStream.removeTrack(n)),this._changeRemoteMediaSettings(e,r.mediaSettings)),this._changeRemoteParticipantState(e,r.participantState),o.label=5;case 5:return[2]}}))}))},t.prototype._onRemoteTrackRemoved=function(e,t,n){switch(Jt.debug("["+e+"] remote track (removed)",{track:n}),n.kind){case"audio":this._removeAudioTrack(e,t,n);break;case"video":case"screen":this._removeVideoTrack(e,t,n)}},t.prototype._removeAudioTrack=function(e,t,n){if("audio-mix"!==e){var r=this._participants[e];if(!r)return;if(r.remoteStream&&r.remoteStream!==t)return}this._audioOutput.remove()},t.prototype._removeVideoTrack=function(e,t,n){},t.prototype._onRemoteActivityNoSignal=function(){this._onRemoteSignalledStall([]),this._onRemoteAllStall(!1)},t.prototype._onTopologyChanged=function(e){this._conversation&&(this._conversation.topology=e,this._changeFeatureSet())},t.prototype._onRemoteAllStall=function(e){var t=this;this._remoteAllStalled!==e&&(this._remoteAllStalled=e,Object.values(this._participants).forEach((function(n){n.externalId&&Qt.onParticipantStatus(n.externalId,e||t._lastStalled[n.id]?xt.RECONNECT:xt.CONNECTED)})))},t.prototype._onRemoteSignalledStall=function(e){var t=this,n={};e.forEach((function(e){if(n[e]=!0,!t._lastStalled[e]){var r=t._participants[e];r&&r.externalId&&!t._remoteAllStalled&&Qt.onParticipantStatus(r.externalId,xt.RECONNECT)}delete t._lastStalled[e]})),Object.keys(this._lastStalled).forEach((function(e){var n=t._participants[e];n&&n.externalId&&!t._remoteAllStalled&&Qt.onParticipantStatus(n.externalId,xt.CONNECTED)})),this._lastStalled=n},t.prototype._onRemoteDataStats=function(e){var t;this._debugInfo&&this._debugInfo.onRemoteDataStats(e,this._participants,null===(t=this._mediaSource)||void 0===t?void 0:t.getMediaSettings()),this._fixAudioDevice(e.outbound.rtps)},t.prototype._fixAudioDevice=function(e){var t;Mn.hasMicrophone()&&this._audioFix&&(null===(t=this._mediaSource)||void 0===t?void 0:t.getMediaSettings().isAudioEnabled)&&this._audioFix.fix(e)},t.prototype._toggleJoinAvailability=function(){var e=this._conversation&&this._conversation.chatId,t=e&&"CLOSE"!==this._state||!1;e&&(Jt.debug("Toggle join availability",{available:t,chatId:e}),Qt.onJoinStatus(t,e))},t.prototype._updateDisplayLayoutFromCache=function(e){var t;return et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return"SERVER"!==(null===(t=this._transport)||void 0===t?void 0:t.getTopology())?[2]:(n=this._participants[e])&&n.lastRequestedLayout?[4,this._signaling.updateDisplayLayout((r={},r[e]=n.lastRequestedLayout,r))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t._delayedHangup=!1,t}(st),Or=function(e){function t(n,r){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i.participantErrors=r,i}return Ze(t,e),t}(Error);function Tr(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!1),window.Blob&&window.navigator.sendBeacon){var r=Rr(e,t,n),i=new window.Blob([r],{type:"application/x-www-form-urlencoded"});window.navigator.sendBeacon(Vt.apiEnv.api+"fb.do",i)}}function Ir(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){return tt(this,(function(r){return[2,Pr(Rr(e,t,n))]}))}))}function Pr(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("POST",Vt.apiEnv.api+"fb.do",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e;try{e=JSON.parse(r.responseText)}catch(t){e={result:r.responseText}}200!==r.status||e.hasOwnProperty("error_msg")?n(e):t(e)}},r.send(e)}))]}))}))}function Rr(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1),t.method=e,t.format="JSON",t.application_key||(t.application_key=Vt.apiKey),n||(Ut.sessionKey?t.session_key=Ut.sessionKey:Ut.accessToken&&(t.access_token=Ut.accessToken));for(var r=0,i=Object.entries(t);r<i.length;r++){var a=i[r],o=a[0];"object"==typeof(d=a[1])&&(t[o]=JSON.stringify(d))}for(var s="",c=0,u=Object.entries(t);c<u.length;c++){var l=u[c],d=(o=l[0],l[1]);s&&(s+="&"),s+=o+"="+encodeURIComponent(d)}return s}var Dr,kr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._userId=null,t._externalUidsCache={},t}return Ze(t,e),t.prototype._callUnsafe=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r,i=this;return tt(this,(function(a){return[2,(r=function(a){return et(i,void 0,void 0,(function(){var i;return tt(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,5]),[4,Ir(e,t,n)];case 1:return[2,o.sent()];case 2:return(i=o.sent()).hasOwnProperty("error_msg")?[3,4]:(a++,Jt.debug(e+" network error, attempt "+a+"..."),a<10?[4,$t.delay(Math.min(700*a,3e3))]:[3,4]);case 3:return o.sent(),[2,r(a)];case 4:throw Jt.warn(e,"error",i),i;case 5:return[2]}}))}))})(0)]}))}))},t.prototype._call=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r,i;return tt(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,10]),[4,this._callUnsafe(e,t,n)];case 1:return[2,a.sent()];case 2:switch(r=a.sent(),Jt.warn("Api call error",r),i=ft.API,r.error_code){case 102:case 103:case 104:return[3,3];case 1101:return[3,5];case 1102:return[3,6];case 1103:return[3,7];case 1104:case 1106:return[3,8]}return[3,9];case 3:return[4,this.authorize()];case 4:return a.sent(),[2,this._callUnsafe(e,t,n)];case 5:return i=vt.SERVICE_DISABLED,[3,9];case 6:return i=vt.CALLEE_IS_OFFLINE,[3,9];case 7:return i=vt.NOT_FRIENDS,[3,9];case 8:return i=vt.EXTERNAL_API_ERROR,[3,9];case 9:throw new Wn(i,{message:r.error_msg,code:r.error_code});case 10:return[2]}}))}))},t.prototype._getCurrentUser=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,this._call("users.getCurrentUser")]}))}))},t.prototype.userId=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i;return tt(this,(function(a){switch(a.label){case 0:return t=$t.decomposeId(e).id,Ut.isEmpty()?[2,Ln.fromId(t)]:this._externalUidsCache.hasOwnProperty(t)?[3,2]:(r=(n=Object).assign,i=[this._externalUidsCache],[4,this._getExternalIdsByOkIds([t])]);case 1:r.apply(n,i.concat([a.sent()])),a.label=2;case 2:return[2,Ln.fromString(this._externalUidsCache[t])]}}))}))},t.prototype.prepareUserIds=function(e){return et(this,void 0,void 0,(function(){var t,n,r;return tt(this,(function(i){switch(i.label){case 0:return Ut.isEmpty()?[3,2]:(n=(t=Object).assign,r=[this._externalUidsCache],[4,this._getExternalIdsByOkIds(e)]);case 1:n.apply(t,r.concat([i.sent()])),i.label=2;case 2:return[2]}}))}))},t.prototype.authorize=function(){return et(this,void 0,void 0,(function(){var e,t,n=this;return tt(this,(function(r){return this._uuid||((e=rn.get("uuid"))||(e=$t.uuid(),rn.set("uuid",e)),this._uuid=String(e)),t={session_data:{version:2,device_id:this._uuid,client_version:Vt.appVersion,client_type:"SDK_JS"}},Vt.authToken&&(t.session_data.auth_token=Vt.authToken,t.session_data.version=3),[2,this._callUnsafe("auth.anonymLogin",t,!0).then((function(e){e.uid&&(n._userId=String(e.uid)),Ut.sessionKey=e.session_key,Ut.sessionSecretKey=e.session_secret_key})).catch((function(e){throw 401===e.error_code&&Qt.onTokenExpired(),new Wn(ft.AUTH,{message:e.error_msg,code:e.error_code})}))]}))}))},t.prototype.log=function(e){Tr("log.externalLog",{collector:"ok.mobile.apps.video",data:JSON.stringify({application:Vt.appName+":2.3.5-beta.7",platform:Vt.platform,items:e})})},t.prototype.init=function(){!function(){if(!Vt.apiAppId||!Vt.apiKey)throw new Wn(ft.API,{message:"Required arguments apiAppId/apiAppKey not passed"})}()},t.prototype.joinConversation=function(e,t,n){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var r;return tt(this,(function(i){return r={conversationId:e,isVideo:t},n&&(r.chatId=n),[2,this._call("vchat.joinConversation",r)]}))}))},t.prototype.createConversation=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r;return tt(this,(function(i){return r={conversationId:e,createJoinLink:!0,isVideo:!1},t&&(r.payload=t),Vt.domain&&(r.domainId=Vt.domain),n&&(r.requireAuthToJoin=!0),[2,this._startConversation(r)]}))}))},t.prototype.startConversation=function(e,t,n,r,i,a,o){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),void 0===o&&(o=!1),et(this,void 0,void 0,(function(){var s;return tt(this,(function(c){if(s={conversationId:e,isVideo:r},t&&t.length)switch(n){case lt.USER:s.uids=t.join(",");break;case lt.GROUP:s.gid=t[0];break;case lt.CHAT:s.chatId=t[0]}return a&&(s.createJoinLink=!0),i&&(s.payload=i),Vt.domain&&(s.domainId=Vt.domain),o&&(s.requireAuthToJoin=!0),[2,this._startConversation(s)]}))}))},t.prototype._startConversation=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._call("vchat.startConversation",e)]}))}))},t.prototype.createJoinLink=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._call("vchat.createJoinLink",{conversationId:e})]}))}))},t.prototype.removeJoinLink=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._call("vchat.removeJoinLink",{conversationId:e})]}))}))},t.prototype.getAnonymTokenByLink=function(e,t){return et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return n={joinLink:e},t&&(n.anonymName=t),[4,this._call("vchat.getAnonymTokenByLink",n)];case 1:return r=i.sent(),this._userId=String(r.uid),[2,r.token]}}))}))},t.prototype.joinConversationByLink=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return n={joinLink:e,isVideo:t},Vt.anonymToken&&(n.anonymToken=Vt.anonymToken),[2,this._call("vchat.joinConversationByLink",n)]}))}))},t.prototype.getOkIdsByExternalIds=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d,p=this;return tt(this,(function(h){switch(h.label){case 0:for(t=Ln.fromIds(e),n=[],r={methods:[]},i=[],a=Object.keys(this._externalUidsCache),o=Object.values(this._externalUidsCache),s=0,c=t;s<c.length;s++)u=c[s],l=Ln.toString(u),(d=o.indexOf(l))>-1?n.push(a[d]):(i.push(l),r.methods.push({"vchat.getOkIdByExternalId":{params:{externalId:u.id,anonym:u.type===Fn.ANONYM},onError:"SKIP"}}));return r.methods.length?[4,this._call("batch.executeV2",r)]:[2,n];case 1:return h.sent().forEach((function(e,t){if(e.ok){var r=String(e.ok.ok_id);p._externalUidsCache[r]=i[t],n.push(r)}})),[2,n]}}))}))},t.prototype.getConversationParams=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return e={},Vt.anonymToken&&(e.anonymToken=Vt.anonymToken),[2,this._call("vchat.getConversationParams",e)]}))}))},t.prototype.getUserId=function(){return this._userId},t.prototype.setUserId=function(e){this._userId=e},t.prototype.hangupConversation=function(e){var t={conversationId:e,reason:vt.HUNGUP};Vt.anonymToken&&(t.anonymToken=Vt.anonymToken),Tr("vchat.hangupConversation",t)},t.prototype.cleanup=function(){},t.prototype._getExternalIdsByOkIds=function(e){return et(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l;return tt(this,(function(d){switch(d.label){case 0:t={},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._call("vchat.getExternalIdsByOkIds",{uids:e.join(",")})];case 2:if((n=d.sent()).external_ids)for(r=0,i=Object.entries(n.external_ids);r<i.length;r++)a=i[r],u=a[0],l=a[1],t[u]=Ln.fromIdToString(l,Fn.USER);if(n.anonym_ids)for(o=0,s=Object.entries(n.anonym_ids);o<s.length;o++)c=s[o],u=c[0],l=c[1],t[u]=Ln.fromIdToString(l,Fn.ANONYM);return[2,t];case 3:return d.sent(),[2,t];case 4:return[2]}}))}))},t}(at);!function(e){e.RECOVER="recover",e.ACCEPT_CALL="accept-call",e.ADD_PARTICIPANT="add-participant",e.REMOVE_PARTICIPANT="remove-participant",e.HANGUP="hangup",e.TRANSMIT_DATA="transmit-data",e.ACCEPT_PRODUCER="accept-producer",e.ALLOCATE_CONSUMER="allocate-consumer",e.CHANGE_MEDIA_SETTINGS="change-media-settings",e.CHANGE_PARTICIPANT_STATE="change-participant-state",e.CHANGE_STREAM_PRIORITIES="change-streams-priorities",e.UPDATE_DISPLAY_LAYOUT="update-display-layout",e.REPORT_PERF_STAT="report-perf-stat",e.RECORD_START="record-start",e.RECORD_STOP="record-stop",e.RECORD_GET_STATUS="record-get-status",e.SWITCH_MICRO="switch-micro",e.SWITCH_TOPOLOGY="switch-topology",e.REQUEST_REALLOC="request-realloc",e.CHAT_MESSAGE="chat-message",e.CHAT_HISTORY="chat-history",e.CUSTOM_DATA="custom-data",e.GRANT_ROLES="grant-roles",e.MUTE_PARTICIPANT="mute-participant",e.PIN_PARTICIPANT="pin-participant",e.UPDATE_MEDIA_MODIFIERS="update-media-modifiers",e.CHANGE_OPTIONS="change-options"}(Dr||(Dr={}));var Nr,Fr,Lr=Dr,Mr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.socket=null,t.sequence=1,t.lastStamp=0,t.websocketCommandsQueue=[],t.datachannelCommandsQueue=[],t.incomingCache=[],t.responseHandlers={},t.reconnectCount=0,t.conversationResolve=null,t.conversationReject=null,t.connected=!1,t.listenersReady=!1,t.postfix="&platform="+Vt.platform+"&appVersion="+Vt.appVersion+"&version="+Vt.protocolVersion+"&device="+Vt.device,t.peerId=null,t.conversationId=null,t.reconnectTimer=0,t.connectionMessageWaitTimer=0,t.doctorTimer=0,t.participantIdRegistry=null,t.producerNotificationDataChannel=null,t.producerCommandDataChannel=null,t}return Ze(t,e),t.prototype.setEndpoint=function(e){this.endpoint=e},t.prototype.setConversationId=function(e){this.conversationId=e},t.prototype.setParticipantIdRegistry=function(e){this.participantIdRegistry=e},t.prototype.setProducerNotificationDataChannel=function(e){var t=this;this.producerNotificationDataChannel=e,this.producerNotificationDataChannel.onmessage=function(e){var n,r=null===(n=t.participantIdRegistry)||void 0===n?void 0:n.handleMessage(e.data);r&&t._handleMessage(r)}},t.prototype.setProducerCommandDataChannel=function(e){this.producerCommandDataChannel=e,this.producerCommandDataChannel.onmessage=this._onMessage.bind(this),this._handleCommandsQueue(this.datachannelCommandsQueue)},t.prototype.cleanup=function(){this.datachannelCommandsQueue=[]},t.prototype.connect=function(e){return et(this,void 0,void 0,(function(){var t=this;return tt(this,(function(n){return this.postfix+="&clientType="+Vt.clientType,[2,new Promise((function(n,r){if(t.socket&&t.socket.readyState<WebSocket.CLOSING)return Un.log("callSocketAction","already_opened"),void r(Error("Socket already opened"));t.conversationResolve=function(e){n(e),t.conversationResolve=null,t.conversationReject=null},t.conversationReject=function(e){r(e),t.conversationResolve=null,t.conversationReject=null},t._connect(e)}))]}))}))},t.prototype._send=function(e,t){return void 0===t&&(t={}),et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return t.participantId&&(n=$t.decomposeId(t.participantId),t=Object.assign({},t,{participantId:n.id,participantType:n.type})),[2,this._sendRaw(e,t)]}))}))},t.prototype._isDataChannelCommand=function(e){return e===Lr.UPDATE_DISPLAY_LAYOUT||e===Lr.REPORT_PERF_STAT},t._isDataChannelResponseRequired=function(e){return e===Lr.UPDATE_DISPLAY_LAYOUT||e===Lr.REPORT_PERF_STAT},t.prototype._sendRaw=function(e,t){return void 0===t&&(t={}),et(this,void 0,void 0,(function(){var n=this;return tt(this,(function(r){return[2,new Promise((function(r,i){var a={sequence:n.sequence++,name:e,params:t,responseTimer:0,resolve:r,reject:i};if(n._isDataChannelCommand(e))n.datachannelCommandsQueue.push(a),n.producerCommandDataChannel&&"open"===n.producerCommandDataChannel.readyState&&n._handleCommandsQueue(n.datachannelCommandsQueue);else{if(!n.socket)return Un.log("callSocketAction","not_opened"),Jt.warn("Socket not opened"),void i(new Error("Socket not opened"));n.socket.readyState>WebSocket.OPEN&&(Un.log("callSocketAction","invalid_state"),Jt.warn("Invalid state "+n.socket.readyState)),n.websocketCommandsQueue.push(a),n.socket&&n.socket.readyState===WebSocket.OPEN&&n._handleCommandsQueue(n.websocketCommandsQueue)}}))]}))}))},t.prototype.hangup=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.HANGUP,{reason:e}).catch((function(){}))]}))}))},t.prototype.sendCandidate=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.TRANSMIT_DATA,{participantId:e,data:{candidate:t}})]}))}))},t.prototype.sendSdp=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.TRANSMIT_DATA,{participantId:e,data:{sdp:t}})]}))}))},t.prototype.acceptCall=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.ACCEPT_CALL,{mediaSettings:e})]}))}))},t.prototype.changeMediaSettings=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.CHANGE_MEDIA_SETTINGS,{mediaSettings:e})]}))}))},t.prototype.changeParticipantState=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.CHANGE_PARTICIPANT_STATE,{participantState:{state:e}})]}))}))},t.prototype.addParticipant=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.ADD_PARTICIPANT,Xe({participantId:e},t))]}))}))},t.prototype.removeParticipant=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.REMOVE_PARTICIPANT,{participantId:e,ban:t})]}))}))},t.prototype.allocateConsumer=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return n={capabilities:t},e&&(n.description=e.sdp),[2,this._send(Lr.ALLOCATE_CONSUMER,n)]}))}))},t.prototype.acceptProducer=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return n={description:e.sdp},t&&(n.ssrcs=t),[2,this._send(Lr.ACCEPT_PRODUCER,n)]}))}))},t.prototype.changePriorities=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.CHANGE_STREAM_PRIORITIES,{typedPriorities:e}).catch((function(){}))]}))}))},t.prototype.updateDisplayLayout=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.UPDATE_DISPLAY_LAYOUT,{layouts:e})]}))}))},t.prototype.startStream=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.RECORD_START,e)]}))}))},t.prototype.stopStream=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,this._send(Lr.RECORD_STOP)]}))}))},t.prototype.getRecordStatus=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return[2,this._send(Lr.RECORD_GET_STATUS)]}))}))},t.prototype.switchTopology=function(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.SWITCH_TOPOLOGY,{topology:e,force:t})]}))}))},t.prototype.requestRealloc=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){return t={},e&&(t.target=e.toUpperCase()),[2,this._send(Lr.REQUEST_REALLOC,t)]}))}))},t.prototype.reportPerfStat=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.REPORT_PERF_STAT,{report:e})]}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.CHAT_MESSAGE,{message:e,participantId:t})]}))}))},t.prototype.chatHistory=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.CHAT_HISTORY,{count:e})]}))}))},t.prototype.customData=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._send(Lr.CUSTOM_DATA,{data:e,participantId:t})]}))}))},t.prototype.grantRoles=function(e,t,n){return et(this,void 0,void 0,(function(){var r;return tt(this,(function(i){return r={participantId:e,roles:t},n&&(r.revoke=!0),[2,this._sendRaw(Lr.GRANT_ROLES,r)]}))}))},t.prototype.muteParticipant=function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),et(this,void 0,void 0,(function(){return tt(this,(function(i){return[2,this._sendRaw(Lr.MUTE_PARTICIPANT,{participantId:e,mediaOptions:t,unmute:n,mutePermanent:r})]}))}))},t.prototype.pinParticipant=function(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return n={participantId:e},t&&(n.unpin=!0),[2,this._sendRaw(Lr.PIN_PARTICIPANT,n)]}))}))},t.prototype.updateMediaModifiers=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.UPDATE_MEDIA_MODIFIERS,{mediaModifiers:e})]}))}))},t.prototype.changeOptions=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this._send(Lr.CHANGE_OPTIONS,{options:e})]}))}))},t.prototype.close=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&this._closeSocket(),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype.readyToSend=function(){this.listenersReady=!0,this._handleCachedMessages()},t.prototype._connect=function(e){if(!(this.socket&&this.socket.readyState<WebSocket.CLOSING)){var t=e?"&tgt="+e:"";Jt.debug("Connecting to "+this.endpoint+this.postfix+t),this.socket=new WebSocket(this.endpoint+this.postfix+t),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this._onMessage.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this._startDoctor()}},t.prototype._disconnect=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype._recover=function(){var e=this;new Promise((function(n,r){if(!e.socket||e.socket.readyState!==WebSocket.OPEN)return Jt.warn("Socket not opened"),void r(new Error("Socket not opened"));var i={sequence:e.sequence++,name:"recover",params:{stamp:e.lastStamp},responseTimer:0,resolve:n,reject:r},a=Object.assign({command:i.name,sequence:i.sequence},i.params);i.responseTimer=window.setTimeout((function(){return e._handleCommandResponse(!1,a)}),t.WAIT_RESPONSE_DELAY),e.responseHandlers[i.sequence]=i,e.socket.send(JSON.stringify(a))})).then((function(t){t.error||t.messages.forEach(e._handleMessage.bind(e)),e._handleCommandsQueue(e.websocketCommandsQueue)}))},t.prototype._onOpen=function(){Jt.debug("Socket opened"),Un.log("callSocketAction","opened"),this._waitConnectionMessage(),this._startDoctor()},t.prototype._onMessage=function(e){if(this._startDoctor(),"ping"!==e.data)try{this._handleMessage(JSON.parse(e.data))}catch(t){Un.log("callSocketAction","parse_error"),Jt.error("Unable to parse message",t,e.data)}else this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send("pong")},t.prototype._handleMessage=function(e){"notification"===e.type?"connection"===e.notification?(Jt.debug("Signaling connected",e),this.connected=!0,this.reconnectCount=0,this.endpoint=e.endpoint,e.peerId&&this.peerId!==e.peerId.id&&(this.postfix+="&peerId="+e.peerId.id,this.peerId=e.peerId.id),this._stopWaitConnectionMessage(),this.conversationResolve?this.conversationResolve(e):this._triggerEvent("RECONNECT",e),this.lastStamp?(this._handleCachedMessages(),this._recover()):this._handleCommandsQueue(this.websocketCommandsQueue)):this.connected&&this.listenersReady?this._triggerEvent("NOTIFICATION",e):this.incomingCache.push(e):"response"===e.type&&this.responseHandlers[e.sequence]?this._handleCommandResponse(!0,e):"error"===e.type&&this.responseHandlers[e.sequence]?(Un.log("callSocketAction","error-"+e.error),this._handleCommandResponse(!1,e)):"error"===e.type?(Un.log("callSocketAction","error-"+e.error),"service-unavailable"===e.error?this._reconnect():"conversation-ended"===e.error?this.conversationReject?this.conversationReject(new Wn(vt.SOCKET_CLOSED,{message:"Unable to connect to the signaling: "+e.error})):this._triggerEvent("NOTIFICATION",{notification:"closed-conversation",reason:e.reason}):this.connected||"invalid-token"===e.error?this._throwError(new Error("Signaling error: "+e.error)):e.sequence||(this.conversationReject&&this.conversationReject(new Wn(ft.SIGNALING_FAILED,{message:"Unable to connect to the signaling: "+e.error})),this._closeSocket())):(Un.log("callSocketAction","unknown_message"),Jt.warn("Unhandled message",e)),this.lastStamp=e.stamp||this.lastStamp},t.prototype._handleCachedMessages=function(){for(;this.incomingCache.length>0;){var e=this.incomingCache.pop();this._handleMessage(e)}},t.prototype._throwError=function(e){this._triggerEvent("FAILED",e)},t.prototype._onError=function(e){Un.log("callSocketAction","error"),Jt.error("Error",e)},t.prototype._onClose=function(e){Un.log("callSocketAction","closed"),Jt.debug("Connection closed",{code:e.code,reason:e.reason}),this.connected=!1,this._stopDoctor(),this.socket&&this.reconnectCount++<t.RECONNECT_MAX_COUNT?this._reconnect():this.socket&&this._closeSocket(new Error("Connection closed"))},t.prototype._closeSocket=function(e){void 0===e&&(e=null),this.socket&&(this._disconnect(),Object.values(this.responseHandlers).forEach((function(t){window.clearTimeout(t.responseTimer),e&&t.reject(new Error("Connection closed"))})),this.websocketCommandsQueue=[],this.responseHandlers={},this.lastStamp=0,e&&this._throwError(new Error("Connection closed")))},t.prototype._reconnect=function(){var e=Math.min(t.RECONNECT_MAX_DELAY,t.RECONNECT_DELAY*Math.pow(2,this.reconnectCount-1));Jt.log("Reconnect websocket after "+e+"ms ("+this.reconnectCount+")"),Un.log("callSocketAction","reconnect"),this.reconnectTimer=window.setTimeout(this._connect.bind(this,yt.RETRY),e)},t.prototype._handleCommandResponse=function(e,t){if(this.responseHandlers.hasOwnProperty(t.sequence)){var n=this.responseHandlers[t.sequence];window.clearTimeout(n.responseTimer),e?n.resolve(t):(Un.log("callSocketAction","response-timeout"),n.reject(new Error(t.error||"Response timeout ["+n.name+"]"))),delete this.responseHandlers[t.sequence]}},t.prototype._handleCommandsQueue=function(e){for(var n=this,r=function(){var r=e.shift(),a=Object.assign({command:r.name,sequence:r.sequence},r.params);if(i._isDataChannelCommand(r.name)){if(!i.producerCommandDataChannel||"open"!==i.producerCommandDataChannel.readyState){var o=i.producerCommandDataChannel&&i.producerCommandDataChannel.readyState||"channel is null";return r.reject(new Error("Invalid data channel state: "+o)),{value:void 0}}t._isDataChannelResponseRequired(r.name)&&(r.responseTimer=window.setTimeout((function(){return n._handleCommandResponse(!1,a)}),t.WAIT_RESPONSE_DELAY),i.responseHandlers[r.sequence]=r),i.producerCommandDataChannel.send(JSON.stringify(a))}else{if(!i.socket||i.socket.readyState!==WebSocket.OPEN)return r.reject(new Error("Invalid state or socket already closed")),"continue";r.responseTimer=window.setTimeout((function(){return n._handleCommandResponse(!1,a)}),t.WAIT_RESPONSE_DELAY),i.responseHandlers[r.sequence]=r,i.socket.send(JSON.stringify(a))}},i=this;e.length>0;){var a=r();if("object"==typeof a)return a.value}},t.prototype._waitConnectionMessage=function(){var e=this;this.connectionMessageWaitTimer=window.setTimeout((function(){e.conversationReject&&e.conversationReject(new Wn(ft.SIGNALING_FAILED,{message:"Unable to connect to the signaling: connection timeout"}))}),t.WAIT_CONNECTION_DELAY)},t.prototype._stopWaitConnectionMessage=function(){window.clearTimeout(this.connectionMessageWaitTimer),this.connectionMessageWaitTimer=0},t.prototype._startDoctor=function(){var e=this;this._stopDoctor(),this.doctorTimer=window.setTimeout((function(){Jt.warn("Socket is dead, trying to reconnect"),e._disconnect(),e._connect(yt.RETRY)}),t.WAIT_MESSAGE_DELAY)},t.prototype._stopDoctor=function(){window.clearTimeout(this.doctorTimer),this.doctorTimer=0},t.RECONNECT_DELAY=Vt.signalingReconnectDelay,t.RECONNECT_MAX_DELAY=Vt.signalingReconnectMaxDelay,t.RECONNECT_MAX_COUNT=Vt.signalingReconnectMaxCount,t.WAIT_CONNECTION_DELAY=Vt.waitConnectionDelay,t.WAIT_RESPONSE_DELAY=Vt.waitResponseDelay,t.WAIT_MESSAGE_DELAY=Vt.waitMessageDelay,t}(ct),jr=null,xr={getCameras:Mn.getCameras,getMicrophones:Mn.getMicrophones,getOutput:Mn.getOutput,hasCamera:Mn.hasCamera,hasMicrophone:Mn.hasMicrophone,getSavedCamera:Mn.getSavedCamera,getSavedMicrophone:Mn.getSavedMicrophone,getSavedOutput:Mn.getSavedOutput,hasCameraPermission:Mn.hasCameraPermission,hasMicrophonePermission:Mn.hasMicrophonePermission,hasPermissions:Mn.hasPermissions,getUserMedia:Mn.getUserMedia,getUserVideo:Mn.getUserVideo,getUserAudio:Mn.getUserAudio,saveDeviceId:Mn.saveDeviceId,isBrowserSupported:Mn.isBrowserSupported,isScreenCapturingSupported:Mn.isScreenCapturingSupported,os:Mn.os,isMobile:Mn.isMobile,browserName:Mn.browserName,browserVersion:Mn.browserVersion,baseChromeVersion:Mn.baseChromeVersion,getAudioContext:Mn.getAudioContext};function Br(e){Fr=e}function Ur(e){Nr=e}function Vr(e){jr=e}function Gr(e){Vt.videoEffects=e}function Hr(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return Vt.set(e),"Sferum"===Mn.browserName()&&(Vt.platform="SFERUM:"+Mn.browserVersion()),Fr||Br(new kr),Nr||Ur((function(){return new Mr})),Jt.log("Calls SDK 2.3.5-beta.7",e),[4,Mn.init()];case 1:if(t.sent(),!Mn.isBrowserSupported())throw new Wn(ft.UNSUPPORTED);if(!Mn.hasMicrophone()&&!Vt.allowMissingMic)throw new Wn(ft.MIC_NOT_FOUND);return Fr.init(),[2]}}))}))}function Wr(e,t,n,r,i){return void 0===t&&(t=!1),void 0===n&&(n=""),void 0===r&&(r=!1),void 0===i&&(i=!1),et(this,void 0,void 0,(function(){var a,o;return tt(this,(function(s){switch(s.label){case 0:return a=[],o=[],Array.isArray(e)?a=e.length?e:[]:e&&(a=[e]),a.length?[4,Fr.getOkIdsByExternalIds(a)]:[3,2];case 1:if(!(o=s.sent()).length)throw new Wn(vt.CALLEE_IS_OFFLINE);s.label=2;case 2:return[2,Kr(o,lt.USER,t,n,r,i)]}}))}))}function zr(e,t,n,r,i){return void 0===t&&(t=!1),void 0===n&&(n=""),void 0===r&&(r=!1),void 0===i&&(i=!1),et(this,void 0,void 0,(function(){return tt(this,(function(a){return[2,Wr(e,t,n,r,i)]}))}))}function Kr(e,t,n,r,i,a){return void 0===t&&(t=lt.USER),void 0===n&&(n=!1),void 0===r&&(r=""),void 0===i&&(i=!1),void 0===a&&(a=!1),et(this,void 0,void 0,(function(){return tt(this,(function(o){if(wr.current())throw Jt.error("There is already active call"),new Wn(vt.FAILED);return[2,new wr(Fr,Nr(),jr).onStart(e,t,n,r,i,a)]}))}))}function Qr(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,qr(e)]}))}))}function qr(e,t,n){return void 0===t&&(t="USER"),et(this,void 0,void 0,(function(){return tt(this,(function(r){if(e===wr.id())throw new Error("Push has already been processed");return[2,new wr(Fr,Nr(),jr).onPush(e,t,n)]}))}))}function Jr(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return e&&(Vt.authToken=e),[2,Fr.authorize()]}))}))}function Yr(e){return void 0===e&&(e=!1),et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){if(t=wr.current())return[2,t.accept(e)];throw new Error("Conversation not found")}))}))}function $r(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.decline()]:[2]}))}))}function Zr(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,Xr(e,t)]}))}))}function Xr(e,t,n){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(r){if(wr.current())throw Jt.error("There is already active call"),new Wn(vt.FAILED);return[2,new wr(Fr,Nr(),jr).onJoin({conversationId:e,needVideo:t,chatId:n})]}))}))}function ei(e,t,n){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(r){if(wr.current())throw Jt.error("There is already active call"),new Wn(vt.FAILED);return n&&(Vt.anonymToken=n),[2,new wr(Fr,Nr(),jr).onJoin({joinLink:e,needVideo:t})]}))}))}function ti(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.hangup()]:(wr.hangupAfterInit(),[2])}))}))}function ni(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:return[4,Fr.getOkIdsByExternalIds([e])];case 1:if(!(n=r.sent()).length)throw new Error("User not found");return[2,ri(n[0],t)]}}))}))}function ri(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:return(n=wr.current())?[4,n.addParticipant($t.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function ii(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return[4,Fr.getOkIdsByExternalIds([e])];case 1:return[2,ai(n.sent()[0],t)]}}))}))}function ai(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:return(n=wr.current())?[4,n.removeParticipant($t.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function oi(e,t){return et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return[4,Mn.saveDeviceId(e,t)];case 1:return n=i.sent(),r=wr.current(),n&&r?[2,r.changeDevice(e)]:[2,Promise.reject()]}}))}))}function si(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){return(t=wr.current())?[2,t.toggleScreenCapturing(e)]:[2,Promise.reject()]}))}))}function ci(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:return(n=wr.current())?[4,n.setVideoStream(e,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function ui(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.toggleLocalVideo(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function li(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.toggleLocalAudio(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function di(e,t){return et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){return(n=wr.current())?[2,n.setLocalResolution(e,t)]:[2]}))}))}function pi(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.changePriorities(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function hi(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.changeParticipantState(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function fi(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.updateDisplayLayout(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function mi(e,t,n){return void 0===n&&(n=!1),et(this,void 0,void 0,(function(){return tt(this,(function(r){switch(r.label){case 0:return[4,Fr.getOkIdsByExternalIds([e])];case 1:return[2,vi(r.sent()[0],t,n)]}}))}))}function vi(e,t,n){return void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r;return tt(this,(function(i){switch(i.label){case 0:return(r=wr.current())?[4,r.grantRoles($t.composeId(e,"USER"),t,n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function _i(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=[gt.AUDIO]),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r,i;return tt(this,(function(a){switch(a.label){case 0:return r=null,e?[4,Fr.getOkIdsByExternalIds([e])]:[3,2];case 1:i=a.sent(),r=i[0],a.label=2;case 2:return[2,gi(r,t,n)]}}))}))}function gi(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=[gt.AUDIO]),void 0===n&&(n=!1),et(this,void 0,void 0,(function(){var r,i;return tt(this,(function(a){switch(a.label){case 0:return(r=wr.current())?(i=e?$t.composeId(e,"USER"):null,[4,r.switchParticipantDevice(i,t,!1,n)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))}function Ai(e,t){return void 0===e&&(e=null),void 0===t&&(t=[gt.AUDIO]),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return n=null,e?[4,Fr.getOkIdsByExternalIds([e])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,yi(n,t)]}}))}))}function yi(e,t){return void 0===e&&(e=null),void 0===t&&(t=[gt.AUDIO]),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return(n=wr.current())?(r=e?$t.composeId(e,"USER"):null,[4,n.switchParticipantDevice(r,t,!0)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Ei(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return[4,Fr.getOkIdsByExternalIds([e])];case 1:return[2,Si(n.sent()[0],t)]}}))}))}function Si(e,t){return void 0===t&&(t=!1),et(this,void 0,void 0,(function(){var n;return tt(this,(function(r){switch(r.label){case 0:return(n=wr.current())?[4,n.pinParticipant($t.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function bi(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.updateMediaModifiers(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Ci(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return(t=wr.current())?[4,t.changeOptions(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function wi(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return n=null,t?[4,Fr.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Oi(e,n)]}}))}))}function Oi(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return(n=wr.current())?(r=t?$t.composeId(t,"USER"):null,[4,n.chatMessage(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Ti(e){return void 0===e&&(e=10),et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){return(t=wr.current())?[2,t.chatHistory(e)]:[2]}))}))}function Ii(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return n=null,t?[4,Fr.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Pi(e,n)]}}))}))}function Pi(e,t){return void 0===t&&(t=null),et(this,void 0,void 0,(function(){var n,r;return tt(this,(function(i){switch(i.label){case 0:return(n=wr.current())?(r=t?$t.composeId(t,"USER"):null,[4,n.customData(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Ri(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),et(this,void 0,void 0,(function(){return tt(this,(function(n){switch(n.label){case 0:return[4,Fr.createConversation($t.uuid(),e,t)];case 1:return[2,n.sent().join_link]}}))}))}function Di(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.createJoinLink()]:[2,Promise.reject()]}))}))}function ki(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.removeJoinLink()]:[2,Promise.reject()]}))}))}function Ni(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,Fr.getAnonymTokenByLink(e,t)]}))}))}function Fi(e){var t=wr.current();t&&t.setVolume(e)}function Li(e){Vt.forceRelayPolicy=e}function Mi(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),et(this,void 0,void 0,(function(){var a;return tt(this,(function(o){return(a=wr.current())?[2,a.startStream(e,t,n,r,i)]:[2,Promise.reject()]}))}))}function ji(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.stopStream()]:[2,Promise.reject()]}))}))}function xi(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){return(e=wr.current())?[2,e.getStreamInfo()]:[2,Promise.reject()]}))}))}function Bi(e){Vt.statisticsInterval=e;var t=wr.current();if(t)return t.updateStatisticsInterval()}function Ui(e){Jt.toggle(e)}function Vi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Vt.debugLog&&Jt.send.apply(Jt,nt([e,"[external]"],t))}function Gi(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){return(t=wr.current())?[2,t.videoEffect(e)]:[2]}))}))}var Hi,Wi,zi,Ki,Qi=n("tEnI");!function(e){e.CREATOR="CREATOR",e.ADMIN="ADMIN"}(Hi||(Hi={})),function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO"}(Wi||(Wi={})),function(e){e.NEURAL="NEURAL",e.SIMPLE="SIMPLE",e.NONE="NONE"}(zi||(zi={})),function(e){e.SD="SD",e.HD="HD",e.FHD="FHD"}(Ki||(Ki={}));var qi,Ji,Yi,$i,Zi,Xi,ea,ta,na,ra;!function(e){e[e.SD=360]="SD",e[e.HD=720]="HD",e[e.FHD=1080]="FHD"}(qi||(qi={})),function(e){e[e.SD=640]="SD",e[e.HD=1280]="HD",e[e.FHD=1920]="FHD"}(Ji||(Ji={})),function(e){e[e.SINGLE=0]="SINGLE",e[e.ALL=1]="ALL"}(Yi||(Yi={})),function(e){e[e.DENY=0]="DENY",e[e.ONCE=1]="ONCE",e[e.ALLOW=1/0]="ALLOW"}($i||($i={})),function(e){e[e.DECLINE=0]="DECLINE",e[e.PROCESS=1]="PROCESS",e[e.FATAL=2]="FATAL"}(Zi||(Zi={})),function(e){e.ALREADY_IN_CALL="already_in_call",e.CANT_REACH_API="cant_reach_api"}(Xi||(Xi={})),function(e){e.MIC_CAMERA_PERMISSION="mic_camera",e.CAMERA_PERMISSION="camera",e.MIC_PERMISSION="mic",e.CAMERA_ACCESS="cameralock",e.MIC_ACCESS="miclock",e.MIC_NOT_FOUND="nomic",e.SCREEN_PERMISSION="screenpermission",e.SCREEN_ACCESS="screenlock"}(ea||(ea={})),function(e){e.AUTH="auth"}(ta||(ta={})),function(e){e[e.HEADER=0]="HEADER",e[e.CALL_ALL_IN_CHAT=1]="CALL_ALL_IN_CHAT",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE"}(na||(na={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR",e[e.FEEDBACK=5]="FEEDBACK"}(ra||(ra={}));var ia,aa,oa,sa,ca,ua,la="change_mode",da="toggle_popup",pa="error",ha="show_loader";!function(e){e.AUDIO="audio",e.VIDEO="video"}(ia||(ia={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(aa||(aa={})),function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(oa||(oa={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA",e.ADMIN_MUTE="ADMIN_MUTE",e.ADMIN_MUTE_PERMANENT="ADMIN_MUTE_PERMANENT",e.ADMIN_ROLE_GRANTED="ADMIN_ROLE_GRANTED",e.USER_GRANTED_WITH_ADMIN_ROLE="USER_GRANTED_WITH_ADMIN_ROLE",e.PINNED_BY_ADMIN="PINNED_BY_ADMIN",e.USER_PINNED_BY_ADMIN="USER_PINNED_BY_ADMIN"}(sa||(sa={})),function(e){e.LOWERED="0",e.RAISED="1"}(ca||(ca={})),function(e){e.NETWORK="network_error",e.API="api_error"}(ua||(ua={}));var fa,ma=vt.BUSY,va=vt.CALLEE_IS_OFFLINE,_a=vt.CALLER_IS_BLOCKED,ga=vt.CANCELED,Aa=vt.EXTERNAL_API_ERROR,ya=vt.FAILED,Ea=vt.HUNGUP,Sa=vt.MISSED,ba=vt.NOT_FRIENDS,Ca=vt.OLD_VERSION,wa=vt.REJECTED,Oa=vt.REMOVED,Ta=vt.SERVICE_DISABLED,Ia=vt.UNKNOWN_ERROR,Pa=vt.UNSUPPORTED,Ra=function(){return(Ra=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Da=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(fa||(fa={}));var ka=function(e){var t=e.icon,n=e.text,r=e.type,i=e.className,a=Da(e,["icon","text","type","className"]),o=Object(p.a)("CallButton","CallButton--"+r,i,{"CallButton--withText":!!n},"CallButton--withAnimation"),s=Object(p.a)("CallButton__icon","CallButton__icon--withAnimation"),c=Ra(Ra({},a),{onMouseDown:function(e){e.preventDefault(),a.onMouseDown&&a.onMouseDown(e)}});return l.a.createElement("button",Ra({className:o},c,{disabled:r===fa.DISABLED}),l.a.createElement("figure",{className:s},t),n)},Na=function(){return(Na=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Fa=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},La=function(e){var t=Fa(e,[]);return l.a.createElement("svg",Na({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"}))},Ma=function(){return(Ma=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ja=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},xa=function(e){var t=ja(e,[]);return l.a.createElement("svg",Ma({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"}))},Ba=function(){return(Ba=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ua=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Va=function(e){var t=Ua(e,[]);return l.a.createElement("svg",Ba({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"}))},Ga=n("17x9"),Ha=n.n(Ga),Wa=l.a.createContext({isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1});function za(e){return e>0&&e<2e9}function Ka(e){return e>2e9}var Qa=function(e){return 0===e||Ka(e)};function qa(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}var Ja=function(){return(Ja=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ya=new(function(){function e(){}return e.prototype.setActionStatCollector=function(e){this.actionStatCollector=e},e.prototype.logEvent=function(e){var t,n=Ja(Ja({},e),{peer_id:e.peer_id.toString(),session_id:e.session_id||"",lib_version:"calls_v2"});this.actionStatCollector&&this.actionStatCollector.logEvent(((t={type:"type_voip_call_item"}).type_voip_call_item=n,t))},e}()),$a=function(e){return e<0},Za=function(e){return(null==e?void 0:e.peerId)?e.isAnonym?{id:e.peerId.toString(),type:Fn.ANONYM}:e.peerId.toString():null},Xa=function(e,t,n,r,i,a,o,s,c){void 0===c&&(c=!1);var u=r.peerId===e.me,l=$a(r.peerId)||r.isAnonym,d=Qa(e.peer),p=e.participants[e.me],h=[],f=[],m=e.config.isModalView;if(u||!i||l||void 0===s||h.push({text:a("calls_go_to_profile"),onClick:function(e){s(e,r.link)}}),u||l||$a(e.me)||void 0===o||h.push({text:a("calls_go_to_chat_with_participant"),onClick:function(){m&&n({type:"change_ui_mode",mode:aa.COLLAPSED}),n({type:"management",isOpen:!1}),o(r.peerId)}}),!u&&d&&!$a(e.me)&&function(e){return ho(e)}(p)&&!uo(r)){var v={negative:!0,text:a("calls_participant_menu_kick"),onClick:function(){n({type:"toggle_participants_kick",data:{participant:r}})}};c?f.push(v):h.push(v)}return!u&&d&&!$a(e.me)&&lo(p)&&h.push({text:a("calls_participant_menu_mute_audio_video"),onClick:function(){n({type:"toggle_participants_management",data:{mode:Yi.SINGLE,participant:r}})}}),u||d||$a(e.me)||!lo(p)||h.push({text:a("calls_participant_menu_mute"),onClick:function(){var e=Za(r);e&&t.muteParticipant(e,[Wi.AUDIO],!1).catch(console.log)}}),u||!d||$a(e.me)||!lo(e.participants[e.me])||function(e){if(!e.mediaSettings)return!1;var t=e.mediaSettings,n=t.isAudioEnabled,r=t.isVideoEnabled,i=t.isScreenSharingEnabled;return n&&(r||i)}(r)||h.push({text:a("calls_participant_menu_enable_media_request"),onClick:function(){t.unmuteRequest(Za(r),[Wi.AUDIO,Wi.VIDEO]).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ASK_USER_TO_UNMUTE,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Qa(e.peer)})}}),u||!d||$a(e.me)||$a(r.peerId)||!po(e.participants[e.me])||co(r)||uo(r)||r.status!==oa.CONNECTED||h.push({text:a("calls_participant_menu_assign_admin_role"),onClick:function(){n({type:"toggle_admin_assignment",data:{participant:r}})}}),!u&&d&&!$a(e.me)&&po(e.participants[e.me])&&co(r)&&h.push({text:a("calls_participant_menu_revoke_admin_role"),onClick:function(){var i=Za(r);i&&(t.grantRoles(i,[Hi.ADMIN],!0).then((function(){n({type:"change_participant_roles",participantId:r.peerId,data:r.roles.filter((function(e){return e!==Hi.ADMIN}))})})).catch(console.log),Ya.logEvent({call_event_type:Qi.a.RETRIEVE_ADMIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Qa(e.peer)}))}}),d&&!$a(e.me)&&so(e.participants[e.me])&&!oo(e,r)&&h.push({text:a("calls_participant_menu_pin"),onClick:function(){var i=Za(r);i&&(t.pinParticipant(i,!1).then((function(){n({type:"set_admin_pinned_participant",data:r.peerId}),n({type:"toggle_orator_mode",isOratorMode:!0})})).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ADMIN_PIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Qa(e.peer)}))}}),d&&!$a(e.me)&&so(e.participants[e.me])&&oo(e,r)&&h.push({text:a("calls_participant_menu_pin_cancel"),onClick:function(){var i=Za(r);i&&(t.pinParticipant(i,!0).then((function(){n({type:"set_admin_pinned_participant",data:null})})).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ADMIN_UNPIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Qa(e.peer)}))}}),c&&f.length>0&&(h.push({separator:!0}),h=h.concat(f)),h},eo=function(e,t){var n=e.participants[t];return n&&(n.peerId===e.me||!!n.status)};function to(e,t){var n,r,i,a=e.screenSharingPinnedParticipant||e.pinnedParticipant||e.orator;if(a)return e.participants[a];for(var o=0,s=Object.values(e.participants);o<s.length;o++){var c=s[o];if(c.peerId!==e.me&&c.wasConnected&&(i||(i=c),!t||(null===(n=c.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)))return c}var u=e.participants[e.me];return!i&&t&&(null===(r=u.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)?u:i}function no(e,t){return Object.values(e.participants).reduce((function(n,r){return(void 0===t||t(r))&&r.peerId!==e.me&&r.status&&n.push(r),n}),[e.participants[e.me]])}function ro(e){var t=e.participants,n=0;for(var r in t)t.hasOwnProperty(r)&&ao(e,t[r])&&n++;return n}function io(e){return Object.values(e.participants).filter((function(e){return e.status===oa.CONNECTED})).concat(e.participants[e.me])}function ao(e,t){return t.peerId===e.me||t.status}function oo(e,t){return e.adminPinnedParticipant===t.peerId}function so(e){return co(e)||uo(e)}function co(e){return!!(null==e?void 0:e.roles)&&e.roles.some((function(e){return e===Hi.ADMIN}))}function uo(e){return!!(null==e?void 0:e.roles)&&e.roles.some((function(e){return e===Hi.CREATOR}))}function lo(e){return!!e.roles&&(uo(e)||co(e))}function po(e){return!!e.roles&&(uo(e)||co(e))}function ho(e){return co(e)||uo(e)}function fo(e){var t=e.permissions;return[t.audio,t.video,t.screenSharing].some((function(e){return e===$i.DENY}))}function mo(e){var t=e.id,n=e.disablePhoto,r=e.photo,i=e.className,a=e.children,o=Math.abs(t%6)+1,s=u.useContext(Wa).anonymPhoto,c=$a(t)?s:r&&!r.includes("https://vk.com/images/camera_400.png"),l=Object(p.a)("BlurredBackground",i,"BlurredBackground--"+o,{"BlurredBackground--noPhoto":!n&&!c});return u.createElement("div",{className:l},u.createElement("div",{className:"BlurredBackground__in"},!n&&c&&u.createElement("div",{className:"BlurredBackground__inner",style:{backgroundImage:`url(${r})`}})),u.createElement("div",{className:"BlurredBackground__content"},a))}mo.defaultProps={photo:"",children:"",disablePhoto:!1};var vo=n("Aegd"),_o=function(){return(_o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},go=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ao=function(e){var t=go(e,[]);return l.a.createElement("svg",_o({width:"10",height:"10",viewBox:"0 0 10 10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M6.80486 3.06621L9.19457 3.30079C10.0261 3.38241 10.2811 4.21346 9.63901 4.75944L7.76813 6.35033L8.46267 8.94201C8.69075 9.79313 7.98312 10.3084 7.27435 9.79614L5.0011 8.15325L2.72785 9.79614C2.02194 10.3063 1.31141 9.79324 1.53953 8.94201L2.23406 6.35033L0.363183 4.75944C-0.281598 4.21116 -0.0275869 3.38278 0.807493 3.30079L3.19677 3.06621L4.24943 0.583062C4.57908 -0.194562 5.42332 -0.194173 5.75269 0.583142L6.80486 3.06621Z"}))},yo=function(e){var t=e.className,n=e.type;return l.a.createElement("div",{className:Object(p.a)("UserBadge","UserBadge--"+n,t)},l.a.createElement(Ao,null))},Eo=function(e){var t=e.id,n=e.waves,r=void 0!==n&&n,i=e.size,a=void 0===i?"m":i,o=e.photo,s=void 0===o?"":o,c=e.alt,d=e.letter,h=e.showCreatorBadge,f=e.showAdminBadge,m=Object(u.useContext)(Wa),v=m.withAnimation,_=m.anonymPhoto,g=$a(t),A=Object(p.a)("CallPhoto__photo","CallPhoto--"+a,{"CallPhoto--waves":v&&!!r});return!s||s.includes("https://vk.com/images/camera_400.png")||g&&!_?l.a.createElement("div",{className:"CallPhoto"},l.a.createElement(vo.a,{id:Math.abs(t),text:d||c.slice(0,1),size:a,className:A}),h?l.a.createElement(yo,{className:"CallPhoto__badge",type:"creator"}):f?l.a.createElement(yo,{className:"CallPhoto__badge",type:"admin"}):null):l.a.createElement("div",{className:"CallPhoto"},l.a.createElement("img",{src:s,className:A,alt:c}),h?l.a.createElement(yo,{className:"CallPhoto__badge",type:"creator"}):f?l.a.createElement(yo,{className:"CallPhoto__badge",type:"admin"}):null)};function So(e){var t=e.title,n=e.description,r=e.className;return u.createElement("header",{className:Object(p.a)("CallHeader",r)},u.createElement("h1",{className:"CallHeader__title"},t),u.createElement("div",{className:"CallHeader__description"},n))}var bo=function(){return(bo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Co=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},wo=Object(u.forwardRef)((function(e,t){var n,r=e.type,i=e.isActive,a=e.icon,o=e.className,s=Co(e,["type","isActive","icon","className"]),c=Object(p.a)("CallIconButton",o,"CallIconButton--withAnimation",((n={"CallIconButton--active":i})["CallIconButton--"+r]=!!r,n)),u=bo(bo({},s),{onMouseDown:function(e){e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return l.a.createElement("button",bo({},u,{className:c,ref:t}),a)})),Oo=n("s0Wt"),To=l.a.createContext({getLang:function(e){return e},langSex:function(e,t){return t},langNumeric:function(e,t){return""+t},langShortDateTime:function(e){return""+e}});function Io(e){var t=e.id,n=e.photo,r=e.title,i=e.description,a=e.onCollapseCall,o=e.children,s=u.useContext(To).getLang;return u.createElement("section",{className:"IncomingCall"},u.createElement(mo,{id:t,photo:n}),u.createElement(Oo.default,{position:"b",text:s("calls_collapse"),marginTop:-6},u.createElement(wo,{type:"collapse",className:"IncomingCall__collapse",onClick:a})),u.createElement(So,{title:r,description:i}),u.createElement(Eo,{id:t,waves:!0,photo:n,alt:r||""}),u.createElement("footer",{className:"IncomingCall__footer"},o))}var Po=n("e87a"),Ro=n("1nu5"),Do=function(e,t,n){var r=Object(u.useRef)(null);r.current=r.current?r.current:new Ro.a(e,t);var i=r.current,a=Object(u.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),o=Object(u.useState)(e),s=o[0],c=o[1],l=Object(u.useState)(a(e)),d=l[0],p=l[1];return Object(u.useEffect)((function(){var t=a(e),r=e.filter((function(e){return!d[n(e)]})),o=s.filter((function(e){return!t[n(e)]}));(r.length||o.length)&&(r.forEach((function(e){i.add(e)})),o.forEach((function(e){i.remove(e)})),c(e),p(t))}),[e]),i};var ko=function(e){var t=e.onClose,n=e.onBackdropClick,r=e.isIncoming,i=void 0!==r&&r,a=e.isCautionBoxShown,o=void 0!==a&&a,s=e.children,c=Object(h.d)(),d=Object(u.useContext)(Wa).withAnimation,f=Object(p.a)("CallModal",{"CallModal--withAnimation":d});Object(u.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var m=o?function(){c({type:"show_caution_box",isOpen:!0,isIncoming:i||!1})}:t;return l.a.createElement(Po.default,{className:f,disableBodyScroll:!0,onClose:m,onBackdropClick:n},s)};function No(e){var t=e.SDK,n=e.bridge,r=Object(h.e)((function(e){return[e.peer,e.callData,e.participants]})),i=r[0],a=r[1],o=r[2],s=Object(h.d)(),c=l.a.useContext(To).getLang,u=Qa(i)?a.conversation:o[i],d=a.type===ia.VIDEO,p=c(d?"calls_incoming_videocall":"calls_incoming_audiocall"),f=c(d?"calls_reply_with_audio":"calls_reply"),m=c(d?"calls_reject_call":"calls_reject"),v=function(){t.declineCall(),Ya.logEvent({call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callId,peer_id:i,is_group_call:Qa(i),reason:"none"})};return l.a.createElement(ko,{onClose:v,isIncoming:!0,isCautionBoxShown:!0},l.a.createElement(Io,{id:i,title:(null==u?void 0:u.tab)||"",description:p,photo:(null==u?void 0:u.photo)||"",onCollapseCall:function(){s({type:"change_ui_mode",mode:aa.COLLAPSED})}},d&&l.a.createElement(ka,{text:c("calls_reply_with_video"),type:fa.POSITIVE,icon:l.a.createElement(La,null),onClick:function(){return n.acceptCall(!0,!0)}}),l.a.createElement(ka,{text:f,type:d?fa.REGULAR:fa.POSITIVE,icon:l.a.createElement(xa,null),onClick:function(){return n.acceptCall(!1,!0)}}),l.a.createElement(ka,{text:m,type:fa.NEGATIVE,icon:l.a.createElement(Va,null),onClick:v})))}n("pIFo"),n("SRfc"),n("OG14"),n("hhXQ"),n("KKXr");function Fo(e,t){return new Promise((function(n){setTimeout(n.bind(null,t),1e3*e)}))}var Lo=navigator.userAgent.toLowerCase(),Mo={version:(Lo.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(Lo)&&/webkit|safari|khtml/i.test(Lo)},jo=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function xo(e){return jo.reduce((function(e,t){var n=t[0],r=t[1];return e.replace(new RegExp(r,"ig"),n)}),e)}function Bo(e){return jo.reduce((function(e,t){var n=t[0],r=t[1];return e.replace(new RegExp(n,"ig"),r)}),e).replace(/&#(\d+);/g,(function(e,t){return String.fromCodePoint(t)}))}var Uo=function(){return(Uo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vo=function(e){var t=e.id,n=e.photo_400_orig,r=e.sex,i=e.first_name,a=e.last_name,o=e.screen_name,s=e.name,c=e.photo_400;return Uo({id:+t,peerId:+t,name:s||i+" "+a,firstName:i,shortName:qo(i,a,s),link:o&&"/"+o,sex:r},n||c?{photo:n||c}:{})};function Go(e){return e.reduce((function(e,t){return e[t.id]=!0,e}),{})}function Ho(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Wo(){return(Wo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function zo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ko(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ko(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ko(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qo(e){var t=e.shortName,n=e.firstName;e.lastName;if(!t||!n){var r=zo(e.name.split(" "),2);t=qo(n=r[0],r[1],e.name)}return Wo({},e,{peerId:+e.id,tab:e.name,shortName:t,firstName:n})}function qo(e,t,n){if(e){var r=t?t.length>2?t.substring(0,1)+".":t:"";return r?`${e} ${r}`:e}return n}function Jo(e){var t=zo(e,2),n=t[0],r=t[1],i=n&&function(e){var t=e.callInProgress,n=Ho(e,["callInProgress"]);return!n.call_in_progress&&t&&(n.call_in_progress=t),n}(n);return[i&&("peerId"in i?i:Qo(i)),r?r.map(Qo):[]]}function Yo(e){var t=e.items,n=e.profiles,r=zo(t,1)[0],i=function(e){if(e.chat_settings){var t={peerId:e.peer.id,tab:e.chat_settings.title,name:e.chat_settings.title,canAddMembers:e.chat_settings.acl.can_invite,adminIds:e.chat_settings.admin_ids,ownerId:e.chat_settings.owner_id};return e.chat_settings.photo&&(t.photo=e.chat_settings.photo.photo_100),t}return{canAddMembers:!0,peerId:e.peer.id}}(r),a=function(e){return e.map(Vo)}(n);return[Wo({},i,{tab:i.name}),za(i.peerId)?[Wo({},a&&a.filter(e=>e.peerId===i.peerId)[0],{},i)]:a,r]}function $o(e){var t=e.caller_info,n=e.chat_info;return n?2e9+n.chat_id:t.user_id}function Zo(e){return!!e.payload.chat_info}function Xo(e){return Object.values(e.participants).filter(t=>t.peerId===e.me||t.status)}function es(e){return!!Object.values(e.participants).find(t=>(t.peerId===e.me||t.wasConnected)&&t.mediaSettings&&t.mediaSettings.isVideoEnabled)}function ts(e){var t=Date.now(),n=Math.max(0,Math.floor((t-e)/1e3));return 0===n?"00:00":n<=599?"0"+Object(p.d)(n):Object(p.d)(n)}function ns(e,t,n){switch(+e){case 963:return n("calls_join_error_require_access");case 951:return n("calls_join_error_text");case 928:return n("calls_privacy_error");case 948:return n(t?"calls_chat_busy_error":"calls_busy_error");case 9:return n("calls_flood_error");case 960:return n("calls_join_error_require_auth");case 1:case 8:case 10:case 923:default:return n("calls_start_error")}}function rs(e,t,n){var r=0===e.search("EXTERNAL_API_ERROR"),i=e.match(/\d+/g),a=i?+e.match(/\d+/g)[1]:-2,o=i?+e.match(/\d+/g)[0]:-2;if(!r||Number.isNaN(a)){switch(o){case 401:return n("calls_start_error_auth")}return function(e,t,n){switch(!0){case-1!==e.search("error.webrtc.auth.required"):return n("calls_join_error_require_auth");case-1!==e.search("error.webrtc.auth.banned"):case-1!==e.search("error.webrtc.participant.check.privacy"):return n("calls_join_error_banned");case-1!==e.search("error.webrtc.participant.check.killed_call"):return n("calls_join_error_killed_call");case-1!==e.search("not.found.webrtc.conversation"):return n("calls_join_error_not_found_conversation");default:return n("calls_start_error")}}(e,0,n)}switch(e){case vt.CANCELED:return n("calls_hangup_error_canceled");case vt.REJECTED:return n("calls_hangup_error_rejected");case vt.REMOVED:return n("calls_hangup_error_removed");case vt.HUNGUP:return n("calls_hangup_error_hangup");case vt.MISSED:return n("calls_hangup_error_missed");case vt.BUSY:return n("calls_hangup_error_busy");case vt.FAILED:return n("calls_hangup_error_failed");case vt.NETWORK_ERROR:return n("calls_hangup_error_network_error");case vt.CALLER_IS_BLOCKED:return n("calls_hangup_error_caller_is_blocked");case vt.NOT_FRIENDS:return n("calls_hangup_error_not_friends");case vt.CALLEE_IS_OFFLINE:return n("calls_hangup_error_callee_is_offline");case vt.UNKNOWN_ERROR:return n("calls_hangup_error_unknown_error");case vt.UNSUPPORTED:return n("calls_hangup_error_unsupported");case vt.OLD_VERSION:return n("calls_hangup_error_old_version");case vt.SERVICE_DISABLED:return n("calls_hangup_error_service_disabled");case vt.EXTERNAL_API_ERROR:return n("calls_hangup_error_external_api_error");case vt.SOCKET_CLOSED:return n("calls_hangup_error_socket_closed")}return ns(+a,t,n)}function is(e){Mo.safari&&+Mo.version.split(".")[0]<13&&window.setTimeout(()=>{e&&e.current&&(e.current.volume=1e-4)},10)}var as=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){return n.reduce((e,t)=>t(e),e)(...arguments)}};function os(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{attempts:10,timeout:0};return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.attempts>0?Fo(t.timeout,null).then(()=>e(...r)).catch(n=>(!t.timeout&&(t.timeout=1),t.attempts=n.type===ua.API?0:t.attempts-1,t.timeout=Math.min(2*t.timeout,300),os(e,t)(...r))):Promise.reject(Xi.CANT_REACH_API)}}var ss=(e,t)=>function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t(...r).catch(n=>{if(n.error===ta.AUTH)return e().then(()=>t(...r));throw n})};function cs(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=", ",s=e=>Bo(n(e)||"");if(0===a&&e.length>0&&(a=e.length),a>t.length){var c=a-t.length,u=e.slice(0,3).map(s).join(o);return i(c,"calls_members_list_label",r("calls_members_list_label",c)).replace("{name}",u)}if(t.length>1){var l=t.length>2?e.slice(0,2).map(s).join(o):s(e[0]),d=s(e[t.length-1]);return r("calls_and").replace("{before}",l).replace("{after}",d)}return 1===t.length?s(e[0]):""}function us(e){return"current"in e?e.current:e}function ls(e,t){var n=t.join_link,r=t.preview,i=t.profiles,a=[...t.anonyms,...i].map(Vo);return{joinLink:n,title:r.title,membersCount:r.members_count,photo_100:r.photo.photo_100,photo_200:r.photo.photo_200,members:a,conversationData:{peerId:0,canAddMembers:!0,tab:e("calls_new_call_title"),photo:"https://vk.com/images/call_convo_stub.png"}}}function ds(){return(ds=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ps(e){var t=e.hasVideo,n=e.stream,r=e.isMe,i=e.isVideoVisible,a=e.isScreenShareStream,o=e.setVideoVisibility,s=e.className,c=e.allowContain,l=e.withAnimation,d=u.useRef(null),h=t&&n,f={autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata",onLoadedData:()=>h&&!i&&o&&o(!0)},m=c&&function(e,t){if(t&&t.active){var n=t.getVideoTracks();if(!n||0===n.length)return!1;var r=n[0].getSettings(),i=void 0!==r.width?r.width:e?e.videoWidth:0;return(void 0!==r.height?r.height:e?e.videoHeight:0)>=i}return!1}(d.current,n)||a,v=Object(p.a)("Video",s,{"Video--contain":h&&n&&m,"Video--visible":h&&i,"Video--mirrored":r&&h&&!a,"Video--withAnimation":l});return u.useEffect(()=>{h&&d.current&&(d.current.srcObject=n,d.current.volume=0,is(d)),!h&&i&&o&&o(!1)},[e.hasVideo,e.stream,i]),h?u.createElement("video",ds({className:v,ref:d},f)):null}ps.defaultProps={hasVideo:!1,isMe:!1,isVideoVisible:!1,allowContain:!0,isScreenShareStream:!1,withAnimation:!0};var hs=n("8tCR"),fs=function(e){var t=e.id,n=e.photo,r=e.photoSize,i=void 0===r?"m":r,a=e.alt,o=e.letter,s=e.className;return l.a.createElement(hs.default,{className:Object(p.a)("ParticipantCard",s)},l.a.createElement("span",{className:"ParticipantCard__in"},l.a.createElement(Eo,{id:t,photo:n,size:i,alt:a||"",letter:o})))},ms=function(){return(ms=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},vs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},_s=function(e){var t=vs(e,[]);return l.a.createElement("svg",ms({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},t),l.a.createElement("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"}))},gs=function(){return(gs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},As=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ys=function(e){var t=As(e,[]);return l.a.createElement("svg",gs({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"}))},Es=n("6x0M"),Ss=function(){return(Ss=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},bs=function(e){var t=e.children,n=e.items,r=e.open,i=void 0!==r&&r,a=e.setOpen,o=Object(u.useRef)(null),s=Object(u.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),a(!i)}),[i]),c=function(e){o.current&&o.current.contains(e.target)||a(!1)};return Object(u.useEffect)((function(){return document.documentElement.addEventListener("click",c),function(){return document.documentElement.removeEventListener("click",c)}}),[]),i?l.a.createElement(Es.a,{content:l.a.createElement("ul",{className:"CallsDropdown",ref:o},n.map((function(e,t){return l.a.createElement("li",{className:"CallsDropdown__item",key:e.key||t},function(e,t,n){void 0===n&&(n=!1);var r=Object(p.a)("CallsDropdown__button",{"CallsDropdown__button--disabled":n});return"href"in e&&"onClick"in e&&void 0!==e.onClick?l.a.createElement("a",{href:e.href,rel:"noopener noreferrer",target:"_blank",onClick:n?void 0:function(n){n.stopPropagation(),e.onClick(n),t(!1)},className:r},e.text):"href"in e?l.a.createElement("a",{href:e.href,rel:"noopener noreferrer",target:"_blank",onClick:n?void 0:function(e){e.stopPropagation(),t(!1)},className:r},e.text):"onClick"in e?l.a.createElement("button",{onClick:n?void 0:function(n){n.stopPropagation(),e.onClick(n),t(!1)},className:r},e.text):null}(e,a,e.disabled))}))),mode:"point"},l.a.cloneElement(t,Ss(Ss({},t.props),{onClick:s,"data-active":i}))):l.a.cloneElement(t,Ss(Ss({},t.props),{onClick:s}))},Cs=function(){return(Cs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ws=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Os=function(e){var t=ws(e,[]);return l.a.createElement("svg",Cs({width:"25",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M10 8a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"}),l.a.createElement("path",{d:"M6.558 10a.024.024 0 00-.017.04l3.254 3.255-2.947 2.948a1 1 0 001.414 1.414l2.948-2.948 3.25 3.25c.015.015.04.005.04-.017v-2.114c0-1.81.72-3.547 2-4.828l1.658-.414a.2.2 0 00.093-.336l-4-4a.2.2 0 00-.336.093L13.5 8a6.828 6.828 0 01-4.829 2H6.558z"}))},Ts=function(){return(Ts=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Is=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ps=function(e){var t=Is(e,[]);return l.a.createElement("svg",Ts({width:"56",height:"56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M28.5 37.5A1.5 1.5 0 0030 36V22.622l4.94 4.939a1.5 1.5 0 002.007.103l.114-.103a1.5 1.5 0 000-2.122l-7.5-7.5a1.5 1.5 0 00-2.122 0l-7.5 7.5a1.5 1.5 0 002.122 2.122l4.938-4.939L27 36a1.5 1.5 0 001.355 1.493l.145.007z"}),l.a.createElement("path",{d:"M19.883 8c-5.019 0-7.117.465-9.244 1.603a10.924 10.924 0 00-4.536 4.536C4.965 16.266 4.5 18.364 4.5 23.383v9.234c0 5.019.465 7.117 1.603 9.244a10.924 10.924 0 004.536 4.536C12.766 47.535 14.864 48 19.883 48h17.234c5.019 0 7.117-.465 9.244-1.603a10.924 10.924 0 004.536-4.536c1.138-2.127 1.603-4.225 1.603-9.244v-9.234c0-5.019-.465-7.117-1.603-9.244a10.924 10.924 0 00-4.536-4.536C44.234 8.465 42.136 8 37.117 8H19.883zm-7.83 4.248c1.486-.794 3-1.248 7.83-1.248h17.234c4.83 0 6.344.454 7.83 1.248a7.925 7.925 0 013.305 3.306c.794 1.485 1.248 3 1.248 7.83v9.233c0 4.83-.454 6.344-1.248 7.83a7.925 7.925 0 01-3.306 3.305c-1.485.794-3 1.248-7.83 1.248H19.884c-4.83 0-6.344-.454-7.83-1.248a7.925 7.925 0 01-3.305-3.306c-.794-1.485-1.248-3-1.248-7.83v-9.233c0-4.83.454-6.344 1.248-7.83a7.925 7.925 0 013.306-3.305z"}))};function Rs(e){var t=e.isInverted,n=Object(p.a)("CallingStatus",{"CallingStatus--inverted":!!t}),r=Object(p.a)("CallingStatus__part","CallingStatus__part--withAnimation");return l.a.createElement("div",{className:n},l.a.createElement("span",{className:r}),l.a.createElement("span",{className:r}),l.a.createElement("span",{className:r}))}var Ds,ks=function(e){var t=e.id,n=e.isOrator,r=void 0!==n&&n,i=e.isInfoShown,a=e.isPinned,o=e.isPinnedByAdmin,s=e.isHandRaised,c=e.photo,d=e.hasVideo,h=e.hasAudio,f=e.isSharingScreen,m=e.isSpeaking,v=void 0!==m&&m,_=e.stream,g=e.isMe,A=void 0!==g&&g,y=e.photoSize,E=e.name,S=e.letter,b=e.status,C=void 0===b?oa.CONNECTED:b,w=e.wasConnected,O=void 0===w||w,T=e.onClickParticipant,I=e.onDblClickParticipant,P=e.onStopScreenShare,R=e.onShow,D=e.onHide,k=e.allowContain,N=void 0!==k&&k,F=e.actions,L=l.a.useContext(To).getLang,M=Object(u.useContext)(Wa),j=M.withAnimation,x=M.anonymPhoto,B=l.a.useRef(null),U=$a(t),V=!!T||!!I,G=r&&f&&A,H=Object(p.a)("Participant",{"Participant--isInteractive":V,"Participant--isPinned":a,"Participant--isSpeaking":v,"Participant--isOrator":r,"Participant--withAnimation":j}),W=Object(p.a)("Participant__more",{"Participant__more--withAnimation":j}),z=l.a.useState(!1),K=z[0],Q=z[1],q=l.a.useState(!1),J=q[0],Y=q[1];l.a.useEffect((function(){if(R&&D){R(t);var e=new IntersectionObserver((function(e){e[0].isIntersecting?R(t):D(t)}),{root:null,rootMargin:"0px",threshold:0});return B.current&&e.observe(B.current),function(){return e.disconnect()}}return function(){}}),[B]),l.a.useEffect((function(){d&&_||Q(!1)}),[d,_,K]);var $=!(d&&_)||!K,Z=Object(u.useCallback)((function(e){T&&T(e,t)}),[T]),X=Object(u.useCallback)((function(e){I&&I(e,t)}),[I]);return l.a.createElement("article",{ref:B,className:H,onClick:Z,onDoubleClick:X},F&&F.length>0&&l.a.createElement(bs,{items:F,open:J,setOpen:Y},l.a.createElement("button",{className:W,"aria-label":L("calls_actions")},l.a.createElement(ys,null))),V&&!o&&l.a.createElement("header",{className:"Participant__header"},a&&l.a.createElement("div",{className:"Participant__pin"})),o&&l.a.createElement("header",{className:"Participant__header"},l.a.createElement(Os,{className:"Participant__icon"})),$&&l.a.createElement(mo,{id:t,photo:!x&&U?"":c,className:"Participant__main"},l.a.createElement(fs,{id:t,photo:!x&&U?"":c,photoSize:y,alt:E||"",letter:S,className:i?"Participant__offsetCard":""})),s&&l.a.createElement("div",{className:"Participant__handIndicator"},l.a.createElement(_s,{className:"Participant__handIcon"})),G&&l.a.createElement("div",{className:"Participant__screenSharer"},l.a.createElement(Ps,null),l.a.createElement("div",{className:"Participant__screenSharerText"},L("calls_you_are_screen_sharer")),l.a.createElement("button",{className:"Participant__screenSharerButton",onClick:P},L("calls_screen_share_stop"))),!G&&d&&l.a.createElement(ps,{className:"Participant__main",hasVideo:d,stream:_,isMe:A,isVideoVisible:K,isScreenShareStream:f,setVideoVisibility:Q,allowContain:N,withAnimation:j}),(C!==oa.CONNECTED||!(O||A))&&l.a.createElement("div",{className:"Participant__status"},l.a.createElement(Rs,{isInverted:!0})),i&&l.a.createElement("footer",{className:"Participant__footer"},l.a.createElement("span",{className:"Participant__name"},E),(O||A)&&!h&&l.a.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--mic"})))},Ns=function(e){var t=e.id,n=e.name,r=e.letter,i=e.hasAudio,a=e.hasVideo,o=e.isSharingScreen,s=e.stream,c=e.wasConnected,u=e.opponentId,d=e.opponentHasAudio,h=e.opponentHasVideo,f=e.opponentIsSharingScreen,m=e.opponentStream,v=e.opponentPhoto,_=e.opponentName,g=e.opponentLetter,A=e.opponentWasConnected,y=Object(p.a)("OneToOne",{"OneToOne--hasVideo":a,"OneToOne--opponentHasVideo":h});return l.a.createElement("div",{className:y},l.a.createElement("aside",{className:"OneToOne__local"},l.a.createElement(ks,{id:t,hasVideo:a,hasAudio:i,isSharingScreen:o,stream:s,isMe:!0,name:n,letter:r,photoSize:"m",wasConnected:c})),l.a.createElement("main",{className:"OneToOne__remote"},l.a.createElement(ks,{id:u,hasVideo:h,hasAudio:d,isSharingScreen:f,stream:m,photo:v,name:_,letter:g,photoSize:"l",wasConnected:A})))},Fs=function(){return(Fs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ls=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ms=function(e){var t=e.children,n=e.className,r=e.alignX,i=e.alignY,a=e.size,o=void 0===a?"m":a,s=Ls(e,["children","className","alignX","alignY","size"]),c=Object(p.a)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+i,"CallIconButtonGroup--size-"+o,n);return l.a.createElement("div",Fs({className:c},s),t)},js=function(){return(js=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},xs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Bs=function(e){var t=xs(e,[]);return l.a.createElement("svg",js({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"}))},Us=function(){return(Us=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Gs=Object(u.forwardRef)((function(e,t){var n=e.unreadCount,r=void 0===n?0:n,i=Vs(e,["unreadCount"]),a=Object(u.useContext)(Wa).withAnimation,o="",s="";switch(!0){case!r:o="none";break;case r<=9:o="single",s=r.toString();break;case r<=99:o="double",s=r.toString();break;case r>99:o="max",s="99+"}var c=Object(p.a)("ChatIconButton","ChatIconButton--"+o,{"ChatIconButton--withAnimation":a});return l.a.createElement("button",Us({className:c},i,{ref:t}),s&&l.a.createElement("div",{className:"ChatIconButton__count "},s))})),Hs=function(){return(Hs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ws=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},zs=function(e){var t=Ws(e,[]);return l.a.createElement("svg",Hs({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"}))},Ks=function(){return(Ks=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Qs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qs=function(e){var t=Qs(e,[]);return l.a.createElement("svg",Ks({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"}),l.a.createElement("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"}))},Js=function(){return(Js=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ys=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},$s=function(e){var t=Ys(e,[]);return l.a.createElement("svg",Js({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"}))},Zs=function(){return(Zs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Xs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ec=function(e){var t=Xs(e,[]);return l.a.createElement("svg",Zs({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M20.465 4.4c-.489-.26-.974-.4-2.31-.4H5.844c-1.336 0-1.821.14-2.31.4A2.726 2.726 0 002.4 5.536C2.139 6.024 2 6.509 2 7.845v8.31c0 1.336.14 1.821.4 2.31.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h12.31c1.336 0 1.821-.14 2.31-.4a2.726 2.726 0 001.134-1.135c.262-.489.401-.974.401-2.31v-8.31c0-1.336-.14-1.821-.4-2.31A2.726 2.726 0 0020.464 4.4zm-11.81 5.728l2.97-2.978c.207-.2.543-.2.75 0l2.97 2.978c.33.318.077.872-.376.872H13v4.979c0 .564-.442 1.021-1 1.021s-1-.457-1-1.021V11H9.031c-.44 0-.715-.545-.375-.872z"}))},tc=function(){return(tc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},nc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},rc=function(e){var t=nc(e,[]);return l.a.createElement("svg",tc({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"}))},ic=function(){return(ic=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ac=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},oc=function(e){var t=ac(e,[]);return l.a.createElement("svg",ic({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"}))},sc=function(){return(sc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},cc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},uc=function(e){var t=cc(e,[]);return l.a.createElement("svg",sc({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"}))},lc=function(){return(lc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},dc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},pc=function(e){var t=dc(e,[]);return l.a.createElement("svg",lc({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"}))},hc=function(){return(hc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},fc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function mc(e){var t=e.children,n=e.content,r=e.position,i=void 0===r?"auto":r,a=e.align,o=void 0===a?"auto":a,s=e.appearance,c=void 0===s?"dark":s,d=e.open,h=void 0!==d&&d,f=e.onOpen,m=e.onClose,v=e.delay,_=void 0===v?50:v,g=fc(e,["children","content","position","align","appearance","open","onOpen","onClose","delay"]),A=Object(u.useState)(h?Ds.OPENED:Ds.CLOSED),y=A[0],E=A[1],S=Object(u.useRef)(null);Object(u.useEffect)((function(){var e=null,t=null,n=function(){e&&(clearTimeout(e),e=null)},r=function(){n(),e=window.setTimeout((function(){E(Ds.OPENED),f&&f()}),_)},i=function(){n(),t=window.setTimeout((function(){y===Ds.OPENED?E(Ds.IS_CLOSING):(E(Ds.CLOSED),m&&m())}),0)};return S&&S.current&&(S.current.addEventListener("mouseenter",r),S.current.addEventListener("mouseleave",i)),function(){S&&S.current&&(S.current.removeEventListener("mouseenter",r),S.current.removeEventListener("mouseleave",i)),n(),t&&(window.clearTimeout(t),t=null)}}),[S,y]),Object(u.useEffect)((function(){var e=h?Ds.OPENED:Ds.CLOSED;y!==e&&E(e)}),[h]);var b=Object(u.useCallback)((function(){y===Ds.IS_CLOSING&&(E(Ds.CLOSED),m&&m())}),[y]),C=Object(p.a)("TooltipNew",{"TooltipNew--removed":"isClosing"===y,"TooltipNew--dark":"dark"===c,"TooltipNew--light":"light"===c}),w=l.a.createElement("div",{className:C,onTransitionEnd:b},n);return l.a.createElement(Es.a,hc({content:w,position:i,align:o,open:y!==Ds.CLOSED,ref:S},g),t)}!function(e){e.OPENED="opened",e.IS_CLOSING="isClosing",e.CLOSED="closed"}(Ds||(Ds={}));var vc=n("gEg2"),_c=function(){var e=Object(vc.classNames)({MicIconWithSpeakingIndicator__scale:!0});return l.a.createElement("svg",{height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},l.a.createElement("mask",{id:"MicIconWithSpeakingIndicatorMask"},l.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"})),l.a.createElement("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"}),l.a.createElement("g",{mask:"url(#MicIconWithSpeakingIndicatorMask)"},l.a.createElement("g",{className:e},l.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"}),l.a.createElement("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"}))))},gc=function(){return(gc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ac=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},yc=function(e){var t=Ac(e,[]);return l.a.createElement("svg",gc({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.49 4.293a4.402 4.402 0 116.225 6.225l-1.072 1.072a.9.9 0 01-1.273-1.273l1.071-1.072a2.601 2.601 0 10-3.678-3.678l-3.537 3.537a2.601 2.601 0 000 3.678.9.9 0 01-1.274 1.273 4.402 4.402 0 010-6.225l3.537-3.537zm-.708 5.66a.9.9 0 011.273 0 4.402 4.402 0 010 6.225l-3.537 3.537a4.402 4.402 0 11-6.225-6.226l1.122-1.121a.9.9 0 111.273 1.273l-1.121 1.122a2.601 2.601 0 103.678 3.678l3.537-3.537a2.601 2.601 0 000-3.678.9.9 0 010-1.274z",fill:"#fff"}))};function Ec(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Sc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bc(e){var t=e.id,n=e.photo,r=e.disablePhoto,i=e.info,a=e.chatUnreadCount,o=void 0===a?0:a,s=e.callMenuActions,c=e.isAudioAllowed,l=e.isVideoAllowed,d=e.isVideoEnabled,h=e.isAudioEnabled,f=e.isScreenSharingEnabled,m=e.isOratorMode,v=e.isFullScreen,_=e.onToggleVideo,g=e.onToggleAudio,A=e.onLeaveCall,y=e.onCollapseCall,E=e.onToggleOratorMode,S=e.onChat,b=e.onHandClick,C=e.onToggleScreenShare,w=e.onFullScreenToggle,O=e.isParticipantControlActive,T=e.isLayoutSwitchShown,I=e.isScreenShareControlShown,P=e.isHandRaised,R=e.isHandControlShown,D=e.isChatControlShown,k=e.onParticipantsClick,N=e.onTooltipChange,F=e.onHidePanel,L=e.notification,M=e.tooltips,j=e.amISpeaking,x=e.children,B=e.onChainClick,U=u.useContext(Wa),V=U.withAnimation,G=U.isModalView,H=u.useContext(To).getLang,W=Object(p.a)("Call",{"Call--fullscreen":v||!G}),z=u.useRef(null),K=u.useRef(null),Q=Ec(u.useState(!1),2),q=Q[0],J=Q[1],Y=function(e,t,n,r){var i=Ec(u.useState(!0),2),a=i[0],o=i[1],s=u.useRef(null),c=u.useRef(!1),l=u.useRef(!1),d=u.useRef(!1);d.current!==r&&(d.current=r);var h=u.useRef(!1),f=()=>{c.current||h.current?h.current=!1:(s.current&&window.clearTimeout(s.current),o(!0),l.current||d.current||(s.current=window.setTimeout(()=>{o(!1),s.current=null,n&&n()},5e3)))};return u.useEffect(()=>{f();var n=Object(p.k)(()=>{f()},1e3),r=()=>{l.current=!0},i=()=>{l.current=!1};return t.current.addEventListener("mouseover",r),t.current.addEventListener("mouseout",i),e.current.addEventListener("mousemove",n),()=>{c.current=!0,s.current&&window.clearTimeout(s.current),t.current.removeEventListener("mouseover",r),t.current.removeEventListener("mouseout",i),e.current.removeEventListener("mousemove",n)}},[l,r.current]),[a,e=>{e?o(!0):(o(!1),h.current=!0)}]}(z,K,F,q),$=Ec(Y,2),Z=$[0],X=$[1],ee=Object(p.a)({"Call__controlPanel--withAnimation":V,"Call__controlPanel--hideBottomWithAnimation":V,"Call__controlPanel--hideBottom":!Z}),te=Object(p.a)({"Call__controlPanel--withAnimation":V,"Call__controlPanel--hideBottomWithAnimation":V,"Call__controlPanel--hideBottom":!Z},"Call__curtain"),ne=Object(p.a)("Call__buttons",{"Call__controlPanel--withAnimation":V,"Call__controlPanel--hideBottomWithAnimation":V,"Call__controlPanel--hideBottom":!Z});return u.createElement("section",{className:W,onMouseEnter:()=>X(!0),onMouseLeave:()=>!q&&X(!1),ref:z},i,u.createElement("div",{className:"Call__content"},u.createElement(mo,{id:t,photo:n,disablePhoto:r},x)),u.createElement("div",{className:te,ref:K}),u.createElement(Ms,{alignX:"l",alignY:"b",className:ee},D&&u.createElement(mc,{content:H("calls_chat"),open:M.chat,delay:300,onOpen:()=>N("chat",!0),onClose:()=>N("chat",!1)},u.createElement(Gs,{unreadCount:o,onClick:S})),R&&u.createElement(mc,{content:H(P?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:M.hand,delay:300,onOpen:()=>N("hand",!0),onClose:()=>N("hand",!1)},u.createElement(wo,{icon:u.createElement(rc,null),type:"hand",isActive:P,onClick:b})),I&&u.createElement(mc,{content:H(f?"calls_stop_screen_share":"calls_start_screen_share"),open:M.screenShare,delay:300,onOpen:()=>N("screenShare",!0),onClose:()=>N("screenShare",!1)},u.createElement(wo,{icon:u.createElement(ec,null),isActive:f,onClick:C}))),u.createElement(Ms,{alignX:"r",alignY:"b",className:ee},T&&u.createElement(mc,{content:H(m?"calls_show_grid":"calls_show_orator"),open:M.layout,delay:300,onOpen:()=>N("layout",!0),onClose:()=>N("layout",!1)},u.createElement(wo,{type:m?"changeToGrid":"changeToOrator",onClick:E})),u.createElement(bs,{items:s,open:q,setOpen:J},u.createElement(wo,{type:"settings"})),y&&u.createElement(mc,{content:H("calls_collapse"),open:M.collapse,delay:300,onOpen:()=>N("collapse",!0),onClose:()=>N("collapse",!1)},u.createElement(wo,{type:"collapse",onClick:y})),w&&u.createElement(mc,{content:H(v?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:M.fullscreen,delay:300,onOpen:()=>N("fullscreen",!0),onClose:()=>N("fullscreen",!1)},u.createElement(wo,{onClick:w,icon:v?u.createElement(oc,null):u.createElement(uc,null)}))),u.createElement("footer",{className:"Call__footer"},L&&u.createElement("div",{className:"Call__notification"},L),u.createElement("div",{className:ne},u.createElement(ka,{type:fa.ON,icon:u.createElement(yc,null),onClick:B,className:"Call__footerButton"}),u.createElement(ka,{type:O?fa.OFF:fa.ON,icon:u.createElement($s,null),onClick:k,className:"Call__footerButton"}),u.createElement(ka,{type:l?d?fa.ON:fa.OFF:fa.DISABLED,icon:d?u.createElement(La,null):u.createElement(pc,null),onClick:_,className:"Call__footerButton"}),u.createElement(ka,{type:c?h?fa.ON:fa.OFF:fa.DISABLED,icon:h?j?u.createElement(_c,null):u.createElement(qs,null):u.createElement(zs,null),onClick:g,className:"Call__footerButton"}),u.createElement(ka,{type:fa.NEGATIVE,icon:u.createElement(Bs,null),onClick:A,className:"Call__footerButton"}))))}var Cc=function(e){var t=e.limit,n=e.children,r=u.Children.toArray(n),i=Math.min(r.length,t),a=Object(p.a)("CallGridNew","CallGridNew--c"+i);return l.a.createElement("section",{className:a},l.a.createElement("div",{className:"CallGridNew__in"},r.map((function(e,t){return l.a.createElement("article",{className:"CallGridNew__item",key:e.key||t},e)}))))},wc=function(){return(wc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Oc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Tc=function(e){var t=Oc(e,[]);return l.a.createElement("svg",wc({width:"25",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.541 10.04a.024.024 0 01.017-.04h2.114c1.811 0 3.548-.72 4.829-2l.414-1.657a.2.2 0 01.335-.093l4 4a.2.2 0 01-.092.336L16.5 11a6.828 6.828 0 00-2 4.828v2.114a.024.024 0 01-.04.017l-3.25-3.25-2.948 2.948a1 1 0 11-1.414-1.414l2.947-2.948-3.254-3.254z"}))},Ic=function(e){var t=e.children,n=e.orator,r=e.onToggleParticipantsAside,i=e.isShownParticipantsAside,a=e.isPinned,o=e.isPinnedByAdmin,s=e.isPinnedByShareScreen,c=e.isUnpinAllowed,d=e.onUnpin,h=e.tooltips,f=e.onTooltipChange,m=Object(u.useContext)(To).getLang,v=l.a.Children.toArray(t),_=Object(p.a)({CallOrator__toggleIcon:!0,"CallOrator__toggleIcon--withAnimation":!0}),g=Object(p.a)({CallOrator:!0,"CallOrator--withoutOthers":!i}),A=Object(p.a)({CallOrator__others:!0,"CallOrator__others--hide":!i}),y=Object(p.a)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":i,"CallOrator__toggleArrow--toRight":!i});return l.a.createElement("article",{className:g},l.a.createElement("main",{className:"CallOrator__orator"},(o||s||a)&&l.a.createElement(mc,{position:"b",align:"center",content:m(o&&c?"calls_hint_admin_pin_for_admin":o?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:h.oratorPin,delay:300,onOpen:function(){return f("oratorPin",!0)},onClose:function(){return f("oratorPin",!1)}},l.a.createElement("div",{className:"CallOrator__pinButtonWrapper"},l.a.createElement("button",{className:"CallOrator__pinButton",onClick:function(){f("oratorPin",!1),d()},disabled:!c},o?l.a.createElement(Os,null):l.a.createElement(Tc,null)))),n),l.a.createElement("button",{className:"CallOrator__toggleOthers",onClick:r},l.a.createElement("div",{className:_},l.a.createElement("div",{className:y}))),l.a.createElement("aside",{className:A},l.a.createElement("ul",{className:"CallOrator__list"},v.map((function(e){return l.a.createElement("li",{className:"CallOrator__participant",key:"key"in e?e.key:void 0},e)})))))};function Pc(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r=e.browser.hasMicrophonePermission(),i=e.browser.hasCameraPermission(),a=n&&!r,o=t&&!i;return a||o?function(e,t,n){return e.browser.getUserMedia(t,n).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))}(e,o,a):Promise.resolve()}var Rc=function(e){var t=e.children,n=e.className,r=Object(p.a)("CallNotification",n);return l.a.createElement("div",{className:r},t)},Dc=function(){return(Dc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},kc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Nc=function(e){var t=kc(e,[]);return l.a.createElement("svg",Dc({width:"14",height:"12",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),l.a.createElement("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"}))},Fc=function(){var e=Object(h.e)((function(e){return e})),t=Object(h.d)(),n=l.a.useContext(To),r=n.getLang,i=n.langSex,a=Object(u.useMemo)((function(){return function(e,t,n){if(!e.notification)return null;switch(e.notification.type){case sa.SPEAKING_ON_MUTE:return t("calls_notification_mic_is_mute");case sa.SCREEN_SHARING_STARTED:if(!(i=e.participants[e.notification.data])||!i.name)return l.a.createElement("span",null,t("calls_notification_screen_sharing_started"));var r=n(i.sex,"calls_notification_user_started_screen_sharing",t("calls_notification_user_started_screen_sharing",!0));return l.a.createElement("span",null,r.replace("{user}",i.name));case sa.RAISED_HAND:var i=e.participants[e.notification.data];r=n(i.sex,"calls_notification_raised_hand",t("calls_notification_raised_hand",!0));return l.a.createElement("span",null,r.replace("{user}",i.name));case sa.BAD_NETWORK_CONNECTION:return l.a.createElement("span",null,t("calls_notification_bad_network_connection"));case sa.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[l.a.createElement(Nc,{key:"icon"}),l.a.createElement("span",{key:"text"},t("calls_notification_bad_network_connection_disable_camera"))];case sa.ADMIN_MUTE:return l.a.createElement("span",{key:"text"},t("calls_notification_admin_mute"));case sa.ADMIN_MUTE_PERMANENT:return l.a.createElement("span",{key:"text"},t("calls_notification_admin_permanent_mute"));case sa.ADMIN_ROLE_GRANTED:return l.a.createElement("span",{key:"text"},t("calls_notification_admin_role_granted"));case sa.USER_GRANTED_WITH_ADMIN_ROLE:i=e.participants[e.notification.data];var a=t("calls_notification_user_granted_with_admin_role").replace("{name}",i.shortName||i.name);return l.a.createElement("span",{key:"text"},a);case sa.PINNED_BY_ADMIN:return l.a.createElement("span",{key:"text"},t("calls_notification_admin_pinned_self"));case sa.USER_PINNED_BY_ADMIN:i=e.participants[e.notification.data],a=t("calls_notification_admin_pinned_user").replace("{name}",i.shortName||i.name);return l.a.createElement("span",{key:"text"},a);default:return null}}(e,r,i)}),[e.notification]),o=Object(u.useRef)(0);return Object(u.useEffect)((function(){return o.current&&window.clearTimeout(o.current),e.notification&&0!==e.notification.timer&&(o.current=window.setTimeout((function(){t({type:"call_notification",notification:null}),o.current=0}),e.notification.timer||5e3)),function(){o.current&&window.clearTimeout(o.current)}}),[e.notification]),e.notification?l.a.createElement(Rc,null,a):null};var Lc=function(){return(Lc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Mc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},jc=function(e){var t=e.children,n=e.className,r=Mc(e,["children","className"]),i=Object(p.a)("ActivityIndicator",n);return l.a.createElement("span",Lc({},r,{className:i}),t)};jc.propTypes={className:Ha.a.string,children:Ha.a.node};var xc=jc,Bc=function(e){var t=e.participant,n=l.a.useContext(To).getLang,r=t.status,i=t.wasConnected;switch(r){case oa.WAITING:return i?l.a.createElement(xc,null,n("calls_status_waiting")):l.a.createElement(Rs,{isInverted:!0});case oa.CONNECTING:case oa.RECONNECT:return l.a.createElement(xc,null,n("calls_status_connecting"));case oa.ERROR:return n("calls_error");case oa.HANGUP:return l.a.createElement(xc,null,n("calls_status_hangup"));case oa.PERMISSIONS:return n("calls_status_no_permissions");case oa.CONNECTED:default:return null}},Uc=function(e){var t=e.duration;return l.a.createElement("div",{className:"CallTimer","aria-label":t,"data-duration":t})},Vc=function(){var e=Object(h.e)((function(e){return e})),t=l.a.useContext(To).getLang,n=e.peer,r=Qa(n)?e.callData.conversation:e.participants[n],i=l.a.useState(),a=i[0],o=i[1],s=l.a.useState(""),c=s[0],u=s[1];return(null==r?void 0:r.status)!==a&&(u(Gc(e,t)),o(null==r?void 0:r.status)),l.a.useEffect((function(){u(Gc(e,t));var n=setInterval((function(){return u(Gc(e,t))}),1e3);return function(){return clearInterval(n)}}),[e]),l.a.createElement(l.a.Fragment,null,c)};function Gc(e,t){if(!e)return"";var n=e.peer;return Qa(n)?Kc(e,!1)||zc(t):Hc(e,t)||Wc(e,n)||Kc(e,!0)||zc(t)}function Hc(e,t){if(e.hangupType)switch(e.hangupType){case ma:return t("calls_busy");case va:return t("calls_callee_is_offline");case wa:return t("calls_rejected_status");case ga:case Sa:case Ea:case Oa:return null;case _a:case Aa:case ya:case ba:case Ca:case Ta:case Ia:case Pa:return t("calls_error")}return null}function Wc(e,t){var n=e.participants[t];return n&&n.status!==oa.CONNECTED?l.a.createElement(Bc,{participant:n}):null}function zc(e){return l.a.createElement(xc,null,e("calls_status_waiting"))}function Kc(e,t){var n=t?e.callData.localTimeStamp:e.callData.ts;return n?l.a.createElement(Uc,{duration:ts(n)}):null}var Qc=function(){return(Qc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},qc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Jc=function(e){var t=qc(e,[]);return l.a.createElement("svg",Qc({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},t),l.a.createElement("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"}))},Yc=function(){return(Yc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},$c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Zc=function(e){var t=$c(e,[]);return l.a.createElement("svg",Yc({width:"16",height:"10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C4.546 0 1.596 2.073.4 5c1.196 2.927 4.146 5 7.6 5 3.455 0 6.405-2.073 7.6-5-1.195-2.927-4.145-5-7.6-5zm3.5 5a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zM8 7a2 2 0 100-4 2 2 0 000 4z",fill:"#F5F5F5"}))},Xc=n("yuXj"),eu=function(){return(eu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},nu=function(e){var t=tu(e,[]);return l.a.createElement("svg",eu({xmlns:"http://www.w3.org/2000/svg",width:"8",height:"4",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},t),l.a.createElement("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"}))},ru=function(e){var t=e.canHoverStatus,n=void 0!==t&&t,r=e.translationHost,i=e.translationTimer,a=e.viewersCount,o=void 0===a?0:a,s=e.isLiveIndicatorOff,c=void 0!==s&&s,d=e.actions,h=void 0===d?[]:d,f=e.showTranslationStat,m=void 0!==f&&f,v=Object(p.a)("TranslationStatus__translation",{TranslationStatus__translationActive:n}),_=Object(p.a)("TranslationStatus__translationIndicator",{"TranslationStatus__translationIndicator--disabled":c}),g=Object(u.useContext)(To).getLang,A=(null==h?void 0:h.length)>0,y=l.a.createElement("div",{className:v,key:"translation"},l.a.createElement(Jc,{className:_}),m&&l.a.createElement(l.a.Fragment,null,!!i&&l.a.createElement("div",{className:"TranslationStatus__translationTimer"},i),!c&&l.a.createElement("div",{className:"TranslationStatus__translationViewersCount"},l.a.createElement(Zc,null),l.a.createElement("div",{className:"TranslationStatus__translationViewersCountNumber"},o)),A&&l.a.createElement("div",{className:"TranslationStatus__translationDropdown"},l.a.createElement(nu,null))),!m&&l.a.createElement("div",{className:"TranslationStatus__translationInfo"},r?g("calls_translation_host_info").replace("{name}",r):g("calls_translation_host_info_unknown")));return A&&(y=l.a.createElement(Xc.a,{position:"b",align:"center",horizontalPosition:"right",trigger:"hover",marginLeft:-10,marginTop:-10,data:h,className:"TranslationStatus_dropdown"},y)),l.a.createElement("div",{className:"TranslationStatus"},y)},iu=function(){return(iu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},au=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ou=function(e){var t=au(e,[]);return l.a.createElement("svg",iu({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M9.978 3.423a1.792 1.792 0 00-1.645 1.785v1.765l-.1.021a8.254 8.254 0 00-6.44 8.917.75.75 0 001.343.379l.175-.22a7.577 7.577 0 015.022-2.721v2.08a1.792 1.792 0 002.897 1.41l6.52-5.11a1.792 1.792 0 000-2.82l-6.52-5.11a1.791 1.791 0 00-1.105-.382l-.147.006zm.147 1.494c.065 0 .129.021.18.062l6.52 5.11a.292.292 0 010 .459l-6.52 5.11a.292.292 0 01-.472-.23v-2.873a.75.75 0 00-.767-.75l-.215.005-.305.016a9.065 9.065 0 00-5.162 2.056l-.037.032.004-.027a6.752 6.752 0 015.823-5.533.75.75 0 00.659-.744V5.208c0-.16.13-.291.292-.291z",fill:"#99A2AD"}))},su=function(){return(su=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},cu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},uu=function(e){var t=cu(e,[]);return l.a.createElement("svg",su({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.72 4.72a.75.75 0 011.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z",fill:"#99A2AD"}))};var lu,du,pu=n("Db7M");!function(e){e.FIRST_NAME_NOM="first_name_nom",e.FIRST_NAME_GEN="first_name_gen",e.FIRST_NAME_DAT="first_name_dat",e.FIRST_NAME_ACC="first_name_acc",e.FIRST_NAME_INS="first_name_ins",e.FIRST_NAME_ABL="first_name_abl",e.LAST_NAME_NOM="last_name_nom",e.LAST_NAME_GEN="last_name_gen",e.LAST_NAME_DAT="last_name_dat",e.LAST_NAME_ACC="last_name_acc",e.LAST_NAME_INS="last_name_ins",e.LAST_NAME_ABL="last_name_abl",e.PHOTO_ID="photo_id",e.VERIFIED="verified",e.SEX="sex",e.BDATE="bdate",e.CITY="city",e.COUNTRY="country",e.HOME_TOWN="home_town",e.HAS_PHOTO="has_photo",e.PHOTO_50="photo_50",e.PHOTO_100="photo_100",e.PHOTO_200_ORIG="photo_200_orig",e.PHOTO_200="photo_200",e.PHOTO_400="photo_400",e.PHOTO_400_ORIG="photo_400_orig",e.PHOTO_MAX="photo_max",e.PHOTO_MAX_ORIG="photo_max_orig",e.PHOTO_MAX_SIZE="photo_max_size",e.ONLINE="online",e.LISTS="lists",e.DOMAIN="domain",e.HAS_MOBILE="has_mobile",e.CONTACTS="contacts",e.SITE="site",e.EDUCATION="education",e.UNIVERSITIES="universities",e.SCHOOLS="schools",e.STATUS="status",e.LAST_SEEN="last_seen",e.FOLLOWERS_COUNT="followers_count",e.COUNTERS="counters",e.COMMON_COUNT="common_count",e.OCCUPATION="occupation",e.NICKNAME="nickname",e.RELATIVES="relatives",e.RELATION="relation",e.PERSONAL="personal",e.CONNECTIONS="connections",e.EXPORTS="exports",e.WALL_COMMENTS="wall_comments",e.ACTIVITIES="activities",e.INTERESTS="interests",e.MUSIC="music",e.MOVIES="movies",e.TV="tv",e.BOOKS="books",e.GAMES="games",e.ABOUT="about",e.QUOTES="quotes",e.CAN_POST="can_post",e.CAN_SEE_ALL_POSTS="can_see_all_posts",e.CAN_SEE_AUDIO="can_see_audio",e.CAN_WRITE_PRIVATE_MESSAGE="can_write_private_message",e.CAN_SEND_FRIEND_REQUEST="can_send_friend_request",e.IS_FAVORITE="is_favorite",e.IS_HIDDEN_FROM_FEED="is_hidden_from_feed",e.TIMEZONE="timezone",e.SCREEN_NAME="screen_name",e.MAIDEN_NAME="maiden_name",e.CROP_PHOTO="crop_photo",e.IS_FRIEND="is_friend",e.FRIEND_STATUS="friend_status",e.CAREER="career",e.MILITARY="military",e.BLACKLISTED="blacklisted",e.BLACKLISTED_BY_ME="blacklisted_by_me",e.CAN_SUBSCRIBE_POSTS="can_subscribe_posts",e.DESCRIPTIONS="descriptions",e.TRENDING="trending",e.MUTUAL="mutual",e.FRIENDSHIP_WEEKS="friendship_weeks",e.CAN_INVITE_TO_CHATS="can_invite_to_chats",e.STORIES_ARCHIVE_COUNT="stories_archive_count",e.VIDEO_LIVE_LEVEL="video_live_level",e.VIDEO_LIVE_COUNT="video_live_count",e.CLIPS_COUNT="clips_count",e.SERVICE_DESCRIPTION="service_description",e.IS_DEAD="is_dead"}(lu||(lu={})),function(e){e.ABOUT="about",e.ACTION_BUTTON="action_button",e.ACTIVITIES="activities",e.ACTIVITY="activity",e.ADDRESSES="addresses",e.ADMIN_LEVEL="admin_level",e.AGE_LIMITS="age_limits",e.AUTHOR_ID="author_id",e.BAN_INFO="ban_info",e.BDATE="bdate",e.BLACKLISTED="blacklisted",e.BLACKLISTED_BY_ME="blacklisted_by_me",e.BOOKS="books",e.CAN_CREATE_TOPIC="can_create_topic",e.CAN_MESSAGE="can_message",e.IS_WIDGET_MESSAGES_ENABLED="is_widget_messages_enabled",e.CAN_POST="can_post",e.CAN_SEE_ALL_POSTS="can_see_all_posts",e.CAN_SEE_AUDIO="can_see_audio",e.CAN_SEND_FRIEND_REQUEST="can_send_friend_request",e.CAN_UPLOAD_VIDEO="can_upload_video",e.CAN_WRITE_PRIVATE_MESSAGE="can_write_private_message",e.CAREER="career",e.CITY="city",e.COMMON_COUNT="common_count",e.CONNECTIONS="connections",e.CONTACTS="contacts",e.COUNTERS="counters",e.COUNTRY="country",e.COVER="cover",e.CROP_PHOTO="crop_photo",e.DEACTIVATED="deactivated",e.DESCRIPTION="description",e.DOMAIN="domain",e.EDUCATION="education",e.EXPORTS="exports",e.FINISH_DATE="finish_date",e.FIXED_POST="fixed_post",e.FOLLOWERS_COUNT="followers_count",e.FRIEND_STATUS="friend_status",e.GAMES="games",e.HAS_MARKET_APP="has_market_app",e.HAS_MOBILE="has_mobile",e.HAS_PHOTO="has_photo",e.HOME_TOWN="home_town",e.ID="id",e.INTERESTS="interests",e.IS_ADMIN="is_admin",e.IS_CLOSED="is_closed",e.IS_FAVORITE="is_favorite",e.IS_FRIEND="is_friend",e.IS_HIDDEN_FROM_FEED="is_hidden_from_feed",e.IS_MEMBER="is_member",e.IS_MESSAGES_BLOCKED="is_messages_blocked",e.CAN_SEND_NOTIFY="can_send_notify",e.IS_SUBSCRIBED="is_subscribed",e.LAST_SEEN="last_seen",e.LINKS="links",e.LISTS="lists",e.MAIDEN_NAME="maiden_name",e.MAIN_ALBUM_ID="main_album_id",e.MAIN_SECTION="main_section",e.MARKET="market",e.MEMBER_STATUS="member_status",e.MEMBERS_COUNT="members_count",e.MILITARY="military",e.MOVIES="movies",e.MUSIC="music",e.NAME="name",e.NICKNAME="nickname",e.OCCUPATION="occupation",e.ONLINE="online",e.ONLINE_STATUS="online_status",e.PERSONAL="personal",e.PHONE="phone",e.PHOTO_100="photo_100",e.PHOTO_200="photo_200",e.PHOTO_200_ORIG="photo_200_orig",e.PHOTO_400_ORIG="photo_400_orig",e.PHOTO_50="photo_50",e.PHOTO_ID="photo_id",e.PHOTO_MAX="photo_max",e.PHOTO_MAX_ORIG="photo_max_orig",e.QUOTES="quotes",e.RELATION="relation",e.RELATIVES="relatives",e.SCHOOLS="schools",e.SCREEN_NAME="screen_name",e.SEX="sex",e.SITE="site",e.START_DATE="start_date",e.STATUS="status",e.TIMEZONE="timezone",e.TRENDING="trending",e.TV="tv",e.TYPE="type",e.UNIVERSITIES="universities",e.VERIFIED="verified",e.WALL_COMMENTS="wall_comments",e.WIKI_PAGE="wiki_page",e.VK_ADMIN_STATUS="vk_admin_status"}(du||(du={}));var hu=n("7pkf"),fu=[lu.PHOTO_400,lu.PHOTO_400_ORIG,lu.SEX,lu.SCREEN_NAME].join(","),mu=["photo_400",du.PHOTO_400_ORIG,du.SEX,du.SCREEN_NAME].join(","),vu=[du.NAME,du.PHOTO_100,"can_upload_video"].join(","),_u=0,gu=[],Au=[],yu=os((function(e,t){return void 0===t&&(t=50),gu.push(e),new Promise((function(e){Au.push(e),_u||(_u=window.setTimeout((function(){var e;(e=gu,Object(hu.a)()(pu.a)("messages.getConversationsById",{peer_ids:e,extended:1,fields:mu})).then((function(e){Au.forEach((function(t){t(e)})),Au=[]})),gu=[],_u=0}),t))}))})),Eu=function(e){return Vi(zt.DEBUG,{type:"request",method:"messages.getCallToken",data:{isDev:e}}),Object(hu.a)()(pu.a)("messages.getCallToken",{env:e?"development":"production"}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getCallToken",data:e}),e}))},Su=(os(Eu),function(e,t){return void 0===t&&(t=!1),Vi(zt.DEBUG,{type:"request",method:"messages.getCallPreview",data:{link:e,fields:mu,device_id:"anyId"}}),Object(hu.a)(!t)(pu.a)("messages.getCallPreview",{link:e,fields:mu,device_id:"anyId"}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getCallPreview",data:e}),e}))}),bu=function(e){return Object(hu.a)()(pu.a)("users.get",e)},Cu=function(e){return Object(hu.a)()(pu.a)("messages.callReceived",{call_id:e})},wu=function(){return ji()};function Ou(){var e=Object(u.useContext)(To),t=e.getLang,n=e.langNumeric,r=Object(h.e)((function(e){return e})),i=Object(h.d)(),a=Object(u.useState)(null),o=a[0],s=a[1],c=Object(u.useState)(!1),d=c[0],p=c[1],f=Object(u.useState)(""),m=f[0],v=f[1],_=Object(u.useState)(0),g=_[0],A=_[1],y=Object(u.useState)([]),E=y[0],S=y[1],b=Object(u.useState)(Du(r.translation.startTime)),C=b[0],w=b[1],O=Object(u.useState)(Ru(C)),T=O[0],I=O[1],P=Object(u.useState)(ku(T,d)),R=P[0],D=P[1],k=Object(u.useState)(!1),N=k[0],F=k[1];return Object(u.useEffect)((function(){var e=function(e){var t,n,r,i,a=e.participants[e.me];return!(!co(a)&&!uo(a))||!!(null===(n=null===(t=e.translation)||void 0===t?void 0:t.host)||void 0===n?void 0:n.id)&&+(null===(i=null===(r=e.translation)||void 0===r?void 0:r.host)||void 0===i?void 0:i.id)===e.me}(r);p(e)}),[r.translation,r.participants[r.me]]),Object(u.useEffect)((function(){var e,t;if(null===(e=r.translation.host)||void 0===e?void 0:e.id){var n=r.participants[null===(t=r.translation.host)||void 0===t?void 0:t.id],i=(null==n?void 0:n.shortName)||(null==n?void 0:n.name);i!==o&&s(i)}else o&&s(null)}),[r.translation,r.participants]),Object(u.useEffect)((function(){var e=[];d&&(e.push(Tu(l.a.createElement(ou,null),t("calls_info_translation_share_menu_item"),(function(){return i({type:da,data:"translation_stop_share"})}))),e.push(Tu(l.a.createElement(uu,null),t("calls_translation_stop_menu_item"),(function(){return i({type:da,data:"translation_stop"})})))),S(e)}),[d]),Object(u.useEffect)((function(){var e=Ru(C);e&&C>-4&&d&&!N&&(F(!0),i({type:da,data:"translation_start_countdown"})),I(e)}),[C]),Object(u.useEffect)((function(){var e=ku(T,d);D(e)}),[d,T]),Object(u.useEffect)((function(){var e;if(R){var t=Du(r.translation.startTime);w(t),e=setInterval((function(){return w(Du(r.translation.startTime))}),1e3)}return function(){return clearInterval(e)}}),[r.translation.startTime,R]),Object(u.useEffect)((function(){var e="";if(R)if(T){var r=Math.abs(C);if(r>86400){var i=Math.floor(r/86400);e=n(i,"calls_translation_upcoming_time_more_day",t("calls_translation_upcoming_time_more_day",i)).replace("%s",i)}else e=Iu("-"+Pu(r))}else e=Iu(Pu(C));v(e)}),[C,R,T]),Object(u.useEffect)((function(){var e,t=r.translation,n=t.ownerId,i=t.videoId;if(R&&n&&i&&!T){var a=function(){(function(e){return Object(hu.a)()(pu.a)("video.liveGetSpectators",{owner_id:e.owner_id,video_id:e.video_id})})({owner_id:n,video_id:i}).then((function(e){var t;A(null===(t=e.spectators)||void 0===t?void 0:t.count)}))};a(),e=setInterval(a,15e3)}return function(){return clearInterval(e)}}),[R,T,r.translation.ownerId,r.translation.videoId]),l.a.createElement(ru,{showTranslationStat:R,canHoverStatus:d,translationHost:o,translationTimer:m,viewersCount:g,isLiveIndicatorOff:T,actions:E})}function Tu(e,t,n){return{text:l.a.createElement("div",{className:"TranslationStatus__dropdownItem"},e,l.a.createElement("div",{className:"TranslationStatus__dropdownItemText"},t)),onClick:n}}function Iu(e){return l.a.createElement(Uc,{duration:e})}function Pu(e){return 0===e?"00:00":e<=599?"0"+Object(p.d)(e):Object(p.d)(e)}function Ru(e){return e<0}function Du(e){var t=Date.now();return Math.floor((t-e)/1e3)}function ku(e,t){return e||t}var Nu=function(){return(Nu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Fu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Lu=function(e){var t=Fu(e,[]);return l.a.createElement("svg",Nu({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},t),l.a.createElement("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"}))},Mu=function(e){var t=e.isGroupCall,n=e.handsCount,r=void 0===n?0:n,i=e.callStatus,a=e.translationStatus,o=e.participantCount,s=e.speakers,c=Object(u.useContext)(To).getLang,d=Object(p.a)("CallInfo",{"CallInfo--full":t}),h=Object(p.a)("CallInfo__hands",{"CallInfo__hands--visible":r>0});return l.a.createElement("div",{className:d},l.a.createElement("div",{className:"CallInfo__status"},l.a.createElement("div",{className:"CallInfo__statusMain"},i,t&&l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"CallInfo__dot"}," · "),c("calls_participants_plural",o))),l.a.createElement("div",{className:h},l.a.createElement(Lu,null)," ",r),!!a&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"CallInfo__pipe",key:"pipe"}),a)),t&&s&&l.a.createElement("div",{className:"CallInfo__speakers"},s))};function ju(e){var t=e.onHandCountChanged,n=Object(h.e)((function(e){return e})),r=Object(h.d)(),i=Qa(n.peer),a=Object(u.useContext)(To),o=a.getLang,s=a.langNumeric,c=Object(u.useState)(0),d=c[0],p=c[1],f=Object(u.useState)(null),m=f[0],v=f[1],_=Object(u.useState)(0),g=_[0],A=_[1],y=Object(u.useState)(""),E=y[0],S=y[1];return Object(u.useEffect)((function(){n.callData.localTimeStamp||Qa(n.peer)||Hc(n,o)||Wc(n,n.peer)||r({type:"local_time_start",data:Date.now()})}),[n]),Object(u.useEffect)((function(){var e=function(e){var t,n,r=e.participants,i=0;for(var a in r)r.hasOwnProperty(a)&&ao(e,r[a])&&(null===(n=null===(t=r[a])||void 0===t?void 0:t.statusData)||void 0===n?void 0:n.hand)&&i++;return i}(n);e!==g&&(A(e),t&&t(e))}),[n.participants]),Object(u.useEffect)((function(){p(ro(n))}),[n]),Object(u.useEffect)((function(){if(i){var e=n.speakersInHeader.reduce((function(e,t){return n.participants[t]&&(n.participants[t].shortName||n.participants[t].name)&&e.push(n.participants[t]),e}),[]);v(e.length>0?o("calls_participants_speak",e.length).replace("{names}",cs(e,e.slice(0,3),(function(e){return e.shortName||e.name}),o,s)):null)}}),[n.participants,n.speakersInHeader]),Object(u.useEffect)((function(){var e="";n.translation.isOn&&(e=l.a.createElement(Ou,null)),S(e)}),[n.translation.isOn]),l.a.createElement(Mu,{isGroupCall:i,handsCount:g,callStatus:l.a.createElement(Vc,null),translationStatus:E,participantCount:d,speakers:m})}var xu=function(){return(xu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Bu={acc:{},timer:0,tasks:0};function Uu(e,t,n,r){Hu(t,n,(function(t){e({type:"update_participants_batch",data:t})}),r,Bu)}var Vu={acc:{},timer:0,tasks:0};function Gu(e,t,n,r){Hu(t,n,(function(t){e({type:"set_visible_participants",data:t})}),r,Vu)}function Hu(e,t,n,r,i){var a;void 0===r&&(r=30),i.timer?(i.acc[e]=i.acc[e]&&"object"==typeof i.acc[e]?Object.assign(i.acc[e],t):t,i.tasks++):function e(t){n(t),i.timer=window.setTimeout((function(){i.tasks>0&&(e(i.acc),i.acc={},i.tasks=0),clearTimeout(i.timer),i.timer=0}),r)}(((a={})[e]=t,a))}var Wu,zu=n("euvX"),Ku=n("5PZO"),Qu=function(e){var t=e.title,n=e.onCloseModal,r=e.hint,i=e.actionButtons,a=e.isWithBackButton,o=e.onBackClick,s=e.children,c=l.a.useContext(To).getLang;return l.a.createElement(Po.default,{className:"CallManagementModal",disableBodyScroll:!1,onClose:n},l.a.createElement(zu.a,{title:t,onClose:n,appearance:"blue",backText:a?c("calls_back"):void 0,onBack:o}),l.a.createElement("div",{className:"CallManagementModal__content"},l.a.Children.toArray(s).map((function(e,t){return l.a.createElement("div",{className:"CallManagementModal__section",key:t},e)}))),(i||r)&&l.a.createElement(Ku.a,{actionButtons:i||[],hint:r}))},qu=n("p9ed"),Ju=n("5R8M");!function(e){e.BLUE="blue",e.GREEN="green",e.GRAY="gray",e.RED="red"}(Wu||(Wu={}));var Yu=function(e){var t=e.icon,n=e.color;return l.a.createElement("div",{className:Object(p.a)("ListIcon","ListIcon--"+n)},t)},$u=function(){return($u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Zu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Xu=function(e){var t=Zu(e,[]);return l.a.createElement("svg",$u({width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{"aria-hidden":"true"}),l.a.createElement("path",{d:"M6.022 9.184a.837.837 0 01-1.187-.001 3.861 3.861 0 010-5.419l2.618-2.643a3.772 3.772 0 015.366 0c1.261 1.274 1.557 3.033.67 4.508-.296.49-.947.47-1.325.09-.275-.276-.254-.707-.077-1.019.465-.817.24-1.683-.456-2.379a2.094 2.094 0 00-2.997 0L6.023 4.956a2.143 2.143 0 00-.001 3.025.83.83 0 010 1.202zm1.95-3.166c.833.835.832 2.19-.001 3.025L5.36 11.68a2.094 2.094 0 01-2.998 0c-.695-.696-.91-1.555-.446-2.371.178-.313.199-.744-.076-1.019-.379-.38-1.03-.4-1.325.09-.888 1.474-.602 3.226.659 4.5a3.772 3.772 0 005.367 0l2.617-2.643a3.861 3.861 0 000-5.419.837.837 0 00-1.187 0 .83.83 0 000 1.2z"}))},el=function(e){var t=e.text,n=e.onCopyDone,r=e.children,i=Object(u.useRef)(null),a=Object(u.useCallback)((function(e){i.current&&(i.current.focus(),i.current.select(),document.execCommand("copy"),e.preventDefault(),e.stopPropagation(),n&&n())}),[n]);return l.a.createElement("div",{className:"CopyText",onClick:a},l.a.createElement("input",{type:"text",readOnly:!0,value:t||"",ref:i,className:"CopyText__input"}),r)},tl=n("x9XA"),nl=n("zgoX"),rl=function(e){var t=e.value,n=e.copyText,r=e.doneText,i=e.className,a=Object(u.useState)(!1),o=a[0],s=a[1],c=Object(u.useCallback)((function(){s(!0)}),[]),d=Object(u.useCallback)((function(){s(!1)}),[]),h=Object(p.a)("ListCopyControl",i,{"ListCopyControl--copied":o});return l.a.createElement("div",{className:h},l.a.createElement(el,{text:t,onCopyDone:c},l.a.createElement(tl.a,{className:"ListCopyControl__copyButton"},n)),l.a.createElement(nl.default,{shown:o,callback:d,className:"ListCopyControl__copyDone"},r))},il=function(e){var t=e.isLinkBlockShown,n=e.linkBlockTitle,r=e.onLinkBlockClick,i=e.callUrlLink,a=l.a.useContext(To).getLang;return l.a.createElement(qu.a,null,t&&l.a.createElement(Ju.default,{onClick:r,chevron:!0,icon:l.a.createElement(Yu,{icon:l.a.createElement(Xu,null),color:Wu.GREEN})},n,i&&l.a.createElement(rl,{value:i,copyText:a("calls_menu_link_copy"),doneText:a("calls_menu_link_copied")})))},al=n("h7Kf"),ol=n("bhWw"),sl=n("IrTF"),cl=function(e){var t=e.link,n=void 0===t?"":t,r=e.isLinkLoading,i=e.isCopied,a=e.hideCopiedText,o=l.a.useContext(To).getLang;return l.a.createElement("div",{className:"CallLink"},l.a.createElement("p",{className:"CallLink__info"},o("calls_management_link_info_desc")),r?l.a.createElement(ol.a,{className:"CallLink__input"},l.a.createElement(sl.a,null)):l.a.createElement("div",{className:"CallLink__input"},l.a.createElement(al.default,{readOnly:"readonly",value:n}),l.a.createElement("div",null,l.a.createElement("div",{className:"CallLink__hint"},o("calls_management_add_warning"),l.a.createElement(nl.default,{className:"CallLink__copied",shown:i,callback:a},o("calls_link_copied"))))))},ul=n("CGHU"),ll=function(e){var t=e.headingElement,n=void 0===t?"h3":t,r=e.extra,i=e.className,a=e.children,o=n;return l.a.createElement("header",{className:Object(p.a)("ListHeader",i)},l.a.createElement(o,{className:"ListHeader__text"},a),l.a.createElement("span",{className:"ListHeader__extra"},r))},dl=function(e){var t=e.searchQuery,n=e.onSearchChange,r=e.length,i=e.children,a=l.a.useContext(To).getLang;return l.a.createElement("div",{className:"CallParticipantList"},l.a.createElement(ul.a,{value:t,placeholder:a("calls_search_participants_placeholder"),onChange:n,onInput:n,onPaste:n,className:"CallParticipantList__input"}),l.a.createElement(ll,{extra:r||""},a("calls_participant_list_header")),l.a.createElement(qu.a,{border:!1,className:"CallParticipantList__list"},i))},pl=n("Hri0"),hl=n("b2wb"),fl=function(e){var t=e.position,n=e.align,r=e.trigger,i=e.marginTop,a=e.marginLeft,o=e.actions;return o.length>0?l.a.createElement(Xc.a,{position:t,align:n,trigger:r,marginTop:i,marginLeft:a,className:"ParticipantMenu__dropdown",data:o},l.a.createElement(hl.a,null)):null},ml=function(e){var t=e.SDK,n=e.participant,r=e.navigateToConvo,i=e.navigateToProfile,a=Object(h.e)((function(e){return e})),o=Object(h.d)(),s=l.a.useContext(To).getLang,c=Xa(a,t,o,n,!1,s,r,i,!0);return c.length>0?l.a.createElement(fl,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:c}):null},vl=function(){return(vl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},gl=function(e){var t=_l(e,[]);return l.a.createElement("svg",vl({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},t),l.a.createElement("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"}))},Al=function(){return(Al=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},yl=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},El=function(e){var t=yl(e,[]);return l.a.createElement("svg",Al({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"}))},Sl=function(){var e=Object(vc.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return l.a.createElement("div",{className:e})},bl=function(e){var t=e.showSpeaking,n=e.showAudioDisabled,r=e.showRaisedHand,i=e.showConnecting,a=e.showRaisedHandTooltip,o=e.onRaisedHandClick,s=Object(u.useContext)(To).getLang,c=l.a.createElement("span",{className:Object(p.a)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==o}),onClick:null!=o?o:void 0},l.a.createElement(El,{className:"ParticipantIndicators__hand"}));return l.a.createElement("span",{className:"ParticipantIndicators"},t&&l.a.createElement("span",{className:"ParticipantIndicators__item"},l.a.createElement(Sl,null)),n&&l.a.createElement("span",{className:"ParticipantIndicators__item"},l.a.createElement(gl,{className:"ParticipantIndicators__muted"})),r?a?l.a.createElement(Oo.default,{className:"ParticipantIndicators__tooltip",text:s("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},c):c:null,i&&l.a.createElement("span",{className:"ParticipantIndicators__item"},l.a.createElement(Rs,null)))},Cl=n("d8ub"),wl=function(e){var t=e.SDK,n=e.onAddClick,r=e.navigateToProfile,i=e.navigateToConvo,a=Object(h.e)((function(e){return e})),o=l.a.useContext(To).getLang,s=function(e){return Object.values(e.participants).reduce((function(t,n){return(n.peerId===e.me||n.status)&&(t[0].push(n),n.name&&t[1].push(n)),t}),[[],[]])}(a),c=s[0],d=s[1],p=Object(u.useState)(""),f=p[0],m=p[1],v=Object(u.useCallback)((function(e){return e.name}),[]),_=Object(u.useCallback)((function(e){return e.peerId}),[]),g=Do(d,v,_),A=lo(a.participants[a.me]),y=f?g.search(f):c,E=Object(u.useCallback)((function(e){m(e.target.value)}),[]),S=!$a(a.me);return l.a.createElement(dl,{searchQuery:f,onSearchChange:E,length:y.length},!f&&S&&l.a.createElement(Ju.default,{selectable:!1,border:!1,key:"add"},l.a.createElement(Cl.a,{onClick:n},o("calls_add_participants"))),y.length>0&&y.map((function(e){var n,o,s,c=e.peerId!==a.me&&e.status===oa.WAITING,u=!c&&!(null===(n=e.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),d=!c&&!(null===(o=e.mediaSettings)||void 0===o?void 0:o.isVideoEnabled),p=!c&&!!(null===(s=e.statusData)||void 0===s?void 0:s.hand),h=!!a.speakers[e.peerId],f=c||u||p||h,m=e.peerId===a.me,v=!c&&(u||d)&&A&&!m;return l.a.createElement(Ju.default,{selectable:!1,border:!1,key:e.peerId,aside:l.a.createElement(l.a.Fragment,null,f&&l.a.createElement(bl,{showSpeaking:h,showRaisedHand:p,showAudioDisabled:u,showConnecting:c,showRaisedHandTooltip:v,onRaisedHandClick:v?function(){return function(e){var n=a.participants[e],r=Za(n);r&&t.unmuteRequest(r,[Wi.AUDIO,Wi.VIDEO]).catch(console.log)}(e.peerId)}:void 0,key:"indicators"}),l.a.createElement(ml,{SDK:t,participant:e,key:"menu",navigateToConvo:i,navigateToProfile:r}))},l.a.createElement(pl.a,{onLinkClick:r,photo:l.a.createElement(Eo,{id:e.peerId,photo:e.photo,alt:e.name||"",size:"xxxs",showCreatorBadge:uo(e),showAdminBadge:co(e)}),title:e.name,href:e.link,target:"_blank"}))})),f&&0===y.length&&l.a.createElement(hs.default,null,o("calls_participants_not_found")))};var Ol=n("BiHW"),Tl=n("F0+T"),Il=function(e){var t=e.tokens,n=e.onRemoveToken,r=e.value,i=e.onChange,a=e.onSelect,o=e.renderSuggest,s=e.data,c=l.a.useContext(To).getLang;return l.a.createElement(Tl.a,{className:"CallsMultiSelect",tokens:t,removeTokenPlaceholder:c("calls_remove_token"),onRemoveToken:n,placeholder:c("calls_search_participants_placeholder"),value:r,onChange:i,onSelect:a,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:function(){},notFoundText:c("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:o,data:s})};function Pl(e){var t=e.member,n=e.selected,r=e.disabled,i=Object(p.a)("ParticipantSuggest",{"ParticipantSuggest--selected":n,"ParticipantSuggest--disabled":r});return u.createElement("div",{className:i,"data-id":t.id},u.createElement(pl.a,{size:"34",title:t.name,photo:t.photo}))}Pl.defaultProps={selected:!1,disabled:!1};var Rl=n("NfnF"),Dl=function(){return(Dl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},kl=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Nl=function(e){var t=kl(e,[]);return l.a.createElement("svg",Dl({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"}))},Fl=function(e){var t=e.data,n=e.onClick,r=e.selected,i=e.disabled;if("type"in t)switch(t.type){case na.HEADER:return l.a.createElement(ll,{className:"CallsSearchResult CallsSearchResult--header",extra:t.count},t.text);case na.CALL_ALL_IN_CHAT:return l.a.createElement("div",{className:"CallsSearchResult CallsSearchResult--select"},l.a.createElement(Ol.a,{appearance:"secondary",wide:!0,onClick:n},l.a.createElement("span",{className:"CallsSearchResult__icon"},l.a.createElement(Nl,null)),t.text));case na.MEMBERS_MORE:case na.FRIENDS_MORE:return l.a.createElement(Rl.a,{onClick:n},t.text)}return l.a.createElement(Ju.default,{"data-id":t.peerId,onClick:n,selectable:!i},l.a.createElement(Pl,{member:t,selected:r,disabled:i}))},Ll=function(){return(Ll=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ml=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},jl=function(e){return e?xo(e.replace(/\t/g,"\n")):""},xl=function(e){var t=e.onChange,n=e.onClickCallAll,r=Object(h.e)((function(e){return e})),i=l.a.useContext(To).getLang,a=Object(u.useState)(""),o=a[0],s=a[1],c=Object(u.useState)({}),d=c[0],p=c[1],f=Object(u.useState)(!1),m=f[0],v=f[1],_=Object(u.useState)(!1),g=_[0],A=_[1],y=Object(u.useState)(function(e,t){var n=e.reduce((function(e,t){return e[t.id]=!0,e}),{});return t.filter((function(e){return!n[e.id]}))}(r.chatMembers,r.friends))[0],E=Object(u.useState)(function(e,t){return[].concat(t,e).reduce((function(e,t){return e[t.id]=t,e}),{})}(r.chatMembers,y))[0],S=(r.preselectedIds||[]).filter((function(e){return!$a(e)&&E[e]})),b=Object(u.useState)(S),C=b[0],w=b[1],O=Object(u.useCallback)((function(e){return e.name}),[]),T=Object(u.useCallback)((function(e){return e.peerId}),[]),I=Do(Ml(Ml([],r.chatMembers),y),O,T),P=Object(u.useCallback)((function(e){return e?I.search(e):function(e,t,n,r,i,a){var o={type:na.MEMBERS_MORE,text:a("calls_show_all_members")},s={type:na.FRIENDS_MORE,text:a("calls_show_all_friends")},c={type:na.HEADER,text:a("calls_chat_members"),count:e.length},u={type:na.HEADER,text:a("calls_friends")},l={type:na.CALL_ALL_IN_CHAT,text:a("calls_call_all")},d=[];if(e.length>0)if(d.push(c),e.length<=i&&d.push(l),n||e.length<=5)d.push.apply(d,e);else{for(var p=0;p<5;p++)d.push(e[p]);d.push(o)}if(d.push(u),r||t.length<=10)d.push.apply(d,t);else{for(p=0;p<10;p++)d.push(t[p]);d.push(s)}return d}(r.chatMembers,y,m,g,r.participantLimit,i)}),[r,m,g]),R=Object(u.useState)(P(o)),D=R[0],k=R[1],N=function(e){w(e),t(e)},F=Object(u.useCallback)((function(e){return N(Ml(Ml([],C),[+e]))}),[C]),L=Object(u.useCallback)((function(e){return N(C.filter((function(t){return t!==+e})))}),[C]),M=no(r).map((function(e){return{id:e.peerId.toString(),text:jl(e.name),locked:!0}})).concat(C.map((function(e){return{text:jl(E[e].name),id:e.toString(),locked:!1}})));Object(u.useEffect)((function(){p(C.reduce((function(e,t){return e[t]=!0,e}),{}))}),[]),Object(u.useEffect)((function(){k(P(o))}),[C,m,g]);var j=Object(u.useCallback)((function(e){s(e.target.value),k(P(e.target.value))}),[]),x=Object(u.useCallback)((function(e){var t;return L(e),p(Ll(Ll({},d),((t={})[e]=!1,t))),Promise.resolve()}),[d]),B=Object(u.useCallback)((function(e){var t,n;return Bl(e,r,d)?(L(e),p(Ll(Ll({},d),((t={})[e]=!1,t)))):Ul(e,r,M,d)||(F(e),p(Ll(Ll({},d),((n={})[e]=!0,n))),s(""),k(P(""))),Promise.resolve()}),[C,r,d]),U=Object(u.useCallback)((function(){var e=no(r).reduce((function(e,t){return e[t.peerId]=!0,e}),{}),t=r.chatMembers.reduce((function(t,n){var i=n.peerId;return e[i]||Ul(i||0,r,M,d)||t.push(i),t}),[]);n(t)}),[r,C,d]),V=Object(u.useCallback)((function(e,t){if(!("type"in e))return t;switch(e.type){case na.CALL_ALL_IN_CHAT:return function(){return U()};case na.MEMBERS_MORE:return function(){return v(!0)};case na.FRIENDS_MORE:return function(){return A(!0)};default:return function(){}}}),[U]);return l.a.createElement(Il,{tokens:M,onRemoveToken:x,value:o,onChange:j,onSelect:B,renderSuggest:function(e,t){return l.a.createElement(Fl,{data:e,onClick:V(e,t),selected:Bl("peerId"in e&&e.peerId||0,r,d),disabled:Ul("peerId"in e&&e.peerId||0,r,M,d),key:"peerId"in e&&e.peerId||"text"in e&&e.text||void 0})},data:D})};function Bl(e,t,n){return n&&n[e]||eo(t,e)}function Ul(e,t,n,r){return!!eo(t,e)||!Bl(e,t,r)&&(n.length>=t.participantLimit||!za(e))}var Vl=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},Gl=function(e){var t=e.SDK,n=e.isWithBackButton,r=e.onBackClick,i=Object(h.e)((function(e){return e})),a=Object(h.d)(),o=l.a.useContext(To).getLang,s=Object(u.useState)(i.preselectedIds||[]),c=s[0],d=s[1],p=Object(u.useState)(ro(i))[0]+c.length,f=function(){a({type:"group_call_setup",open:!1,preselectedIds:null}),a({type:"management",isOpen:!1})},m=0===c.length,v=function(e){f(),a({type:"manual_add_participants",participants:e});var n=e.map((function(e){return new Promise((function(n){t.addParticipant(e).then(n).catch((function(t){"auth.banned"===t.message?n(e):n(null)}))}))}));Promise.all(n).then((function(e){if((e=e.filter((function(e){return void 0!==e}))).length){var t=function(e,t){var n=Vl(Vl([],e.friends),e.chatMembers),r=[];return n.filter((function(e){var n=e.id;return!(!t.includes(n)||r.includes(n))&&(r.push(n),!0)}))}(i,e);a({type:"unban_participants",data:{members:t}})}}));var r=Jo(function(e,t){var n=e.chatData||e.callData.conversation,r=t.reduce((function(t,n){return e.participants[n]||t.set(n,!0),t}),new Map);if(0===r.size)return[n,[]];var i=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,a=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,o=i.reduce((function(e,t){return r.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),s=o.smallerListData,c=o.smallerListMap;if(s.length===r.size)return[n,s];var u=a.filter((function(e){return!c.get(e.id)&&r.get(e.id)}));return[n,Vl(Vl([],s),u)]}(i,e)),o=r[0],s=r[1];a({type:"load_peer",conversation:o,members:s}),Ya.logEvent({call_event_type:Qi.a.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:i.callData.callId,peer_id:i.peer.toString(),is_group_call:Qa(i.peer),group_call_users_count:c.length})},_=Object(u.useCallback)((function(){v(c)}),[c]);return l.a.createElement(Qu,{title:o("calls_add_participants_to_call"),onCloseModal:f,actionButtons:l.a.createElement(Ol.a,{key:"add",disabled:m,onClick:_},o("calls_add")),hint:Hl(p,i.participantLimit,o),isWithBackButton:n,onBackClick:n?r:function(){}},l.a.createElement(xl,{onChange:d,onClickCallAll:function(e){v(e)}}))};function Hl(e,t,n){return e<2?n("calls_management_add_warning"):n("calls_selected").replace("{selected}",""+e).replace("{limit}",""+t)}function Wl(e){return new Promise((t,n)=>{var r=new Image;r.src=e,r.onload=t,r.onerror=n})}function zl(e){var t=[].concat(...e).map(e=>{var t=e.photo;return t?Wl(t):Promise.resolve()});return Promise.all(t).then(()=>e).catch(()=>e)}var Kl=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function Ql(e,t,n){if(us(t).friends.length>0)return Promise.resolve();if(e.getFriends){var r=e.getFriends();if(null!==r)return n({type:"set_friends",data:r}),Promise.resolve()}return(Vi(zt.DEBUG,{type:"request",method:"friends.get",data:{fields:fu,order:"hints"}}),Object(hu.a)()(pu.a)("friends.get",{fields:fu,order:"hints"}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"friends.get",data:e}),e}))).then((function(e){return e.items.map(Vo)})).then((function(e){n({type:"set_friends",data:e})}))}function ql(e,t,n,r){return function(e){return Vi(zt.DEBUG,{type:"request",method:"messages.getConversationMembers",data:{peerId:e}}),Object(hu.a)()(pu.a)("messages.getConversationMembers",{peer_id:e,fields:fu}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getConversationMembers",data:e}),e}))}(n).then((function(n){var i=n.profiles;i&&t({type:"set_chat_info",data:i.map(Vo).sort((function(t,n){var r=us(e).me;return t.peerId===r?-1:n.peerId===r?1:0})),conversation:r})}))}function Jl(e,t,n){return yu(n).then((function(e){var n=Yo(e),r=n[0],i=n[1],a=n[2];return ed(t,a),zl([r,i])})).then((function(e){var r=e[0],i=e[1];t({type:"load_peer",conversation:r,members:i,peerId:n})}))}function Yl(e,t,n){return n?function(e){return Object(hu.a)()(pu.a)("messages.getConversationsById",{peer_ids:[e],extended:1,fields:mu})}(n).then((function(e){var n=e.items[0];ed(t,n)})):Promise.resolve()}var $l={acc:[],timer:0,tasks:0,timeout:300};function Zl(e,t,n,r,i,a){var o=us(e).me,s=us(e).anonymSecret,c=o<0?o:void 0;return function(e,t,n,r,i){void 0===r&&(r=!1);for(var a=[],o=t;o.length;)o.length>100?(a.push(o.slice(0,100)),o=o.slice(100)):(a.push(o),o=[]);var s=os((function(t,i){var a=r?{call_id:e,peer_ids:i.join(","),fields:mu,device_id:"anyId",secret:t.secret,user_id:n}:{call_id:e,peer_ids:i.join(","),fields:mu};return Object(hu.a)(!r)(pu.a)("messages.getCallParticipants",a).then((function(e){return{count:e.count+t.count,secret:e.secret,profiles:(t.profiles||[]).concat(e.profiles||[]),anonyms:(t.anonyms||[]).concat(e.anonyms||[])}}))})),c=Promise.resolve({secret:i,count:0});return a.reduce((function(e,t){return e.then((function(e){return s(e,t)}))}),c)}(r,Kl(Kl([],i),[o]),c,o<0,s).then((function(e){var n=e.profiles,r=void 0===n?[]:n,i=e.anonyms,o=void 0===i?[]:i,s=e.secret;s&&t({type:"update_anon_token",secret:s});var c=Kl(Kl([],o),r).map(Vo),u=zl([{},c]);return a.awaitImages?u.then((function(){return[null,c]})):[null,c]})).then((function(e){var n=e[1];t({type:"load_peer",members:n})})).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),Vi(zt.ERROR,e),console.error(e)}))}function Xl(e,t,n){return function(e,t){return Vi(zt.DEBUG,{type:"request",method:"messages.getCallToken",data:{call_id:e,invalidate:t?1:0}}),Object(hu.a)()(pu.a)("messages.getJoinLink",{call_id:e,invalidate:t?1:0}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getJoinLink",data:e}),e}))}(t,n).then((function(t){var n=t.join_link;return e({type:"call_state",callData:{callUrlLink:n}}),n}))}function ed(e,t){if(t&&t.call_in_progress){var n=t.unread_count,r=t.last_message_id,i=t.call_in_progress.has_link;e({type:"call_state",callData:{canFinishCall:t.call_in_progress.can_finish_call,hasUrlLink:i}}),(n||r)&&e({type:"set_unread_count",chatUnreadCount:n,chatUpToMsgId:r})}}function td(e){return Mi(!1,null,e).catch((function(e){Vi(zt.ERROR,e),console.error(e)}))}function nd(e){return function(e){return Object(hu.a)()(pu.a)("video.startStreaming",e)}(e).then((function(e){return Mi(!1,null,e.stream.ov_id)})).catch((function(e){Vi(zt.ERROR,e),console.error(e)}))}function rd(e,t,n,r){var i=t.callData.callId||"";n({type:ha,isLoaderVisible:!0}),function(e){return Vi(zt.DEBUG,{type:"request",method:"messages.forceCallFinish",data:{call_id:e}}),Object(hu.a)()(pu.a)("messages.forceCallFinish",{call_id:e}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.forceCallFinish",data:e}),e}))}(i).catch((function(e){console.error(e),n({type:pa,text:r("calls_error_force_call_finish"),handleType:Zi.FATAL})})).finally((function(){n({type:ha,isLoaderVisible:!1})}))}var id,ad=n("ngxX"),od=function(){return(od=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},sd=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},cd=function(e){var t=sd(e,[]);return l.a.createElement("svg",od({width:"28",height:"28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("circle",{cx:"14",cy:"14",r:"14",fill:"url(#paint0_linear)"}),l.a.createElement("path",{d:"M6.746 14.391c-.165-1.078-.204-1.206-.493-1.614-.363-.513-.415-1.1.38-1.255 2.042-.397 4.252-.1 6.265.268a5.546 5.546 0 002.204 0c2.013-.368 4.223-.665 6.264-.268.796.154.744.742.38 1.255-.288.408-.327.536-.492 1.614-.248 1.617-1.607 2.275-3.29 2.276-1.85 0-2.465-1.055-3.04-2.494-.557-1.398-1.29-1.398-1.849 0-.574 1.439-1.19 2.494-3.038 2.494-1.684 0-3.043-.66-3.29-2.276z",fill:"#fff"}),l.a.createElement("defs",null,l.a.createElement("linearGradient",{id:"paint0_linear",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},l.a.createElement("stop",{stopColor:"#99A2AD"}),l.a.createElement("stop",{offset:"1",stopColor:"#99A2AD"}))))},ud=function(e){var t=e.requireAuthToJoin,n=void 0!==t&&t,r=e.onRequireAuthToJoinChanged,i=Object(u.useContext)(To).getLang,a=Object(u.useState)(!n),o=a[0],s=a[1],c=!1,d=Object(u.useCallback)((function(){if(!c){c=!0;var e=!o;s(e),r&&r(!e)}}),[n]);return l.a.createElement(qu.a,null,l.a.createElement(Ju.default,{border:!0,canBeHovered:!1,onClick:d,selectable:!0,icon:l.a.createElement(cd,null),aside:l.a.createElement(ad.a,{onChange:d,checked:o})},i("calls_management_link_allow_anonymous")))};!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS"}(id||(id={}));var ld=function(e){var t,n,r=e.bridge,i=e.SDK,a=e.navigateToConvo,o=e.navigateToProfile,s=e.allowAddMembers,c=void 0!==s&&s,d=Object(h.e)((function(e){return e})),p=Object(h.d)(),f=Object(u.useState)(d.callData.callUrlLink||""),m=f[0],v=f[1],_=d.managementView||id.MAIN,g=Object(u.useState)(_),A=g[0],y=g[1],E=Object(u.useState)(!1),S=E[0],b=E[1],C=Object(u.useState)(!1),w=C[0],O=C[1],T=Object(u.useState)(!1),I=T[0],P=T[1],R=Object(u.useState)(!1),D=R[0],k=R[1],N=c||!!(null===(t=d.callData.conversation)||void 0===t?void 0:t.canAddMembers),F=null===(n=d.callData)||void 0===n?void 0:n.canFinishCall,L=l.a.useContext(To).getLang,M=function(e){return e.conversationOptions.includes(pt.REQUIRE_AUTH_TO_JOIN)}(d),j=Object(u.useCallback)((function(){p({type:"management",isOpen:!1})}),[]),x=Object(u.useCallback)((function(){y(id.MAIN)}),[]),B=function(e){var t=d.callData.callId||"";return b(!0),Xl(p,t,e).then((function(e){v(e),b(!1)})).catch((function(e){console.error(e),b(!1),p({type:pa,text:L("calls_get_url_link_error_text")})}))},U=Object(u.useCallback)((function(){y(id.CALL_LINK),m||B(!1).catch((function(){y(id.MAIN)}))}),[d.callData.callId,m]),V=Object(u.useCallback)((function(){p({type:ha,isLoaderVisible:!0});var e=[Ql(r,d,p)].concat(Ka(d.peer)?[ql(d,p,d.peer,d.callData.conversation)]:[]);return Promise.all(e).then((function(){p({type:ha,isLoaderVisible:!1}),y(id.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),p({type:ha,isLoaderVisible:!1})}))}),[d.peer,d.callData]),G=Object(u.useCallback)((function(){p({type:da}),rd(0,d,p,L)}),[d.callData.callId,d.imHash]);Object(u.useEffect)((function(){_===id.CALL_LINK&&U()}),[]),Object(u.useEffect)((function(){var e=ho(d.participants[d.me]),t=e;P(e),k(t)}),[d.participants[d.me]]);var H=Object(u.useCallback)((function(e){!function(e){var t;Ci(((t={})[pt.REQUIRE_AUTH_TO_JOIN]=e,t))}(e)}),[]),W=Object(u.useCallback)((function(){return O(!0)}),[]),z=Object(u.useCallback)((function(){return O(!1)}),[]),K=Object(u.useCallback)((function(){B(!0).catch((function(){y(id.MAIN)}))}),[d.callData.callId,m]);return l.a.createElement(l.a.Fragment,null,A===id.MAIN&&l.a.createElement(Qu,{title:L("calls_management_participants"),actionButtons:(F?[l.a.createElement(Ol.a,{onClick:G,key:"forceCallFinish",appearance:"secondary"},L("calls_force_call_finish"))]:[]).concat([l.a.createElement(Ol.a,{onClick:i.hangup,key:"leave"},L("calls_leave_call"))]),onCloseModal:j},l.a.createElement(il,{isLinkBlockShown:N,linkBlockTitle:L("calls_menu_link"),onLinkBlockClick:U,callUrlLink:m}),l.a.createElement(wl,{SDK:i,onAddClick:V,navigateToProfile:o,navigateToConvo:a})),A===id.CALL_LINK&&l.a.createElement(Qu,{title:L("calls_management_link"),hint:M?L("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:j,isWithBackButton:_!==id.CALL_LINK,onBackClick:x,actionButtons:(D?[l.a.createElement(Ol.a,{key:"invalidate-link",appearance:"tertiary",onClick:K},L("calls_link_invalidate"))]:[]).concat([l.a.createElement(el,{key:"copy-link",text:m},l.a.createElement(Ol.a,{className:"CallManagementModal__copyTextButton",disabled:S,onClick:W},L("calls_link_copy")))])},l.a.createElement(cl,{link:m,isLinkLoading:S,isCopied:w,hideCopiedText:z}),I&&l.a.createElement(ud,{onRequireAuthToJoinChanged:H,requireAuthToJoin:M})),A===id.ADD_PARTICIPANTS&&l.a.createElement(Gl,{SDK:i,isWithBackButton:!0,onBackClick:x}))},dd=function(){return(dd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function pd(e){var t,n,r,i,a,o,s,c,d=e.SDK,p=e.navigateToConvo,f=e.navigateToProfile,m=e.onHandCountChanged,v=Object(h.e)((function(e){return e})),_=Object(h.d)(),g=Object(u.useContext)(To).getLang,A=Object(u.useContext)(Wa),y=A.isModalView,E=A.debugLog,S=v.peer,b=Qa(S),C=b?v.callData.conversation:v.participants[S],w=v.participants[v.me],O=w.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},T=w.permissions,I=no(v),P=I.length>1,R=P||O.isVideoEnabled,D=function(e){return io(e).filter((function(e){return!$a(e.peerId)})).length}(v),k=b&&(co(w)||uo(w))&&D>1&&1===function(e){return io(e).filter((function(e){return co(e)||uo(e)})).length}(v),N=b||I.length>2,F=N&&R&&!v.isOratorMode,L=N&&R&&v.isOratorMode,M=null!==v.adminPinnedParticipant,j=!M&&null!==v.pinnedParticipant,x=!j&&null!==v.screenSharingPinnedParticipant,B=v.uiMode===aa.FULLSCREEN,U=Object(u.useMemo)((function(){return d.browser.isScreenCapturingSupported()}),[]),V=null===(t=v.callData)||void 0===t?void 0:t.canFinishCall,G=Object(u.useState)(!1),H=G[0],W=G[1],z=Object(u.useState)(!1),K=z[0],Q=z[1],q=function(e){return _({type:"change_ui_mode",mode:e})},J=Object(u.useCallback)((function(){y&&(v.uiMode===aa.FULLSCREEN?(Fo(.3,null).then((function(){q(aa.COLLAPSED)})),q(aa.DEFAULT)):q(aa.COLLAPSED))}),[v.uiMode]),Y=Object(u.useCallback)((function(){_({type:"toggle_orator_mode",isOratorMode:!v.isOratorMode})}),[v.isOratorMode]),$=Object(u.useCallback)((function(){_({type:"toggle_participants_aside",isShownParticipantsAside:!v.isShownParticipantsAside})}),[v.isShownParticipantsAside]),Z=Object(u.useCallback)((function(e,t){var n=v.pinnedParticipant===t?null:t;v.screenSharingPinnedParticipant===t&&(n=null),v.screenSharingPinnedParticipant&&_({type:"set_screen_sharing_pinned_participant",screenSharingPinnedParticipant:null}),_({type:"set_pinned_participant",pinnedParticipant:n})}),[v.pinnedParticipant,v.screenSharingPinnedParticipant]),X=Object(u.useCallback)((function(e,t){v.isOratorMode||_({type:"toggle_orator_mode",isOratorMode:!0}),v.pinnedParticipant!==t&&_({type:"set_pinned_participant",pinnedParticipant:t})}),[v.isOratorMode,v.pinnedParticipant]),ee=Object(u.useCallback)((function(){_({type:"management",isOpen:!0})}),[]),te=Object(u.useCallback)((function(){_({type:"management",isOpen:!0,managementView:id.CALL_LINK})}),[]),ne=Object(u.useCallback)((function(){if(!K){var e=!O.isVideoEnabled||O.isScreenSharingEnabled;(e?Pc(d,!0,!1):Promise.resolve()).then((function(){Q(!0),O.isScreenSharingEnabled&&d.captureScreen(!1),d.toggleLocalVideo(e).finally((function(){Q(!1)}))})),Ya.logEvent({call_event_type:e?Qi.a.VIDEO_ENABLED:Qi.a.VIDEO_DISABLED,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer),reason:e?void 0:"manual"})}}),[O,K]),re=Object(u.useCallback)((function(){d.captureScreen(!O.isScreenSharingEnabled),Ya.logEvent({call_event_type:O.isScreenSharingEnabled?Qi.a.SCREEN_SHARING_STOPPED:Qi.a.SCREEN_SHARING_STARTED,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer)})}),[O.isScreenSharingEnabled,v.screenSharers]),ie=Object(u.useCallback)((function(){J(),p(v.peer)}),[v.peer,v.uiMode]),ae=Object(u.useCallback)((function(){var e,t,n=!(null===(e=w.statusData)||void 0===e?void 0:e.hand);d.changeParticipantState({hand:n?ca.RAISED:ca.LOWERED}),_({type:"change_participant_state",participantId:w.peerId,data:dd(dd({},w.statusData),{hand:!(null===(t=w.statusData)||void 0===t?void 0:t.hand)})}),Ya.logEvent({call_event_type:n?Qi.a.HAND_RAISED:Qi.a.HAND_LOWERED,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer)})}),[null===(n=w.statusData)||void 0===n?void 0:n.hand]),oe=Object(u.useCallback)((function(){_({type:da,data:"exit"})}),[]),se=l.a.useCallback((function(){_({type:da,data:"transfer_admin_rights"})}),[]),ce=function(){d.hangup(),Ya.logEvent({call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer),reason:"none",group_call_users_count:ro(v)})},ue=Object(u.useCallback)((function(){_({type:"change_ui_mode",mode:B?aa.DEFAULT:aa.FULLSCREEN}),_({type:"set_tooltip",tooltips:null})}),[v.uiMode]),le=Object(u.useCallback)((function(e,t){var n;_({type:"set_tooltip",tooltips:(n={},n[e]=t,n)})}),[]),de=Object(u.useCallback)((function(){_({type:"set_tooltip",tooltips:null})}),[]),pe=Object(u.useCallback)((function(e){Gu(_,e,!1,1e3)}),[]),he=Object(u.useCallback)((function(e){Gu(_,e,!0,1e3)}),[]),fe=[{text:g("calls_call_menu_settings"),key:"settings",onClick:function(){Pc(d,!0,!0).then((function(){_({type:da,data:"settings"})}))},disabled:!1}];v.config.streaming&&!$a(v.me)&&fe.push({text:g("calls_call_menu_translation"),key:"translation",onClick:function(){_({type:da,data:"translation"})},disabled:!(!(null===(r=v.translation)||void 0===r?void 0:r.isOn)||!(null===(a=null===(i=v.translation)||void 0===i?void 0:i.host)||void 0===a?void 0:a.id))&&+(null===(s=null===(o=v.translation)||void 0===o?void 0:o.host)||void 0===s?void 0:s.id)!==v.me}),Object(u.useEffect)((function(){return function(){_({type:"set_tooltip",tooltips:null})}}),[]);var me=Object(u.useCallback)((function(){M&&so(w)?(d.pinParticipant(v.adminPinnedParticipant,!0).then((function(){_({type:"set_admin_pinned_participant",data:null})})).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ADMIN_UNPIN,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer)})):(_({type:"set_screen_sharing_pinned_participant",screenSharingPinnedParticipant:null}),_({type:"set_pinned_participant",pinnedParticipant:null}))}),[M,so(w)]);lo(w)&&b&&fe.push({text:g("calls_call_menu_mute_audio_video_all"),key:"muteAll",onClick:function(){_({type:"toggle_participants_management",data:{mode:Yi.ALL}})}}),lo(w)&&b&&P&&fe.push({text:g("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:function(){d.unmuteRequest(void 0,[Wi.AUDIO,Wi.VIDEO]).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ASK_ALL_TO_UNMUTE,session_id:v.callData.callId,peer_id:v.peer,is_group_call:Qa(v.peer)})}});return E&&fe.push({text:g("calls_call_menu_debug"),key:"debugLog",onClick:function(){window.__OKCallsSDKLogs__()},disabled:!1}),l.a.createElement(ko,{onClose:k?se:ce,isCautionBoxShown:!k,onBackdropClick:J},l.a.createElement(bc,{id:S,photo:C&&C.photo||"",disablePhoto:R,info:l.a.createElement(ju,{onHandCountChanged:m}),callMenuActions:fe,isVideoAllowed:O.isVideoEnabled||T.video>0,isAudioAllowed:O.isAudioEnabled||T.audio>0,isVideoEnabled:O.isVideoEnabled&&!O.isScreenSharingEnabled,isAudioEnabled:O.isAudioEnabled,isScreenSharingEnabled:O.isScreenSharingEnabled,isOratorMode:v.isOratorMode,isFullScreen:B,onToggleVideo:ne,onToggleAudio:function(){if(!H){var e=!O.isAudioEnabled;(e?Pc(d,!1,!0):Promise.resolve()).then((function(){var t;W(!0),(null===(t=v.notification)||void 0===t?void 0:t.type)===sa.SPEAKING_ON_MUTE&&_({type:"call_notification",notification:null}),d.toggleLocalAudio(e).finally((function(){W(!1)}))}))}},onToggleScreenShare:re,onLeaveCall:k?se:V?oe:ce,onCollapseCall:y?J:null,onToggleOratorMode:Y,onFullScreenToggle:ue,onTooltipChange:le,onHidePanel:de,onChat:ie,onHandClick:ae,isParticipantControlActive:v.isManagementOpen,isLayoutSwitchShown:b&&P,isHandRaised:null===(c=w.statusData)||void 0===c?void 0:c.hand,isHandControlShown:b,isChatControlShown:!!S,isScreenShareControlShown:T.screenSharing>0&&U,onParticipantsClick:ee,chatUnreadCount:v.chatUnreadCount,notification:l.a.createElement(Fc,null),tooltips:v.tooltips,amISpeaking:!!v.speakers[v.me],onChainClick:te},!N&&l.a.createElement(Ns,dd({},function(e,t,n,r){var i,a,o=e[t],s=e[n],c=o.mediaSettings,u=s.mediaSettings;return{hasAudio:!!(null==c?void 0:c.isAudioEnabled),hasVideo:!!(null==c?void 0:c.isVideoEnabled),isSharingScreen:!!(null==c?void 0:c.isScreenSharingEnabled),stream:o.stream,id:t,name:r("calls_own_label"),letter:null===(i=o.name)||void 0===i?void 0:i.slice(0,1),wasConnected:!!o.wasConnected,opponentHasAudio:!!(null==u?void 0:u.isAudioEnabled),opponentHasVideo:!!(null==u?void 0:u.isVideoEnabled),opponentIsSharingScreen:!!(null==u?void 0:u.isScreenSharingEnabled),opponentStream:s.stream,opponentPhoto:s.photo,opponentId:n,opponentName:s.name||n.toString(),opponentLetter:null===(a=s.name)||void 0===a?void 0:a.slice(0,1),opponentWasConnected:!!s.wasConnected}}(v.participants,v.me,v.peer,g))),F&&l.a.createElement(Cc,{limit:v.participantLimit},I.map((function(e,t,n){var r,i,a=e.mediaSettings||{},o=a.isVideoEnabled,s=a.isAudioEnabled,c=a.isScreenSharingEnabled,u=e.peerId===v.me?g("calls_own_label"):e.shortName?e.shortName:e.name;return l.a.createElement(ks,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:e.peerId===v.me,isHandRaised:null===(r=e.statusData)||void 0===r?void 0:r.hand,hasVideo:!!o,hasAudio:!!s,isSharingScreen:!!c,isSpeaking:!!s&&!!v.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:n.length<=8||B?"s":"xs",name:u,letter:null===(i=e.name)||void 0===i?void 0:i.slice(0,1),status:e.status,wasConnected:e.wasConnected,onDblClickParticipant:X,onShow:he,onHide:pe,actions:Xa(v,d,_,e,!0,g,p,f,!1)})}))),L&&l.a.createElement(Ic,{orator:hd(v,g,re),onToggleParticipantsAside:$,isShownParticipantsAside:v.isShownParticipantsAside,isPinned:j,isPinnedByAdmin:M,isPinnedByShareScreen:x,isUnpinAllowed:so(w)||!M,onUnpin:me,tooltips:v.tooltips,onTooltipChange:le},I.map((function(e){var t,n,r=e.mediaSettings||{},i=r.isVideoEnabled,a=r.isAudioEnabled,o=r.isScreenSharingEnabled,s=e.peerId===v.me,c=s?g("calls_own_label"):e.shortName?e.shortName:e.name;return l.a.createElement(ks,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:s,isPinned:e.peerId===v.pinnedParticipant||e.peerId===v.screenSharingPinnedParticipant,isPinnedByAdmin:e.peerId===v.adminPinnedParticipant,isHandRaised:null===(t=e.statusData)||void 0===t?void 0:t.hand,hasVideo:!!i,hasAudio:!!a,isSharingScreen:!!o,isSpeaking:!!a&&!!v.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:"xxs",name:c,letter:null===(n=e.name)||void 0===n?void 0:n.slice(0,1),status:e.status,wasConnected:e.wasConnected,onClickParticipant:Z,onShow:he,onHide:pe,actions:Xa(v,d,_,e,!0,g,p,f,!1)})}))),N&&!R&&l.a.createElement(hs.default,null,l.a.createElement(Eo,{id:S,photo:C&&C.photo||"",size:"l",waves:!0,alt:C&&C.tab||""}))))}function hd(e,t,n){var r,i=e.participants[e.adminPinnedParticipant||e.screenSharingPinnedParticipant||e.pinnedParticipant||e.orator||e.me],a=i.mediaSettings||{},o=a.isVideoEnabled,s=a.isAudioEnabled,c=a.isScreenSharingEnabled,u=i.peerId===e.me;return l.a.createElement(ks,{id:i.peerId,key:i.peerId,isOrator:!0,isInfoShown:!0,isMe:u,hasVideo:!!o,hasAudio:!!s,isSharingScreen:!!c,stream:i.stream,photo:i.photo,photoSize:"l",name:u?t("calls_own_label"):i.name,letter:null===(r=i.name)||void 0===r?void 0:r.slice(0,1),status:i.status,wasConnected:i.wasConnected,allowContain:!0,onStopScreenShare:n})}var fd=function(e){var t=e.children,n=Object(u.useContext)(Wa).withAnimation,r=Object(p.a)("CollapsedCall",{"CollapsedCall--withAnimation":n});return l.a.createElement("div",{className:r},t)},md=function(e){var t=e.id,n=e.photo,r=e.title,i=e.status,a=e.isIncoming,o=e.onClick,s=e.children;return l.a.createElement("div",{className:"CallWidget",onClick:o},l.a.createElement(mo,{id:t,photo:n,className:"CallWidget__background"}),l.a.createElement(Eo,{id:t,photo:n,size:"xs",waves:a,alt:r||""}),l.a.createElement("h1",{className:"CallWidget__name"},r),l.a.createElement("div",{className:"CallWidget__status"},i),s)},vd=function(e){var t=e.localVideoStream,n=e.isLocalAudioEnabled,r=e.isLocalScreenSharing,i=e.participantId,a=e.isMe,o=e.isWithVideo,s=e.isWithAudio,c=e.isScreenSharing,d=e.stream,p=e.photo,h=e.name,f=e.status,m=void 0===f?oa.CONNECTED:f,v=e.onRestoreCall,_=e.onToggleAudio,g=e.children,A=l.a.useContext(To).getLang,y=Object(u.useContext)(Wa).withAnimation,E=Object(u.useState)(!1),S=E[0],b=E[1];Object(u.useEffect)((function(){t||b(!1)}),[t,S]);var C=Object(u.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),v()}),[v]),w=Object(u.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),_()}),[_]);return l.a.createElement("div",{className:"CallVideoWidget",onClick:v},t&&l.a.createElement(ps,{stream:t,hasVideo:!0,isMe:!0,isVideoVisible:S,isScreenShareStream:r,setVideoVisibility:b,className:"CallVideoWidget__local",allowContain:!0,withAnimation:y}),l.a.createElement(ks,{id:i,hasVideo:o,hasAudio:s,isSharingScreen:c,isMe:a,stream:d,photo:p,name:h,status:m,photoSize:"s"}),g,l.a.createElement(Ms,{alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},l.a.createElement(Oo.default,{position:"t",align:"left",marginTop:6,text:A(n?"calls_mute":"calls_unmute")},l.a.createElement(wo,{type:n?"mute":"unmute",onClick:w}))),l.a.createElement(Ms,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},l.a.createElement(Oo.default,{position:"t",align:"right",text:A("calls_restore"),marginTop:6},l.a.createElement(wo,{type:"restore",onClick:C}))))},_d=function(){return(_d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},gd=function(e){var t,n,r,i=e.SDK,a=Object(h.e)((function(e){return e})),o=Object(h.d)(),s=l.a.useContext(To).getLang,c=a.peer,d=es(a),p=Qa(c)?a.callData.conversation:a.participants[c],f=a.participants[a.me],m=to(a,d),v=(null===(t=f.mediaSettings)||void 0===t?void 0:t.isVideoEnabled)&&m&&m.peerId!==a.me,_=Object(u.useCallback)((function(){o({type:"change_ui_mode",mode:aa.DEFAULT})}),[]),g=Object(u.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=f.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[a]);return l.a.createElement(fd,null,a.mode===ra.INCOMING&&l.a.createElement(md,{id:c,title:(null==p?void 0:p.tab)||"",photo:(null==p?void 0:p.photo)||"",status:s("calls_incoming_collapsed"),isIncoming:!0,onClick:_}),a.mode!==ra.INCOMING&&l.a.createElement(vd,_d({localVideoStream:v?f.stream:void 0,isLocalAudioEnabled:!!(null===(n=f.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalScreenSharing:!!(null===(r=f.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)},function(e,t,n){var r,i,a;return e?{participantId:e.peerId,isMe:e.peerId===n,isWithVideo:!!(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled),isWithAudio:!!(null===(i=e.mediaSettings)||void 0===i?void 0:i.isAudioEnabled),isScreenSharing:!!(null===(a=e.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:e.stream,photo:e.photo,name:e.name,status:e.status}:{participantId:t&&t.peerId||0,isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:t&&t.photo||"",name:t&&t.tab||"",status:t&&t.status||oa.CONNECTED}}(m,p,a.me),{onRestoreCall:_,onToggleAudio:g})))};var Ad=function(){return(Ad=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function yd(e){var t,n=e.onBeforeCallStart,r=e.onAfterCallFinish,i=e.callSounds,a=Object(h.e)((function(e){return e})),o=Object(u.useRef)(),s=((t={}).incoming=Object(u.useRef)(null),t.outgoing=Object(u.useRef)(null),t.connecting=Object(u.useRef)(null),t.connected=Object(u.useRef)(null),t.end=Object(u.useRef)(null),t),c={controls:!1,preload:"auto"},d=Object(u.useCallback)((function(e){var t=s[e].current;t&&t.paused&&t.play().catch((function(){}))}),[]),p=Object(u.useCallback)((function(e){var t=s[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)}),[]),f=Object(u.useCallback)((function(){Object.keys(s).forEach(p)}),[]),m=Object(u.useCallback)((function(e){var t=s[e].current;if(t){var n=t.volume;t.volume=0,t.play().catch((function(){})),t.pause(),t.currentTime=0,t.volume=n}}),[]),v=Object(u.useCallback)((function(){n&&n()}),[n]),_=Object(u.useCallback)((function(){r&&r()}),[r]);return Object(u.useEffect)((function(){return Mo.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(s).forEach(m),document.body.removeEventListener("mousedown",e)})),function(){f(),_()}}),[]),Object(u.useEffect)((function(){var e,t,n=o.current||a,r=a;n.mode!==r.mode&&(n.mode!==ra.READY||r.mode!==ra.INCOMING&&r.mode!==ra.CALL||v(),n.mode===ra.INCOMING&&p("incoming"),r.mode===ra.INCOMING&&d("incoming"),r.mode!==ra.READY||n.mode!==ra.INCOMING&&n.mode!==ra.CALL||(f(),d("end"),_()));var i=r.me,s=n.participants,c=r.participants,u=null===(e=s[i])||void 0===e?void 0:e.status,l=null===(t=c[i])||void 0===t?void 0:t.status;u!==l&&(u===oa.CONNECTING&&p("connecting"),l===oa.CONNECTING&&d("connecting"));var h=Object.keys(c).some((function(e){return s[e]&&s[e].status===oa.CONNECTED})),m=Object.keys(c).some((function(e){var t=s[e],n=c[e];return t&&t.status!==n.status&&n.status===oa.CONNECTED}));!h&&m&&d("connected"),r.mode===ra.CALL&&(!function(e,t,n,r){for(var i=!1,a=0,o=Object.values(e);a<o.length;a++){var s=o[a];if(s.peerId!==t){if(s.status===oa.CONNECTED)return!1;s.status===oa.WAITING&&(!r||n.has(s.peerId))&&(i=!0)}}return i}(c,i,r.participantsAddedByMe,Qa(a.peer))?p("outgoing"):d("outgoing")),o.current=a}),[a]),l.a.createElement(l.a.Fragment,null,l.a.createElement("audio",Ad({src:i.incoming,ref:s.incoming,loop:!0},c)),l.a.createElement("audio",Ad({src:i.outgoing,ref:s.outgoing,loop:!0},c)),l.a.createElement("audio",Ad({src:i.connected,ref:s.connected,loop:!1},c)),l.a.createElement("audio",Ad({src:i.connecting,ref:s.connecting,loop:!0},c)),l.a.createElement("audio",Ad({src:i.end,ref:s.end,loop:!1},c)))}var Ed=n("hN/p"),Sd=n("b8Q7");function bd(){return(bd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Cd=u.useRef,wd=u.useEffect;function Od(e){var t=e.cameras,n=e.mics,r=e.noiseCancellationOptions,i=e.videoResolutionOptions,a=e.currentCamId,o=e.currentMicId,s=e.currentNoiseCancellation,c=e.currentVideoResolution,l=e.isCamAvailable,d=e.isMicAvailable,p=e.onCameraChange,h=e.onMicChange,f=e.onNoiseCancellationChange,m=e.onVideoResolutionChange,v=u.useContext(To).getLang,_=Cd(null),g=Cd(null),A=Cd(null),y=Cd(null),E={controls:!1,crossOrigin:"anonymous",playsInline:"playsinline"};return Id({kind:"video",resolution:c,mediaElRef:_,streamRef:A,deviceId:a,isActive:l}),Id({kind:"audio",mediaElRef:g,streamRef:y,deviceId:o,isActive:d}),u.createElement("div",{className:"CallSettings"},u.createElement("div",{className:"CallSettings__camera"},l?u.createElement("video",bd({ref:_},E,{className:"CallSettings__cameraStream CallSettings__cameraContent"})):u.createElement("div",{className:"CallSettings__cameraStub CallSettings__cameraContent"},v("calls_no_camera"))),d&&u.createElement("audio",bd({ref:g},E)),u.createElement("div",{className:"CallSettings__block"},u.createElement("div",{className:"CallSettings__label"},v("calls_settings_camera")),l?u.createElement(Ed.default,{options:t.map(Td),value:a,onChange:e=>{var t=e.selected;return p(t.value)},appearance:"secondary",className:"CallSettings__field"}):u.createElement(ol.a,{className:"CallSettings__field"},v("calls_settings_no_camera"))),l&&u.createElement("div",{className:"CallSettings__block"},u.createElement("div",{className:"CallSettings__label"},v("calls_settings_video_resolution")),u.createElement(Ed.default,{options:i,value:c,onChange:e=>{var t=e.selected;return m(t.value)},appearance:"secondary",className:"CallSettings__field"})),u.createElement("div",{className:"CallSettings__block"},u.createElement("div",{className:"CallSettings__label"},v("calls_settings_mic")),d?u.createElement(Ed.default,{options:n.map(Td),value:o,onChange:e=>{var t=e.selected;return h(t.value)},appearance:"secondary",className:"CallSettings__field"}):u.createElement(ol.a,{className:"CallSettings__field"},v("calls_settings_no_mic"))),u.createElement("div",{className:"CallSettings__block"},u.createElement("div",{className:"CallSettings__label"},u.createElement("span",{dangerouslySetInnerHTML:{__html:v("calls_settings_noise")}})),d?u.createElement(Ed.default,{options:r,value:s,onChange:e=>{var t=e.selected;return f(t.value)},appearance:"secondary",className:"CallSettings__field"}):u.createElement(ol.a,{className:"CallSettings__field"},v("calls_settings_no_mic")),u.createElement(Oo.default,{className:"CallSettings__tooltip",text:v("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},u.createElement(Sd.default,{className:"CallSettings__hint","aria-label":v("calls_settings_noise_description")}))))}function Td(e){return{value:e.deviceId,label:e.label}}function Id(e){var t=e.kind,n=e.resolution,r=e.mediaElRef,i=e.streamRef,a=e.deviceId,o=e.isActive,s={video:!1,audio:!1},c={deviceId:a};"video"===t&&n&&(c.width={min:428,max:Ji[n]||Ji.SD,ideal:Ji[n]||Ji.SD},c.height={min:240,max:qi[n]||qi.SD,ideal:qi[n]||qi.SD}),wd(()=>{o&&navigator.mediaDevices.getUserMedia(bd({},s,{[t]:c})).then(e=>{var t=i.current;t&&t.getTracks().forEach(e=>e.stop());var n=r.current;n&&(i.current=e,n.srcObject=e,n.volume=0,n.play(),is(r))}).catch(e=>{console.error("Error occurred: "+e)})},[a,o,n]),wd(()=>()=>{var e=i.current;e&&e.getTracks().forEach(e=>e.stop());var t=r.current;t&&(t.srcObject=null)},[])}Od.defaultProps={cameras:[],mics:[],noiseCancellationOptions:[],videoResolutionOptions:[],currentCamId:"",currentMicId:"",currentNoiseCancellation:"",currentVideoResolution:"",isCamAvailable:!1,isMicAvailable:!1};var Pd=n("GSQL");function Rd(e){var t=e.onClose,n=e.onSubmit,r=e.children,i=u.useContext(To).getLang;return u.createElement(Pd.default,{onClose:t,title:i("calls_settings"),appearance:"blue",actionButtons:u.createElement(u.Fragment,null,u.createElement(Ol.a,{onClick:t,appearance:"tertiary"},i("calls_cancel")),u.createElement(Ol.a,{onClick:n},i("calls_save"))),className:"CallSettingsModal"},r)}var Dd=l.a.useState;function kd(e){var t=e.SDK,n=l.a.useContext(To).getLang,r=l.a.useContext(Wa).fullHD,i=[{label:n("calls_noise_neural"),value:zi.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:n("calls_noise_simple"),value:zi.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:n("calls_noise_none"),value:zi.NONE,data:{denoise:!1,denoiseAnn:!1}}],a=[{label:n("calls_video_resolution_sd"),value:Ki.SD},{label:n("calls_video_resolution_hd"),value:Ki.HD}];r&&a.push({label:n("calls_video_resolution_fhd"),value:Ki.FHD});var o=Object(h.e)((function(e){return e})),s=Object(h.e)((function(e){var t;return[e.mode,null===(t=e.participants[e.me].mediaSettings)||void 0===t?void 0:t.isVideoEnabled]})),c=s[0],u=s[1],d=Object(h.d)(),f=t.browser.getCameras(),m=t.browser.getMicrophones(),v=t.browser.hasCamera()&&t.browser.hasCameraPermission(),_=t.browser.hasMicrophone()&&t.browser.hasMicrophonePermission(),g=t.browser.getSavedCamera(),A=t.browser.getSavedMicrophone(),y=v&&(g&&g.deviceId||f[0].deviceId),E=_&&(A&&A.deviceId||m[0].deviceId),S=Dd(y),b=S[0],C=S[1],w=Dd(E),O=w[0],T=w[1],I=Dd(o.noiseCancellation),P=I[0],R=I[1],D=p.j.getItem("calls_video_resolution"),k=Dd(D===Ki.FHD?Ki.FHD:D===Ki.HD?Ki.HD:Ki.SD),N=k[0],F=k[1];return l.a.createElement(Rd,{onClose:function(){d({type:da})},onSubmit:function(){var e,n=[Promise.resolve()];!g&&y===b&&c!==ra.READY&&!u||g&&g.deviceId===b||n.push(t.changeDevice("videoinput",b)),A&&A.deviceId===O||n.push(t.changeDevice("audioinput",O)),o.noiseCancellation!==P&&n.push(t.setMediaModifiers(null===(e=i.find((function(e){return e.value===P})))||void 0===e?void 0:e.data).then((function(e){console.log("noise: ",e),d({type:"set_noise_cancellation",data:P})}))),o.localVideoResolution!==N&&(console.debug("set resolution from -> to: ",o.localVideoResolution,N,Ji[N],qi[N]),n.push(t.setLocalResolution(Ji[N],qi[N]).catch((function(e){console.error(e)})).finally((function(){p.j.setItem("calls_video_resolution",N),d({type:"change_local_video_resolution",data:N})})))),Promise.all(n).then((function(){d({type:da})})).catch((function(e){console.error("Device change failed",e),d({type:da})}))}},l.a.createElement(Od,{mics:m,cameras:f,noiseCancellationOptions:i,videoResolutionOptions:a,currentCamId:b,currentMicId:O,currentNoiseCancellation:P,currentVideoResolution:N,isCamAvailable:v,isMicAvailable:_,onCameraChange:function(e){return C(e)},onMicChange:function(e){return T(e)},onNoiseCancellationChange:function(e){return R(e)},onVideoResolutionChange:function(e){return F(e)}}))}class Nd extends u.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){switch(this.props.mode){case ra.CALL:this.props.SDK.hangup();break;case ra.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)}render(){return this.state.hasError?null:this.props.children}}var Fd=function(e){var t=e.children;return l.a.createElement("h2",{className:"JoinHeader"},t)},Ld=function(e){var t=e.children;return l.a.createElement("div",{className:"VisuallyHidden"},t)},Md=function(e){var t=e.items;return l.a.createElement("figure",{className:"AvatarsStack"},l.a.createElement(Ld,null,l.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},l.a.createElement("defs",null,l.a.createElement("clipPath",{id:"users-mask"},l.a.createElement("path",{d:"M43.56 8.25a25 25 0 100 33.5A27.88 27.88 0 0138 25c0-6.28 2.07-12.08 5.56-16.75z"}))))),t.map((function(e,t){return"src"in e?l.a.createElement("img",{src:e.src,className:"AvatarsStack__item",alt:e.alt,key:e.key||t}):l.a.createElement(vo.a,{text:e.text,id:e.id,size:"50",className:"AvatarsStack__item",key:e.key||t})})))},jd=function(){return(jd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},xd=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Bd=function(e){var t=xd(e,[]);return l.a.createElement("svg",jd({width:"16",height:"16",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),l.a.createElement("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"}))},Ud=function(e){var t=e.isAnonym,n=e.title,r=e.label,i=e.items,a=e.onChangeName,o=e.name,s=e.namePlaceholder,c=e.joinWithVideoText,u=e.joinWithAudioText,d=e.onJoinWithVideo,h=e.onJoinWithAudio,f=e.disabled,m=e.inputDisabled;return l.a.createElement("div",{className:Object(p.a)("JoinScreen",{"JoinScreen--anonym":t})},l.a.createElement(Fd,null,n),l.a.createElement("div",{className:"JoinScreen__members"},l.a.createElement(Md,{items:i}),l.a.createElement("div",{className:"JoinScreen__membersLabel"},r)),l.a.createElement("footer",{className:"JoinScreen__footer"},t&&l.a.createElement(al.default,{onChange:a,className:"JoinScreen__input",value:o,placeholder:s,disabled:m,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&d()}}),l.a.createElement(Ol.a,{appearance:"primary",onClick:d,disabled:f,type:"submit"},l.a.createElement(Bd,{className:"JoinScreen__icon"}),l.a.createElement("span",null,c)),l.a.createElement(Ol.a,{appearance:"primary",title:u,"aria-label":u,onClick:h,disabled:f},l.a.createElement(Nl,{className:"JoinScreen__icon"}))))};function Vd(e,t,n){void 0===n&&(n={baseURL:""});var r=n.enabled,i=n.isTab,a=n.baseURL;return!r&&t?t:i?'<i class="emoji @'+e+'" emoji="'+e+'"'+(t?' title="'+t+'"':"")+"></i>":'<img class="emoji" src="'+a+"/emoji/e/"+e+(window.devicePixelRatio>=2?"_2x":"")+'.png"'+(t?' alt="'+t+'"':"")+">"}function Gd(e){return Vd(function(e){return encodeURIComponent(e.replace(/\uFE0F/giu,"")).replace(/%/gi,"").toLowerCase()}(e),xo(e).replace(/[\u00A0-\u9999<>\&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"})),{enabled:!0})}function Hd(e){var t=e.onVolumeLevelReached,n=e.needCheckMicEnabled,r=e.vectorLength,i=e.volumeLevelDetection,a=e.callbackFactorStep,o=e.sensitivityCoefficient,s=e.onVolumeLevelUpdated,c=e.debugCallback,u=function(e){var t=[],n=0;return function(r){if(t.push(r),n+=r,t.length>e){var i=t.shift();n-=i||0}return n/t.length}}(r),l=0,d=!1;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];c&&c(e);var p=e[0],h=e[1],f=p>i;d!==f&&s&&s(f),d=f,0!==l&&h&&(l=0);var m=u(p);n&&h||p/m>(1+l)/o&&p>i&&(l+=a,t())}}function Wd(e,t){var n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every((function(e){return t[e]}))}function zd(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Kd(e){p.j.setItem("calls_token",e)}function Qd(e){var t=p.j.getItem("calls_token");return t?Promise.resolve(t):Eu(e).then(e=>e.token)}var qd=function(){return(qd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Jd={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function Yd(e){switch(e){case oa.WAITING:return 1;case oa.CONNECTING:return 2;case oa.CONNECTED:return 3;default:return 0}}var $d,Zd=function(){return Jd},Xd=function(e){var t,n;Jd=qd(qd(qd({},Jd),e),{connectionStep:(t=e.connectionStep,n=Jd.connectionStep,t&&Yd(t)&&Yd(t)>Yd(n)?t:n)})},ep=function(){Jd={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function tp(e){$d=e}function np(e,t,n,r){var i,a,o,s=Zd(),c=s.startType,u=s.entryPoint,l=s.timeStart,d=s.isGroupCall,p=s.hadVideoEnabled,h=s.isOutgoingCall,f=!e||e===Ea&&!n,m={type:c&&function(e,t,n){var r;r=e===ia.VIDEO?t?Qi.d.GROUP_VIDEO:Qi.d.VIDEO:n?t?Qi.d.GROUP_AUDIO_TO_VIDEO:Qi.d.AUDIO_TO_VIDEO:t?Qi.d.GROUP_AUDIO:Qi.d.AUDIO;return r}(c,d,p),result:f?Qi.e.SUCCESS:Qi.e.FAIL,failReason:f?null:rp(e,n),callSource:u,totalDuration:l?Date.now()-l:0};h&&(r&&console.log(m),i=t,o=[(a=m).type||"",a.result,a.failReason||"",a.callSource||"",a.totalDuration],$d&&$d({name:"call_stats",value:i,keys:o}))}function rp(e,t){var n=Zd().isOutgoingCall,r=Zd().connectionStep;switch(!0){case t:return Qi.b.CONNECTION_LOST;case e===ga:return Qi.b.LOCAL_DECLINE;case e===wa:return Qi.b.REMOTE_DECLINE;case e===ma:return Qi.b.REMOTE_BUSY;case e===Sa:return n?Qi.b.REMOTE_TIMEOUT:null;case r===oa.CONNECTING:return Qi.b.REMOTE_FAILED_ACCEPT;case!r:return Qi.b.REMOTE_NO_CONNECT;default:return null}}function ip(e,t,n){void 0===t&&(t=!0);var r="";return e&&t?r=n("calls_error_no_cam_and_mic"):e?r=n("calls_error_no_cam"):t&&(r=n("calls_error_no_mic")),r}function ap(e,t){var n;return((n={})[ea.CAMERA_PERMISSION]=t("calls_error_no_cam"),n[ea.MIC_PERMISSION]=t("calls_error_no_mic"),n[ea.CAMERA_ACCESS]=t("calls_error_cameralock"),n[ea.MIC_ACCESS]=t("calls_error_miclock"),n[ea.MIC_NOT_FOUND]=t("calls_error_nomic"),n[ea.SCREEN_PERMISSION]=t("calls_error_screenpermission"),n[ea.SCREEN_ACCESS]=t("calls_error_screenlock"),n)[e]}function op(e,t){return"/video"+e+"_"+t}var sp=function(){return(sp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},cp=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function up(e,t,n,r,i,a){var o,s,c,u,l,d,h,f,m=r.dispatch,v=r.getState(),_=v.me,g=3,A=!1,y=as(hp,ss.bind(null,dp.bind(null,t,e,r))),E=as(t.joinCallByLink,ss.bind(null,dp.bind(null,t,e,r))),S={apiKey:n.key,apiEnv:n.is_dev?"VIDEOTEST":"PROD",anonymToken:n.is_anonym?n.token:"",voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},allowMissingMic:!0,domain:a?"vk_corp":void 0,unifiedPlanInterop:!1,consumerScreenDataChannel:!0,singleSession:!0,producerNotificationDataChannel:!0,producerCommandDataChannel:!0,producerScreenDataChannel:!0,preferVP9:!0,videoMaxHeight:v.localVideoResolution===Ki.SD?qi.SD:qi.HD,videoMaxWidth:v.localVideoResolution===Ki.SD?Ji.SD:Ji.HD,debugLog:v.config.debugLog,onDemandTracks:!0,onLocalStream:function(t,n){e.debug&&console.warn("onLocalStream",t,n),Uu(m,_,{stream:t,mediaSettings:n}),Xd({hadVideoEnabled:n.isVideoEnabled})},onLocalStreamUpdate:function(t,n){e.debug&&console.warn("onLocalStreamUpdate",t,n);var i=r.getState(),a=i.participants[_],o=a.mediaSettings,s=a.permissions;Uu(m,_,{mediaSettings:t,permissions:{audio:(null==o?void 0:o.isAudioEnabled)&&!t.isAudioEnabled?Math.max(s.audio-1,$i.DENY):s.audio,video:(null==o?void 0:o.isVideoEnabled)&&!t.isVideoEnabled?Math.max(s.video-1,$i.DENY):s.video,screenSharing:(null==o?void 0:o.isScreenSharingEnabled)&&!t.isScreenSharingEnabled?Math.max(s.screenSharing-1,$i.DENY):s.screenSharing}}),t.isScreenSharingEnabled!==(null==o?void 0:o.isScreenSharingEnabled)&&(gp(i,m,t.isScreenSharingEnabled,_),t.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),Xd({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:function(t,n){e.debug&&console.warn("onRemoteStream",t.id,n),Uu(m,t.id,{stream:n})},onConversation:function(t){if(e.debug&&console.warn("onConversation",t),!r.getState().callData.ts){var n=Date.now();m({type:"time_start",data:n})}var i=r.getState().peer;0!==i&&Yl(0,m,i)},onRemoteMediaSettings:function(t,n){var i,a;e.debug&&console.warn("onRemoteMediaSettings",t.id,n);var o=+t.id,s=r.getState(),c=null===(a=null===(i=s.participants[o])||void 0===i?void 0:i.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled;n.isScreenSharingEnabled!==c&&gp(s,m,n.isScreenSharingEnabled,o,!0),Uu(m,o,{mediaSettings:n}),Xd({hadVideoEnabled:n.isVideoEnabled})},onParticipantStatus:function(t,n,i){var a=+t.id,o=r.getState(),s=n;if(e.debug&&console.warn("onParticipantStatus",a,s,i),!o.participants[a]||!o.participants[a].mediaSettings){m({type:"load_peer",members:[{peerId:a,mediaSettings:{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},isAnonym:"ANONYM"===t.type}]});var c=[a],u=o.callData.callId||"",l={withConversation:!r.getState().callData.conversation,awaitImages:!0};!function(e,t,n,r,i,a){var o;(o=$l.acc).push.apply(o,i),$l.timer&&clearTimeout($l.timer),$l.timer=window.setTimeout((function(){var i=$l.acc;$l.acc=[],Zl(e,t,n,r,i,a).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),Vi(zt.ERROR,e),console.error(e)}))}),$l.timeout)}(o,m,e,u,c,l)}if(Uu(m,a,{status:s,statusData:i}),Xd({connectionStep:s}),a===o.peer){var d=function(e,t){var n={call_event_type:e,session_id:o.callData.callId,peer_id:o.peer,is_group_call:!1};t&&(n.reason=t),Ya.logEvent(n)};if(s===oa.CONNECTED){if(d(Qi.a.CALL_CONNECTED),!o.participants[o.peer].wasConnected&&uo(o.participants[o.me])){var p=Zd().startType;d(Qi.a.OUTGOING_CALL_ACCEPTED_REMOTELY,null==p?void 0:p.toString())}}else s===oa.WAITING&&d(Qi.a.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:function(n){if(e.debug&&console.warn("onPermissionsError",n),r.getState().mode===ra.CALL){switch(n){case ea.CAMERA_PERMISSION:case ea.CAMERA_ACCESS:t.toggleLocalVideo(!1);break;case ea.MIC_ACCESS:case ea.MIC_NOT_FOUND:t.toggleLocalAudio(!1);break;case ea.SCREEN_PERMISSION:case ea.SCREEN_ACCESS:t.captureScreen(!1)}m({type:pa,text:ap(n,i)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t){e.debug&&console.warn("onRemoteRemoved",t.id),m({type:"remove_user",participantId:+t.id})},onCallState:function(t,n,i){e.debug&&console.warn("onCallState",t,n,i);var a=i.id,o=i.direction;if(!a||!r.getState().callData.callId){if(m({type:"call_state",callData:{callId:a}}),!r.getState().peer){var s=Object.keys(r.getState().participants||{}).map((function(e){return Number(e)}));s.length&&Zl(v,m,e,a,s,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!0})}!Qa(r.getState().peer||0)||"JOINING"!==o&&"OUTGOING"!==o||Ya.logEvent({call_event_type:Qi.a.CALL_CONNECTED,session_id:a,peer_id:r.getState().peer||0,is_group_call:!0})}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(t){var n=t.id;e.debug&&console.warn("onSpeakerChanged",n),m({type:"set_orator",orator:+n})},onJoinStatus:function(t,n){e.debug&&console.warn("onJoinStatus",t,n)},onHangup:function(t,n){var i=t.hangup;e.debug&&console.warn("onHangup",i,n);var a=i&&![ga,Sa,Ea,Oa].includes(i),o=i&&i===Ea,s=Qa(r.getState().peer);if(r.getState().mode===ra.CALL&&a)m({type:"hangup",data:i}),Fo(2,null).finally((function(){m({type:la,mode:ra.READY})}));else if(v.config.showFeedbackScreen&&o){var c=r.getState().callData.ts,u=(c?Math.floor((Date.now()-c)/1e3):0)>10&&0===Math.floor(3*Math.random()),l=0===Math.floor(5*Math.random());s&&u||l?(m({type:"management",isOpen:!1}),m({type:la,mode:ra.FEEDBACK})):m({type:la,mode:ra.READY})}else m({type:la,mode:ra.READY});e.isInActiveCall=!1;var d=function(e){return!!Object.values(e.participants).find(e=>e.status===oa.RECONNECT)}(r.getState());if(np(i,n=n||"",d,e.debug),!d&&!s){var p="none";i===vt.MISSED?p="timeout":i===vt.BUSY&&(p="busy");var h={call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:r.getState().callData.callId,peer_id:r.getState().peer,is_group_call:!1,reason:p};Ya.logEvent(h)}ep()},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),Qa(r.getState().peer)&&Ya.logEvent({call_event_type:Qi.a.CALL_CONNECTED,session_id:r.getState().callData.callId,peer_id:r.getState().peer,is_group_call:Qa(r.getState().peer)})},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(dp(t,e,r),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(t){e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(o={onUpdate:function(e){m({type:"set_speakers",data:e})},volumeLevelDetection:.25,debugCallback:function(){e.debug}},s=o.onUpdate,c=o.volumeLevelDetection,u=o.debugCallback,l={},d=[],h={},f=[],function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];u&&u(e);var n=e[0];h=Object.keys(h).reduce((function(e,t){return h[t]-1>0&&(e[t]=h[t]-1),e}),{});var r=n.reduce((function(e,t){var n=t.uid.id;return t.volume>c&&(e[n]=!0,h[n]=3),e}),{});f=Object.keys(h);var i=!1,a={speakers:null,speakersInHeader:null};Wd(l,r)||(a.speakers=r,l=r,i=!0),zd(d,f)||(a.speakersInHeader=f,d=f,i=!0),i&&s(a)}),onLocalVolume:Hd({onVolumeLevelReached:function(){var e=r.getState();m({type:"call_notification",notification:{type:sa.SPEAKING_ON_MUTE}}),Ya.logEvent({call_event_type:Qi.a.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Qa(e.peer)})},onVolumeLevelUpdated:function(e){var t,n=null===(t=r.getState().participants[_].mediaSettings)||void 0===t?void 0:t.isAudioEnabled,i=r.getState().speakers,a=Object.assign({},i);e&&n?a[_]=!0:e||delete a[_],a[_]!==i[_]&&m({type:"set_speakers",data:{speakers:a}})},needCheckMicEnabled:!0,volumeLevelDetection:.25,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(t,n,r){e.debug&&console.warn("onChatMessage",t,n,r)},onCustomData:function(t,n){e.debug&&console.warn("onCustomData",t,n)},onNetworkStatus:function(n){var i=r.getState();if(e.debug&&console.warn("onNetworkStatus",n),!n){var a=r.getState().participants[_].mediaSettings,o=!!(null==a?void 0:a.isScreenSharingEnabled),s=!!(null==a?void 0:a.isVideoEnabled);A||!s||o||g--,g>0||A||o||!s?m({type:"call_notification",notification:{type:sa.BAD_NETWORK_CONNECTION}}):(A=!0,t.toggleLocalVideo(!1).catch((function(t){e.eventHandlers.onError&&e.eventHandlers.onError(t),Vi(zt.ERROR,t),console.error(t)})),m({type:"call_notification",notification:{type:sa.BAD_NETWORK_CONNECTION_DISABLE_CAMERA}}),Ya.logEvent({call_event_type:Qi.a.VIDEO_DISABLED,session_id:i.callData.callId,peer_id:i.peer,is_group_call:Qa(i.peer),reason:"lowBandwidth"}),Ya.logEvent({call_event_type:Qi.a.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT,session_id:i.callData.callId,peer_id:i.peer,is_group_call:Qa(i.peer)}))}},onDebugMessage:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e.debug&&console.warn.apply(console,cp(["onDebugMessage",t],n))},onRemoteParticipantState:function(t,n){var i,a,o;e.debug&&console.warn("onRemoteParticipantState",t,n);var s=function(e){return e.hand?sp(sp({},e),{hand:e.hand===ca.RAISED}):e}(n),c=t.id,u=!!(null===(a=null===(i=r.getState().participants[c])||void 0===i?void 0:i.statusData)||void 0===a?void 0:a.hand),l=!!(null===(o=r.getState().participants[c])||void 0===o?void 0:o.name);Uu(m,c,{statusData:s}),(null==s?void 0:s.hand)&&!u&&l&&m({type:"call_notification",notification:{type:sa.RAISED_HAND,data:c}})},onRolesChanged:function(t,n){e.debug&&console.warn("onRolesChanged",t,n);var i=r.getState().participants[t.id];n.includes(Hi.ADMIN)&&i&&m({type:"call_notification",notification:{type:sa.USER_GRANTED_WITH_ADMIN_ROLE,data:t.id}}),Uu(m,t.id,{roles:n})},onLocalRolesChanged:function(t){e.debug&&console.warn("onLocalRolesChanged",t),(t.includes(Hi.ADMIN)||t.includes(Hi.CREATOR))&&Uu(m,_,{permissions:{audio:$i.ALLOW,video:$i.ALLOW,screenSharing:$i.ALLOW}}),Uu(m,_,{permissions:{audio:$i.ALLOW,video:$i.ALLOW,screenSharing:$i.ALLOW}}),t.includes(Hi.ADMIN)&&m({type:"call_notification",notification:{type:sa.ADMIN_ROLE_GRANTED}}),m({type:"change_participant_roles",participantId:_,data:t})},onDeviceSwitched:function(t,n){e.debug&&console.warn("onDeviceSwitched",t,n)},onUnmutePermission:function(t){e.debug&&console.warn("onUnmutePermission",t);var n=r.getState(),i=n.participants[_],a=n.popup;if(t||"unmute_request"!==a||m({type:da}),!co(i)&&!uo(i)){var o=i.permissions,s=o.audio,c=o.video,u=o.screenSharing;s===$i.DENY&&c===$i.DENY&&u===$i.DENY||m({type:"call_notification",notification:{type:t?sa.ADMIN_MUTE:sa.ADMIN_MUTE_PERMANENT}}),Uu(m,_,{permissions:{audio:t?$i.ALLOW:$i.DENY,video:t?$i.ALLOW:$i.DENY,screenSharing:t?$i.ALLOW:$i.DENY}}),t&&Ya.logEvent({call_event_type:Qi.a.MIC_OFF_WHILE_TALKING_ENABLE_CLICK,session_id:n.callData.callId,peer_id:n.peer,is_group_call:Qa(n.peer)})}},onUnmuteRequest:function(n){var i;if(e.debug&&console.warn("onUnmuteRequest",n),n!==Wi.VIDEO){var a=r.getState(),o=a.participants[a.me],s=o.permissions,c=s.audio,u=s.video,l=s.screenSharing,d=fo(o),p=!!(null===(i=o.statusData)||void 0===i?void 0:i.hand);p&&t.changeParticipantState({hand:ca.LOWERED}).catch(console.log),Uu(m,_,sp({permissions:{audio:d?$i.ONCE:c,video:d?$i.ONCE:u,screenSharing:d?$i.ONCE:l}},p&&{statusData:sp(sp({},o.statusData),{hand:!1})})),m({type:da,data:"unmute_request"})}},onRecordStarted:function(t,n,r,i,a,o){e.debug&&console.warn("onRecordStarted",t,n,r,i);var s={isOn:!0,videoId:parseInt(a),ownerId:parseInt(o),host:t,startTime:r,link:"https://"+window.location.host+op(o,a),startStreamParams:void 0};m({type:"set_translation",data:s})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),m({type:"set_translation",data:{isOn:!1,hasPermission:!1}})},onLocalPin:function(t){var n;e.debug&&console.warn("onLocalPin",{unpin:t});var i=r.getState(),a=i.participants[_];t||m({type:"call_notification",notification:{type:sa.PINNED_BY_ADMIN}}),!t&&fo(a)&&Uu(m,_,{permissions:{audio:$i.ONCE,video:$i.ONCE,screenSharing:$i.ONCE}}),t||(null===(n=a.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||m({type:da,data:"admin_pin_unmute_request"}),t||i.isOratorMode||m({type:"toggle_orator_mode",isOratorMode:!0}),m({type:"set_admin_pinned_participant",data:t?null:_})},onPinnedParticipant:function(t,n){e.debug&&console.warn("onPinnedParticipant",t,n);var i=r.getState(),a=i.participants[t.id];!n&&a&&((null==a?void 0:a.shortName)||(null==a?void 0:a.name))&&m({type:"call_notification",notification:{type:sa.USER_PINNED_BY_ADMIN,data:t.id}}),i.isOratorMode||m({type:"toggle_orator_mode",isOratorMode:!0}),m({type:"set_admin_pinned_participant",data:n?null:Number(t.id)})},onOptionsChanged:function(t){e.debug&&console.warn("onOptionsChanged",t),m({type:"set_conversation_options",data:t})}};e.authorized=!1,e.debugMessage=Vi,e.call=function(e,t,n,r,i){var a=r.dispatch;return function(o,s,c,u){return e.isInActiveCall?Promise.reject(Xi.ALREADY_IN_CALL).catch(lp):(e.isInActiveCall=!0,Promise.resolve().then((function(){a({type:ha,isLoaderVisible:!0})})).then((function(){return pp(e)})).then((function(){return Pc(t,s)})).then((function(){return fp(r,o,c)})).then((function(n){return Promise.all([zl(n),i(e,t,r,s,o)])})).then((function(){a({type:ha,isLoaderVisible:!1}),a({type:la,mode:ra.CALL,peerId:o}),Xd({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:u,startType:s?ia.VIDEO:ia.AUDIO}),Ya.logEvent({call_event_type:s?Qi.a.OUTGOING_CALL_STARTED_VIDEO:Qi.a.OUTGOING_CALL_STARTED_AUDIO,session_id:r.getState().callData.callId,peer_id:o,is_group_call:!1,source:u,group_call_users_count:2}),mp(r,o,c)})).catch((function(r){e.isInActiveCall=!1,a({type:ha,isLoaderVisible:!1}),_p(r,t,e,Qa(o),s,n,a)})))}}(e,t,i,r,y),e.startGroupCall=function(e,t,n,r,i){var a=r.dispatch;return function(o,s,c,u,l,d){void 0===d&&(d=!0);var p=c?c.filter(za):[];return e.debug&&c&&c.length!==p.length&&console.warn("Some ids cannot get into the call.",c.filter((function(e){return!za(e)}))),e.isInActiveCall?Promise.reject(Xi.ALREADY_IN_CALL).catch(lp):(e.isInActiveCall=!0,Promise.resolve().then((function(){a({type:ha,isLoaderVisible:!0})})).then((function(){return pp(e)})).then((function(){return Pc(t,u)})).then((function(){return fp(r,o,s)})).then((function(e){return ql(r.getState(),a,o,e[0])})).then((function(){return i(e,t,r,u,o)})).then((function(){a({type:ha,isLoaderVisible:!1}),a({type:la,mode:ra.CALL,peerId:o}),d&&(p&&p.length?a({type:"group_call_setup",open:!0,peerId:o,preselectedIds:p}):a({type:"management",isOpen:!0})),mp(r,o,s),Xd({timeStart:Date.now(),isOutgoingCall:!0,startType:u?ia.VIDEO:ia.AUDIO,entryPoint:l,isGroupCall:!0}),Ya.logEvent({call_event_type:u?Qi.a.OUTGOING_CALL_STARTED_VIDEO:Qi.a.OUTGOING_CALL_STARTED_AUDIO,session_id:r.getState().callData.callId,peer_id:o,is_group_call:!0,source:l,group_call_users_count:1})})).catch((function(r){e.isInActiveCall=!1,a({type:ha,isLoaderVisible:!1}),_p(r,t,e,Qa(o),u,n,a)})))}}(e,t,i,r,y),e.startCall=function(e,t,n,r,i){var a=r.dispatch;return function(o,s,c){if(void 0===c&&(c=!0),e.isInActiveCall)return Promise.reject(Xi.ALREADY_IN_CALL).catch(lp);e.isInActiveCall=!0;var u={peerId:0,canAddMembers:!0,tab:n("calls_new_call_title"),photo:"https://vk.com/images/call_convo_stub.png"};return Promise.resolve().then((function(){a({type:ha,isLoaderVisible:!0})})).then((function(){return pp(e)})).then((function(){return Pc(t,o)})).then((function(){return Promise.all([i(e,t,r,o),zl([u])])})).then((function(){a({type:ha,isLoaderVisible:!1}),a({type:"load_peer",conversation:u,members:[],peerId:0}),a({type:la,mode:ra.CALL}),c&&a({type:"management",isOpen:!0}),Xd({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:o?ia.VIDEO:ia.AUDIO,isGroupCall:!0}),Ya.logEvent({call_event_type:o?Qi.a.OUTGOING_CALL_STARTED_VIDEO:Qi.a.OUTGOING_CALL_STARTED_AUDIO,session_id:r.getState().callData.callId,peer_id:0,is_group_call:!0,source:s,group_call_users_count:1})})).catch((function(r){e.isInActiveCall=!1,a({type:ha,isLoaderVisible:!1}),_p(r,t,e,!0,o,n,a)}))}}(e,t,i,r,y),e.joinCallByLink=function(e,t,n,r,i){var a=r.dispatch;return function(o,s,c,u){return void 0===c&&(c=!1),e.isInActiveCall?Promise.reject(Xi.ALREADY_IN_CALL).catch(lp):(e.isInActiveCall=!0,$a(r.getState().me)?Promise.resolve().then((function(){a({type:ha,isLoaderVisible:!0})})).then((function(){return pp(e)})).then((function(){return Pc(t,c)})).then((function(){return i(o,c).then((function(){a({type:ha,isLoaderVisible:!1}),a({type:la,mode:ra.CALL})}))})).catch((function(r){e.isInActiveCall=!1,a({type:ha,isLoaderVisible:!1}),_p(r,t,e,Qa(0),c,n,a)})):Promise.resolve().then((function(){a({type:ha,isLoaderVisible:!0})})).then((function(){return pp(e)})).then((function(){return Pc(t,c)})).then((function(){return i(o,c).then((function(e){var t,n=e.id;return(t=[n],Vi(zt.DEBUG,{type:"request",method:"messages.getConversationsByCall",data:{call_ids:t,fields:mu}}),Object(hu.a)()(pu.a)("messages.getConversationsByCall",{call_ids:t,fields:mu}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getConversationsByCall",data:e}),e}))).then((function(e){var t=e.items[0].peer.id;return fp(r,t,s).then((function(e){return zl(e)})).then((function(){return t}))}))}))})).then((function(e){a({type:ha,isLoaderVisible:!1}),a({type:la,mode:ra.CALL,peerId:e}),mp(r,e,s),Ya.logEvent({call_event_type:Qi.a.GROUP_CALL_JOINED,session_id:r.getState().callData.callId,peer_id:e,is_group_call:!0,source:u,group_call_users_count:Xo(r.getState()).length})})).catch((function(r){e.isInActiveCall=!1,a({type:ha,isLoaderVisible:!1}),_p(r,t,e,Qa(0),c,n,a)})))}}(e,t,i,r,E),e.showJoinPopup=function(e,t,n){var r=n.dispatch;return function(i,a){var o=n.getState().mode;return o===ra.CALL||o===ra.INCOMING?Promise.reject(Xi.ALREADY_IN_CALL).catch((function(){r({type:pa,text:t("calls_already_in_call_error")})})):(r({type:ha,isLoaderVisible:!0}),Su(i).then(ls.bind(null,t)).then((function(e){r({type:ha,isLoaderVisible:!1}),r({type:"join",data:sp(sp({},e),{entryPoint:a})})})).catch((function(n){var i;e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.warn("getJoinLinkDetails",n);var a=ns(null===(i=null==n?void 0:n.error)||void 0===i?void 0:i.error_code,!0,t);console.error(a),r({type:ha,isLoaderVisible:!1}),r({type:pa,text:a,handleType:Zi.FATAL})})))}}(e,i,r),e.acceptCall=function(e,t,n,r){var i=r.dispatch;return function(a,o){var s=r.getState(),c=s.peer,u=s.callData;return Pc(t,a,o).then((function(){return t.acceptCall(a)})).then((function(t){var n=t.acceptTime;i({type:la,mode:ra.CALL,ts:n}),e.isInActiveCall=!0,Ya.logEvent({call_event_type:Qi.a.INCOMING_CALL_ACCEPTED,session_id:u.callId,peer_id:c,is_group_call:Qa(c),reason:a?ia.VIDEO:ia.AUDIO})})).catch((function(t){i({type:pa,text:ip(a,!0,n),handleType:Zi.DECLINE}),e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),Vi(zt.ERROR,t),console.error(t)}))}}(e,t,i,r);var b=n.token?Promise.resolve(n.token):Qd(n.is_dev),C=function(n){return Promise.resolve().then((function(){return $a(r.getState().me)?Promise.resolve():t.authorize(n).then((function(){return Kd(n)})).then((function(){return e.authorized=!0})).catch((function(e){throw p.j.removeItem("calls_token"),e}))}))};return b.then((function(n){return t.init(S).then((function(){v.config.debugLog&&e.setDebug(!0)})).then((function(){return C(n)}))}))}function lp(e){switch(e){case Xi.ALREADY_IN_CALL:console.log("Already in call");break;default:console.log(e)}}function dp(e,t,n){return function(e,t,n){return Eu(n.getState().isDev).then((function(n){var r=n.token;return e.authorize(r).then((function(){return Kd(r)})).then((function(){return t.authorized=!0}))}))}(e,t,n).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function pp(e){return new Promise((function(t){e.initializing.finally((function(){t()}))}))}function hp(e,t,n,r,i,a){void 0===i&&(i=0),void 0===a&&(a=[]);var o=function(e,t){return JSON.stringify({is_video:t,chat_id:Ka(e)?e-2e9:void 0,with_join_link:Qa(e),join_by_link:Qa(e)})}(i,r);if(!i)return t.call(void 0,r,o,!0);if(!Qa(i))return function e(t,n,r){var i=n.getState();if(!i.ipSettingEnabled||"all"===i.privacySettings.callsIp)return Promise.resolve(!1);if(Ka(r))return Promise.resolve(!0);if(t.isFriend)return Promise.resolve(!t.isFriend(r));if(Object.keys(i.friendsCache).length>0)return Promise.resolve(!i.friendsCache[r]);return os(Ql)(t,i,n.dispatch).then((function(){return e(t,n,r)}))}(e,n,i).then((function(e){return t.forceRelayPolicy(e),t.call(i.toString(),r,o)}));var s=a.filter((function(e){return za(e=Number(e))&&e!==n.getState().me}));return t.call(s,r,o,!0)}function fp(e,t,n){var r=e.dispatch;return!!n||t?(n?Promise.resolve(Jo(n)):yu(t).then(Yo)).then((function(e){var n=e[0],i=e[1],a=e[2];return ed(r,a||n),r({type:"load_peer",conversation:n,members:i,peerId:t}),e})):Promise.reject("Cannot load data")}function mp(e,t,n){var r=e.dispatch;return!!n&&t?yu(t).then((function(e){var t=Yo(e),n=t[0],i=t[1];return ed(r,e.items[0]),zl([n,i])})).then((function(e){var t=e[0],n=e[1];r({type:"load_peer",conversation:t,members:n})})):Promise.resolve()}function vp(e,t,n){switch(!0){case function(e){var t=e||{},n=t.hangup,r=t.message;return!(!n||!r)}(e):case function(e){var t=e||{},n=t.hangup;return t.message&&void 0===n}(e):return rs(e.message,t,n);case function(e){var t;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null===(t=null==e?void 0:e.__proto__)||void 0===t?void 0:t.name)}(e):return n("calls_error");case function(e){return!!e.error_msg}(e):return rs(e.error_msg,t,n);case function(e){return"number"==typeof e}(e):return function(e,t,n){return n("calls_sorry_error")}(0,0,n);case function(e){return!!e}(e):default:return n("calls_sorry_error")}}function _p(e,t,n,r,i,a,o){var s,c;try{var u=vp(e,r,a);t.hangup(),n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),Vi(zt.ERROR,e),console.error(e),o({type:pa,text:u}),(null===(s=n.eventHandlers)||void 0===s?void 0:s.onErrorStartCall)&&(null===(c=n.eventHandlers)||void 0===c||c.onErrorStartCall())}catch(n){throw Vi(zt.ERROR,n),console.error(n),t.hangup(),e}}function gp(e,t,n,r,i){var a=Object.keys(e.screenSharers).filter((function(t){return e.screenSharers[t]})).length,o=function(n,r){var i=function(e){t({type:"toggle_orator_mode",isOratorMode:e})},a=function(e){t({type:"set_pinned_participant",pinnedParticipant:e})};n?e.isOratorMode||i(!0):e.screenSharingNeedDisableOratorModeAfterStop&&i(!1),t({type:"set_screen_sharing_pinned_participant",screenSharingPinnedParticipant:r,screenSharingNeedDisableOratorModeAfterStop:!e.isOratorMode,screenSharingOldPinnedParticipant:e.pinnedParticipant}),r?e.pinnedParticipant&&a(null):!e.pinnedParticipant&&e.screenSharingOldPinnedParticipant&&a(e.screenSharingOldPinnedParticipant)};0===a&&n?o(!0,r):1!==a||n||o(!(!e.adminPinnedParticipant&&!e.pinnedParticipant),null),t({type:"set_screen_sharer",participantId:r,isScreenSharingEnabled:n}),n&&i&&t({type:"call_notification",notification:{type:sa.SCREEN_SHARING_STARTED,data:r}})}var Ap=function(e){var t=e.isAnonym,n=e.joinLink,r=e.vkJoinLink,i=e.title,a=e.members,o=e.membersCount,s=e.conversationData,c=e.withPopup,d=e.onBeforeCallStart,p=e.onAfterCallFinish,h=e.onClose,f=e.bridge,m=e.entryPoint,v=e.tabIsMaster,_=e.tabIsIdle,g=e.onError,A=e.isDev,y=e.okPublicKey,E=l.a.useContext(To),S=E.getLang,b=E.langNumeric,C=Object(u.useState)(""),w=C[0],O=C[1],T=Object(u.useState)(null),I=T[0],P=T[1],R=Object(u.useState)(!1),D=R[0],k=R[1],N=!1,F=a?a.slice(0,3).map((function(e){var t=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:t,key:e.peerId}:{id:e.peerId,text:t.slice(0,1)}})):[],L=Object(u.useCallback)((function(e){O(e.target.value)}),[]),M=Object(u.useCallback)((function(e){if(t)return N?Promise.resolve():(N=!0,function(e,t,n,r,i,a){if(e)return Promise.resolve(e);return Su(n,!0).then((function(e){var o=e.secret,s=void 0===o?"":o,c=e.user_id,u=void 0===c?0:c,l=e.preview;return function(e,t,n,r){return Vi(zt.DEBUG,{type:"request",method:"messages.getAnonymCallToken",data:{link:e,user_id:t,name:n,secret:r,device_id:"anyId"}}),Object(hu.a)(!1)(pu.a)("messages.getAnonymCallToken",{link:e,user_id:t,name:n,secret:r,device_id:"anyId"}).then((function(e){return Vi(zt.DEBUG,{type:"response",method:"messages.getAnonymCallToken",data:e}),e}))}(n,u,r,s).then((function(e){var n=e.token,o=e.secret,s=void 0===o?"":o,c={is_dev:yp(a),key:i,token:n,ok_user:u,secret:s,is_anonym:!0,me:{canAddMembers:!1,firstName:r,peerId:u,id:u,sex:0,shortName:r,name:r,lastName:"",link:"",photo:"",photo_100:""}},d={callPreview:{tab:l.title,photo:l.photo.photo_200},callsCredentials:c,participantLimit:128,callsOkStaging:yp(a),callsLogging:!1,CallsIncomingCall:!1,callsAllowBanParticipant:!1,callsFeedbackScreenEnabled:!1};return t(d),d}))}))}(I,P,r,w,y,A).then((function(e){return function(e){var t=e.bridge,n=e.inited,r=e.setInited,i=e.data,a=e.onBeforeCallStart,o=e.onAfterCallFinish,s=e.tabIsMaster,c=e.tabIsIdle,u=e.langUtils;if(n)return Promise.resolve();var l=i.callPreview,d=i.callsCredentials,p=i.participantLimit,h=i.callsOkStaging,f=i.callsLogging,m=i.CallsIncomingCall,v=i.callsAllowBanParticipant,_=i.callsFeedbackScreenEnabled;return t.init({callPreview:l,callsCredentials:d,imHash:"",participantLimit:p,callsOkStaging:h,onBeforeCallStart:a,onAfterCallFinish:o,tabIsMaster:s,tabIsIdle:c,langUtils:u,toggles:{debugLog:f,incomingCall:m,allowBanParticipant:v,showFeedbackScreen:_}}).then((function(){return r(!0)}))}({bridge:f,inited:D,setInited:k,data:e,onBeforeCallStart:d,onAfterCallFinish:p,tabIsMaster:v,tabIsIdle:_,langUtils:E})})).then((function(){return f.joinCallByLink(n,null,e,m)})).catch((function(e){f.eventHandlers.onError&&e&&f.eventHandlers.onError(e);var t="";t="string"==typeof e?e:e&&e.error&&e.error.error_code?ns(e.error.error_code,!0,S):vp(e,!0,S)||S("calls_unknown_error"),g&&g(t)})).finally((function(){N=!1})));if(h&&h(),!s)throw Error("no peer_id to join");return f.joinCallByLink(n,[s,a],e,m).catch((function(e){var t="";t="string"==typeof e?e:e&&e.error&&e.error.error_code?ns(e.error.error_code,!0,S):S("calls_unknown_error"),g&&g(t)})),Promise.resolve()}),[n,h,w,I,D,y]),j=Object(u.useCallback)((function(){h&&h()}),[h]),x=Object(u.useMemo)((function(){var e=/\u{1F3F4}(?:\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074})\u{E007F}|\u{200D}\u{2620}\u{FE0F}?)|\u{1F469}\u{200D}\u{1F469}\u{200D}(?:\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}])|\u{1F468}(?:\u{200D}(?:\u{2764}\u{FE0F}?\u{200D}(?:\u{1F48B}\u{200D})?\u{1F468}|[\u{1F468}\u{1F469}]\u{200D}(?:\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}])|\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u{200D}(?:\u{2764}\u{FE0F}?\u{200D}(?:\u{1F48B}\u{200D}[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u{200D}\u{1F466}\u{200D}\u{1F466}|(?:\u{1F441}\u{FE0F}?\u{200D}\u{1F5E8}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2695}\u{2696}\u{2708}]|\u{1F468}(?:[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2695}\u{2696}\u{2708}]|\u{200D}[\u{2695}\u{2696}\u{2708}])|(?:[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}]\u{FE0F}?|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u{200D}[\u{2640}\u{2642}]|[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2640}\u{2642}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}](?:[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2640}\u{2642}]|\u{200D}[\u{2640}\u{2642}])|\u{1F469}\u{200D}[\u{2695}\u{2696}\u{2708}])\u{FE0F}?|\u{1F469}\u{200D}\u{1F467}\u{200D}[\u{1F466}\u{1F467}]|\u{1F469}\u{200D}\u{1F469}\u{200D}[\u{1F466}\u{1F467}]|\u{1F468}(?:\u{200D}(?:[\u{1F468}\u{1F469}]\u{200D}[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|[\u{1F3FB}-\u{1F3FF}])|\u{1F3F3}\u{FE0F}?\u{200D}\u{1F308}|\u{1F469}\u{200D}\u{1F467}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}]|\u{1F469}\u{200D}\u{1F466}|\u{1F1F6}\u{1F1E6}|\u{1F1FD}\u{1F1F0}|\u{1F1F4}\u{1F1F2}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|[#\*0-9]\u{FE0F}?\u{20E3}|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]|[\u{261D}\u{270A}-\u{270D}\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F470}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F4AA}\u{1F574}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91D}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F936}\u{1F9B5}\u{1F9B6}\u{1F9D1}-\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u{231A}\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25FD}\u{25FE}\u{2614}\u{2615}\u{2648}-\u{2653}\u{267F}\u{2693}\u{26A1}\u{26AA}\u{26AB}\u{26BD}\u{26BE}\u{26C4}\u{26C5}\u{26CE}\u{26D4}\u{26EA}\u{26F2}\u{26F3}\u{26F5}\u{26FA}\u{26FD}\u{2705}\u{270A}\u{270B}\u{2728}\u{274C}\u{274E}\u{2753}-\u{2755}\u{2757}\u{2795}-\u{2797}\u{27B0}\u{27BF}\u{2B1B}\u{2B1C}\u{2B50}\u{2B55}\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]|[\xA9\xAE\u{203C}\u{2049}\u{2122}\u{2139}\u{2194}-\u{2199}\u{21A9}\u{21AA}\u{231A}\u{231B}\u{2328}\u{23CF}\u{23E9}-\u{23F3}\u{23F8}-\u{23FA}\u{24C2}\u{25AA}\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2600}-\u{2604}\u{260E}\u{2611}\u{2614}\u{2615}\u{2618}\u{261D}\u{2620}\u{2622}\u{2623}\u{2626}\u{262A}\u{262E}\u{262F}\u{2638}-\u{263A}\u{2648}-\u{2653}\u{265F}\u{2660}\u{2663}\u{2665}\u{2666}\u{2668}\u{267B}\u{267E}\u{267F}\u{2692}-\u{2697}\u{2699}\u{269B}\u{269C}\u{26A0}\u{26A1}\u{26AA}\u{26AB}\u{26B0}\u{26B1}\u{26BD}\u{26BE}\u{26C4}\u{26C5}\u{26C8}\u{26CE}\u{26CF}\u{26D1}\u{26D3}\u{26D4}\u{26E9}\u{26EA}\u{26F0}-\u{26F5}\u{26F7}-\u{26FA}\u{26FD}\u{2702}\u{2705}\u{2708}-\u{270D}\u{270F}\u{2712}\u{2714}\u{2716}\u{271D}\u{2721}\u{2728}\u{2733}\u{2734}\u{2744}\u{2747}\u{274C}\u{274E}\u{2753}-\u{2755}\u{2757}\u{2763}\u{2764}\u{2795}-\u{2797}\u{27A1}\u{27B0}\u{27BF}\u{2934}\u{2935}\u{2B05}-\u{2B07}\u{2B1B}\u{2B1C}\u{2B50}\u{2B55}\u{3030}\u{303D}\u{3297}\u{3299}\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]\u{FE0F}?|[\u{261D}\u{26F9}\u{270A}-\u{270D}\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F469}\u{1F46E}\u{1F470}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9D1}-\u{1F9DD}]/gu;return xo(Bo(i)).replace(e,Gd)}),[i]),B=l.a.createElement(Ud,{isAnonym:t,name:w,onChangeName:L,namePlaceholder:S("calls_name_placeholder"),title:x,label:cs(a||[],F,(function(e){return e.firstName}),S,b,o),items:F,joinWithVideoText:S("calls_join_with_video"),joinWithAudioText:S("calls_join_with_audio"),onJoinWithVideo:function(){return M(!0)},onJoinWithAudio:function(){return M(!1)},disabled:t&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(w),inputDisabled:!!I});return c?l.a.createElement(Po.default,{onClose:j},l.a.createElement(zu.a,{appearance:"blue",title:S("calls_invite"),onClose:j}),B):B},yp=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var Ep,Sp=function(e){var t=e.children;return l.a.createElement("div",{className:"ErrorPopupText"},t)},bp=function(e){var t=e.title,n=e.onClose,r=e.actionButtons,i=e.text;return l.a.createElement(Pd.default,{appearance:"blue",title:t,onClose:n,actionButtons:r,className:"CallError"},l.a.createElement(Sp,null,i))},Cp=function(e){var t=e.title,n=e.text,r=e.onCloseFatal,i=e.handleType,a=e.callId,o=e.bridge,s=Object(h.d)(),c=l.a.useContext(To).getLang,u=function(){switch(s({type:pa,isClosed:!0}),i){case Zi.FATAL:r();break;case Zi.DECLINE:$r().catch((function(){}));break;case Zi.PROCESS:Qr(a||"").then((function(){$r().catch((function(){}))})).catch((function(e){o.debug&&console.error("Delayed by error push process error",e)}))}},d=n||c("calls_error"),p=d.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?l.a.createElement("span",{dangerouslySetInnerHTML:{__html:d}}):d;return l.a.createElement(bp,{title:t||c("calls_oops"),onClose:u,actionButtons:l.a.createElement(Ol.a,{onClick:u},c("calls_close")),text:p})},wp=function(e){var t=e.onClose,n=e.actionButtons,r=l.a.useContext(To).getLang;return l.a.createElement(Pd.default,{onClose:t,title:r("calls_exit_menu"),appearance:"blue",actionButtons:n,className:"CallExitModal"},l.a.createElement("div",{className:"CallExitModal__text"},r("calls_sure_leave_call")))},Op=function(e){var t=e.SDK,n=Object(h.e)((function(e){return e})),r=Object(h.d)(),i=l.a.useContext(To).getLang,a=function(){return Ya.logEvent({call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:n.callData.callId,peer_id:n.peer,is_group_call:Qa(n.peer),reason:"none",group_call_users_count:ro(n)})},o=Object(u.useCallback)((function(){r({type:da})}),[]);return l.a.createElement(wp,{onClose:o,actionButtons:[l.a.createElement(Ol.a,{onClick:function(){r({type:da}),a(),rd(0,n,r,i)},key:"forceCallFinish",appearance:"secondary"},i("calls_force_call_finish")),l.a.createElement(Ol.a,{onClick:function(){return r({type:da}),a(),t.hangup()},key:"leave"},i("calls_leave_call"))]})};!function(e){e.CONTAIN="cn",e.COVER="cv"}(Ep||(Ep={}));function Tp(e,t,n){return e.uiMode===aa.COLLAPSED?function(e){var t=es(e),n=to(e,t);return no(e).reduce((function(e,t){var r=t.peerId,i=t.mediaSettings;return r===(null==n?void 0:n.peerId)&&(null==i?void 0:i.isVideoEnabled)?e.set(t.peerId,{fit:Ep.CONTAIN,width:265,height:200,priority:2,uid:Za(n)}):e.set(t.peerId,{fit:Ep.CONTAIN,width:0,height:0,priority:-1,uid:Za(t)}),e}),new Map)}(e):e.isOratorMode?function(e,t,n){var r=e.adminPinnedParticipant||e.screenSharingPinnedParticipant||e.pinnedParticipant||e.orator||e.me;return no(e).reduce((function(i,a){var o=a.peerId,s=a.mediaSettings;if(r===o&&(null==s?void 0:s.isVideoEnabled)){var c=e.uiMode===aa.FULLSCREEN,u={fit:Ep.CONTAIN,width:c?t:900,height:c?n:504,priority:3,uid:Za(a),keyFrame:null==s?void 0:s.isScreenSharingEnabled};i.set(a.peerId,u)}else(null==s?void 0:s.isVideoEnabled)&&!1!==e.visibleParticipants[a.peerId]?i.set(a.peerId,{fit:(null==s?void 0:s.isScreenSharingEnabled)?Ep.CONTAIN:Ep.COVER,width:140,height:140,priority:1,uid:Za(a)}):i.set(a.peerId,{fit:Ep.COVER,width:0,height:0,priority:-1,uid:Za(a)});return i}),new Map)}(e,t,n):function(e,t,n){var r=e.uiMode===aa.FULLSCREEN,i=r?t:900,a=r?n:504,o=no(e),s=function(e,t,n){switch(n){case 1:return t;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(t/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(t/3);default:return Math.round(e/6)}}(i,a,o.length),c=s<200?1:2;return o.reduce((function(t,n){var r,i=Za(n);return i?((null===(r=n.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)&&!1!==e.visibleParticipants[n.peerId]?t.set(n.peerId,{fit:Ep.COVER,width:s,height:s,priority:c,uid:i}):t.set(n.peerId,{fit:Ep.COVER,width:0,height:0,priority:-1,uid:i}),t):t}),new Map)}(e,t,n)}var Ip=function(e,t){var n=Object(u.useState)([0,0]),r=n[0],i=r[0],a=r[1],o=n[1],s=Object(u.useCallback)(Object(p.k)(Pp,1e3),[]),c=Object(u.useRef)(new Map),l=Object(u.useRef)([]);Object(u.useEffect)((function(){var e=function(){return o([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(u.useEffect)((function(){if(t.mode===ra.CALL){var n=Tp(t,i,a),r=function(e,t){var n=[];return t.forEach((function(t,r){var i,a,o=e.get(r);o&&(a=t,(i=o).fit===a.fit&&i.width===a.width&&i.height==i.height&&i.priority===a.priority)||n.push(t)})),n}(c.current,n);r.length>0&&s(e,t,r,c,n,l)}}),[i,a,t.participants,t.mode,t.visibleParticipants,t.uiMode,t.isOratorMode,t.orator,t.pinnedParticipant,t.screenSharingPinnedParticipant])};function Pp(e,t,n,r,i,a){if(t.mode!==ra.CALL)return r.current=new Map,void(a.current=[]);a.current=n,r.current=i,e.updateDisplayLayout(n)}var Rp,Dp=function(e){var t=e.isIncoming,n=void 0!==t&&t,r=Object(h.e)((function(e){return e})),i=Object(h.d)(),a=Object(u.useContext)(To).getLang,o=a(n?"calls_reject_title":"calls_hangup_description"),s=a(n?"calls_reject_description":"calls_hangup_description"),c=Object(u.useCallback)((function(){i({type:"show_caution_box",isOpen:!1})}),[]);return l.a.createElement(bp,{title:o,onClose:c,actionButtons:l.a.createElement(l.a.Fragment,null,l.a.createElement(Ol.a,{onClick:function(){c(),n?$r().catch((function(){})):(ti().catch((function(){})),Ya.logEvent({call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:r.callData.callId,peer_id:r.peer,is_group_call:Qa(r.peer),reason:"none",group_call_users_count:Xo(r).length}))}},a("calls_yes")),l.a.createElement(Ol.a,{onClick:c},a("calls_no"))),text:l.a.createElement("span",{dangerouslySetInnerHTML:{__html:s}})})},kp=n("wQFj"),Np=function(e){var t=e.onClose,n=e.onUnmuteToggle,r=e.allowUnmute,i=e.unmuteToggleDisabled,a=e.actionButtons,o=e.title,s=e.description,c=e.toggleSign;return l.a.createElement(Pd.default,{className:"MuteParticipantModal",appearance:"blue",title:o,actionButtons:a,onClose:t},l.a.createElement("div",{className:"MuteParticipantModal__content"},s,l.a.createElement(kp.default,{className:"MuteParticipantModal__checkbox",onChange:n,checked:r,disabled:i},c)))},Fp=function(e){var t,n,r,i,a,o=e.SDK,s=Object(h.e)((function(e){return e})),c=Object(u.useState)(!0),d=c[0],p=c[1],f=Object(u.useState)(null),m=f[0],v=f[1],_=Object(u.useState)(!0),g=_[0],A=_[1],y=Object(h.d)(),E=l.a.useContext(To).getLang,S=null===(t=s.participantsManagement)||void 0===t?void 0:t.mode,b=null===(n=s.participantsManagement)||void 0===n?void 0:n.participant,C=S===Yi.SINGLE&&(co(b)||uo(b));Object(u.useEffect)((function(){var e;if(S!==Yi.SINGLE||$a((null==b?void 0:b.peerId)||0))p(!1);else{y({type:ha,isLoaderVisible:!0});var t=null===(e=s.participantsManagement)||void 0===e?void 0:e.participant;bu({user_ids:t&&String(t.peerId),name_case:"acc"}).then((function(e){var t=e[0];v(t),p(!1)})).then((function(){y({type:ha,isLoaderVisible:!1})})).catch(console.log)}}),[S,null===(r=s.participantsManagement)||void 0===r?void 0:r.participant]);var w=Object(u.useCallback)((function(){y({type:"toggle_participants_management"})}),[]),O=Object(u.useCallback)((function(){if(S===Yi.SINGLE){var e=Za(b);o.muteParticipant(e,[Wi.AUDIO,Wi.VIDEO],!g).catch(console.log).finally(w),Ya.logEvent({call_event_type:Qi.a.USER_MICS_AND_VIDEO_DISABLED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:Qa(s.peer),mute_permanent:g?Qi.c.ONCE:Qi.c.PERMANENT})}else S===Yi.ALL&&(o.muteParticipant(void 0,[Wi.AUDIO,Wi.VIDEO],!g).catch(console.log).finally(w),Ya.logEvent({call_event_type:Qi.a.ALL_MICS_AND_VIDEO_DISABLED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:Qa(s.peer),mute_permanent:g?Qi.c.ONCE:Qi.c.PERMANENT}))}),[g]);return S===Yi.SINGLE&&d?null:l.a.createElement(Np,{onClose:w,allowUnmute:g,unmuteToggleDisabled:C,onUnmuteToggle:function(e,t){return A(t)},title:S===Yi.SINGLE?E("calls_mute_participant_dialog_title").replace("{name}",null!==(i=null==m?void 0:m.first_name)&&void 0!==i?i:null==b?void 0:b.name):E("calls_mute_all_participants_dialog_title"),description:S===Yi.SINGLE?E("calls_mute_participant_dialog_description").replace("{name}",null!==(a=null==m?void 0:m.first_name)&&void 0!==a?a:null==b?void 0:b.name):E("calls_mute_all_participants_dialog_description"),toggleSign:S===Yi.SINGLE?E("calls_mute_participant_dialog_permanent_toggle"):E("calls_mute_all_participants_dialog_permanent_toggle"),actionButtons:[l.a.createElement(Ol.a,{onClick:w,appearance:"secondary",key:"cancel"},E("calls_cancel")),l.a.createElement(Ol.a,{onClick:O,key:"disable"},E("calls_mute_participant_dialog_action"))]})},Lp=function(e){var t=e.onClose,n=e.actionButtons,r=e.title,i=e.description;return l.a.createElement(Pd.default,{className:"UnmuteRequestModal",appearance:"blue",title:r,actionButtons:n,onClose:t},l.a.createElement("div",{className:"UnmuteRequestModal__content"},i))},Mp=function(e){var t=e.SDK,n=Object(h.d)(),r=l.a.useContext(To).getLang,i=Object(h.e)((function(e){return e})),a=i.participants[i.me],o=a.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},s=function(){n({type:da})},c=function(){var e=a.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(o.isAudioEnabled?Promise.resolve():Pc(t,!1,!0)).then((function(){var e;(null===(e=i.notification)||void 0===e?void 0:e.type)===sa.SPEAKING_ON_MUTE&&n({type:"call_notification",notification:null}),t.toggleLocalAudio(!0).catch(console.log)}))};return l.a.createElement(Lp,{onClose:s,title:r("calls_dialog_unmute_request_title"),description:r("calls_dialog_unmute_request_description"),actionButtons:[l.a.createElement(Ol.a,{onClick:function(){c(),s()},appearance:"secondary",key:"mic"},r("calls_dialog_unmute_request_mic_only_action")),l.a.createElement(Ol.a,{onClick:function(){var e;c(),(null==(e=a.mediaSettings)?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!o.isVideoEnabled||o.isScreenSharingEnabled?Pc(t,!0,!1):Promise.resolve()).then((function(){t.toggleLocalVideo(!0).catch(console.log)})),s()},key:"all"},r("calls_dialog_unmute_request_action"))]})},jp=function(e){var t=e.title,n=e.description,r=e.onClose,i=e.actionButtons;return l.a.createElement(Pd.default,{className:"AssignAdminModal",appearance:"blue",title:t,actionButtons:i,onClose:r},l.a.createElement("div",{className:"AssignAdminModal__content"},n))},xp=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},Bp=function(e){var t=e.SDK,n=Object(h.e)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),r=Object(h.e)((function(e){return e})),i=Object(h.d)(),a=Object(u.useState)(!0),o=a[0],s=a[1],c=Object(u.useState)(null),d=c[0],p=c[1],f=l.a.useContext(To).getLang;Object(u.useEffect)((function(){i({type:ha,isLoaderVisible:!0}),bu({user_ids:n&&String(n.peerId),name_case:"dat"}).then((function(e){var t=e[0];p(t),s(!1)})).then((function(){i({type:ha,isLoaderVisible:!1})})).catch(console.log)}),[n]);var m=Object(u.useCallback)((function(){i({type:"toggle_admin_assignment"})}),[]),v=Object(u.useCallback)((function(){var e=Za(n);e?(t.grantRoles(e,[Hi.ADMIN],!1).then((function(){n&&i({type:"change_participant_roles",participantId:n.peerId,data:n.roles?xp(xp([],n.roles),[Hi.ADMIN]):[Hi.ADMIN]})})).catch(console.log),Ya.logEvent({call_event_type:Qi.a.ASSIGN_ADMIN,session_id:r.callData.callId,peer_id:r.peer,is_group_call:Qa(r.peer)}),m()):m()}),[]);return o?null:l.a.createElement(jp,{onClose:m,title:f("calls_dialog_assign_admin_role_title"),description:f("calls_dialog_assign_admin_role_description").replace("{name}",(null==d?void 0:d.first_name)+" "+(null==d?void 0:d.last_name)),actionButtons:[l.a.createElement(Ol.a,{onClick:m,appearance:"secondary",key:"cancel"},f("calls_dialog_assign_admin_role_action_later")),l.a.createElement(Ol.a,{onClick:v,key:"primary"},f("calls_dialog_assign_admin_role_action_primary"))]})},Up=n("QDnf"),Vp="wakeLock"in navigator&&!0,Gp=null,Hp=!1,Wp=function(){null!==Gp&&"visible"===document.visibilityState&&Kp()},zp=function(){var e,t,n,r;Rp||((Rp=document.createElement("video")).setAttribute("title","Wake lock"),Rp.setAttribute("playsinline",""),e=Rp,t="mp4",n="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(r=document.createElement("source")).src=n,r.type="video/"+t,e.appendChild(r),Rp.addEventListener("loadedmetadata",(function(){Rp&&Rp.addEventListener("timeupdate",(function(){Rp&&Rp.currentTime>.5&&(Rp.currentTime=Math.random())}))}))),Rp.play().catch((function(){}))};function Kp(){if(!Vp)return zp();Hp||(Hp=!0,document.addEventListener("visibilitychange",Wp));try{navigator.wakeLock.request("screen").then((function(e){(Gp=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function Qp(){Vp?Gp&&Gp.release().then((function(){Gp=null})):Rp&&Rp.pause()}var qp=n("s1Gz");function Jp(e){var t=e.onClose,n=e.onSubmit,r=e.title,i=e.children,a=e.isWithBackButton,o=e.onBackClick,s=e.contentClassName,c=void 0===s?"TranslationCreateModal__content":s,u=l.a.useContext(To).getLang,d=n&&t;return l.a.createElement(Po.default,{disableBodyScroll:!0,onClose:t,className:"TranslationCreateModal",hasScroll:!1},l.a.createElement(zu.a,{title:r,onClose:t,appearance:"blue",backText:a?u("calls_back"):void 0,onBack:o}),l.a.createElement("div",{className:c},i),d&&l.a.createElement(Ku.a,{actionButtons:l.a.createElement(l.a.Fragment,null,l.a.createElement(Ol.a,{onClick:t,appearance:"tertiary"},u("calls_cancel")),l.a.createElement(Ol.a,{onClick:n},u("calls_translation_start")))}))}var Yp,$p,Zp=function(){return(Zp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Xp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},eh=function(e){var t=Xp(e,[]);return l.a.createElement("svg",Zp({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{d:"M4 9.6c0-.56 0-.84.109-1.054a1 1 0 01.437-.437C4.76 8 5.04 8 5.6 8h8.8c.56 0 .84 0 1.054.109a1 1 0 01.437.437C16 8.76 16 9.04 16 9.6v4.8c0 .56 0 .84-.109 1.054a1 1 0 01-.437.437C15.24 16 14.96 16 14.4 16H5.6c-.56 0-.84 0-1.054-.109a1 1 0 01-.437-.437C4 15.24 4 14.96 4 14.4V9.6z",fill:"#fff"}),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2 6a2.2 2.2 0 00-4.4 0v4a2.2 2.2 0 104.4-.001V6zM10 2a4 4 0 00-4 4v4a4 4 0 108-.001V6A4 4 0 0010 2z",fill:"#fff"}))},th=function(){return(th=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},nh=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},rh=function(e){var t=nh(e,[]);return l.a.createElement("svg",th({width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),l.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.8 8a6.2 6.2 0 1112.4 0A6.2 6.2 0 011.8 8zM0 8a8 8 0 1116 0A8 8 0 010 8zm8.9-3a.9.9 0 00-1.8 0v4a.9.9 0 00.498.805l2 1a.9.9 0 10.804-1.61L8.9 8.444V5z",fill:"#fff"}))},ih=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function ah(e){var t=e.onSubmit,n=e.onClose,r=Object(u.useContext)(To),i=r.getLang,a=r.langShortDateTime,o=Object(h.e)((function(e){return e})),s=function(){var e=(new Date).toISOString().split("T")[0];return i("calls_translation_title_default_value").replace("%s",e)},c=function(e,t,n){return{id:e,name:t,photo:n,isGroup:e<0}},d=function(e){var t=[{value:Yp.ONLY_ME,label:i("calls_translation_privacy_only_me_and_chat")},{value:Yp.FRIENDS,label:i("calls_translation_privacy_friends_and_chat")}];return e&&t.push({value:Yp.ALL,label:i("calls_translation_privacy_all_users")}),t},p=function(e){return e.participants[e.me]}(o),f=Object(u.useState)(s()),m=f[0],v=f[1],_=Object(u.useState)(""),g=_[0],A=_[1],y=Object(u.useState)(Yp.ONLY_ME),E=y[0],S=y[1],b=Object(u.useState)((function(){return d(!p.isClosed)})),C=b[0],w=b[1],O=Object(u.useState)(c(p.peerId,p.name,p.photo)),T=O[0],I=O[1],P=Object(u.useState)($p.MAIN),R=P[0],D=P[1],k=Object(u.useState)({}),N=k[0],F=k[1],L=Object(u.useState)([{value:p.peerId,label:p.name}]),M=L[0],j=L[1],x=Object(u.useState)([]),B=x[0],U=x[1],V=Object(u.useState)(!1),G=V[0],H=V[1],W=Object(u.useState)([]),z=W[0],K=W[1],Q=Object(u.useState)([]),q=Q[0],J=Q[1],Y=function(e){var t,n,r;e.owner_id>0&&(t=e.owner_id,n=[e.owner_id+"_"+e.id],r=!0,Object(hu.a)()(pu.a)("video.get",{owner_id:t,videos:n,need_privacy:r})).then((function(t){if(t.count>0){var n=t.items.filter((function(t){return t.id==e.id}));n.length>0&&(e.privacy_view=n[0].privacy_view,F(e),e.privacy_view&&S(e.privacy_view.category))}})),F(e),D($p.MAIN),v(e.title),A(e.description)},$=Object(u.useCallback)((function(){var e=m.trim(),n=g.trim(),r={};if(Object.keys(N).length>0){e||(e=N.title),n||(n=N.description);var i=n!=N.title||e!=N.description;i||(i=T.id>0&&N.privacy_view.category!=E),i&&function(e,t,n,r,i){return Object(hu.a)()(pu.a)("video.edit",{owner_id:e,video_id:t,name:n,desc:r,privacy_view:i})}(T.id,N.id,e,n,E).catch((function(e){return console.error(e)}));var a={ovId:N.ov_id};N.live_start_time&&(a.startTime=N.live_start_time),r.upcomingStreamParams=a}else r.streamParams={name:e||s(),description:n,privacy_view:E,group_id:T.id<0?-T.id:0,call:!0};t(r)}),[m,g,E,T,N]);Object(u.useEffect)((function(){Object(hu.a)()(pu.a)("groups.get",{fields:vu,filter:"admin",extended:!0}).then((function(e){var t=ih([],M);e.count>0&&(e.items.forEach((function(e){e.can_upload_video&&t.push({value:-e.id,label:e.name})})),j(t),U(e.items))})).catch((function(e){return console.error(e)}))}),[]),Object(u.useEffect)((function(){var e;F({}),H(!1),K([]),(e=[T.id],Object(hu.a)()(pu.a)("video.getUpcomingLives",{owner_ids:e})).then((function(e){var t=[];e.count>0&&(t=e.items.filter((function(e){return""!==e.ov_id})));var n=t.length>0;if(H(n),K(t),n){var r=[];t.forEach((function(e){e.owner_id&&e.owner_id>0&&r.push(e.owner_id.toString())})),r&&bu({user_ids:r.join(",")}).then((function(e){var t=[];e.forEach((function(e){t.push({id:e.id,name:e.first_name+" "+e.last_name})})),J(t)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[T]);var Z=function(e){var t=e.date;e.live_start_time&&(t=e.live_start_time);var n=t-Date.now()/1e3;return n>0&&n<604800?i("calls_translation_date_label_soon"):""};return l.a.createElement(l.a.Fragment,null,R===$p.MAIN&&l.a.createElement(Jp,{onClose:n,onSubmit:$,title:i("calls_translation_box_title")},l.a.createElement("div",{className:"TranslationCreateForm__link"},l.a.createElement(qu.a,null,M.length>0&&l.a.createElement(Ju.default,{border:!0,canBeHovered:!1,selectable:!1,icon:l.a.createElement(Yu,{icon:l.a.createElement("img",{className:"TranslationCreateForm__ownerIcon",src:T.photo,alt:T.name}),color:Wu.GRAY}),aside:l.a.createElement(Ed.default,{className:"TranslationCreateFormOptions__longselect",options:M,value:T.id,onChange:function(e){var t=e.selected.value;t<0?B.forEach((function(e){e.id==-t&&(S(Yp.ALL),w(d(!0)),I(c(-e.id,e.name,e.photo_100)))})):(w(d(!p.isClosed)),S(Yp.ONLY_ME),I(c(p.peerId,p.name,p.photo)))}})},i("calls_translation_owner_title")),l.a.createElement(Ju.default,{className:G?"":"TranslationCreateForm__selectUpcoming--disabled",canBeHovered:G,selectable:G,onClick:function(){G&&D($p.SELECT_POSTPONE)},chevron:!0,border:!0,icon:l.a.createElement(Yu,{icon:l.a.createElement(rh,null),color:Wu.GREEN})},i("calls_translation_postponed_title"),Object.keys(N).length>0&&l.a.createElement("div",{className:"TranslationCreateForm__copyControl"},l.a.createElement(tl.a,{className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),F({}),v(s()),A("")}},i("calls_translation_postponed_reset")))),l.a.createElement(Ju.default,{border:!1,canBeHovered:!1,selectable:!1,icon:l.a.createElement(Yu,{icon:l.a.createElement(eh,null),color:Wu.GRAY}),aside:l.a.createElement(Ed.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:T.isGroup,options:C,value:E,onChange:function(e){S(e.selected.value)}})},i("calls_translation_who_can_see_video_privacy"))),l.a.createElement("div",{className:"TranslationCreateForm__privacyHint"},i("calls_translation_who_can_see_video_privacy_hint"))),l.a.createElement("form",{className:"TranslationCreateForm__main",onSubmit:$},l.a.createElement("div",{className:"TranslationCreateForm__section"},l.a.createElement("div",{className:"TranslationCreateForm__block"},l.a.createElement("label",{className:"TranslationCreateForm__label"},i("calls_translation_title"),l.a.createElement(al.default,{className:"TranslationCreateForm__field",value:m,onChange:function(e){var t=e.target;v(t.value)},placeholder:i("calls_translation_name_placeholder")}))),l.a.createElement("div",{className:"TranslationCreateForm__block"},l.a.createElement("label",{className:"TranslationCreateForm__label"},i("calls_translation_description"),l.a.createElement(qp.default,{className:"TranslationCreateForm__field",placeholder:i("calls_translation_description_placeholder"),value:g,onChange:function(e){var t=e.target;A(t.value)}})))),l.a.createElement("div",{className:"TranslationCreateForm__tabSection"},l.a.createElement("div",{className:"TranslationCreateForm__warning"},i("calls_translation_notification_warning"))))),R===$p.SELECT_POSTPONE&&l.a.createElement(Jp,{title:i("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return D($p.MAIN)},onClose:n,contentClassName:"TranslationCreateForm__modalVideo"},l.a.createElement("div",null,z.length>0&&l.a.createElement(qu.a,{className:"TranslationCreateForm__VideoList"},z.map((function(e,t){return l.a.createElement(Ju.default,{className:"TranslationCreateForm__videoItem",active:e.id===N,key:t,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return Y(e)},aside:l.a.createElement("span",{className:"TranslationCreateForm__videoLink"},i("calls_translation_select_video_link"))},l.a.createElement("div",{className:"TranslationCreateForm__videoImagePreview"},l.a.createElement("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title}),Z(e)&&l.a.createElement("span",{className:"TranslationCreateForm__videoImageLabel"},Z(e))),l.a.createElement("div",{className:"TranslationCreateForm__videoDescription"},l.a.createElement("div",{className:"TranslationCreateForm__videoTitle"},e.title),l.a.createElement("div",{className:"TranslationCreateForm__videoOwner"},function(e){if(!(e>0))return T.name;var t=q.filter((function(t){return t.id==e}));if(t.length>0){var n=t[0];if(n)return n.name}return""}(e.owner_id)),l.a.createElement("div",{className:"TranslationCreateForm__videoDate"},(r=(n=e).date,n.live_start_time&&(r=n.live_start_time),a(1e3*r)))));var n,r}))))))}function oh(){var e,t,n,r,i,a=Object(h.e)((function(e){return e})),o=Object(h.d)(),s=l.a.useContext(To).getLang,c=Object(u.useCallback)((function(){o({type:da})}),[]),d=!!(null===(t=null===(e=a.translation)||void 0===e?void 0:e.host)||void 0===t?void 0:t.id)&&+(null===(r=null===(n=a.translation)||void 0===n?void 0:n.host)||void 0===r?void 0:r.id)===a.me,p=Object(u.useCallback)((function(){o({type:da,data:"translation_stop"})}),[]),f=Object(u.useCallback)((function(e){if(null==e?void 0:e.upcomingStreamParams){var t=e.upcomingStreamParams,n=t.startTime,r=t.ovId;if(n&&n>Date.now()/1e3+4)return td(r).finally(c)}return o({type:"set_translation",data:{isOn:!1,startStreamParams:e}}),o({type:da,data:"translation_start_countdown"}),Promise.resolve()}),[]),m=Object(u.useCallback)((function(){o({type:da,data:"translation_stop_share"})}),[]);return(null===(i=a.translation)||void 0===i?void 0:i.isOn)?l.a.createElement(Qu,{title:s("calls_translation_menu_title"),actionButtons:d?[l.a.createElement(Ol.a,{onClick:p,appearance:"negative",key:"stop"},s("calls_translation_menu_stop"))]:[],onCloseModal:c},l.a.createElement(il,{isLinkBlockShown:!0,linkBlockTitle:s("calls_translation_menu_link"),onLinkBlockClick:m,callUrlLink:a.translation.link})):l.a.createElement(ah,{onSubmit:f,onClose:c})}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(Yp||(Yp={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}($p||($p={}));var sh=function(e){var t=e.onClose,n=e.actionButtons,r=l.a.useContext(To).getLang;return l.a.createElement(Pd.default,{onClose:t,title:r("calls_translation_stop_confirmation"),appearance:"blue",actionButtons:n,className:"TranslationStopModal"},l.a.createElement("div",{className:"TranslationStopModal__text"},r("calls_translation_stop_sure")))},ch=function(){var e=Object(h.d)(),t=l.a.useContext(To).getLang,n=Object(u.useCallback)((function(){e({type:da})}),[]);return l.a.createElement(sh,{onClose:n,actionButtons:[l.a.createElement(Ol.a,{onClick:n,appearance:"secondary",key:"cancel"},t("calls_cancel")),l.a.createElement(Ol.a,{onClick:function(){wu().then((function(){e({type:da})}))},key:"stop"},t("calls_translation_stop"))]})},uh=function(e){var t=e.link,n=l.a.useContext(To).getLang,r=Object(u.useState)(!1),i=r[0],a=r[1],o=Object(u.useCallback)((function(){return a(!0)}),[]),s=Object(u.useCallback)((function(){return a(!1)}),[]);return l.a.createElement("div",{className:"TranslationLink"},l.a.createElement("p",{className:"TranslationLink__info"},n("calls_translation_link_info")),l.a.createElement(al.default,{readOnly:"readonly",className:"TranslationLink__input",value:t}),l.a.createElement(el,{text:t,onCopyDone:o},l.a.createElement(Ol.a,null,n("calls_translation_link_copy"))),l.a.createElement(nl.default,{className:"TranslationLink__copied",shown:i,callback:s},n("calls_translation_link_copied")))},lh=function(e){var t=e.onBack,n=e.link,r=Object(h.d)(),i=l.a.useContext(To).getLang,a=Object(u.useCallback)((function(){r({type:da})}),[]);return l.a.createElement(Qu,{title:i("calls_translation_link"),onCloseModal:a,isWithBackButton:!!t,onBackClick:t},l.a.createElement(uh,{link:n}))},dh=function(e){var t=e.onClose,n=e.actionButtons,r=e.title,i=e.description;return l.a.createElement(Pd.default,{className:"AdminPinUnmuteRequestModal",appearance:"blue",title:r,actionButtons:n,onClose:t},l.a.createElement("div",{className:"AdminPinUnmuteRequestModal__content"},i))},ph=function(e){var t=e.SDK,n=Object(h.d)(),r=l.a.useContext(To).getLang,i=Object(h.e)((function(e){return e})),a=i.participants[i.me].mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},o=function(){n({type:da})};return l.a.createElement(dh,{onClose:o,title:r("calls_admin_pin_dialog_title"),description:r("calls_admin_pin_dialog_description"),actionButtons:[l.a.createElement(Ol.a,{onClick:o,appearance:"secondary",key:"cancel"},r("calls_admin_pin_dialog_cancel")),l.a.createElement(Ol.a,{onClick:function(){(a.isAudioEnabled?Promise.resolve():Pc(t,!1,!0)).then((function(){var e;(null===(e=i.notification)||void 0===e?void 0:e.type)===sa.SPEAKING_ON_MUTE&&n({type:"call_notification",notification:null}),t.toggleLocalAudio(!0).catch(console.log)})).then((function(){return o()}))},key:"mic"},r("calls_admin_pin_dialog_action"))]})},hh=function(e){var t=e.participants,n=e.selected,r=e.onSelect,i=e.onClose,a=e.onCallForceFinish,o=e.onRightsTransfer,s=e.onSearch,c=Object(u.useContext)(To).getLang,d=Object(h.e)((function(e){return e.me}));return l.a.createElement(Po.default,{className:"TransferAdminRightsModal",disableBodyScroll:!1,onClose:i},l.a.createElement(zu.a,{title:c("calls_dialog_creator_exit_title"),onClose:i,appearance:"blue"}),l.a.createElement("div",{className:"TransferAdminRightsModal__content"},l.a.createElement(al.default,{onChange:function(e){return s(e.target.value)},placeholder:c("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"}),l.a.createElement(qu.a,{border:!1},l.a.createElement(ll,{extra:t.length},c("calls_call_participants")),0===t.filter((function(e){return e.peerId!==d})).length&&l.a.createElement(hs.default,null,c("calls_participants_not_found")),t.filter((function(e){return e.peerId!==d})).map((function(e){return l.a.createElement(Ju.default,{key:e.peerId,className:"TransferAdminRightsModal__item",onClick:function(){return r(n!==e.peerId?e:null)},aside:l.a.createElement("span",{className:"TransferAdminRightsModal__label","aria-selected":n===e.peerId},n===e.peerId?c("calls_dialog_creator_exit_selected"):c("calls_dialog_creator_exit_select"))},l.a.createElement(pl.a,{size:"34",title:e.name,photo:e.photo}))})))),l.a.createElement(Ku.a,{actionButtons:[l.a.createElement(Ol.a,{key:"force",appearance:"secondary",onClick:a},c("calls_force_call_finish")),l.a.createElement(Ol.a,{key:"action",onClick:o},c(null===n?"calls_leave_call":"calls_dialog_creator_exit_action"))]}))},fh=function(e){var t=e.SDK,n=Object(h.d)(),r=Object(h.e)((function(e){return e})),i=l.a.useContext(To).getLang,a=Object(u.useState)(Object.values(r.participants).filter((function(e){return e.peerId===r.me||e.status===oa.CONNECTED&&!$a(e.peerId)}))),o=a[0],s=a[1],c=Object(u.useState)(null),d=c[0],p=c[1],f=Object(u.useCallback)((function(e){return e.name}),[]),m=Object(u.useCallback)((function(e){return e.peerId}),[]),v=Do(o,f,m),_=function(){return Ya.logEvent({call_event_type:Qi.a.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:r.callData.callId,peer_id:r.peer,is_group_call:Qa(r.peer),reason:"none",group_call_users_count:ro(r)})},g=Object(u.useCallback)((function(e){s(e?v.search(e):v.list),p(null)}),[r]),A=function(){n({type:da})},y=function(){n({type:da}),_(),t.hangup().catch(console.log)},E=Object(u.useCallback)((function(e){p(null===e?null:e.peerId)}),[]);return Object(u.useEffect)((function(){d&&!o.find((function(e){return e.peerId===d}))&&p(null)}),[d]),l.a.createElement(hh,{participants:o,onClose:A,onSelect:E,selected:d,onCallForceFinish:function(){n({type:da}),_(),t.hangup(),rd(0,r,n,i)},onRightsTransfer:function(){if(null!==d){var e=Za(r.participants[d]);e&&(t.grantRoles(e,[Hi.ADMIN],!1).then((function(){return y()})).catch(console.log),A())}else y()},onSearch:g})},mh=function(e){var t=e.onCloseModal,n=e.counter,r=e.onStopTranslation,i=l.a.useContext(To).getLang;return l.a.createElement(Po.default,{disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:t},l.a.createElement("div",{className:"TranslationStartCountdownModal__content"},l.a.createElement("div",{className:"TranslationStartCountdownModal__counter"},n),l.a.createElement(Ol.a,{className:"TranslationStartCountdownModal__stop",onClick:r,appearance:"overlay_secondary"},i("calls_translation_cancel_button"))))};function vh(){var e=Object(h.d)(),t=Object(h.e)((function(e){return e})),n=Object(u.useState)(3),r=n[0],i=n[1],a=Object(u.useCallback)((function(){e({type:da})}),[]),o=Object(u.useCallback)((function(){var e,n=null===(e=t.translation)||void 0===e?void 0:e.startTime;n&&n>=Date.now()&&wu(),a()}),[]);return Object(u.useEffect)((function(){var e=setInterval((function(){return i(r-1)}),1e3);return function(){return clearInterval(e)}}),[r]),Object(u.useEffect)((function(){var e;if(r<=0){var n=null===(e=t.translation)||void 0===e?void 0:e.startStreamParams;(null==n?void 0:n.streamParams)?nd(n.streamParams):(null==n?void 0:n.upcomingStreamParams)&&td(n.upcomingStreamParams.ovId),a()}}),[r]),l.a.createElement(mh,{onCloseModal:a,counter:r,onStopTranslation:o})}var _h,gh=function(e){var t=e.onClose,n=e.actionButtons,r=e.onAllowReconnectChange,i=e.description,a=e.allowBan,o=Object(u.useContext)(To).getLang,s=Object(u.useContext)(Wa).allowBanParticipant,c=Object(u.useState)(!0),d=c[0],p=c[1],h=Object(u.useCallback)((function(e,t){r&&r(t),p(t)}),[]);return l.a.createElement(Pd.default,{className:"KickParticipantModal",appearance:"blue",title:o("calls_kick_participant_title"),actionButtons:n,onClose:t,hasScroll:!1},l.a.createElement("div",{className:"KickParticipantModal__content"},i,s&&a&&l.a.createElement("div",null,l.a.createElement(kp.default,{className:"KickParticipantModal__checkbox",onChange:h,checked:d},o("calls_kick_participant_with_ban_setting")))))},Ah=function(){var e,t,n=Object(h.d)(),r=l.a.useContext(To),i=r.getLang,a=r.langSex,o=Object(h.e)((function(e){return e})),s=null===(e=o.participantKick)||void 0===e?void 0:e.participant,c=Object(u.useState)(!0),d=c[0],p=c[1],f=!!s&&(!ho(s)&&!function(e,t){if(!t)return!1;var n=null==e?void 0:e.peerId;return!!n&&(n===t.ownerId||!!t.adminIds&&t.adminIds.includes(n))}(s,o.callData.conversation)),m=Object(u.useCallback)((function(){n({type:"toggle_participants_kick"})}),[]),v=Object(u.useCallback)((function(){!function(e,t){void 0===t&&(t=!1);var n=Za(e);n&&ii(n,t)}(s,!d),m()}),[o.participantKick,d]),_=Object(u.useCallback)((function(e){p(e)}),[]),g=a(null==s?void 0:s.sex,"calls_kick_participant_text",i("calls_kick_participant_text",!0)).replace("{user}",null!==(t=null==s?void 0:s.name)&&void 0!==t?t:"");return l.a.createElement(gh,{onClose:m,onAllowReconnectChange:_,description:g,allowBan:f,actionButtons:[l.a.createElement(Ol.a,{onClick:m,appearance:"secondary",key:"cancel"},i("calls_cancel")),l.a.createElement(Ol.a,{onClick:v,key:"stop"},i("calls_kick_participant_kick_button_text"))]})},yh=function(e){var t=e.title,n=e.children,r=e.sendButtonClick,i=e.skipButtonClick,a=e.sendButtonDisabled,o=void 0===a||a,s=l.a.useContext(To).getLang;return l.a.createElement("div",{className:"FeedbackScreen"},l.a.createElement("div",{className:"FeedbackScreen__close",onClick:i}),l.a.createElement("div",{className:"FeedbackScreen__title"},t),n,l.a.createElement("div",{className:"FeedbackScreen__actions"},l.a.createElement(Ol.a,{appearance:"overlay_secondary",onClick:i},s("calls_feedback_skip")),l.a.createElement(Ol.a,{appearance:"overlay_primary",onClick:r,disabled:o},s("calls_feedback_send"))))},Eh=function(){return(Eh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Sh=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},bh=function(e){var t=Sh(e,[]);return l.a.createElement("svg",Eh({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"}))},Ch=function(){return(Ch=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},wh=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Oh=function(e){var t=wh(e,[]);return l.a.createElement("svg",Ch({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),l.a.createElement("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"}))},Th=function(){return(Th=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(_h||(_h={}));var Ih=["DID_NOT_HEAR_INTERLOCUTOR","DID_NOT_SEE_INTERLOCUTOR","BAD_VIDEO_QUALITY","VIDEO_FREEZES","VERY_QUIET_SOUND","BAD_SOUND_QUALITY","SOUND_DID_NOT_MATCH_THE_VIDEO","FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE"],Ph=function(e){var t=e.onSuccessFeedback,n=Object(h.d)(),r=Object(h.e)((function(e){return e})),i=l.a.useContext(To).getLang,a=Object(u.useState)(_h.DEFAULT),o=a[0],s=a[1],c=Object(u.useState)(!0),d=c[0],f=c[1],m=Object(u.useState)(!1),v=m[0],_=m[1],g=Object(u.useState)({user_response:0,feedback:[],custom_feedback:void 0}),A=g[0],y=g[1],E=Object(u.useState)(Ih.map((function(e){return{name:e,checked:!1}})))[0],S=function(){n({type:la,mode:ra.READY})},b=function(e){var t=e.target.getAttribute("data-response");if(t){var n=parseInt(t,10);n<=3&&s(_h.ADVANCE),y(Th(Th({},A),{user_response:n})),f(!1)}},C=function(e,t){E.forEach((function(n){n.name===e&&(n.checked=t)})),y((function(e){return Th(Th({},e),{feedback:E.filter((function(e){return e.checked})).map((function(e){return e.name}))})}))},w=function(e,t){_(t)},O=function(e){y(Th(Th({},A),{custom_feedback:e.currentTarget.value}))};return l.a.createElement(ko,{onClose:S,onBackdropClick:S},l.a.createElement("section",{className:"Call"},l.a.createElement(yh,{title:o===_h.DEFAULT?i("calls_feedback_default_title"):i("calls_feedback_advance_title"),sendButtonClick:function(){var e=r.lastCallData?r.lastCallData.peerId:0;Ya.logEvent({call_event_type:Qi.a.USER_FEEDBACK_RECEIVED,session_id:r.lastCallData?r.lastCallData.callId:"",peer_id:e,is_group_call:Qa(e),user_response:A.user_response,feedback:A.feedback,custom_feedback:v&&A.custom_feedback?A.custom_feedback:void 0}),n({type:la,mode:ra.READY}),t&&t()},skipButtonClick:S,sendButtonDisabled:d},o===_h.DEFAULT?l.a.createElement("div",{className:"FeedbackScreen__stars",onClick:b},[1,2,3,4,5].map((function(e,t){return l.a.createElement("div",{className:Object(p.a)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=A.user_response}),"data-response":e,key:t},l.a.createElement(bh,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"}),l.a.createElement(Oh,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"}))}))):l.a.createElement("div",{className:"FeedbackScreen__voting"},Ih.map((function(e,t){return l.a.createElement("div",{className:"FeedbackScreen__votingItem",key:t},l.a.createElement(kp.default,{name:e,className:"FeedbackScreen__votingItemCheckbox",onChange:C},i("calls_feedback_reason_"+e.toLowerCase())))})),l.a.createElement("div",{className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom"},l.a.createElement(kp.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:w}),l.a.createElement(qp.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:i("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!v,onChange:O}))))))},Rh=function(e){var t=e.onClose,n=e.actionButtons,r=e.description,i=e.subDescription,a=e.avatarsItems,o=Object(u.useContext)(To).getLang;return l.a.createElement(Pd.default,{className:"UnbanMembersModal",appearance:"blue",title:o("calls_unban_participant_title"),actionButtons:n,onClose:t,hasScroll:!1},l.a.createElement("div",{className:"UnbanMembersModal__content"},l.a.createElement(Md,{items:a}),l.a.createElement("div",{className:"UnbanMembersModal__description"},r),l.a.createElement("div",{className:"UnbanMembersModal__subDescription"},i)))},Dh=function(e){var t=e.name||"";return e.photo?{src:e.photo,alt:t,key:e.peerId}:{id:e.peerId,text:t.slice(0,1)}},kh=function(e){var t,n=e.SDK,r=Object(h.d)(),i=l.a.useContext(To),a=i.getLang,o=i.langNumeric,s=i.langSex,c=Object(h.e)((function(e){return e})),d=ho(c.participants[c.me]),p=null===(t=c.membersUnban)||void 0===t?void 0:t.members,f=Object(u.useCallback)((function(){r({type:"unban_participants"})}),[]),m=Object(u.useCallback)((function(){null==p||p.forEach((function(e){n.addParticipant(e.id,{unban:!0})})),f()}),[c.membersUnban]);if(!p)return l.a.createElement(l.a.Fragment,null);var v=null==p?void 0:p.length,_=o(v,"calls_unban_participant_text",a("calls_unban_participant_text",!0)),g="",A=[];if(1===v){var y=p[0];g=s(y.sex,"calls_unban_participant_description_text_one_person",a("calls_unban_participant_description_text_one_person",!0)).replace("{user}",y.name),A.push(Dh(y))}else{var E=[p[0].name,p[1].name];A=p.slice(0,2).map((function(e){return Dh(e)}));if(v<=3)3===v&&(E.push(p[2].name),A.push(Dh(p[2]))),g=a("calls_unban_participant_description_text_two_persons").replace("{users}",E.join(", "));else{var S=v-2;g=o(S,"calls_unban_participant_description_text_more_persons",a("calls_unban_participant_description_text_more_persons",!0)).replace("{users}",E.join(", ")).replace("{users_count}",S),A.push({id:S,text:"+"+S})}}var b=d?[l.a.createElement(Ol.a,{onClick:f,appearance:"secondary",key:"cancel"},a("calls_unban_participant_cancel_button_text")),l.a.createElement(Ol.a,{onClick:m,key:"stop"},a("calls_unban_participant_ok_button_text"))]:[l.a.createElement(Ol.a,{onClick:f,key:"cancel"},a("calls_unban_participant_disallowed_button_text"))];return l.a.createElement(Rh,{onClose:f,description:_,subDescription:g,actionButtons:b,avatarsItems:A})};function Nh(){return(Nh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Fh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Lh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mh(e){var t=e.SDK,n=e.bridge,r=e.onBeforeCallStart,i=e.onAfterCallFinish,a=e.tabIsMaster,o=e.navigateToConvo,s=e.callSounds,c=e.navigateToProfile,l=e.onHandCountChanged,d=e.onSuccessFeedback,p=e.okPublicKey,f=e.config,m=f.allowAddMembers,v=f.incomingCall,_=f.showFeedbackScreen,g=Object(h.e)(e=>e),A=Object(h.d)(),y=u.useRef(g),E=u.useCallback(()=>{A({type:la,mode:ra.READY})},[]),S=Fh(u.useState(null),2),b=S[0],C=S[1];return u.useEffect(()=>{y.current=g},[g]),u.useEffect(()=>{if(g.mode===ra.CALL)return Kp(),()=>{Qp()}},[g.mode]),function(e,t,n,r){void 0===r&&(r=[]);var i=window.document,a=i.documentElement,o=a.requestFullscreen||a.webkitRequestFullscreen;if(o){var s=!a.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,l=s?"webkitfullscreenchange":"fullscreenchange",d=s?"webkitFullscreenElement":"fullscreenElement";Object(u.useEffect)((function(){var e=function(){i.fullscreenElement?t&&t():n&&n()};return i.addEventListener(l,e),function(){return i.removeEventListener(l,e)}}),[]),Object(u.useEffect)((function(){e&&!i[d]?o.call(i.documentElement):!e&&i[d]&&c.call(i)}),r)}}(g.uiMode===aa.FULLSCREEN&&g.mode===ra.CALL,()=>{window.FastChat&&(C(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0))},()=>{y.current.uiMode===aa.FULLSCREEN&&A({type:"change_ui_mode",mode:aa.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(b),C(null))},[g.uiMode,g.mode]),Ip(t,g),u.createElement(Nd,{SDK:t,mode:g.mode,onReset:()=>A({type:la,mode:ra.READY})},(v||a())&&u.createElement(yd,{onBeforeCallStart:r,onAfterCallFinish:i,callSounds:s}),g.mode===ra.CALL&&g.uiMode!==aa.COLLAPSED&&u.createElement(pd,{SDK:t,navigateToConvo:o,navigateToProfile:c,onHandCountChanged:l}),g.mode===ra.INCOMING&&g.uiMode!==aa.COLLAPSED&&u.createElement(No,{SDK:t,bridge:n}),g.mode!==ra.READY&&g.uiMode===aa.COLLAPSED&&u.createElement(gd,{SDK:t}),_&&g.mode===ra.FEEDBACK&&u.createElement(Ph,{onSuccessFeedback:d}),g.mode===ra.JOIN&&u.createElement(Ap,Nh({},g.join,{bridge:n,withPopup:!0,onClose:E,onError:e=>{A({type:pa,text:e})},okPublicKey:p})),g.errorShown&&u.createElement(Cp,{title:g.error.title,text:g.error.text,handleType:g.error.handleType,callId:g.error.callId,bridge:n,onCloseFatal:E}),g.cautionShown&&u.createElement(Dp,{isIncoming:g.isIncoming}),g.groupCallSetup&&u.createElement(Gl,{SDK:t}),g.isManagementOpen&&u.createElement(ld,{bridge:n,SDK:t,navigateToProfile:c,navigateToConvo:o,allowAddMembers:m}),"settings"===g.popup&&u.createElement(kd,{SDK:t}),"translation"===g.popup&&u.createElement(oh,null),"translation_start_countdown"===g.popup&&u.createElement(vh,null),"translation_stop"===g.popup&&u.createElement(ch,null),"translation_stop_share"===g.popup&&u.createElement(lh,{link:g.translation.link}),"exit"===g.popup&&u.createElement(Op,{SDK:t}),"transfer_admin_rights"===g.popup&&u.createElement(fh,{SDK:t}),"unmute_request"===g.popup&&u.createElement(Mp,{SDK:t}),"admin_pin_unmute_request"===g.popup&&u.createElement(ph,{SDK:t}),g.participantKick&&u.createElement(Ah,{SDK:t}),g.membersUnban&&u.createElement(kh,{SDK:t}),g.participantsManagement&&u.createElement(Fp,{SDK:t}),g.adminAssignment&&u.createElement(Bp,{SDK:t}),g.isLoaderVisible&&u.createElement(Up.a,null))}n("OEbY");function jh(){return(jh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function xh(e,t,n,r){var i=r.reduce((r,i)=>{switch(i.type){case"incoming_call":if(!Bh(e,i)){r.push(Promise.resolve());break}var a=Zo(i),o=(u=i.payload,l=u.caller_info,d=l.first_name+" "+l.last_name,{peerId:+l.user_id,name:d,tab:d,photo:l.photo_400,firstName:l.first_name,lastName:l.last_name,shortName:qo(l.first_name,l.last_name,d)});if(a){var s=function(e){var t=e.chat_info;return{peerId:2e9+t.chat_id,tab:t.title,name:t.title,photo:t.photo_400}}(i.payload);t({type:"load_peer",conversation:s,members:[o],peerId:s.peerId}),s.photo&&r.push(Wl(s.photo));var c=function(e,t,n,r){return yu(r).then((function(e){var r=Yo(e),i=r[0],a=r[1],o=r[2];ed(t,o),zl([i,a]).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),Vi(zt.ERROR,e),console.error(e)})),t({type:"load_peer",conversation:i,members:a})}))}(0,t,n,s.peerId);r.push(c)}else t({type:"load_peer",conversation:o,members:[o],peerId:o.peerId});o.photo&&r.push(Wl(o.photo))}var u,l,d;return r},[]);return Promise.all(i)}function Bh(e,t){return function(e){return!!e.payload.call_id}(t)&&e.mode!==ra.INCOMING&&e.mode!==ra.CALL}function Uh(){return Object(h.e)((function(e){return e})).isLoaderVisible?l.a.createElement(Up.a,null):null}var Vh=n("ANjH"),Gh=function(){return(Gh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Hh=function(e,t,n,r){var i,a=r.participantLimit,o=void 0===a?128:a,s=r.isDev,c=void 0!==s&&s,u=r.token,l=r.config,d=void 0===l?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1}:l,p=r.localVideoResolution,h=void 0===p?Ki.SD:p,f=r.friends,m=void 0===f?[]:f,v=r.friendsCache,_=r.privacySettings,g=r.ipSettingEnabled,A=window.vk&&window.vk.id||e.peerId;return{anonymSecret:u,me:A,mode:ra.READY,peer:0,participants:(i={},i[A]=Gh(Gh({},e),{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1},statusData:{hand:!1},roles:[],permissions:{audio:$i.ALLOW,video:$i.ALLOW,screenSharing:$i.ALLOW}}),i),visibleParticipants:{},callData:{type:null,ts:null,localTimeStamp:null,conversation:n},imHash:t,participantLimit:o,isDev:c,popup:null,uiMode:aa.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!1,chatMembers:[],preselectedIds:null,friends:m,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:zi.NEURAL,config:d,localVideoResolution:h,conversationOptions:[],privacySettings:{callsIp:(null==_?void 0:_.callsIp)||"friends"},friendsCache:v||{},ipSettingEnabled:g||!1}};n("T39b");function Wh(){return(Wh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function zh(e,t){switch(t.type){case"load_peer":var n=t.conversation||e.callData.conversation,r=t.members;return Wh({},e,{participants:Wh({},e.participants,{},r.reduce((t,n)=>(n&&n.peerId&&(t[n.peerId]=Wh({},e.participants[n.peerId]||{},{},n)),t),{})),callData:Wh({},e.callData,{conversation:n}),peer:"peerId"in t?t.peerId:e.peer});case la:var i=t.mode!==ra.READY&&t.data&&t.data.type?t.data.type:null;if(t.mode===ra.READY||t.mode===ra.FEEDBACK){var a=e.callData&&e.callData.conversation,o=Hh(e.participants[e.me],e.imHash,a,{participantLimit:e.participantLimit,token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,privacySettings:e.privacySettings,friendsCache:e.friendsCache,ipSettingEnabled:e.ipSettingEnabled});return t.mode===ra.FEEDBACK&&(o.mode=ra.FEEDBACK,o.lastCallData={callId:e.callData?e.callData.callId:"",peerId:e.peer||0}),o}return Wh({},e,{mode:t.mode,peer:"peerId"in t?t.peerId:e.peer,callData:Wh({},e.callData,{type:i,ts:t.ts||e.callData.ts||null}),hangupType:e.hangupType});case"hangup":return Wh({},e,{hangupType:t.data});case"time_start":return Wh({},e,{callData:Wh({},e.callData,{ts:t.data})});case"local_time_start":return Wh({},e,{callData:Wh({},e.callData,{localTimeStamp:t.data})});case"remove_user":var s=Kh(e,t.participantId,{status:void 0,statusData:void 0,wasConnected:void 0});if(e.screenSharers[t.participantId]&&delete s.screenSharers[t.participantId],e.orator===t.participantId&&(s.orator=null),e.pinnedParticipant===t.participantId&&(s.pinnedParticipant=null),e.adminPinnedParticipant===t.participantId&&(s.adminPinnedParticipant=null),e.screenSharingPinnedParticipant===t.participantId&&(s.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(t.participantId)){var c=new Set(e.participantsAddedByMe);c.delete(t.participantId),s.participantsAddedByMe=c}return s;case"set_chat_info":return Wh({},e,{chatMembers:t.data,chatData:t.conversation});case"group_call_setup":return Wh({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case da:return Wh({},e,{popup:t.data||null});case"update_hash":return Wh({},e,{imHash:t.hash});case"change_ui_mode":return Wh({},e,{uiMode:t.mode||aa.DEFAULT});case"toggle_orator_mode":return Wh({},e,{isOratorMode:t.isOratorMode});case"toggle_participants_aside":return Wh({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case"set_orator":return Wh({},e,{orator:t.orator||null});case"set_pinned_participant":return Wh({},e,{pinnedParticipant:t.pinnedParticipant});case"set_admin_pinned_participant":return Wh({},e,{adminPinnedParticipant:t.data});case"set_screen_sharing_pinned_participant":return Wh({},e,{screenSharingPinnedParticipant:t.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:t.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:t.screenSharingOldPinnedParticipant});case"management":return Wh({},e,{isManagementOpen:t.isOpen,managementView:t.managementView});case"call_state":return Wh({},e,{callData:Wh({},e.callData,{},t.callData)});case"call_notification":return Wh({},e,{notification:t.notification});case"join":return Wh({},e,{mode:ra.JOIN,join:t.data});case pa:return Wh({},e,{mode:t.handleType===Zi.FATAL?ra.ERROR:e.mode,errorShown:!t.isClosed,error:{title:t.title,text:t.text,handleType:t.handleType,callId:t.callId}});case"change_participant_state":var u=e.participants[t.participantId].statusData;return Kh(e,t.participantId,{statusData:Wh({},u,{},t.data)});case"change_participant_roles":return Kh(e,t.participantId,{roles:t.data});case"change_participant_permissions":var l=e.participants[t.participantId];return Kh(e,t.participantId,{permissions:Wh({},l.permissions,{},t.data)});case"set_screen_sharer":return Wh({},e,{screenSharers:Wh({},e.screenSharers,{[t.participantId]:t.isScreenSharingEnabled})});case"set_friends":return Wh({},e,{friends:t.data,friendsCache:Go(t.data)});case"set_speakers":var d=t.data,p=d.speakers,h=d.speakersInHeader;return Wh({},e,{speakers:p||e.speakers,speakersInHeader:h||e.speakersInHeader});case"update_participants_batch":return function(e,t){var n,r=xu(xu({},e),{participants:xu({},e.participants)});for(var i in t)if(t.hasOwnProperty(i))if(void 0===(null===(n=e.participants[i])||void 0===n?void 0:n.status)&&t[i].status===oa.HANGUP)delete r.participants[i];else{var a=e.participants[i]||{},o=t[i],s=o.statusData?xu(xu({},a.statusData),o.statusData):a.statusData,c=a.wasConnected||o.status===oa.CONNECTED;r.participants[i]=xu(xu(xu({},e.participants[i]),t[i]),{statusData:s,wasConnected:c})}return r}(e,t.data);case"set_unread_count":return Wh({},e,{chatUnreadCount:t.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in t?t.chatUpToMsgId:e.chatUpToMsgId});case"show_caution_box":return Wh({},e,{cautionShown:t.isOpen,isIncoming:t.isIncoming});case ha:return Wh({},e,{isLoaderVisible:t.isLoaderVisible});case"set_tooltip":var f=t.tooltips?t.tooltips:Object.keys(e.tooltips).reduce((e,t)=>(e[t]=!1,e),{});return Wh({},e,{tooltips:Wh({},e.tooltips,{},f)});case"manual_add_participants":return Wh({},e,{participantsAddedByMe:(t.participants||[]).reduce((e,t)=>e.add(t),new Set(e.participantsAddedByMe))});case"set_visible_participants":return Wh({},e,{visibleParticipants:Wh({},e.visibleParticipants,{},t.data)});case"set_translation":return Wh({},e,{translation:Wh({},e.translation,{},t.data)});case"update_anon_token":return Wh({},e,{anonymSecret:t.secret});case"toggle_participants_kick":return Wh({},e,{participantKick:t.data?{participant:t.data.participant}:null});case"unban_participants":return Wh({},e,{membersUnban:t.data?{members:t.data.members}:null});case"toggle_participants_management":return Wh({},e,{participantsManagement:t.data?{mode:t.data.mode,participant:t.data.participant}:null});case"toggle_admin_assignment":return Wh({},e,{adminAssignment:t.data?{participant:t.data.participant}:null});case"set_noise_cancellation":return Wh({},e,{noiseCancellation:t.data});case"change_local_video_resolution":return Wh({},e,{localVideoResolution:t.data});case"set_conversation_options":return Wh({},e,{conversationOptions:t.data});case"set_privacy_settings":return Wh({},e,{privacySettings:t.data})}return e}function Kh(e,t,n){return Wh({},e,{participants:Wh({},e.participants,{[t]:Wh({},e.participants[t],{},n)})})}function Qh(){return(Qh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function qh(e){var t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}var Jh,Yh,$h,Zh,Xh,ef,tf,nf,rf,af,of,sf,cf=n("rFFZ"),uf=n("Bj12"),lf=n("FbVm"),df=n("6krn"),pf=n("4+be"),hf=n("P13b"),ff=n("HLtZ"),mf=n("kcIO");if(!window.Calls){var vf=new lf.a(new lf.f),_f={getLang:df.b,langSex:function(e,t,n){return Object(pf.k)(e,n)},langNumeric:function(e,t,n,r){return Object(pf.j)(e,n,r)},langShortDateTime:function(e){return Object(pf.i)(e,Object(df.b)("global_short_date_time",!0),0,Object(df.b)("months_of"),!0)}},gf={onScreenSharingEnabled:null,onScreenSharingDisabled:null,onErrorStartCall:null,onHandCountChanged:null,onSuccessFeedback:function(){Object(mf.f)(Object(df.b)("calls_feedback_success"))},onError:ff.c};window.Calls=(Jh={apiWrapper:cf.a,apiWrapperWithAuth:cf.b,actionStatCollector:vf,saveStatlogEvents:uf.e,langUtils:_f,navigateToConvo:function(e){window.nav.go(Object(hf.pb)(e))},callSounds:{end:"/mp3/call_end.mp3",incoming:"/mp3/call_incoming.mp3",outgoing:"/mp3/call_outgoing.mp3",connected:"/mp3/call_connected.mp3",connecting:"/mp3/call_connecting.mp3"},navigateToProfile:function(e,t){e.target.href||(window.Calls.collapseCall(),t&&window.nav.go(t))},eventHandlers:gf},Yh=Jh.actionStatCollector,$h=Jh.saveStatlogEvents,Zh=Jh.langUtils,Xh=Jh.navigateToConvo,ef=Jh.navigateToProfile,tf=Jh.apiWrapperWithAuth,nf=Jh.apiWrapper,rf=Jh.callSounds,af=Jh.config,of=void 0===af?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,streaming:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,allowBanParticipant:!1,showFeedbackScreen:!1}:af,sf=Jh.eventHandlers,Object(hu.b)(tf,nf),{initialized:!1,initializing:void 0,eventHandlers:sf,init(e){var t=e.callPreview,n=e.callsCredentials,r=e.imHash,i=e.participantLimit,a=e.callsOkStaging,o=e.tabIsMaster,s=e.onBeforeCallStart,l=e.onAfterCallFinish,f=e.onError,m=e.toggles,v=void 0===m?{}:m,_=e.friends,g=e.isFriend,A=e.getFriends;this.initialized=!0,this.isFriend=g,this.getFriends=A;var y=Qh({},of,{},v,{withAnimation:!a});if(!xr.isBrowserSupported()){var E=()=>{var e=Zh.getLang("calls_unsupported_browser_error");return f&&f({msg:e}),sf.onError&&sf.onError(new Error(e)),console.error(e),Promise.resolve()};return this.call=E,this.startGroupCall=E,this.startCall=E,this.acceptCall=E,this.joinCallByLink=E,void(this.showJoinPopup=E)}this.id=window.vk&&window.vk.id||n.me.peerId;var S=o||(()=>!0),b=p.j.getItem("calls_video_resolution"),C=Object(Vh.createStore)(zh,Hh(n.me,r,t,{participantLimit:i,isDev:!!n.is_dev,token:n.secret,config:y,localVideoResolution:y.fullHD?b:b===Ki.HD?Ki.HD:Ki.SD,friends:_||[],friendsCache:Go(_||[]),ipSettingEnabled:n.ip_setting_enabled,privacySettings:n.privacySettings}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());return this.collapseCall=()=>{C.dispatch({type:"management",isOpen:!1}),C.dispatch({type:"change_ui_mode",mode:aa.COLLAPSED})},this.restoreCall=()=>{C.dispatch({type:"change_ui_mode",mode:aa.DEFAULT})},$h&&tp($h),Yh&&Ya.setActionStatCollector(Yh),d.render(u.createElement(h.a,{store:C},u.createElement(To.Provider,{value:Zh},u.createElement(Wa.Provider,{value:y},u.createElement(Uh,null)))),qh("calls")),this.initializing=up(this,c,n,C,Zh.getLang,a).finally(()=>{!function(e,t,n,r){var i=r.dispatch,a=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];o.forEach(t=>{"incoming_call"===t.type&&(e.debug&&console.log("[longpoll calls] before loadResourcesIfNeed",o),Cu(t.payload.call_id))});var c=r.getState();xh(c,i,e,o).then(()=>{o.forEach(n=>{switch(n.type){case"incoming_call":if(e.debug&&console.log("[longpoll calls] after loadResourcesIfNeed",o),Bh(c,n))r.getState().ipSettingEnabled&&t.forceRelayPolicy(!n.payload.p2p_allowed),t.processPush(n.payload.call_id).then(()=>{var e=JSON.parse(Bo(n.payload.payload)),t=e.is_video?ia.VIDEO:ia.AUDIO;i({type:la,mode:ra.INCOMING,peerId:$o(n.payload),data:jh({},n.payload,{type:t,payload:e})}),Xd({timeStart:Date.now(),startType:t}),Ya.logEvent({call_event_type:Qi.a.INCOMING_CALL_RECEIVED,session_id:n.payload.call_id,peer_id:$o(n.payload),is_group_call:Zo(n),reason:e.is_video?ia.VIDEO:ia.AUDIO})}).catch(t=>{if(e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug)if("object"==typeof t){var n=t.hangup,r=t.message;console.error("Push process error",n,r)}else console.error("Push process error",t)});else if("incoming_call"===n.type){var a=t=>{e.eventHandlers.onError&&t&&e.eventHandlers.onError(new Error(t)),e.debug&&console.warn("Incoming push skipped:",t,n)};switch(!0){case!n.payload.call_id:a("old lib call");break;case c.mode===ra.CALL||c.mode===ra.INCOMING:a("already in a call"),t.processPush(n.payload.call_id).then(()=>{e.eventHandlers.onError&&e.eventHandlers.onError(new Error("processPush was incorrect accepted with call_id: "+n.payload.call_id)),e.debug&&console.warn("processPush was incorrect accepted",n.payload.call_id)}).catch(t=>{e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.warn("processPush rejected:",t,n.payload.call_id)});break;default:a("reason of decline is unknown")}}break;case"event_add_message":var s=r.getState(),u=Ka(s.peer),l=s.callData.callId;if(s.peer!==n.peerId||2&n.flags||s.me===n.userId||i({type:"set_unread_count",chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),u||!qa(n))return;var d=n.peerId;if(l===n.kludges.attach1_call_id)return Jl(r.getState(),i,d);break;case"event_read_inbound":null!==n.chatUnreadCount&&r.getState().peer===n.peerId&&i({type:"set_unread_count",chatUnreadCount:n.unread,chatUpToMsgId:n.upToId});break;case"event_set_flags":var p=r.getState();p.peer===n.peerId&&null!==p.chatUpToMsgId&&n.messageId>p.chatUpToMsgId&&!(2&n.flags)&&(128&n.flags||64&n.flags)&&i({type:"set_unread_count",chatUnreadCount:p.chatUnreadCount?p.chatUnreadCount-1:0});break;case"event_delete_dialog":r.getState().peer===n.peerId&&i({type:"set_unread_count",chatUnreadCount:0,chatUpToMsgId:null});break;case"event_edit_message":case"event_replace_message":var h=r.getState();h.peer===n.peerId&&null!==h.chatUpToMsgId&&n.messageId>h.chatUpToMsgId&&n.kludges.is_expired&&i({type:"set_unread_count",chatUnreadCount:h.chatUnreadCount?h.chatUnreadCount-1:0});break;case"event_chat_updated":var f=n.peerId,m=n.updateType;if(r.getState().peer!==f)return;if(19!==m)return;void 0!==r.getState().callData.canFinishCall&&r.getState().callData.hasUrlLink||Yl(r.getState(),i,f)}})}).catch(t=>{e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.error("Resource loading error",t),o.forEach(e=>{switch(e.type){case"incoming_call":if(!Bh(c,e))return;i({type:pa,text:n("calls_incoming_process_error"),handleType:Zi.PROCESS,callId:e.payload.call_id})}})})};if(e.handleEvent=a,void 0!==window.Notifier){var o=window.Notifier.getLpInstance();o&&o.onData(a)}}(this,c,Zh.getLang,C);var e=qh("calls");d.unmountComponentAtNode(e),d.render(u.createElement(h.a,{store:C},u.createElement(To.Provider,{value:Zh},u.createElement(Wa.Provider,{value:y},u.createElement(Mh,{bridge:this,SDK:c,tabIsMaster:S,onBeforeCallStart:s,onAfterCallFinish:l,callSounds:rf,navigateToConvo:Xh,onHandCountChanged:sf.onHandCountChanged,onSuccessFeedback:sf.onSuccessFeedback,navigateToProfile:ef,okPublicKey:n.key,config:y})))),e)}),this.initializing.catch(e=>{if(sf.onError){var t=e?e.message||e.msg:"sdk did not send the reasons for the error",n=e?e.error:"";sf.onError(new Error(`Could not init calls. ${t}: ${n}`))}console.error("Could not init calls",e.error,e)})},showJoinScreen(e,t,n,r,i){var a=e=>{r&&r({msg:e}),sf.onError&&sf.onError(new Error(e)),console.error(e)};if(!xr.isBrowserSupported())return a(Zh.getLang("calls_unsupported_browser_error"));tp($h),Ya.setActionStatCollector(Yh);var o=document.querySelector(t);d.render(u.createElement(To.Provider,{value:Zh},u.createElement(Wa.Provider,{value:of},u.createElement(Ap,Qh({},e,{withPopup:!1,bridge:this,entryPoint:n,onError:a,okPublicKey:i})))),o)},debug:!1,setDebug(e){this.debug=e,Ui(e)}})}try{window.stManager.done(window.jsc("web/calls.js"))}catch(e){}},"8D0k":function(e,t,n){"use strict";var r=n("KCt4");function i(e,t,n,i,a){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":a||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var a=r(e.parameters.apt,n),o=r(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!i(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var a=new Event("track");a.track=n,a.receiver=r,a.transceiver={receiver:r},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var l=function(n){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=a[e].bind(a)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,a=this.transceivers[n].iceGatherer;if(!a.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),s.component=1,s.ufrag=a.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(u)),o.candidate.candidate=u,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=r.getMediaSections(i._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+l.join("");var d=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var o=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],c=o.iceGatherer,u=o.iceTransport,l=o.dtlsTransport,d=o.localCapabilities,p=o.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var h=r.getIceParameters(e,n),f=r.getDtlsParameters(e,n);s&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===u.state&&u.start(c,h,s?"controlling":"controlled"),"new"===l.state&&l.start(f));var m=a(d,p);i._transceive(o,m.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!o("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var d={};l.remoteStreams.forEach((function(e){d[e.id]=e}));var p=[],h=r.splitSections(i.sdp),f=h.shift(),m=r.matchPrefix(f,"a=ice-lite").length>0,v=r.matchPrefix(f,"a=group:BUNDLE ").length>0;l.usingBundle=v;var _=r.matchPrefix(f,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,h.forEach((function(o,c){var u=r.splitLines(o),h=r.getKind(o),_=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],A=r.getDirection(o,f),y=r.parseMsid(o),E=r.getMid(o)||r.generateIdentifier();if(_||"application"===h&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))l.transceivers[c]={mid:E,kind:h,protocol:g,rejected:!0};else{var S,b,C,w,O,T,I,P,R;!_&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(h,!0));var D,k,N=r.parseRtpParameters(o);_||(D=r.getIceParameters(o,f),(k=r.getDtlsParameters(o,f)).role="client"),I=r.parseRtpEncodingParameters(o);var F=r.parseRtcpParameters(o),L=r.matchPrefix(o,"a=end-of-candidates",f).length>0,M=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!_&&v&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||_){if("answer"===i.type&&!_){b=(S=l.transceivers[c]).iceGatherer,C=S.iceTransport,w=S.dtlsTransport,O=S.rtpReceiver,T=S.sendEncodingParameters,P=S.localCapabilities,l.transceivers[c].recvEncodingParameters=I,l.transceivers[c].remoteCapabilities=N,l.transceivers[c].rtcpParameters=F,M.length&&"new"===C.state&&(!m&&!L||v&&0!==c?M.forEach((function(e){s(S.iceTransport,e)})):C.setRemoteCandidates(M)),v&&0!==c||("new"===C.state&&C.start(b,D,"controlling"),"new"===w.state&&w.start(k)),!a(S.localCapabilities,S.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,l._transceive(S,"sendrecv"===A||"recvonly"===A,"sendrecv"===A||"sendonly"===A),!O||"sendrecv"!==A&&"sendonly"!==A?delete S.rtpReceiver:(R=O.track,y?(d[y.stream]||(d[y.stream]=new e.MediaStream),n(R,d[y.stream]),p.push([R,O,d[y.stream]])):(d.default||(d.default=new e.MediaStream),n(R,d.default),p.push([R,O,d.default])))}}else{(S=l.transceivers[c]||l._createTransceiver(h)).mid=E,S.iceGatherer||(S.iceGatherer=l._createIceGatherer(c,v)),M.length&&"new"===S.iceTransport.state&&(!L||v&&0!==c?M.forEach((function(e){s(S.iceTransport,e)})):S.iceTransport.setRemoteCandidates(M)),P=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(P.codecs=P.codecs.filter((function(e){return"rtx"!==e.name}))),T=S.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,x=!1;if("sendrecv"===A||"sendonly"===A){if(x=!S.rtpReceiver,O=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,h),x)R=O.track,y&&"-"===y.stream||(y?(d[y.stream]||(d[y.stream]=new e.MediaStream,Object.defineProperty(d[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(R,"id",{get:function(){return y.track}}),j=d[y.stream]):(d.default||(d.default=new e.MediaStream),j=d.default)),j&&(n(R,j),S.associatedRemoteMediaStreams.push(j)),p.push([R,O,j])}else S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===S.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),S.associatedRemoteMediaStreams=[]);S.localCapabilities=P,S.remoteCapabilities=N,S.rtpReceiver=O,S.rtcpParameters=F,S.sendEncodingParameters=T,S.recvEncodingParameters=I,l._transceive(l.transceivers[c],!1,x)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(d).forEach((function(t){var n=d[t];if(n.getTracks().length){if(-1===l.remoteStreams.indexOf(n)){l.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){l._dispatchEvent("addstream",r)}))}p.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(l,t,r,[n])}))}})),p.forEach((function(e){e[2]||u(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(a=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));a>0||o>0;)a>0&&(n._createTransceiver("audio"),a--),o>0&&(n._createTransceiver("video"),o--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,a){var o=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(a,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=i.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];o&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l})),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=a(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var u=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,a){if(!n._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){o=u;break}var l=n.transceivers[o];if(!l)return a(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===o||o>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,d))return a(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(d.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));h++);i()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var d=["createOffer","createAnswer"];return d.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},"8Lyy":function(e,t,n){var r=n("O6qx"),i=/%[sdv%]/g,a=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return a.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,i=t.innerOrder||c,a=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))})),e.media.forEach((function(e){a.push(o("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))}))})),a.join("\r\n")+"\r\n"}},"9XzT":function(e,t,n){t.Interop=n("/oKx")},KCt4:function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=l}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var a=r.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var a=r.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},LQSR:function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},O6qx:function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},TqRt:function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},dAlA:function(e,t,n){(function(e){var r,i=function(e){"use strict";var t=1e7,n=9007199254740992,r=d(n),a="function"==typeof BigInt;function o(e,t,n,r){return void 0===e?o[0]:void 0!==t&&(10!=+t||n)?U(e,t,n,r):z(e)}function s(e,t){this.value=e,this.sign=t,this.isSmall=!1}function c(e){this.value=e,this.sign=e<0,this.isSmall=!0}function u(e){this.value=e}function l(e){return-n<e&&e<n}function d(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function p(e){h(e);var n=e.length;if(n<4&&I(e,r)<0)switch(n){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*t;default:return e[0]+(e[1]+e[2]*t)*t}return e}function h(e){for(var t=e.length;0===e[--t];);e.length=t+1}function f(e){for(var t=new Array(e),n=-1;++n<e;)t[n]=0;return t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function v(e,n){var r,i,a=e.length,o=n.length,s=new Array(a),c=0,u=t;for(i=0;i<o;i++)c=(r=e[i]+n[i]+c)>=u?1:0,s[i]=r-c*u;for(;i<a;)c=(r=e[i]+c)===u?1:0,s[i++]=r-c*u;return c>0&&s.push(c),s}function _(e,t){return e.length>=t.length?v(e,t):v(t,e)}function g(e,n){var r,i,a=e.length,o=new Array(a),s=t;for(i=0;i<a;i++)r=e[i]-s+n,n=Math.floor(r/s),o[i]=r-n*s,n+=1;for(;n>0;)o[i++]=n%s,n=Math.floor(n/s);return o}function A(e,t){var n,r,i=e.length,a=t.length,o=new Array(i),s=0;for(n=0;n<a;n++)(r=e[n]-s-t[n])<0?(r+=1e7,s=1):s=0,o[n]=r;for(n=a;n<i;n++){if(!((r=e[n]-s)<0)){o[n++]=r;break}r+=1e7,o[n]=r}for(;n<i;n++)o[n]=e[n];return h(o),o}function y(e,t,n){var r,i,a=e.length,o=new Array(a),u=-t;for(r=0;r<a;r++)i=e[r]+u,u=Math.floor(i/1e7),i%=1e7,o[r]=i<0?i+1e7:i;return"number"==typeof(o=p(o))?(n&&(o=-o),new c(o)):new s(o,n)}function E(e,t){var n,r,i,a,o=e.length,s=t.length,c=f(o+s);for(i=0;i<o;++i){a=e[i];for(var u=0;u<s;++u)n=a*t[u]+c[i+u],r=Math.floor(n/1e7),c[i+u]=n-1e7*r,c[i+u+1]+=r}return h(c),c}function S(e,n){var r,i,a=e.length,o=new Array(a),s=t,c=0;for(i=0;i<a;i++)r=e[i]*n+c,c=Math.floor(r/s),o[i]=r-c*s;for(;c>0;)o[i++]=c%s,c=Math.floor(c/s);return o}function b(e,t){for(var n=[];t-- >0;)n.push(0);return n.concat(e)}function C(e,n,r){return new s(e<t?S(n,e):E(n,d(e)),r)}function w(e){var t,n,r,i,a=e.length,o=f(a+a);for(r=0;r<a;r++){n=0-(i=e[r])*i;for(var s=r;s<a;s++)t=i*e[s]*2+o[r+s]+n,n=Math.floor(t/1e7),o[r+s]=t-1e7*n;o[r+a]=n}return h(o),o}function O(e,t){var n,r,i,a,o=e.length,s=f(o);for(i=0,n=o-1;n>=0;--n)i=(a=1e7*i+e[n])-(r=m(a/t))*t,s[n]=0|r;return[s,0|i]}function T(e,n){var r,i=z(n);if(a)return[new u(e.value/i.value),new u(e.value%i.value)];var l,v=e.value,_=i.value;if(0===_)throw new Error("Cannot divide by zero");if(e.isSmall)return i.isSmall?[new c(m(v/_)),new c(v%_)]:[o[0],e];if(i.isSmall){if(1===_)return[e,o[0]];if(-1==_)return[e.negate(),o[0]];var g=Math.abs(_);if(g<t){l=p((r=O(v,g))[0]);var y=r[1];return e.sign&&(y=-y),"number"==typeof l?(e.sign!==i.sign&&(l=-l),[new c(l),new c(y)]):[new s(l,e.sign!==i.sign),new c(y)]}_=d(g)}var E=I(v,_);if(-1===E)return[o[0],e];if(0===E)return[o[e.sign===i.sign?1:-1],o[0]];l=(r=v.length+_.length<=200?function(e,n){var r,i,a,o,s,c,u,l=e.length,d=n.length,h=t,m=f(n.length),v=n[d-1],_=Math.ceil(h/(2*v)),g=S(e,_),A=S(n,_);for(g.length<=l&&g.push(0),A.push(0),v=A[d-1],i=l-d;i>=0;i--){for(r=h-1,g[i+d]!==v&&(r=Math.floor((g[i+d]*h+g[i+d-1])/v)),a=0,o=0,c=A.length,s=0;s<c;s++)a+=r*A[s],u=Math.floor(a/h),o+=g[i+s]-(a-u*h),a=u,o<0?(g[i+s]=o+h,o=-1):(g[i+s]=o,o=0);for(;0!==o;){for(r-=1,a=0,s=0;s<c;s++)(a+=g[i+s]-h+A[s])<0?(g[i+s]=a+h,a=0):(g[i+s]=a,a=1);o+=a}m[i]=r}return g=O(g,_)[0],[p(m),p(g)]}(v,_):function(e,t){for(var n,r,i,a,o,s=e.length,c=t.length,u=[],l=[];s;)if(l.unshift(e[--s]),h(l),I(l,t)<0)u.push(0);else{i=1e7*l[(r=l.length)-1]+l[r-2],a=1e7*t[c-1]+t[c-2],r>c&&(i=1e7*(i+1)),n=Math.ceil(i/a);do{if(I(o=S(t,n),l)<=0)break;n--}while(n);u.push(n),l=A(l,o)}return u.reverse(),[p(u),p(l)]}(v,_))[0];var b=e.sign!==i.sign,C=r[1],w=e.sign;return"number"==typeof l?(b&&(l=-l),l=new c(l)):l=new s(l,b),"number"==typeof C?(w&&(C=-C),C=new c(C)):C=new s(C,w),[l,C]}function I(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return e[n]>t[n]?1:-1;return 0}function P(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function R(e,t){for(var n,r,a,o=e.prev(),s=o,c=0;s.isEven();)s=s.divide(2),c++;e:for(r=0;r<t.length;r++)if(!e.lesser(t[r])&&!(a=i(t[r]).modPow(s,e)).isUnit()&&!a.equals(o)){for(n=c-1;0!=n;n--){if((a=a.square().mod(e)).isUnit())return!1;if(a.equals(o))continue e}return!1}return!0}s.prototype=Object.create(o.prototype),c.prototype=Object.create(o.prototype),u.prototype=Object.create(o.prototype),s.prototype.add=function(e){var t=z(e);if(this.sign!==t.sign)return this.subtract(t.negate());var n=this.value,r=t.value;return t.isSmall?new s(g(n,Math.abs(r)),this.sign):new s(_(n,r),this.sign)},s.prototype.plus=s.prototype.add,c.prototype.add=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.subtract(t.negate());var r=t.value;if(t.isSmall){if(l(n+r))return new c(n+r);r=d(Math.abs(r))}return new s(g(r,Math.abs(n)),n<0)},c.prototype.plus=c.prototype.add,u.prototype.add=function(e){return new u(this.value+z(e).value)},u.prototype.plus=u.prototype.add,s.prototype.subtract=function(e){var t=z(e);if(this.sign!==t.sign)return this.add(t.negate());var n=this.value,r=t.value;return t.isSmall?y(n,Math.abs(r),this.sign):function(e,t,n){var r;return I(e,t)>=0?r=A(e,t):(r=A(t,e),n=!n),"number"==typeof(r=p(r))?(n&&(r=-r),new c(r)):new s(r,n)}(n,r,this.sign)},s.prototype.minus=s.prototype.subtract,c.prototype.subtract=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.add(t.negate());var r=t.value;return t.isSmall?new c(n-r):y(r,Math.abs(n),n>=0)},c.prototype.minus=c.prototype.subtract,u.prototype.subtract=function(e){return new u(this.value-z(e).value)},u.prototype.minus=u.prototype.subtract,s.prototype.negate=function(){return new s(this.value,!this.sign)},c.prototype.negate=function(){var e=this.sign,t=new c(-this.value);return t.sign=!e,t},u.prototype.negate=function(){return new u(-this.value)},s.prototype.abs=function(){return new s(this.value,!1)},c.prototype.abs=function(){return new c(Math.abs(this.value))},u.prototype.abs=function(){return new u(this.value>=0?this.value:-this.value)},s.prototype.multiply=function(e){var n,r,i,a=z(e),c=this.value,u=a.value,l=this.sign!==a.sign;if(a.isSmall){if(0===u)return o[0];if(1===u)return this;if(-1===u)return this.negate();if((n=Math.abs(u))<t)return new s(S(c,n),l);u=d(n)}return r=c.length,i=u.length,new s(-.012*r-.012*i+15e-6*r*i>0?function e(t,n){var r=Math.max(t.length,n.length);if(r<=30)return E(t,n);r=Math.ceil(r/2);var i=t.slice(r),a=t.slice(0,r),o=n.slice(r),s=n.slice(0,r),c=e(a,s),u=e(i,o),l=e(_(a,i),_(s,o)),d=_(_(c,b(A(A(l,c),u),r)),b(u,2*r));return h(d),d}(c,u):E(c,u),l)},s.prototype.times=s.prototype.multiply,c.prototype._multiplyBySmall=function(e){return l(e.value*this.value)?new c(e.value*this.value):C(Math.abs(e.value),d(Math.abs(this.value)),this.sign!==e.sign)},s.prototype._multiplyBySmall=function(e){return 0===e.value?o[0]:1===e.value?this:-1===e.value?this.negate():C(Math.abs(e.value),this.value,this.sign!==e.sign)},c.prototype.multiply=function(e){return z(e)._multiplyBySmall(this)},c.prototype.times=c.prototype.multiply,u.prototype.multiply=function(e){return new u(this.value*z(e).value)},u.prototype.times=u.prototype.multiply,s.prototype.square=function(){return new s(w(this.value),!1)},c.prototype.square=function(){var e=this.value*this.value;return l(e)?new c(e):new s(w(d(Math.abs(this.value))),!1)},u.prototype.square=function(e){return new u(this.value*this.value)},s.prototype.divmod=function(e){var t=T(this,e);return{quotient:t[0],remainder:t[1]}},u.prototype.divmod=c.prototype.divmod=s.prototype.divmod,s.prototype.divide=function(e){return T(this,e)[0]},u.prototype.over=u.prototype.divide=function(e){return new u(this.value/z(e).value)},c.prototype.over=c.prototype.divide=s.prototype.over=s.prototype.divide,s.prototype.mod=function(e){return T(this,e)[1]},u.prototype.mod=u.prototype.remainder=function(e){return new u(this.value%z(e).value)},c.prototype.remainder=c.prototype.mod=s.prototype.remainder=s.prototype.mod,s.prototype.pow=function(e){var t,n,r,i=z(e),a=this.value,s=i.value;if(0===s)return o[1];if(0===a)return o[0];if(1===a)return o[1];if(-1===a)return i.isEven()?o[1]:o[-1];if(i.sign)return o[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&l(t=Math.pow(a,s)))return new c(m(t));for(n=this,r=o[1];!0&s&&(r=r.times(n),--s),0!==s;)s/=2,n=n.square();return r},c.prototype.pow=s.prototype.pow,u.prototype.pow=function(e){var t=z(e),n=this.value,r=t.value,i=BigInt(0),a=BigInt(1),s=BigInt(2);if(r===i)return o[1];if(n===i)return o[0];if(n===a)return o[1];if(n===BigInt(-1))return t.isEven()?o[1]:o[-1];if(t.isNegative())return new u(i);for(var c=this,l=o[1];(r&a)===a&&(l=l.times(c),--r),r!==i;)r/=s,c=c.square();return l},s.prototype.modPow=function(e,t){if(e=z(e),(t=z(t)).isZero())throw new Error("Cannot take modPow with modulus 0");var n=o[1],r=this.mod(t);for(e.isNegative()&&(e=e.multiply(o[-1]),r=r.modInv(t));e.isPositive();){if(r.isZero())return o[0];e.isOdd()&&(n=n.multiply(r).mod(t)),e=e.divide(2),r=r.square().mod(t)}return n},u.prototype.modPow=c.prototype.modPow=s.prototype.modPow,s.prototype.compareAbs=function(e){var t=z(e),n=this.value,r=t.value;return t.isSmall?1:I(n,r)},c.prototype.compareAbs=function(e){var t=z(e),n=Math.abs(this.value),r=t.value;return t.isSmall?n===(r=Math.abs(r))?0:n>r?1:-1:-1},u.prototype.compareAbs=function(e){var t=this.value,n=z(e).value;return(t=t>=0?t:-t)===(n=n>=0?n:-n)?0:t>n?1:-1},s.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:I(n,r)*(this.sign?-1:1)},s.prototype.compareTo=s.prototype.compare,c.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return t.isSmall?n==r?0:n>r?1:-1:n<0!==t.sign?n<0?-1:1:n<0?1:-1},c.prototype.compareTo=c.prototype.compare,u.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,n=z(e).value;return t===n?0:t>n?1:-1},u.prototype.compareTo=u.prototype.compare,s.prototype.equals=function(e){return 0===this.compare(e)},u.prototype.eq=u.prototype.equals=c.prototype.eq=c.prototype.equals=s.prototype.eq=s.prototype.equals,s.prototype.notEquals=function(e){return 0!==this.compare(e)},u.prototype.neq=u.prototype.notEquals=c.prototype.neq=c.prototype.notEquals=s.prototype.neq=s.prototype.notEquals,s.prototype.greater=function(e){return this.compare(e)>0},u.prototype.gt=u.prototype.greater=c.prototype.gt=c.prototype.greater=s.prototype.gt=s.prototype.greater,s.prototype.lesser=function(e){return this.compare(e)<0},u.prototype.lt=u.prototype.lesser=c.prototype.lt=c.prototype.lesser=s.prototype.lt=s.prototype.lesser,s.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},u.prototype.geq=u.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals=s.prototype.geq=s.prototype.greaterOrEquals,s.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},u.prototype.leq=u.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals=s.prototype.leq=s.prototype.lesserOrEquals,s.prototype.isEven=function(){return 0==(1&this.value[0])},c.prototype.isEven=function(){return 0==(1&this.value)},u.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},s.prototype.isOdd=function(){return 1==(1&this.value[0])},c.prototype.isOdd=function(){return 1==(1&this.value)},u.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},s.prototype.isPositive=function(){return!this.sign},c.prototype.isPositive=function(){return this.value>0},u.prototype.isPositive=c.prototype.isPositive,s.prototype.isNegative=function(){return this.sign},c.prototype.isNegative=function(){return this.value<0},u.prototype.isNegative=c.prototype.isNegative,s.prototype.isUnit=function(){return!1},c.prototype.isUnit=function(){return 1===Math.abs(this.value)},u.prototype.isUnit=function(){return this.abs().value===BigInt(1)},s.prototype.isZero=function(){return!1},c.prototype.isZero=function(){return 0===this.value},u.prototype.isZero=function(){return this.value===BigInt(0)},s.prototype.isDivisibleBy=function(e){var t=z(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},u.prototype.isDivisibleBy=c.prototype.isDivisibleBy=s.prototype.isDivisibleBy,s.prototype.isPrime=function(e){var t=P(this);if(void 0!==t)return t;var n=this.abs(),r=n.bitLength();if(r<=64)return R(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var a=Math.log(2)*r.toJSNumber(),o=Math.ceil(!0===e?2*Math.pow(a,2):a),s=[],c=0;c<o;c++)s.push(i(c+2));return R(n,s)},u.prototype.isPrime=c.prototype.isPrime=s.prototype.isPrime,s.prototype.isProbablePrime=function(e,t){var n=P(this);if(void 0!==n)return n;for(var r=this.abs(),a=void 0===e?5:e,o=[],s=0;s<a;s++)o.push(i.randBetween(2,r.minus(2),t));return R(r,o)},u.prototype.isProbablePrime=c.prototype.isProbablePrime=s.prototype.isProbablePrime,s.prototype.modInv=function(e){for(var t,n,r,a=i.zero,o=i.one,s=z(e),c=this.abs();!c.isZero();)t=s.divide(c),n=a,r=s,a=o,s=c,o=n.subtract(t.multiply(o)),c=r.subtract(t.multiply(c));if(!s.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===a.compare(0)&&(a=a.add(e)),this.isNegative()?a.negate():a},u.prototype.modInv=c.prototype.modInv=s.prototype.modInv,s.prototype.next=function(){var e=this.value;return this.sign?y(e,1,this.sign):new s(g(e,1),this.sign)},c.prototype.next=function(){var e=this.value;return e+1<n?new c(e+1):new s(r,!1)},u.prototype.next=function(){return new u(this.value+BigInt(1))},s.prototype.prev=function(){var e=this.value;return this.sign?new s(g(e,1),!0):y(e,1,this.sign)},c.prototype.prev=function(){var e=this.value;return e-1>-n?new c(e-1):new s(r,!0)},u.prototype.prev=function(){return new u(this.value-BigInt(1))};for(var D=[1];2*D[D.length-1]<=t;)D.push(2*D[D.length-1]);var k=D.length,N=D[k-1];function F(e){return Math.abs(e)<=t}function L(e,t,n){t=z(t);for(var r=e.isNegative(),a=t.isNegative(),o=r?e.not():e,s=a?t.not():t,c=0,u=0,l=null,d=null,p=[];!o.isZero()||!s.isZero();)c=(l=T(o,N))[1].toJSNumber(),r&&(c=N-1-c),u=(d=T(s,N))[1].toJSNumber(),a&&(u=N-1-u),o=l[0],s=d[0],p.push(n(c,u));for(var h=0!==n(r?1:0,a?1:0)?i(-1):i(0),f=p.length-1;f>=0;f-=1)h=h.multiply(N).add(i(p[f]));return h}s.prototype.shiftLeft=function(e){var t=z(e).toJSNumber();if(!F(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var n=this;if(n.isZero())return n;for(;t>=k;)n=n.multiply(N),t-=k-1;return n.multiply(D[t])},u.prototype.shiftLeft=c.prototype.shiftLeft=s.prototype.shiftLeft,s.prototype.shiftRight=function(e){var t,n=z(e).toJSNumber();if(!F(n))throw new Error(String(n)+" is too large for shifting.");if(n<0)return this.shiftLeft(-n);for(var r=this;n>=k;){if(r.isZero()||r.isNegative()&&r.isUnit())return r;r=(t=T(r,N))[1].isNegative()?t[0].prev():t[0],n-=k-1}return(t=T(r,D[n]))[1].isNegative()?t[0].prev():t[0]},u.prototype.shiftRight=c.prototype.shiftRight=s.prototype.shiftRight,s.prototype.not=function(){return this.negate().prev()},u.prototype.not=c.prototype.not=s.prototype.not,s.prototype.and=function(e){return L(this,e,(function(e,t){return e&t}))},u.prototype.and=c.prototype.and=s.prototype.and,s.prototype.or=function(e){return L(this,e,(function(e,t){return e|t}))},u.prototype.or=c.prototype.or=s.prototype.or,s.prototype.xor=function(e){return L(this,e,(function(e,t){return e^t}))},u.prototype.xor=c.prototype.xor=s.prototype.xor;function M(e){var n=e.value,r="number"==typeof n?n|1<<30:"bigint"==typeof n?n|BigInt(1<<30):n[0]+n[1]*t|1073758208;return r&-r}function j(e,t){return e=z(e),t=z(t),e.greater(t)?e:t}function x(e,t){return e=z(e),t=z(t),e.lesser(t)?e:t}function B(e,t){if(e=z(e).abs(),t=z(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var n,r,i=o[1];e.isEven()&&t.isEven();)n=x(M(e),M(t)),e=e.divide(n),t=t.divide(n),i=i.multiply(n);for(;e.isEven();)e=e.divide(M(e));do{for(;t.isEven();)t=t.divide(M(t));e.greater(t)&&(r=t,t=e,e=r),t=t.subtract(e)}while(!t.isZero());return i.isUnit()?e:e.multiply(i)}s.prototype.bitLength=function(){var e=this;return e.compareTo(i(0))<0&&(e=e.negate().subtract(i(1))),0===e.compareTo(i(0))?i(0):i(function e(t,n){if(n.compareTo(t)<=0){var r=e(t,n.square(n)),a=r.p,o=r.e,s=a.multiply(n);return s.compareTo(t)<=0?{p:s,e:2*o+1}:{p:a,e:2*o}}return{p:i(1),e:0}}(e,i(2)).e).add(i(1))},u.prototype.bitLength=c.prototype.bitLength=s.prototype.bitLength;var U=function(e,t,n,r){n=n||"0123456789abcdefghijklmnopqrstuvwxyz",e=String(e),r||(e=e.toLowerCase(),n=n.toLowerCase());var i,a=e.length,o=Math.abs(t),s={};for(i=0;i<n.length;i++)s[n[i]]=i;for(i=0;i<a;i++){if("-"!==(l=e[i])&&(l in s&&s[l]>=o)){if("1"===l&&1===o)continue;throw new Error(l+" is not a valid digit in base "+t+".")}}t=z(t);var c=[],u="-"===e[0];for(i=u?1:0;i<e.length;i++){var l;if((l=e[i])in s)c.push(z(s[l]));else{if("<"!==l)throw new Error(l+" is not a valid character");var d=i;do{i++}while(">"!==e[i]&&i<e.length);c.push(z(e.slice(d+1,i)))}}return V(c,t,u)};function V(e,t,n){var r,i=o[0],a=o[1];for(r=e.length-1;r>=0;r--)i=i.add(e[r].times(a)),a=a.times(t);return n?i.negate():i}function G(e,t){if((t=i(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var r=!1;if(e.isNegative()&&t.isPositive()&&(r=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:r};for(var a,o=[],s=e;s.isNegative()||s.compareAbs(t)>=0;){a=s.divmod(t),s=a.quotient;var c=a.remainder;c.isNegative()&&(c=t.minus(c).abs(),s=s.next()),o.push(c.toJSNumber())}return o.push(s.toJSNumber()),{value:o.reverse(),isNegative:r}}function H(e,t,n){var r=G(e,t);return(r.isNegative?"-":"")+r.value.map((function(e){return function(e,t){return e<(t=t||"0123456789abcdefghijklmnopqrstuvwxyz").length?t[e]:"<"+e+">"}(e,n)})).join("")}function W(e){if(l(+e)){var t=+e;if(t===m(t))return a?new u(BigInt(t)):new c(t);throw new Error("Invalid integer: "+e)}var n="-"===e[0];n&&(e=e.slice(1));var r=e.split(/e/i);if(r.length>2)throw new Error("Invalid integer: "+r.join("e"));if(2===r.length){var i=r[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==m(i)||!l(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var o=r[0],d=o.indexOf(".");if(d>=0&&(i-=o.length-d-1,o=o.slice(0,d)+o.slice(d+1)),i<0)throw new Error("Cannot include negative exponent part for integers");e=o+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(a)return new u(BigInt(n?"-"+e:e));for(var p=[],f=e.length,v=f-7;f>0;)p.push(+e.slice(v,f)),(v-=7)<0&&(v=0),f-=7;return h(p),new s(p,n)}function z(e){return"number"==typeof e?function(e){if(a)return new u(BigInt(e));if(l(e)){if(e!==m(e))throw new Error(e+" is not an integer.");return new c(e)}return W(e.toString())}(e):"string"==typeof e?W(e):"bigint"==typeof e?new u(e):e}s.prototype.toArray=function(e){return G(this,e)},c.prototype.toArray=function(e){return G(this,e)},u.prototype.toArray=function(e){return G(this,e)},s.prototype.toString=function(e,t){if(void 0===e&&(e=10),10!==e)return H(this,e,t);for(var n,r=this.value,i=r.length,a=String(r[--i]);--i>=0;)n=String(r[i]),a+="0000000".slice(n.length)+n;return(this.sign?"-":"")+a},c.prototype.toString=function(e,t){return void 0===e&&(e=10),10!=e?H(this,e,t):String(this.value)},u.prototype.toString=c.prototype.toString,u.prototype.toJSON=s.prototype.toJSON=c.prototype.toJSON=function(){return this.toString()},s.prototype.valueOf=function(){return parseInt(this.toString(),10)},s.prototype.toJSNumber=s.prototype.valueOf,c.prototype.valueOf=function(){return this.value},c.prototype.toJSNumber=c.prototype.valueOf,u.prototype.valueOf=u.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var K=0;K<1e3;K++)o[K]=z(K),K>0&&(o[-K]=z(-K));return o.one=o[1],o.zero=o[0],o.minusOne=o[-1],o.max=j,o.min=x,o.gcd=B,o.lcm=function(e,t){return e=z(e).abs(),t=z(t).abs(),e.divide(B(e,t)).multiply(t)},o.isInstance=function(e){return e instanceof s||e instanceof c||e instanceof u},o.randBetween=function(e,n,r){e=z(e),n=z(n);var i=r||Math.random,a=x(e,n),s=j(e,n).subtract(a).add(1);if(s.isSmall)return a.add(Math.floor(i()*s));for(var c=G(s,t).value,u=[],l=!0,d=0;d<c.length;d++){var p=l?c[d]:t,h=m(i()*p);u.push(h),h<p&&(l=!1)}return a.add(o.fromArray(u,t,!1))},o.fromArray=function(e,t,n){return V(e.map(z),z(t||10),n)},o}();e.hasOwnProperty("exports")&&(e.exports=i),void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}).call(this,n("YuTi")(e))},gEg2:function(e,t,n){"use strict";var r=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.classNames=function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){if(t)switch((0,i.default)(t)){case"string":e.push(t);break;case"object":Object.keys(t).forEach((function(n){t[n]&&e.push(n)}));break;default:e.push("".concat(t))}})),e.join(" ")};var i=r(n("cDf5"))},k76L:function(e,t,n){var r=n("leix"),i=n("8Lyy");t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},leix:function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=n("O6qx"),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,r,o)}})),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},yLpj:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},zMZw:function(e,t,n){var r=n("k76L");t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach((function(t){var n=e.sources[t];Object.keys(n).forEach((function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})}))})),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach((function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))})),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach((function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach((function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))})),t}},zvoO:function(e,t,n){var r=function(){"undefined"!=typeof document&&document.currentScript&&document.currentScript.src;return function(e){var t,n,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,r){t=e,n=r}));var i,a={};for(i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);var o,s=[],c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var u=r.print||console.log.bind(console),l=r.printErr||console.warn.bind(console);for(i in a)a.hasOwnProperty(i)&&(r[i]=a[i]);a=null,r.arguments&&(s=r.arguments),r.thisProgram&&r.thisProgram,r.quit&&r.quit;var d,p=0;r.wasmBinary&&(d=r.wasmBinary);var h;r.noExitRuntime;"object"!=typeof WebAssembly&&H("no native wasm support detected");var f=!1;var m="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function v(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&m)return m.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var c=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|c:(7&o)<<18|s<<12|c<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function _(e,t){return e?v(y,e,t):""}var g,A,y,E,S,b,C,w,O,T="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function I(e,t){for(var n=e,r=n>>1,i=r+t/2;!(r>=i)&&S[r];)++r;if((n=r<<1)-e>32&&T)return T.decode(y.subarray(e,n));for(var a="",o=0;!(o>=t/2);++o){var s=E[e+2*o>>1];if(0==s)break;a+=String.fromCharCode(s)}return a}function P(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var r=t,i=(n-=2)<2*e.length?n/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);E[t>>1]=o,t+=2}return E[t>>1]=0,t-r}function R(e){return 2*e.length}function D(e,t){for(var n=0,r="";!(n>=t/4);){var i=b[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var a=i-65536;r+=String.fromCharCode(55296|a>>10,56320|1023&a)}else r+=String.fromCharCode(i)}return r}function k(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var r=t,i=r+n-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(b[t>>2]=o,(t+=4)+4>i)break}return b[t>>2]=0,t-r}function N(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t}function F(e){g=e,r.HEAP8=A=new Int8Array(e),r.HEAP16=E=new Int16Array(e),r.HEAP32=b=new Int32Array(e),r.HEAPU8=y=new Uint8Array(e),r.HEAPU16=S=new Uint16Array(e),r.HEAPU32=C=new Uint32Array(e),r.HEAPF32=w=new Float32Array(e),r.HEAPF64=O=new Float64Array(e)}r.INITIAL_MEMORY;var L,M=[],j=[],x=[],B=[];j.push({func:function(){pt()}});var U=0,V=null,G=null;function H(e){r.onAbort&&r.onAbort(e),l(e+=""),f=!0,1,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}r.preloadedImages={},r.preloadedAudios={};function W(e){return t=e,n="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}var z,K="libvpx2.wasm";function Q(e){try{if(e==K&&d)return new Uint8Array(d);if(o)return o(e);throw"both async and sync fetching of the wasm failed"}catch(e){H(e)}}function q(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?L.get(n)():L.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(r)}}function J(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}W(K)||(z=K,K=r.locateFile?r.locateFile(z,c):c+z);var Y=void 0;function $(e){for(var t="",n=e;y[n];)t+=Y[y[n++]];return t}var Z={},X={},ee={};function te(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function ne(e,t){return e=te(e),function(){return t.apply(this,arguments)}}function re(e,t){var n=ne(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ie=void 0;function ae(e){throw new ie(e)}var oe=void 0;function se(e){throw new oe(e)}function ce(e,t,n){function r(t){var r=n(t);r.length!==e.length&&se("Mismatched type converter count");for(var i=0;i<e.length;++i)ue(e[i],r[i])}e.forEach((function(e){ee[e]=t}));var i=new Array(t.length),a=[],o=0;t.forEach((function(e,t){X.hasOwnProperty(e)?i[t]=X[e]:(a.push(e),Z.hasOwnProperty(e)||(Z[e]=[]),Z[e].push((function(){i[t]=X[e],++o===a.length&&r(i)})))})),0===a.length&&r(i)}function ue(e,t,n){if(n=n||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||ae('type "'+r+'" must have a positive integer typeid pointer'),X.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;ae("Cannot register type '"+r+"' twice")}if(X[e]=t,delete ee[e],Z.hasOwnProperty(e)){var i=Z[e];delete Z[e],i.forEach((function(e){e()}))}}function le(e){if(!(this instanceof be))return!1;if(!(e instanceof be))return!1;for(var t=this.$$.ptrType.registeredClass,n=this.$$.ptr,r=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;r.baseClass;)i=r.upcast(i),r=r.baseClass;return t===r&&n===i}function de(e){ae(e.$$.ptrType.registeredClass.name+" instance already deleted")}var pe=!1;function he(e){}function fe(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function me(e){return"undefined"==typeof FinalizationGroup?(me=function(e){return e},e):(pe=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var n=t.value;n.ptr?fe(n):console.warn("object already deleted: "+n.ptr)}})),he=function(e){pe.unregister(e.$$)},(me=function(e){return pe.register(e,e.$$,e.$$),e})(e))}function ve(){if(this.$$.ptr||de(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=me(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function _e(){this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ae("Object already scheduled for deletion"),he(this),fe(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ge(){return!this.$$.ptr}var Ae=void 0,ye=[];function Ee(){for(;ye.length;){var e=ye.pop();e.$$.deleteScheduled=!1,e.delete()}}function Se(){return this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ae("Object already scheduled for deletion"),ye.push(this),1===ye.length&&Ae&&Ae(Ee),this.$$.deleteScheduled=!0,this}function be(){}var Ce={};function we(e,t,n){if(void 0===e[t].overloadTable){var r=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ae("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[r.argCount]=r}}function Oe(e,t,n){r.hasOwnProperty(e)?((void 0===n||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[n])&&ae("Cannot register public name '"+e+"' twice"),we(r,e,e),r.hasOwnProperty(n)&&ae("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),r[e].overloadTable[n]=t):(r[e]=t,void 0!==n&&(r[e].numArguments=n))}function Te(e,t,n,r,i,a,o,s){this.name=e,this.constructor=t,this.instancePrototype=n,this.rawDestructor=r,this.baseClass=i,this.getActualType=a,this.upcast=o,this.downcast=s,this.pureVirtualFunctions=[]}function Ie(e,t,n){for(;t!==n;)t.upcast||ae("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Pe(e,t){if(null===t)return this.isReference&&ae("null is not a valid "+this.name),0;t.$$||ae('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name);var n=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,n,this.registeredClass)}function Re(e,t){var n;if(null===t)return this.isReference&&ae("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,n),n):0;t.$$||ae('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&ae("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;if(n=Ie(t.$$.ptr,r,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ae("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:ae("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var i=t.clone();n=this.rawShare(n,nt((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,n)}break;default:ae("Unsupporting sharing policy")}return n}function De(e,t){if(null===t)return this.isReference&&ae("null is not a valid "+this.name),0;t.$$||ae('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&ae("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,n,this.registeredClass)}function ke(e){return this.fromWireType(C[e>>2])}function Ne(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Fe(e){this.rawDestructor&&this.rawDestructor(e)}function Le(e){null!==e&&e.delete()}function Me(){return Object.keys(Be).length}function je(){var e=[];for(var t in Be)Be.hasOwnProperty(t)&&e.push(Be[t]);return e}function xe(e){Ae=e,ye.length&&Ae&&Ae(Ee)}var Be={};function Ue(e,t){return t=function(e,t){for(void 0===t&&ae("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Be[t]}function Ve(e,t){return t.ptrType&&t.ptr||se("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&se("Both smartPtrType and smartPtr must be specified"),t.count={value:1},me(Object.create(e,{$$:{value:t}}))}function Ge(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var n=Ue(this.registeredClass,t);if(void 0!==n){if(0===n.$$.count.value)return n.$$.ptr=t,n.$$.smartPtr=e,n.clone();var r=n.clone();return this.destructor(e),r}function i(){return this.isSmartPointer?Ve(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ve(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var a,o=this.registeredClass.getActualType(t),s=Ce[o];if(!s)return i.call(this);a=this.isConst?s.constPointerType:s.pointerType;var c=function e(t,n,r){if(n===r)return t;if(void 0===r.baseClass)return null;var i=e(t,n,r.baseClass);return null===i?null:r.downcast(i)}(t,this.registeredClass,a.registeredClass);return null===c?i.call(this):this.isSmartPointer?Ve(a.registeredClass.instancePrototype,{ptrType:a,ptr:c,smartPtrType:this,smartPtr:e}):Ve(a.registeredClass.instancePrototype,{ptrType:a,ptr:c})}function He(e,t,n,r,i,a,o,s,c,u,l){this.name=e,this.registeredClass=t,this.isReference=n,this.isConst=r,this.isSmartPointer=i,this.pointeeType=a,this.sharingPolicy=o,this.rawGetPointee=s,this.rawConstructor=c,this.rawShare=u,this.rawDestructor=l,i||void 0!==t.baseClass?this.toWireType=Re:r?(this.toWireType=Pe,this.destructorFunction=null):(this.toWireType=De,this.destructorFunction=null)}function We(e,t,n){return-1!=e.indexOf("j")?function(e,t,n){var i=r["dynCall_"+e];return n&&n.length?i.apply(null,[t].concat(n)):i.call(null,t)}(e,t,n):L.get(t).apply(null,n)}function ze(e,t){var n,r,i,a=-1!=(e=$(e)).indexOf("j")?(n=e,r=t,i=[],function(){i.length=arguments.length;for(var e=0;e<arguments.length;e++)i[e]=arguments[e];return We(n,r,i)}):L.get(t);return"function"!=typeof a&&ae("unknown function pointer with signature "+e+": "+t),a}var Ke=void 0;function Qe(e){var t=mt(e),n=$(t);return ht(t),n}function qe(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||X[t]||(ee[t]?ee[t].forEach(e):(n.push(t),r[t]=!0))})),new Ke(e+": "+n.map(Qe).join([", "]))}function Je(e,t){for(var n=[],r=0;r<e;r++)n.push(b[(t>>2)+r]);return n}function Ye(e){for(;e.length;){var t=e.pop();e.pop()(t)}}var $e=[],Ze=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Xe(e){e>4&&0==--Ze[e].refcount&&(Ze[e]=void 0,$e.push(e))}function et(){for(var e=0,t=5;t<Ze.length;++t)void 0!==Ze[t]&&++e;return e}function tt(){for(var e=5;e<Ze.length;++e)if(void 0!==Ze[e])return Ze[e];return null}function nt(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=$e.length?$e.pop():Ze.length;return Ze[t]={refcount:1,value:e},t}}function rt(e,t,n){switch(t){case 0:return function(e){var t=n?A:y;return this.fromWireType(t[e])};case 1:return function(e){var t=n?E:S;return this.fromWireType(t[e>>1])};case 2:return function(e){var t=n?b:C;return this.fromWireType(t[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function it(e,t){var n=X[e];return void 0===n&&ae(t+" has unknown type "+Qe(e)),n}function at(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ot(e,t){switch(t){case 2:return function(e){return this.fromWireType(w[e>>2])};case 3:return function(e){return this.fromWireType(O[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function st(e,t,n){switch(t){case 0:return n?function(e){return A[e]}:function(e){return y[e]};case 1:return n?function(e){return E[e>>1]}:function(e){return S[e>>1]};case 2:return n?function(e){return b[e>>2]}:function(e){return C[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function ct(e){try{return h.grow(e-g.byteLength+65535>>>16),F(h.buffer),1}catch(e){}}var ut={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=ut.buffers[e];0===t||10===t?((1===e?u:l)(v(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return ut.varargs+=4,b[ut.varargs-4>>2]},getStr:function(e){return _(e)},get64:function(e,t){return e}};!function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Y=e}(),ie=r.BindingError=re(Error,"BindingError"),oe=r.InternalError=re(Error,"InternalError"),be.prototype.isAliasOf=le,be.prototype.clone=ve,be.prototype.delete=_e,be.prototype.isDeleted=ge,be.prototype.deleteLater=Se,He.prototype.getPointee=Ne,He.prototype.destructor=Fe,He.prototype.argPackAdvance=8,He.prototype.readValueFromPointer=ke,He.prototype.deleteObject=Le,He.prototype.fromWireType=Ge,r.getInheritedInstanceCount=Me,r.getLiveInheritedInstances=je,r.flushPendingDeletes=Ee,r.setDelayFunction=xe,Ke=r.UnboundTypeError=re(Error,"UnboundTypeError"),r.count_emval_handles=et,r.get_first_emval=tt;var lt,dt={G:function(e,t,n,r,i){var a=J(n);ue(e,{name:t=$(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},argPackAdvance:8,readValueFromPointer:function(e){var r;if(1===n)r=A;else if(2===n)r=E;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=b}return this.fromWireType(r[e>>a])},destructorFunction:null})},v:function(e,t,n,i,a,o,s,c,u,l,d,p,h){d=$(d),o=ze(a,o),c&&(c=ze(s,c)),l&&(l=ze(u,l)),h=ze(p,h);var f=te(d);Oe(f,(function(){qe("Cannot construct "+d+" due to unbound types",[i])})),ce([e,t,n],i?[i]:[],(function(t){var n,a;t=t[0],a=i?(n=t.registeredClass).instancePrototype:be.prototype;var s=ne(f,(function(){if(Object.getPrototypeOf(this)!==u)throw new ie("Use 'new' to construct "+d);if(void 0===p.constructor_body)throw new ie(d+" has no accessible constructor");var e=p.constructor_body[arguments.length];if(void 0===e)throw new ie("Tried to invoke ctor of "+d+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(p.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),u=Object.create(a,{constructor:{value:s}});s.prototype=u;var p=new Te(d,s,u,h,n,o,c,l),m=new He(d,p,!0,!1,!1),v=new He(d+"*",p,!1,!1,!1),_=new He(d+" const*",p,!1,!0,!1);return Ce[e]={pointerType:v,constPointerType:_},function(e,t,n){r.hasOwnProperty(e)||se("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==n?r[e].overloadTable[n]=t:(r[e]=t,r[e].argCount=n)}(f,s),[m,v,_]}))},r:function(e,t,n,r,i,a){var o;t>0||H("Assertion failed: "+o);var s=Je(t,n);i=ze(r,i);var c=[a],u=[];ce([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ie("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){qe("Cannot construct "+e.name+" due to unbound types",s)},ce([],s,(function(r){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&ae(n+" called with "+arguments.length+" arguments, expected "+(t-1)),u.length=0,c.length=t;for(var e=1;e<t;++e)c[e]=r[e].toWireType(u,arguments[e-1]);var a=i.apply(null,c);return Ye(u),r[0].fromWireType(a)},[]})),[]}))},f:function(e,t,n,r,i,a,o,s){var c=Je(n,r);t=$(t),a=ze(i,a),ce([],[e],(function(e){var r=(e=e[0]).name+"."+t;function i(){qe("Cannot call "+r+" due to unbound types",c)}s&&e.registeredClass.pureVirtualFunctions.push(t);var u=e.registeredClass.instancePrototype,l=u[t];return void 0===l||void 0===l.overloadTable&&l.className!==e.name&&l.argCount===n-2?(i.argCount=n-2,i.className=e.name,u[t]=i):(we(u,t,r),u[t].overloadTable[n-2]=i),ce([],c,(function(i){var s=function(e,t,n,r,i){var a=t.length;a<2&&ae("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==t[1]&&null!==n,s=!1,c=1;c<t.length;++c)if(null!==t[c]&&void 0===t[c].destructorFunction){s=!0;break}var u="void"!==t[0].name,l=a-2,d=new Array(l),p=[],h=[];return function(){var n;arguments.length!==l&&ae("function "+e+" called with "+arguments.length+" arguments, expected "+l+" args!"),h.length=0,p.length=o?2:1,p[0]=i,o&&(n=t[1].toWireType(h,this),p[1]=n);for(var a=0;a<l;++a)d[a]=t[a+2].toWireType(h,arguments[a]),p.push(d[a]);var c=r.apply(null,p);if(s)Ye(h);else for(a=o?1:2;a<t.length;a++){var f=1===a?n:d[a-2];null!==t[a].destructorFunction&&t[a].destructorFunction(f)}if(u)return t[0].fromWireType(c)}}(r,i,e,a,o);return void 0===u[t].overloadTable?(s.argCount=n-2,u[t]=s):u[t].overloadTable[n-2]=s,[]})),[]}))},F:function(e,t){ue(e,{name:t=$(t),fromWireType:function(e){var t=Ze[e].value;return Xe(e),t},toWireType:function(e,t){return nt(t)},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:null})},K:function(e,t,n,r){var i=J(n);function a(){}t=$(t),a.values={},ue(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:rt(t,i,r),destructorFunction:null}),Oe(t,a)},y:function(e,t,n){var r=it(e,"enum");t=$(t);var i=r.constructor,a=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:ne(r.name+"_"+t,(function(){}))}});i.values[n]=a,i[t]=a},s:function(e,t,n){var r=J(n);ue(e,{name:t=$(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+at(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:ot(t,r),destructorFunction:null})},i:function(e,t,n,r,i){t=$(t),-1===i&&(i=4294967295);var a=J(n),o=function(e){return e};if(0===r){var s=32-8*n;o=function(e){return e<<s>>>s}}var c=-1!=t.indexOf("unsigned");ue(e,{name:t,fromWireType:o,toWireType:function(e,n){if("number"!=typeof n&&"boolean"!=typeof n)throw new TypeError('Cannot convert "'+at(n)+'" to '+this.name);if(n<r||n>i)throw new TypeError('Passing a number "'+at(n)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+r+", "+i+"]!");return c?n>>>0:0|n},argPackAdvance:8,readValueFromPointer:st(t,a,0!==r),destructorFunction:null})},h:function(e,t,n){var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=C,n=t[e>>=2],i=t[e+1];return new r(g,i,n)}ue(e,{name:n=$(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},t:function(e,t){var n="std::string"===(t=$(t));ue(e,{name:t,fromWireType:function(e){var t,r=C[e>>2];if(n)for(var i=e+4,a=0;a<=r;++a){var o=e+4+a;if(a==r||0==y[o]){var s=_(i,o-i);void 0===t?t=s:(t+=String.fromCharCode(0),t+=s),i=o+1}}else{var c=new Array(r);for(a=0;a<r;++a)c[a]=String.fromCharCode(y[e+4+a]);t=c.join("")}return ht(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ae("Cannot pass non-string to std::string");var i=(n&&r?function(){return function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(t)}:function(){return t.length})(),a=ft(4+i+1);if(C[a>>2]=i,n&&r)(function(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(t,y,a+4,i+1);else if(r)for(var o=0;o<i;++o){var s=t.charCodeAt(o);s>255&&(ht(a),ae("String has UTF-16 code units that do not fit in 8 bits")),y[a+4+o]=s}else for(o=0;o<i;++o)y[a+4+o]=t[o];return null!==e&&e.push(ht,a),a},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:function(e){ht(e)}})},n:function(e,t,n){var r,i,a,o,s;n=$(n),2===t?(r=I,i=P,o=R,a=function(){return S},s=1):4===t&&(r=D,i=k,o=N,a=function(){return C},s=2),ue(e,{name:n,fromWireType:function(e){for(var n,i=C[e>>2],o=a(),c=e+4,u=0;u<=i;++u){var l=e+4+u*t;if(u==i||0==o[l>>s]){var d=r(c,l-c);void 0===n?n=d:(n+=String.fromCharCode(0),n+=d),c=l+t}}return ht(e),n},toWireType:function(e,r){"string"!=typeof r&&ae("Cannot pass non-string to C++ string type "+n);var a=o(r),c=ft(4+a+t);return C[c>>2]=a>>s,i(r,c+4,a+t),null!==e&&e.push(ht,c),c},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:function(e){ht(e)}})},H:function(e,t){ue(e,{isVoid:!0,name:t=$(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},l:Xe,m:function(e){e>4&&(Ze[e].refcount+=1)},k:function(e,t){return nt((e=it(e,"_emval_take_value")).readValueFromPointer(t))},E:function(){H()},c:function(e,t){return function(e,t){throw gt(e,t||1),"longjmp"}(e,t)},C:function(e,t,n){y.copyWithin(e,t,t+n)},D:function(e){var t,n,r=y.length;if(e>2147483648)return!1;for(var i=1;i<=4;i*=2){var a=r*(1+.2/i);if(a=Math.min(a,e+100663296),ct(Math.min(2147483648,((t=Math.max(e,a))%(n=65536)>0&&(t+=n-t%n),t))))return!0}return!1},q:function(e,t,n,r){for(var i=0,a=0;a<n;a++){for(var o=b[t+8*a>>2],s=b[t+(8*a+4)>>2],c=0;c<s;c++)ut.printChar(e,y[o+c]);i+=s}return b[r>>2]=i,0},a:function(){return 0|p},g:function(e){var t=Date.now();return b[e>>2]=t/1e3|0,b[e+4>>2]=t%1e3*1e3|0,0},e:function(e,t,n){var r=vt();try{return L.get(e)(t,n)}catch(e){if(_t(r),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},o:function(e,t,n,r){var i=vt();try{return L.get(e)(t,n,r)}catch(e){if(_t(i),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},p:function(e,t,n,r,i){var a=vt();try{return L.get(e)(t,n,r,i)}catch(e){if(_t(a),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},u:function(e,t,n,r,i,a){var o=vt();try{return L.get(e)(t,n,r,i,a)}catch(e){if(_t(o),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},J:function(e,t,n,r,i,a,o,s,c){var u=vt();try{return L.get(e)(t,n,r,i,a,o,s,c)}catch(e){if(_t(u),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},B:function(e,t,n,r,i,a,o,s){var c=vt();try{return At(e,t,n,r,i,a,o,s)}catch(e){if(_t(c),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},z:function(e,t,n,r){var i=vt();try{return Et(e,t,n,r)}catch(e){if(_t(i),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},j:function(e,t){var n=vt();try{L.get(e)(t)}catch(e){if(_t(n),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},x:function(e,t,n){var r=vt();try{L.get(e)(t,n)}catch(e){if(_t(r),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},d:function(e,t,n,r,i){var a=vt();try{L.get(e)(t,n,r,i)}catch(e){if(_t(a),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},I:function(e,t,n,r,i,a,o){var s=vt();try{L.get(e)(t,n,r,i,a,o)}catch(e){if(_t(s),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},w:function(e,t,n,r,i,a,o,s,c){var u=vt();try{L.get(e)(t,n,r,i,a,o,s,c)}catch(e){if(_t(u),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},A:function(e,t,n,r,i,a,o,s,c,u){var l=vt();try{yt(e,t,n,r,i,a,o,s,c,u)}catch(e){if(_t(l),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},b:function(e){p=0|e}},pt=(function(){var e={a:dt};function t(e,t){var n=e.exports;r.asm=n,F((h=r.asm.L).buffer),L=r.asm.P,function(e){if(U--,r.monitorRunDependencies&&r.monitorRunDependencies(U),0==U&&(null!==V&&(clearInterval(V),V=null),G)){var t=G;G=null,t()}}()}function i(e){t(e.instance)}function a(t){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return Q(K)})):fetch(K,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+K+"'";return e.arrayBuffer()})).catch((function(){return Q(K)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){l("failed to asynchronously prepare wasm: "+e),H(e)}))}if(U++,r.monitorRunDependencies&&r.monitorRunDependencies(U),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||W(K)||"function"!=typeof fetch?a(i):fetch(K,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),a(i)}))}))).catch(n)}(),r.___wasm_call_ctors=function(){return(pt=r.___wasm_call_ctors=r.asm.M).apply(null,arguments)}),ht=r._free=function(){return(ht=r._free=r.asm.N).apply(null,arguments)},ft=r._malloc=function(){return(ft=r._malloc=r.asm.O).apply(null,arguments)},mt=r.___getTypeName=function(){return(mt=r.___getTypeName=r.asm.Q).apply(null,arguments)},vt=(r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.R).apply(null,arguments)},r.stackSave=function(){return(vt=r.stackSave=r.asm.S).apply(null,arguments)}),_t=r.stackRestore=function(){return(_t=r.stackRestore=r.asm.T).apply(null,arguments)},gt=r._setThrew=function(){return(gt=r._setThrew=r.asm.U).apply(null,arguments)},At=r.dynCall_iiiijj=function(){return(At=r.dynCall_iiiijj=r.asm.V).apply(null,arguments)},yt=(r.dynCall_iiijiii=function(){return(r.dynCall_iiijiii=r.asm.W).apply(null,arguments)},r.dynCall_vijjjid=function(){return(yt=r.dynCall_vijjjid=r.asm.X).apply(null,arguments)}),Et=r.dynCall_iij=function(){return(Et=r.dynCall_iij=r.asm.Y).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.Z).apply(null,arguments)};function St(e){function n(){lt||(lt=!0,r.calledRun=!0,f||(!0,q(j),q(x),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),B.unshift(e);var e;q(B)}()))}e=e||s,U>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),M.unshift(e);var e;q(M)}(),U>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),n()}),1)):n()))}if(G=function e(){lt||St(),lt||(G=e)},r.run=St,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return St(),e.ready}}();e.exports=r}});