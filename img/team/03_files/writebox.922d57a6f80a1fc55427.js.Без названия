!function(e){function r(r){for(var a,c,n=r[0],m=r[1],l=r[2],d=0,b=[];d<n.length;d++)c=n[d],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&b.push(o[c][0]),o[c]=0;for(a in m)Object.prototype.hasOwnProperty.call(m,a)&&(e[a]=m[a]);for(u&&u(r);b.length;)b.shift()();return i.push.apply(i,l||[]),t()}function t(){for(var e,r=0;r<i.length;r++){for(var t=i[r],a=!0,n=1;n<t.length;n++){var m=t[n];0!==o[m]&&(a=!1)}a&&(i.splice(r--,1),e=c(c.s=t[0]))}return e}var a={},o={"web/writebox":0},i=[];function c(r){if(a[r])return a[r].exports;var t=a[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.e=function(){return Promise.resolve()},c.m=e,c.c=a,c.d=function(e,r,t){c.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,r){if(1&r&&(e=c(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(c.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)c.d(t,a,function(r){return e[r]}.bind(null,a));return t},c.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(r,"a",r),r},c.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},c.p="/js/cmodules/";var n=window.webpackJsonp=window.webpackJsonp||[],m=n.push.bind(n);n.push=r,n=n.slice();for(var l=0;l<n.length;l++)r(n[l]);var u=m;i.push([383,"common","palette","7ed9e4d544bccc8a5ada0a712a9cf1ad","29ce115e24facf4cb9fb345ec7c74430"]),t()}({383:function(e,r,t){e.exports=t("SyNm")},SyNm:function(e,r,t){"use strict";t.r(r);t("91GP"),t("pIFo");var a=t("uytb"),o=t("rjmT"),i=t("v+DW"),c=t("EasH"),n=t("o7bv");function m(){return(m=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var l={mrg:function(e){return vk.rtl?{marginRight:e}:{marginLeft:e}},show:function(e,r){var t=r.toData[0],o=r.toData[7];if(e.setOptions({hideButtons:!0,width:502,bodyStyle:"padding: 0px; border: 0px;",title:r.title,titleControls:('<a class="mail_box_header_link" href="/im?sel='+t+'" onclick="return WriteBox.toFull(event, '+t+')">'+r.mail_go_to_dialog+"</a>").replace("%s",o)}),e.removeButtons(),cur.lang=extend(cur.lang||{},r.lang),extend(cur,{mbTxtInp:{},mbEditable:r.editable,mbSmile:ge("mbe_smile"),toData:r.toData,mbEmoji:r.emoji,mbMedia:null,mbField:ge(r.editable?"mail_box_editable":"mail_box_text"),mbAva:ge("mail_box_ava"),mbMediaTypes:r.mediaTypes,mbTo:r.toData,mbHash:r.hash,mbBannedHim:r.bannedhim,mbExtraSendParams:r.extraSendParams,ldb:Object(a.c)(vk.id)}),r.emojiRcnt&&!cur.mbRcntEmoji){for(var n=[],m=r.emojiRcnt,u=0,d=m.length;u<d;++u){var b=m[u];b&&n.push('<a id="mbe_rc_em_'+b+'" class="mbe_rc_emojibtn" onmousedown="Emoji.addEmoji(cur.emojiWId, \''+b+"', this); return cancelEvent(event);\">"+Emoji.getEmojiHTML(b,!1,!0)+"</a>")}cur.mbRcntEmoji=n.join("")}cur.nav.push(()=>{cur.ldb.unmount()}),val("mbe_rcemoji",cur.mbRcntEmoji||""),cur.peer=l.getPeer(),cur.sharedImWrite={},cur.emojiWId=Emoji.init(cur.mbField,{ttDiff:1,controlsCont:ge("mbe_emoji_wrap"),shouldFocus:!0,onSend:l.send,rPointer:!0,noEnterSend:1,ref:"writebox",noStickers:!!r.checkedRecipent,forceTxt:!r.editable,sharedTT:cur.sharedImWrite,txt:ge("mail_box_editable"),checkEditable:l.checkEditable,saveDraft:l.saveDraft,rceCont:ge("mbe_rcemoji_cont"),addMediaBtn:ge("mail_box_add_row"),sendWrap:ge("mail_box_controls"),onKeyAction:function(e){clearTimeout(cur.saveWriteBoxDraft);var r="paste"==e.type?0:300;cur.saveWriteBoxDraft=setTimeout(l.saveDraft,r)},onStickerSend:function(e,r){var t=trim(Emoji.editableVal(cur.mbField)),a=cur.mbMedia.getMedias(),o=cur.toData[0];ajax.post("/al_im.php",{act:"a_send_box",to_ids:o,chas:cur.mbHash,msg:"",ts:cur.ts,media:"sticker:"+e,send_sticker:1,from:"box",sticker_referrer:r},{onDone:function(e,r){t||a.length?l.send(!1):(r&&ls.set("im_draft"+vk.id+"_"+r,!1),curBox().hide(),showDoneBox(e))},showProgress:i.o.pbind("mail_box_send"),hideProgress:i.w.pbind("mail_box_send"),onFail:function(e){var r=Object(c.d)(getLang("global_error"),e).hide;return setTimeout(r,3e3),!0}})},onRecentEmojiUpdate:function(){l.extractEmoji()}}),Emoji.emojiLoadMore(cur.emojiWId),cur.mbTo[0]?cur.mbHidden=!1:cur.mbHidden=!0,cur.imwEmoji=-1;var s=cur.postTo;cur.postTo=!1,e.setOptions({onHide:function(){removeEvent(document,"keydown",l.onKey),cur.mbEmojiShown&&Emoji.ttClick(cur.emojiWId,cur.mbSmile,!0),cur.mbOnMouseClick&&(cur.onMouseClick=cur.mbOnMouseClick,cur.mbOnMouseClick=!1),browser.mozilla},onShow:function(){addEvent(document,"keydown",l.onKey),cur.mbOnMouseClick||(cur.mbOnMouseClick=cur.onMouseClick),browser.mozilla,cur.sorterClbk&&(cur.sorterClbk(),delete cur.sorterClbk)},onClean:function(){clearTimeout(cur.mbSaveDraftTO),delete cur.mbSaveDraftTO,delete cur.mbField,cur.postTo=s,cur.mbEmojiScroll=cur.mbEmojiExpanded=!1,cur.mbForceAttach=!1,window.WideDropdown&&WideDropdown.deinit("mail_box_dd")}}),addEvent(document,"keydown",l.onKey),cur.mbOnMouseClick||(cur.mbOnMouseClick=cur.onMouseClick),stManager.add(["page.js","page.css"],(function(){var r={mail:1,nocl:1,editable:1,sortable:1,teWidth:150,teHeight:100,toggleLnk:!0,from:"message"};if(cur.mbForceAttach){var t=cur.mbForceAttach[0];"market_item"!==t&&"market_item_service"!==t||(r.onMediaAdd=function(){for(var e in cur.mbMedia.chosenMedias)if("market"==cur.mbMedia.chosenMedias[e][0]){var r=cur.mbMedia.chosenMedias[e][2];hide(geByClass1("page_media_x_wrap",r))}})}cur.mbMedia=new MediaSelector("mail_box_add_link","mail_box_added_row",cur.mbMediaTypes,r),cur.mbMedia.onChange=function(){e.changed=!0,setTimeout((function(){l.saveDraft()}),100)},ls.checkVersion()&&cur.mbTo[0]&&l.restoreDraft(cur.mbTo[0])}))},getPeer:function(){return intval(cur.toData[0])},restoreDraft:function(e){var r=l.getPeer();if(!(!r||e&&r!=intval(e)||browser.mobile)&&cur.mbMedia){var t=Object(o.b)(cur.ldb,r);if(cur.mbForceAttach){var a=cur.mbForceAttach[0],i="market_item_service"===a;if("market_item"===a||i){var c="mail_market_tmpl";i&&(c="mail_market_services_tmpl"),t.setText(unclean(getLang(c)).replace(/<br>/g,"\n")),t.removeAllAttaches(),t.addAttach("market",cur.mbForceAttach[1])}else if("market_order"==cur.mbForceAttach[0]){var n=cur.mbForceAttach[1];t.setText(unclean(getLang("mail_order_tmpl")).replace(/<br>/g,"\n").replace("{id}",""+n)),t.removeAllAttaches()}else cur.mbForceAttach[3]&&t.setText(unclean(getLang(cur.mbForceAttach[3])).replace(/<br>/g,"\n").replace("{username}",cur.toData[9]).replace("{chatname}",unclean(cur.mbForceAttach[4]||"")))}l.editableHasVal(cur.mbField)||(cur.mbEditable?(Emoji.val(cur.mbField,clean(t.dData.txt)),window.Emoji&&Emoji.editableFocus(cur.mbField,!1,!0)):val(cur.mbField,clean(t.dData.txt))),t.prepareObjects().then(()=>{if(cur.mbField&&l.getPeer()==r)for(var e=t.dData.attaches,a=0;a<e.length;a++)cur.mbMedia.chooseMedia(e[a].type,e[a].id,e[a].object||{},null,!0)}),l.checkEditable(cur.emojiWId,cur.mbField),l.checkLen(cur.mbField)}},saveDraft:function(){var e=l.getPeer();if(e&&cur.mbField){var r=Object(o.b)(cur.ldb,e);r.setText(unclean(trim(Emoji.val(cur.mbField)))),r.removeAllAttaches(),cur.mbMedia.getMedias().forEach(e=>r.addAttach(e[0],e[1])),r.destroy()}},toFull:function(e,r){if(!checkEvent(e)){var t={0:"im",sel:r},a=trim(Emoji.editableVal(cur.mbField));if(a&&(t.message=a),cur.mbMedia.chosenMedias){for(var o=cur.mbMedia.getMedias(),i=[],c=0,n=o.length;c<n;++c){var m=o[c],l=[];for(var u in m)"object"!=typeof m[u]&&l.push(m[u]);i.push(l.join(","))}t.media=i.join("*")}return nav.go(t,null,{noback:!0}),!1}},send:function(e){if(!Object(i.k)("mail_box_send")){var r=trim(Emoji.editableVal(cur.mbField)),t=cur.mbMedia.getMedias();cur.mbEditable&&l.extractEmoji();var a=m({act:"a_send_box",chas:cur.mbHash,message:r,title:isVisible("mail_box_title_wrap")&&val("mail_box_title")||"",from:"box",entrypoint:"friends"===cur.module?"friends":"writebox",media:[],to_ids:[]},cur.mbExtraSendParams?cur.mbExtraSendParams:{});cur.mbForceAttach&&(a.attach1_type=cur.mbForceAttach[0],a.attach1=cur.mbForceAttach[1],a.attach1_hash=cur.mbForceAttach[2]);for(var c,n=0,u=t.length;n<u;++n)(c=t[n])&&a.media.push(c[0]+":"+c[1]);if(a.media=a.media.join(","),!r&&!a.media)return cur.mbEditable?Emoji.editableFocus(cur.mbField):elfocus(cur.mbField);a.to_ids=cur.toData[0],cur.mbBannedHim!=a.to_ids||!0===e?ajax.post("al_im.php",a,{onDone:function(e,r){if(r){var t=Object(o.b)(cur.ldb,r);t.clear(),t.destroy()}curBox().hide(),showDoneBox(e)},showProgress:i.o.pbind("mail_box_send"),hideProgress:i.w.pbind("mail_box_send")}):showBox("al_profile.php",{act:"banned_him",action:"mail",mid:cur.mbBannedHim},{dark:1}).onContinue=l.send.pbind(!0)}},checkLen:function(e){cur.mbTxtInp.value=Emoji.editableVal(e),checkTextLength(4096,cur.mbTxtInp,"mail_box_warn"),toggle("mail_box_title_wrap",cur.mbTxtInp.lastLen>200)},codeToChr:function(e){for(var r=e.length/4,t="",a=0;r--;)t+=String.fromCharCode(parseInt(e.substr(a,4),16)),a+=4;return t},editableHasVal:function(e){return!!e&&("TEXTAREA"==e.tagName?!!val(e):!(!geByTag1("IMG",e)&&!stripHTML(val(e)).replace(/[\s\xa0]/g,"").length))},checkEditable:function(e,r){cur.mbEditable&&Emoji.checkEditable(e,r,{height:180})},cssAnimation:function(){var e=intval(browser.version);return!!(browser.chrome&&e>14||browser.mozilla&&e>13||browser.opera&&e>2)},onKey:function(e){var r="INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||"mail_box_editable"==e.target.id;if(!Object(n.a)()){if(e.keyCode>40&&!e.ctrlKey&&!e.metaKey&&!r)if(cur.mbEditable)Emoji.editableFocus(cur.mbField,!1,!0);else{var t=cur.mbField;!t.active&&elfocus(t)}return!0}},extractEmoji:function(){var e=ge("mbe_rcemoji");if(e){var r="",t=Emoji.getRecentEmojiSorted().slice(0,7);for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];r+='<a id="mbe_rc_em_'+o+'" class="mbe_rc_emojibtn" onmousedown="Emoji.addEmoji(cur.emojiWId, \''+o+"', this); return cancelEvent(event);\">"+Emoji.getEmojiHTML(o,!1,!0)+"</a>"}val(e,r)}}};window.WriteBox=l;try{window.stManager.done(window.jsc("web/writebox.js"))}catch(e){}}});