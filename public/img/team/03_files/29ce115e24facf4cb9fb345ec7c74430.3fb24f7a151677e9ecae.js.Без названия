(window.webpackJsonp=window.webpackJsonp||[]).push([["29ce115e24facf4cb9fb345ec7c74430"],{"/eGY":function(e,t,n){"use strict";n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return y})),n.d(t,"h",(function(){return P})),n.d(t,"g",(function(){return T})),n.d(t,"e",(function(){return N})),n.d(t,"f",(function(){return S})),n.d(t,"c",(function(){return x})),n.d(t,"d",(function(){return L}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var r=n("t7n3"),a=n("nAFc"),i=n("/PiP"),o=n("EasH"),c=n("N4ZS"),s=n("8/qD"),u=n("4edV"),d=n("kxld"),l=n("rHUl");var _=n("rudk"),f=n("ftTi"),m=n("P13b"),b=n("4Kbl"),p=n("cYwl"),g=n("R5GP"),h=n("hC3G");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var j="open_link",y="default",I=["app-id","owner-id","type","payload","hash","label","link"];function k(e){var t=e.type,n=e.appId,r=e.ownerId,a=e.hash,o=e.appHash,c="app"+("vkpay"===t?6217559:n)+(r?"_"+r:"");Object(i.H)({w:c+encodeURIComponent("#"+a),from_keyboard:1,app_hash:o})}function C(e){var t=e.peerId,n=e.ownerId,a=e.text,i=e.store,o=Object(d.e)(i,t),c=Object(b.b)(i,n),s=Object(_.c)(t)&&c?c.photo:void 0;!function(e){var t=e.text,n=e.title,a=e.photo;window.Notifier&&window.Notifier.showEvent({text:Object(r.c)(t),title:n,author_photo:a})}({text:a,title:o.name,photo:s})}var E=["open_link","open_app"];function w(e){var t=setTimeout(()=>e.set(u.g),2e3);e.set(e=>Object(u.b)(t,e))}function P(e,t){var n=e.action,r=Object(f.e)(t)===e.peer_id;if(n&&r&&!(E.includes(e.action.type)&&Object(f.a)(t)))switch(e.action.type){case"open_link":!function(e){var t=e.peerId,n=e.store,r=e.link,a=Object(d.e)(n,t),i=new URL(r),o=new MessageBox;o.setOptions({title:getLang("mail_callback_popup_title"),bodyStyle:"overflow: hidden; text-overflow: ellipsis;"});var c=getLang("mail_callback_popup_text").replace("{name}",a.name).replace("{domain}",i.hostname);o.content(c),o.addButton(getLang("box_cancel"),!1,"no"),o.addButton(getLang("global_open"),()=>{window.open(r),o.hide()}),o.show()}({peerId:e.peer_id,link:n.link,store:t}),w(t);break;case"open_app":k({type:n.type,appId:n.app_id,ownerId:n.owner_id,hash:n.hash,appHash:Object(f.c)(t)}),w(t);break;case"show_snackbar":C({peerId:e.peer_id,ownerId:e.owner_id,text:n.text,title:n.title,store:t});break;default:return}}function T(e,t,n,r){var a=e.app_id,i=e.owner_id,c=e.type,b=e.payload,v=e.hash,O=void 0===v?"":v,y=e.link,I=void 0===y?"":y,E=r.keyboardAuthorId,w=r.messageElement,P=r.buttonElement,T=Object(f.c)(n);switch(c){case j:Object(f.e)(n)===h.d&&Object(_.g)(I)&&Object(p.c)(Object(g.b)(n).viewer_id);break;case"vkpay":case"open_app":k({type:c,appId:a,ownerId:i,hash:O,appHash:T});break;case"location":cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:E,action:{label:"",attaches:[e],payload:b}})},Object(o.b)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"text":t({action:e,appHash:T,keyboardAuthorId:E});break;case"callback":var N=Object(d.b)(n);if(!w||!P||!N)break;var S=Number(w.dataset.msgid),A=Object(l.W)(S?N.msgs[S]:N.pinned);if(!A)break;Object(m.gd)(P,!0);var x=A.peerId;Object(s.a)({author_id:E,conversation_message_id:A.chat_local_id,message_id:S,peer_id:x,payload:e.payload}).then(e=>{var t={timeout:setTimeout(()=>{n.set(t=>Object(u.h)({peerId:x,eventId:e},t)).then(()=>Object(m.gd)(P,!1))},6e4),messageId:S,index:Number(P.dataset.index)};n.set(n=>Object(u.e)({peerId:x,eventId:e},t,n))}).catch(e=>{e.error_msg&&C({peerId:x,store:n,text:e.error_msg}),Object(m.gd)(P,!1)});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:c,payload:e.payload}),t({action:e,appHash:T,keyboardAuthorId:E})}}function N(e){return A(e)?"primary":e.color.toLowerCase().replace(y,"secondary")}function S(e){var t=e.action,n=t.label;return"location"===t.type?getLang("mail_keyboard_label_location"):A(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(a.a)(t||""),t=Object(r.c)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function A(e){var t=e.action,n=t.app_id,r=t.type;return"vkpay"===r||"open_app"===r&&6217559===n}function x(e){return I.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function L(e,t){var n=Object.entries(e).reduce((e,t)=>{var n=v(t,2),a=n[0],i=n[1];return e+` data-${a.replace("_","-")}="${Object(r.c)(""+i)}"`},"");e.type===j&&(n+=` href="${Object(c.a)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return n+=` data-index="${t}"`}},"/rNY":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("3qfP");function a(e){return e&&Array.isArray(e)?Object(r.a)(e):e}},"07n8":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c}));var r=n("rHUl"),a=n("tbKy"),i=function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};function o(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[t.length-1];return e.apply(void 0,t).catch((function(n){if(n&&n.match&&n.match(/1001;/))return s(r,e,t);throw n}))}}function c(e){return function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return e.apply(void 0,i([t],n)).catch((function(r){if(r&&r.match&&r.match(/1001;/))return s(t,e,[t].concat(n));throw r}))}}function s(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then((function(i){return i?t.apply(void 0,n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter((function(t){return Object(r.H)(e,+t)}));e.renew_hashes=Object(a.a)(n,{},e).then((function(t){var r=t[0],a=t[1],i=t[2];return n.forEach((function(t){var n=+t;e.tabs[n].hash=r[n]})),e.writeHash=a,e.manageTagsHash=i,delete e.renew_hashes,e.last_hashes_update=Date.now(),e}))}return e.renew_hashes}(e).then((function(){return t.apply(void 0,n)}))}))}},"1y80":function(e,t,n){"use strict";function r(e,t,n,r,a){return window.statlogsValueEvent(e,t,n,r,a)}function a(e){return Math.random()<e}function i(e,t,n,i,o,c){a(e)&&r(t,n,i,o,c)}n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}))},"3qfP":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),function(e){e[e.MENTIONS=1]="MENTIONS",e[e.CASPER=2]="CASPER"}(r||(r={}));var a=n("rudk"),i=function(e){var t=e[0],n=e[1],i=e[2],o=e[3],c=e[4],s=e[5],u=e[6],d=e[7],l=e[8],_=e[9],f=Object.assign({},s||{},u||{});return Array.isArray(f.marked_users)&&(f.marked_users=f.marked_users.filter((function(e){return Object.values(r).includes(e[0])}))),{messageId:t,flags:n,peerId:i,date:o,attaches:Object(a.b)(f,t),subject:f.title||"",text:c,kludges:f,randomId:d,userId:Object(a.c)(i)?Number(f.from)||0:i,update_time:_,chat_local_id:l}};function o(e,t){return!!e.kludges&&(e.kludges.marked_users||[]).some((function(e){if(e[0]!==r.MENTIONS)return!1;switch(e[1]){case"all":return!0;case"online":return e[2].includes(t);default:return e[1].includes(t)}}))}},"4Kbl":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n("aong");function a(e,t){return t in Object(r.s)(e).oCache}function i(e,t){var n=Object(r.s)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}},"4edV":function(e,t,n){"use strict";n.d(t,"i",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"h",(function(){return _})),n.d(t,"b",(function(){return f})),n.d(t,"g",(function(){return m}));var r=n("PEW9"),a=n("ftTi"),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function o(e,t){return t.block_states=i(i({},t.block_states),e),Promise.resolve(t)}function c(e,t){return e.chatList=t,Promise.resolve(e)}function s(e,t){var n=e.count,i=e.countNotMuted;return t.unread_counters={count:n,countNotMuted:i},t.dialog_tab_cts[r.k]=Object(a.g)(t),Promise.resolve(t)}function u(e,t,n){var r=Math.max(0,Object(a.h)(n)+e),i=Math.max(0,Object(a.i)(n)+e);return n.mutedPeers.includes(t)||(n.unread_counters.countNotMuted=r),n.unread_counters.count=i,Promise.resolve(n)}function d(e,t,n){return n.settings[e]=t,Promise.resolve(n)}function l(e,t,n){var r=e.peerId,a=e.eventId;n.keyboardCallbackEventButtons.has(r)||n.keyboardCallbackEventButtons.set(r,new Map);var i=n.keyboardCallbackEventButtons.get(r);return i&&i.set(a,t),Promise.resolve(n)}function _(e,t){var n=e.peerId,r=e.eventId,a=t.keyboardCallbackEventButtons?t.keyboardCallbackEventButtons.get(n):void 0;if(!a)return Promise.resolve(t);var i=a.get(r);return i&&clearTimeout(i.timeout),a.delete(r),a.size||t.keyboardCallbackEventButtons.delete(n),Promise.resolve(t)}function f(e,t){return t.keyboardActionCallbackTimeout=e,Promise.resolve(t)}function m(e){return clearTimeout(e.keyboardActionCallbackTimeout),e.keyboardActionCallbackTimeout=void 0,Promise.resolve(e)}},"6Rqf":function(e,t,n){"use strict";function r(e){return Object.keys(e).map((function(t){var n=e[t];return(t=encodeURIComponent(t||""))+"="+encodeURIComponent(n||"")})).join("&")}function a(e,t){var n=r(t);return fetch(e,{method:"POST",body:n,mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()}))}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}))},"6x51":function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"g",(function(){return b})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return g})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return v})),n.d(t,"i",(function(){return O})),n.d(t,"b",(function(){return j}));var r=n("rudk"),a=n("kxld"),i=n("ftTi"),o=n("Czjj"),c=n("4Kbl"),s=n("PEW9"),u=n("W9Tc"),d=n("4+be"),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},_=function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};function f(e,t,n){var r=e.reduce((function(e,t){return e.set(t.peerId,!0),e}),new Map),a=n||function(){return!0};return _(_([],e),t.filter((function(e){return!r.has(e.peerId)&&a(e)})))}function m(e,t){for(var n in t)t.hasOwnProperty(n)&&b(e,t[n])}function b(e,t){var n,s=Object(c.b)(e,t.peerId),u=Object(a.e)(e,t.peerId),d=t.lastmsg;if(s&&(t.photo=t.photo||s.photo,t.name=t.name||s.name,t.href=t.href||s.link,t.sex=t.sex||s.sex),t.last_touched=(null==u?void 0:u.last_touched)||0,t.verified=!!t.verified,t.lastmsg=d||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,Object(i.k)(e)&&(d||t.lastmsg_meta&&t.lastmsg_meta[0])&&!1===t.lastmsg&&(console.log(l({},t)),Object(o.a)()),t.folders=t.folders||null,t.unread=t.unread||0,t.online=t.online||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(r.j)(t.peerId)){var _=t.last_seen;t.online=_&&(null==_?void 0:_.platform)||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0}}return Object(r.c)(t.peerId)&&(t.memberIds=t.memberIds||(null===(n=u)||void 0===n?void 0:n.memberIds)||null),t}function p(e){return e+19e8}function g(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function h(e){return e===s.c.ALL?function(e){return!Object(a.t)(e)}:e===s.c.UNREAD?function(e){return!Object(a.t)(e)&&(e.unread&&e.unread>0||Object(a.s)(e))}:e===s.c.MR?function(e){return Object(a.t)(e)}:function(t){return t.folders&&t.folders&s.g[e]}}function v(e,t,n){var r=t.data.active.slice(0,4).map((function(t){return Object(c.b)(e,t)})).filter((function(e){return!!e}));return[r.map((function(e){return e.photo})),n?r.map((function(e){return e.link})):[]]}function O(e,t,n){var r=(t.lastmsg||!Object(u.b)("messenger_empty_pinned_support"))&&t.major_sort_id||0,o=(n.lastmsg||!Object(u.b)("messenger_empty_pinned_support"))&&n.major_sort_id||0,c=r!==o?o-r:Object(a.c)(e,n)-Object(a.c)(e,t);return Object(i.m)(e)?-c:c}function j(e,t){var n,i=Object(a.h)(e);return(n={})[s.b.SEARCH]={icon:"search",name:Object(d.d)("mail_im_peer_search")},n[s.b.BLOCK_COMMUNITY]={icon:"block",name:Object(d.d)("mail_block_comm_messages")},n[s.b.BLOCK_NOTIFY]={icon:"block",name:Object(d.d)("mail_block_notify_messages")},n[s.b.ALLOW_COMMUNITY]={icon:"unblock",name:Object(d.d)("mail_allow_comm_messages")},n[s.b.CLEAR]={icon:"clear",name:Object(r.f)(e.peerId)?Object(d.d)("mail_im_delete_email_contact"):Object(d.d)("mail_im_delete_all_history")},n[s.b.MUTE]={icon:"mute",name:Object(d.d)("mail_im_mute")},n[s.b.PIN_CONVO]={icon:"pin_convo",name:Object(d.d)("mail_pin_chat")},n[s.b.UNPIN_CONVO]={icon:"unpin_convo",name:Object(d.d)("mail_unpin_chat")},n[s.b.UNMUTE]={icon:"unmute",name:Object(d.d)("mail_im_unmute")},n[s.b.MEDIA]={icon:"media",name:t?Object(d.d)("mail_im_show_media_history_group"):Object(d.d)("mail_im_show_media_history")},n[s.b.BLOCK]={icon:"block",name:Object(d.d)("mail_block_user")},n[s.b.CHAT_INVITE]={icon:"add",name:Object(d.d)("mail_im_create_chat_with")},n[s.b.USER_INVITE]={icon:"invite",name:Object(r.j)(e.peerId)&&1===e.canBeAddedToChat?Object(d.d)("mail_im_add_to_chat"):Object(d.d)("mail_im_invite_to_chat")},n[s.b.CREATE_CHAT]={icon:"invite",name:Object(d.d)("mail_im_create_chat_with")},n[s.b.LEAVE]={icon:"leave",name:i?Object(d.d)("mail_leave_channel"):Object(d.d)("mail_leave_chat")},n[s.b.RETURN]={icon:"return",name:i?Object(d.d)("mail_return_to_vkcomgroup"):Object(d.d)("mail_return_to_chat")},n[s.b.PIN_HIDE]={icon:"pin_hide",name:Object(d.d)("mail_menu_pin_hide")},n[s.b.PIN_UNHIDE]={icon:"pin_unhide",name:Object(d.d)("mail_menu_pin_show")},n[s.b.UNPIN]={icon:"unpin",name:Object(d.d)("mail_menu_unpin")},n[s.b.SETTINGS]={icon:"settings",name:i?Object(d.d)("mail_vkcomgroup_settings"):Object(d.d)("mail_settings")},n[s.b.CALL_AUDIO]={icon:"call_audio",name:Object(d.d)("mail_im_call_audio")},n[s.b.CALL_VIDEO]={icon:"call_video",name:Object(d.d)("mail_im_call_video")},n[s.b.CALL_APP]={icon:"call_app",name:Object(d.d)("mail_im_call_app")},n[s.b.UNREAD]={icon:"unread",name:Object(d.d)("mail_menu_mark_unread")},n}},"8/qD":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n("rFFZ"),a=n("Db7M");function i(e,t){return Object(r.b)(a.a)("account.setInfo",{name:e,value:t})}function o(e){return Object(r.b)(a.a)("messages.sendMessageEvent",e)}},"86+7":function(e,t,n){"use strict";var r=n("4Kbl");n.d(t,"b",(function(){return r.a})),n.d(t,"c",(function(){return r.b}));var a=n("Wfj7");n.d(t,"a",(function(){return a.a}))},Czjj:function(e,t,n){"use strict";function r(e){void 0===e&&(e=!1),console.trace(),e||window.alert("Вы поймали баг исчезнувшего lastMsg. Пожалуйста откройте консоль (Cmd + Option + I), остановите выполнение JS на странице (F8+cmd+\\) и свяжитесь с командой сообщений на вебе.")}n.d(t,"a",(function(){return r}))},Db7M:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n("6Rqf"),a={domain:"api.vk.com"};function i(e){e=Object.assign({},a,e),a=e}function o(e,t,n){var c=a;n&&(c=Object.assign({},a,n));var s,u,d=c.domain,l=Object(r.b)((u={v:(s=c).version||"5.123"},s.appId&&(u.client_id=s.appId),u)),_=function(e){return{access_token:e.accessToken}}(c),f="https://"+d+"/method/"+e+"?"+l,m=Object.assign({},t,_);return Object(r.a)(f,m).then((function(r){if(r.response)return r.response;var a=r.error;if(!a)return Promise.reject({type:"api_error",error:{error_code:0,error_msg:"Unknown"}});if(c.onCaptcha&&14===a.error_code){var s=a,u=s.captcha_sid,d=s.captcha_img;return c.onCaptcha({captcha_sid:u,captcha_img:d}).then((function(r){var a=Object.assign({},t,r);return o(e,a,n)}))}return!c.onTokenExpired||n&&n.accessToken||5!==a.error_code?Promise.reject({type:"api_error",error:r.error}):c.onTokenExpired().then((function(r){return i({accessToken:r}),o(e,t,n)}))}),(function(e){return Promise.reject({type:"network_error",error:e})}))}},Iqrf:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"k",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"g",(function(){return l})),n.d(t,"i",(function(){return _})),n.d(t,"f",(function(){return f})),n.d(t,"j",(function(){return m})),n.d(t,"l",(function(){return b})),n.d(t,"d",(function(){return p}));var r,a=n("ER42"),i=n("PEW9"),o=function(e,t,n,r,o){return Object(a.b)(i.a,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:n,hash:r,show_history:o?1:0})},c=function(e,t,n,r,o){return Object(a.b)(i.a,{act:"a_get_conversations",offset:o,count:r,filter:n,gid:t,hash:e})},s=function(e,t){return Object(a.b)(i.a,{act:"a_renew_hash",peers:e.join(","),gid:t})};!function(e){e.FRIENDS="friends",e.FRIENDS_AND_CONTACTS="friends_and_contacts",e.ALL="all"}(r||(r={}));var u=function(e,t,n,r){return Object(a.b)(i.a,{act:"a_hints",str:e,gid:t,query:n,peerIds:r.join(",")})},d=function(e,t){return Object(a.b)(i.a,{act:"a_owner_photo",photo:e,peer:t})},l=function(e,t,n,r){return Object(a.b)(i.a,{act:"a_multi_start",hash:e,peers:t.join(","),title:n,flags:r})},_=function(e,t,n){return Object(a.b)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n})},f=function(e,t,n,r){return Object(a.b)(i.a,{act:"a_kick_user",chat:e,hash:n,mid:t,gid:r})},m=function(e,t){return Object(a.b)(i.a,{act:"a_pin_convo",peer_id:e,hash:t})},b=function(e,t){return Object(a.b)(i.a,{act:"a_unpin_convo",peer_id:e,hash:t})},p=function(){return Object(a.b)(i.a,{act:"a_recommend_contacts"})}},MNOG:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("R5GP"),a=n("ftTi");function i(e){var t=Object(a.b)(e),n=Object(a.g)(e),i=t?"mgid"+t:"msg",o=Object(r.b)(e);window.handlePageCount(i,n,"","",o.unread_counters.countNotMuted>0)}},MhhX:function(e,t,n){"use strict";n.d(t,"u",(function(){return i})),n.d(t,"s",(function(){return o})),n.d(t,"h",(function(){return c})),n.d(t,"f",(function(){return s})),n.d(t,"r",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"l",(function(){return _})),n.d(t,"g",(function(){return f})),n.d(t,"t",(function(){return m})),n.d(t,"k",(function(){return b})),n.d(t,"p",(function(){return p})),n.d(t,"q",(function(){return g})),n.d(t,"v",(function(){return h})),n.d(t,"m",(function(){return v})),n.d(t,"d",(function(){return O})),n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return y})),n.d(t,"w",(function(){return I})),n.d(t,"i",(function(){return k})),n.d(t,"o",(function(){return C})),n.d(t,"n",(function(){return E})),n.d(t,"c",(function(){return w})),n.d(t,"j",(function(){return P}));n("OEbY");var r=n("eaP7"),a=n("aong");function i(e,t){return"number"!=typeof t.messageId||(u(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function o(e){return e.kludges&&void 0!==e.kludges.source_act}function c(e){return!(!e.kludges||"call"!==e.kludges.attach1_type)}function s(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function u(e){return e.flags&r.p}function d(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&r.n&&t}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.attaches[0];return r&&(r.type===t||r.type===n)}function _(e){return l(e,"doc")&&"graffiti"===e.attaches[0].kind}function f(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function m(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function b(e){return l(e,"gift")}function p(e){return l(e,"money_transfer","money_request")}function g(e){return l(e,"money_request")}function h(e){return l(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function v(e){return e.flags&r.o}function O(e){return u(e)?vk.id:e.userId}function j(e,t){var n=Object(a.s)(e);return u(t)?n.id:t.userId}function y(e,t){var n=Object(a.s)(e);return n.gid&&u(t)?+t.kludges.from_admin||-n.gid:0}function I(e){return e.update_time>0}function k(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&r.m)}function C(e,t){return!(!e.blocked_community||!u(t))}function E(e){return e.messageId<=0}function w(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function P(e){return!(!e.kludges||!e.kludges.is_expired)}},N4ZS:function(e,t,n){"use strict";function r(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.d(t,"a",(function(){return r}))},O8ze:function(e,t,n){"use strict";n.d(t,"e",(function(){return f})),n.d(t,"g",(function(){return m})),n.d(t,"d",(function(){return b})),n.d(t,"f",(function(){return p})),n.d(t,"k",(function(){return h})),n.d(t,"m",(function(){return v})),n.d(t,"l",(function(){return O})),n.d(t,"h",(function(){return j})),n.d(t,"i",(function(){return k})),n.d(t,"j",(function(){return C})),n.d(t,"c",(function(){return E})),n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return P}));n("pIFo");var r,a=n("1y80"),i=n("Bj12"),o=n("HLtZ"),c=function(){function e(){}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.getBaseEvent=function(){return{id:this.getIntId(),timestamp:this.getCurrentTime()}},e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(i.a)(e):Object(o.c)(new Error("CustomStatCollector: invalid event."))},e.MAX_INT32=2147483647,e}();!function(e){e.TYPE_DEV_NULL_ITEM="type_dev_null_item"}(r||(r={}));var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=function(){function e(e){this.customStatCollector=e}return e.prototype.logEvent=function(e){var t,n=s(s({},this.customStatCollector.getBaseEvent()),((t={type:r.TYPE_DEV_NULL_ITEM})[r.TYPE_DEV_NULL_ITEM]=e,t));this.customStatCollector.logEvent(n)},e}(),d=n("aong"),l=new u(new c),_={};function f(e){Object(a.b)(.1,"im_forward_stat",g(e),!!e.get().gid)}function m(e,t){Object(a.b)(.1,"im_forward_from_community_stat",g(e),!!e.get().gid,+t)}function b(){Object(a.b)(1,"im_apply_community_template_stat",1)}function p(){Object(a.b)(1,"messages_channel_forward_click",1)}function g(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function h(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=1;if(!Object(a.a)(o))return()=>{};var c=+new Date,s=y(e),u=I(e)?"sse":"longpoll";return function(){var e=+new Date-c;Object(i.e)({name:"messages_send_time_web",value:e,keys:[t,n,s,r,u]}),"opt_to_lp"===n&&l.logEvent({key:"messages_send_time_web",value_str:u,value:e})}}function v(e,t,n,r){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var a=[t.messageId.replace("rid",""),n,r].join("_"),i=t.attaches.length>0;_[a]=h(e,n,r,i)}}function O(e,t,n,r){var a=[t.randomId,n,r].join("_"),i=_[a];i&&(i(),delete _[a])}function j(e,t,n,r){var i=y(e),o=""===t?"network":"unknown";Object(a.a)(1)&&Object(a.c)("messages_send_errors_web",o,n,r,i)}function y(e){var t=Object(d.s)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function I(e){var t=Object(d.s)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}function k(e){var t=Object(d.s)(e),n=t.imQueue(t.peer).length;Object(a.a)(1)&&Object(a.c)("messages_send_queue_size",n)}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(a.a)(n)&&Object(a.c)("messages_send_retry",1,t,e)}function E(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(a.c)(e,1))}function w(){Object(a.b)(1,"im_browser_notifications_on",1)}function P(){Object(a.b)(1,"im_browser_notifications_off",1)}},P13b:function(e,t,n){"use strict";n.d(t,"Sb",(function(){return o.H})),n.d(t,"zb",(function(){return o.s})),n.d(t,"kc",(function(){return o.U})),n.d(t,"Nb",(function(){return o.E})),n.d(t,"gc",(function(){return o.O})),n.d(t,"Ob",(function(){return o.F})),n.d(t,"wc",(function(){return o.W})),n.d(t,"Mb",(function(){return o.B})),n.d(t,"Xb",(function(){return o.K})),n.d(t,"Rb",(function(){return o.G})),n.d(t,"kb",(function(){return o.f})),n.d(t,"Jb",(function(){return o.w})),n.d(t,"Id",(function(){return o.Y})),n.d(t,"Kd",(function(){return o.bb})),n.d(t,"Jd",(function(){return o.ab})),n.d(t,"Wb",(function(){return E.k})),n.d(t,"md",(function(){return w.a})),n.d(t,"uc",(function(){return T.g})),n.d(t,"vc",(function(){return T.h})),n.d(t,"Lb",(function(){return d.c})),n.d(t,"nc",(function(){return d.j})),n.d(t,"fc",(function(){return d.i})),n.d(t,"Pb",(function(){return d.e})),n.d(t,"I",(function(){return W})),n.d(t,"v",(function(){return Y})),n.d(t,"H",(function(){return J})),n.d(t,"K",(function(){return X})),n.d(t,"A",(function(){return Q})),n.d(t,"C",(function(){return Z})),n.d(t,"a",(function(){return ee})),n.d(t,"t",(function(){return te})),n.d(t,"q",(function(){return ne})),n.d(t,"j",(function(){return ae})),n.d(t,"k",(function(){return ie})),n.d(t,"n",(function(){return oe})),n.d(t,"m",(function(){return ce})),n.d(t,"o",(function(){return ue})),n.d(t,"r",(function(){return de})),n.d(t,"i",(function(){return le})),n.d(t,"p",(function(){return _e})),n.d(t,"h",(function(){return fe})),n.d(t,"l",(function(){return me})),n.d(t,"u",(function(){return be})),n.d(t,"y",(function(){return pe})),n.d(t,"w",(function(){return he})),n.d(t,"x",(function(){return ve})),n.d(t,"z",(function(){return Oe})),n.d(t,"s",(function(){return je})),n.d(t,"J",(function(){return ye})),n.d(t,"B",(function(){return Ie})),n.d(t,"G",(function(){return ke})),n.d(t,"ob",(function(){return Ce})),n.d(t,"fd",(function(){return Ee})),n.d(t,"N",(function(){return we})),n.d(t,"Y",(function(){return Pe})),n.d(t,"Ib",(function(){return Ne})),n.d(t,"Yc",(function(){return Se})),n.d(t,"pc",(function(){return Ae})),n.d(t,"jb",(function(){return xe})),n.d(t,"bb",(function(){return Me})),n.d(t,"fb",(function(){return De})),n.d(t,"Ab",(function(){return Re})),n.d(t,"xc",(function(){return Be})),n.d(t,"Od",(function(){return Ue})),n.d(t,"cb",(function(){return He})),n.d(t,"ed",(function(){return $e})),n.d(t,"Mc",(function(){return qe})),n.d(t,"db",(function(){return Ge})),n.d(t,"cd",(function(){return Ve})),n.d(t,"Fc",(function(){return Ke})),n.d(t,"M",(function(){return ze})),n.d(t,"bd",(function(){return We})),n.d(t,"tc",(function(){return Ye})),n.d(t,"Uc",(function(){return Je})),n.d(t,"Vc",(function(){return Xe})),n.d(t,"F",(function(){return Qe})),n.d(t,"D",(function(){return Ze})),n.d(t,"E",(function(){return et})),n.d(t,"vb",(function(){return tt})),n.d(t,"bc",(function(){return nt})),n.d(t,"Tb",(function(){return rt})),n.d(t,"ic",(function(){return at})),n.d(t,"jc",(function(){return it})),n.d(t,"ab",(function(){return ut})),n.d(t,"Md",(function(){return dt})),n.d(t,"Dd",(function(){return lt})),n.d(t,"Oc",(function(){return bt})),n.d(t,"Ec",(function(){return pt})),n.d(t,"Nc",(function(){return gt})),n.d(t,"Hc",(function(){return ht})),n.d(t,"Qc",(function(){return vt})),n.d(t,"Gc",(function(){return Ot})),n.d(t,"Rc",(function(){return jt})),n.d(t,"Ic",(function(){return yt})),n.d(t,"Kc",(function(){return It})),n.d(t,"Z",(function(){return kt})),n.d(t,"oc",(function(){return Ct})),n.d(t,"hd",(function(){return Et})),n.d(t,"Gd",(function(){return wt})),n.d(t,"Ac",(function(){return Pt})),n.d(t,"zc",(function(){return Tt})),n.d(t,"Cc",(function(){return St})),n.d(t,"Bc",(function(){return At})),n.d(t,"ad",(function(){return xt})),n.d(t,"hb",(function(){return Lt})),n.d(t,"rc",(function(){return Mt})),n.d(t,"Jc",(function(){return Rt})),n.d(t,"dd",(function(){return Bt})),n.d(t,"Sc",(function(){return Ft})),n.d(t,"L",(function(){return qt})),n.d(t,"Zc",(function(){return Gt})),n.d(t,"hc",(function(){return Vt})),n.d(t,"Bd",(function(){return Kt})),n.d(t,"Rd",(function(){return zt})),n.d(t,"Hd",(function(){return Wt})),n.d(t,"W",(function(){return Yt})),n.d(t,"Lc",(function(){return Jt})),n.d(t,"pd",(function(){return Xt})),n.d(t,"td",(function(){return Qt})),n.d(t,"zd",(function(){return Zt})),n.d(t,"vd",(function(){return en})),n.d(t,"X",(function(){return tn})),n.d(t,"Hb",(function(){return nn})),n.d(t,"Ld",(function(){return rn})),n.d(t,"Ad",(function(){return an})),n.d(t,"U",(function(){return on})),n.d(t,"Vb",(function(){return cn})),n.d(t,"lc",(function(){return sn})),n.d(t,"cc",(function(){return un})),n.d(t,"ec",(function(){return dn})),n.d(t,"dc",(function(){return ln})),n.d(t,"O",(function(){return _n})),n.d(t,"yd",(function(){return fn})),n.d(t,"tb",(function(){return mn})),n.d(t,"sb",(function(){return bn})),n.d(t,"jd",(function(){return gn})),n.d(t,"id",(function(){return hn})),n.d(t,"lb",(function(){return vn})),n.d(t,"od",(function(){return On})),n.d(t,"Qb",(function(){return jn})),n.d(t,"Qd",(function(){return yn})),n.d(t,"Dc",(function(){return In})),n.d(t,"Zb",(function(){return kn})),n.d(t,"Fb",(function(){return Cn})),n.d(t,"Db",(function(){return En})),n.d(t,"Eb",(function(){return wn})),n.d(t,"Gb",(function(){return Pn})),n.d(t,"Tc",(function(){return Nn})),n.d(t,"sc",(function(){return An})),n.d(t,"Nd",(function(){return xn})),n.d(t,"Pc",(function(){return Ln})),n.d(t,"ud",(function(){return Mn})),n.d(t,"nd",(function(){return Dn})),n.d(t,"kd",(function(){return Rn})),n.d(t,"qb",(function(){return Bn})),n.d(t,"xb",(function(){return Un})),n.d(t,"P",(function(){return Hn})),n.d(t,"wd",(function(){return $n})),n.d(t,"xd",(function(){return Fn})),n.d(t,"mc",(function(){return qn})),n.d(t,"ib",(function(){return Gn})),n.d(t,"Ed",(function(){return Vn})),n.d(t,"Yb",(function(){return Kn})),n.d(t,"sd",(function(){return zn})),n.d(t,"Cd",(function(){return Yn})),n.d(t,"S",(function(){return Jn})),n.d(t,"nb",(function(){return Xn})),n.d(t,"gb",(function(){return Qn})),n.d(t,"eb",(function(){return Zn})),n.d(t,"wb",(function(){return er})),n.d(t,"V",(function(){return tr})),n.d(t,"Pd",(function(){return nr})),n.d(t,"Cb",(function(){return rr})),n.d(t,"ub",(function(){return ar})),n.d(t,"T",(function(){return ir})),n.d(t,"Q",(function(){return or})),n.d(t,"R",(function(){return cr})),n.d(t,"yc",(function(){return sr})),n.d(t,"Ub",(function(){return dr})),n.d(t,"ac",(function(){return lr})),n.d(t,"Wc",(function(){return _r})),n.d(t,"Xc",(function(){return pr})),n.d(t,"mb",(function(){return gr})),n.d(t,"g",(function(){return hr})),n.d(t,"b",(function(){return vr})),n.d(t,"f",(function(){return Or})),n.d(t,"e",(function(){return jr})),n.d(t,"d",(function(){return yr})),n.d(t,"c",(function(){return Ir})),n.d(t,"Fd",(function(){return kr})),n.d(t,"Bb",(function(){return Cr})),n.d(t,"Kb",(function(){return Er})),n.d(t,"qc",(function(){return wr})),n.d(t,"pb",(function(){return Pr})),n.d(t,"rd",(function(){return Tr})),n.d(t,"qd",(function(){return Nr})),n.d(t,"yb",(function(){return Sr})),n.d(t,"ld",(function(){return Ar})),n.d(t,"gd",(function(){return xr})),n.d(t,"rb",(function(){return Lr}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("a1Th"),n("91GP"),n("rGqo"),n("pIFo"),n("SRfc"),n("KKXr"),n("VRzm"),n("Btvt");var r=n("eaP7"),a=n("h++7"),i=n("bIHZ"),o=n("rHUl"),c=n("MhhX"),s=n("S2bU"),u=n("jE6c"),d=n("rudk"),l=n("ZxpX"),_=n("yqpO"),f=n("FWc3"),m=n("EasH"),b=n("Egk5"),p=n("1BRX"),g=n("v+DW"),h=n("vT4u"),v=n("ofcU"),O=n("rDjD");function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function k(e,t,n){var r=Object(v.a)({handlers:(r,a)=>{a(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),r=domData(t,"hash"),a=domData(t,"chat-link");return Object(g.o)(t),Object(h.db)(n,r,a,e.get()).then(n=>{var r=j(n,1)[0];Object(g.w)(t);var a=e.get();a.longpoll.push([Object(O.a)(r)]),a.onJoinChat&&a.onJoinChat(r)}).catch(e=>{Object(m.d)(getLang("mail_join_invite_error_title"),e),Object(g.w)(t)})}(t,e.target)),a(e,"click","_im_accept_mr",e=>function(e,t){var n=I(t);return Object(g.o)(t),e.set(h.f.bind(null,n)).then(()=>{Object(g.w)(t),e.get().longpoll.push([Object(O.a)(n)])}).catch(e=>{rr(),Object(m.d)(getLang("mail_join_invite_error_title"),e),Object(g.w)(t)})}(t,e.target)),a(e,"click","_im_reject_mr",e=>function(e,t,n){var r=I(n);return Object(g.o)(n),e.set(h.Qb.bind(null,r)).then(()=>{t.updateMenu(),t.updateList(),Object(g.w)(n),rr()}).catch(e=>{rr(),Object(m.d)(getLang("mail_error"),e),Object(g.w)(n)})}(t,n,e.target))}});return{unmount(){Object(v.c)(r)}}}var C=n("tEnI"),E=n("ftTi"),w=n("Czjj"),P=n("PEW9"),T=n("6x51"),N=n("aong"),S=n("86+7"),A=n("Wu9C"),x=n("wSs/"),L=n("ERyv"),M=n("sp2a"),D=n("t7n3");var R=n("/eGY"),B=n("ambf"),U=n("Syd7"),H=n("nAFc"),$=n("S6+Z"),F=n("zxIV"),q=n("4+be"),G=n("kxld");function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var W="_im_mess_sending",Y="_im_mess_failed",J="_im_mess_restore",X="_im_typing",Q="_im_mess_btn",Z="_im_mess_stack",ee="_im_bot_carousel",te="chat_create",ne="chat_title_update",ae="chat_invite_user",ie="chat_kick_user",oe="chat_photo_update",ce="chat_photo_remove",ue="chat_pin_message",de="chat_unpin_message",le="chat_invite_user_by_link",_e="chat_screenshot",fe="chat_group_call_started",me="chat_kick_user_call_block",be="_im_deselect_all",pe="_im_top_notice_hide",he="_im_aside_notice_hide",ve="_im_aside_promo_block_hide",Oe="_im_vkadmin_promo_link",je="_im_clear_recent",ye="_im_toggle_mr_tab",Ie="_im_mess_search",ke="_im_pinned";function Ce(){return ls.get("chatPosition")||0}function Ee(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function we(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function Pe(e,t,n,r){var a=t&&!n?1:!t&&n?-1:0;a&&!Object(o.B)(e)&&r().compensateHistoryHeightChange(a)}function Te(e,t,n,r){var a=window.devicePixelRatio>=2?"256":"128",i="animation"===n,o="im_gift";i&&(o+=" sticker_img");var c=`<img height="128" class="${o}" src="${Stickers.getStickerUrl(intval(e),a)}"/>`;if(i){var s="animatedSticker"+r;c=`<div id="${s}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${r}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${c}</div>`;var u=!1;browser.msie?(0^r)===r&&(u=!0):u=Number.isInteger(r),u&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(s,10)}return t&&(c=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${c}</a>`),c=`<div class="im_sticker_row">${c}</div>`}function Ne(e,t,n){var r=e.get?e.get():e;if(at(r,t)){var a=r.tabs[t].deleted||[];return inArray(n,a)}return!1}function Se(e,t,n){var r=n.randomId,a=geByClass1("_im_mess_rid"+r,t);return a&&(t=ze(e,n,t=Nt([a],t),!0,!1)),t}function Ae(e){var t=Object(o.a)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):xe().then(e=>e.length>0).catch(e=>!1)}function xe(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function Le(e){return Object(D.n)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function Me(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function De(e){var t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function Re(e){var t=Object(H.a)(e),n=Object($.d)().exec(t);return n?0===n.index?Object(_.a)(n[0]):t[0]:t.split(/\s/).reduce((e,t)=>e+t.slice(0,1),"").slice(0,2)}function Be(e){var t=Object(u.q)(e);return Object(_.b)(Object(D.c)(t),!0)}function Ue(e,t,n){var r=domData(n,"msgid"),a=geByClass1("_im_mess_"+r,t),i=n.cloneNode(!0);return a&&(a.parentNode.replaceChild(i,a),Ge(t)),t}function He(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){var a=se(Fe(e,t));r.classList.contains("im-mess_is_editing")&&a.classList.add("im-mess_is_editing"),r.parentNode.replaceChild(a,r),Ge(n)}return n}function $e(e,t,n){var r=geByClass1("_im_mess_"+n,e);if(r){var a=r.closest("._im_mess_stack"),i=a&&a.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Fe(e,t){var n=[],r=Object(c.u)(e.tabs[t.peerId],t),a=Object(c.h)(t)||Object(c.f)(t),i=Object(o.o)(e),u=Object(c.e)(t)?Object(D.n)("im_message_media",{type:"reply",messageId:t.messageId,attaches:Le("reply"),text:""}):"";a||n.push("_im_mess"),Object(c.r)(t)&&r&&!a&&n.push("im-mess_unread _im_mess_unread"),Object(c.r)(t)&&!a&&n.push("im-mess_out"),Object(c.w)(t)&&n.push("im-mess_was_edited"),Object(x.a)(e,t)&&n.push("im-mess_editable"),Object(c.m)(t)&&n.push("im-mess_fav"),-1!==(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected"),i&&i.messageId===t.messageId&&n.push("_im_mess_pinned");var l=Date.now()-1e3*t.date>1e3;t.local&&l&&n.push("im-mess_sending"),t.local&&n.push(""+W),t.local&&Object(c.w)(t)&&!r&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+Y),Object(c.k)(t)&&n.push("im-mess_gift"),a&&n.push("_im_mess_callsnippet"),Object(c.i)(t)&&n.push("im-mess_casper");var _=qe(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons,n=0;return[].concat(Object(D.n)("sImMessageKeyboard",{content:t.map(t=>Object(D.n)("sImMessageKeyboardRow",{content:t.map(t=>Object(D.n)("sImMessageKeyboardButton",{label:Object(R.f)(t),appearance:Object(R.e)(t),type:t.action.type,modifier:t.action.type.replace("_","-"),attributes:Object(R.d)(t.action,n++,e.messageId),tagName:t.action.type===R.b?"a":"button"})).join("")})).join("")}))}return[]}(t)),f=function(e,t){var n="",r=Object(N.s)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(c.w)(t)&&(n+=Object(D.n)("sImLblWasEdited",{update_time:t.update_time}));if(Object(o.E)(e)&&r){var a=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(D.J)(a))).link&&i.info&&(i.link=Object(s.d)(Object(D.c)(i.link),s.a.bind(null,!1)),i=Object(D.c)(langStr(Object(q.d)("mail_source_info"),"link",i.link,"info",Object(D.c)(i.info))),n+=Object(D.n)("sImLblWasSourceInfo",{source:i}))}catch(e){}}return n}(e,t),m=u+st(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(d.c)(t.peerId)&&(m=Object(D.n)("im_topic",{topic:t.subject})+m);var b=Object(c.k)(t)?`<div class="im-mess--gift-lbl">${m}</div>`:"",p=_.length>0?Object(D.n)("im_message_media",{type:"media",messageId:t.messageId,attaches:_.join(""),text:b}):"",g=t.kludges.has_template?function(e){return'<div class="bot-carousel-placeholder _im_bot_carousel_'+e.messageId+'"></div>'}(t):"";if(Object(c.k)(t)||(p=m+g+p),Object(c.h)(t)){var h=function(e,t,n,r){var a=vk.id,i=e.attaches[0],o=i.initiatorId,c=i.state,s=a===o,u=Boolean(e.kludges.attach1_call_video),d=e.kludges.attach1_call_participants&&JSON.parse(e.kludges.attach1_call_participants)||{},l="group_call"===e.kludges.attach1_kind,_={title:"",description:"",modifier:""},f=u?Object(q.d)("mail_call_snippet_outgoing_video"):Object(q.d)("mail_call_snippet_outgoing"),m=u?Object(q.d)("mail_call_snippet_incoming_video"):Object(q.d)("mail_call_snippet_incoming");switch(c){case"reached":var b=t?"":Ve(i.duration);_.title=s?f:m,_.description=`${Object(q.d)("mail_call_snippet_finished")} · ${b}`;break;case"canceled_by_initiator":_=s?{title:f,description:Object(q.d)("mail_call_snippet_canceled")}:{title:m,description:Object(q.d)("mail_call_snippet_missed")};break;case"canceled_by_receiver":if(s){if(t)return Object(q.d)("mail_call_declined");_={title:f,description:Object(q.d)("mail_call_snippet_declined")}}else _={title:m,description:Object(q.d)("mail_call_snippet_canceled")};break;default:_.title=Object(q.d)("mail_added_call")}l&&(_.title=Object(q.d)("mail_call_snippet_group"));var p=Object.keys(d);return _.user_list=Ke(r,p),_.button="",_.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",_.attributes=`data-participants="${p.join(",")}"`,_}(t,!1,0,e);p+=Object(D.n)("sImCallSnippet",h)}return p+=f,Object(D.n)("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${Object(q.d)("mail_send_message_error")}" role="link"`:"",unread_params:r?`aria-label="${Object(q.d)("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>p)}function qe(e){return e.attaches.reduce((t,n)=>!Object(c.e)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(Te(n.id,n.productId,n.kind,e.messageId)):t.push(Te(n.id,n.productId)):t.push(Le(n.type))),t):t,[])}function Ge(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",Object(D.n)("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function Ve(e){var t=Math.floor(e/3600),n=Math.floor(e/60)-60*t,r=!1,a=!1;return[t,n,e-3600*t-60*n].reduce((e,t)=>{if(0===t&&!a)return a=!0,e;r&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return r=!0,a=!0,n},"")}function Ke(e,t){if(!t.length)return"";var n=t.slice(0,3).reduce((t,n)=>{var r=Object(S.c)(e,n);return r&&(t+=Object(D.n)("sImCallUser",{url:r.photo,name:r.name})),t},"");return Object(D.n)("sImCallUsers",{users:n})}function ze(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,s=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),s.skipped>0)return n;var u=[];t.local||(u=e.imQueue(t.peerId,r)),u.length>0&&Nt(u.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var l=Fe(e,t),_=domLC(n);hasClass(_,"_im_mess_stack")||(_=domClosestSibling(_,"._im_mess_stack",-1));for(var f=Object(o.k)(e,t.peerId,t.messageId);t.peerId===e.peer&&f&&!geByClass1("_im_mess_"+f.messageId);)f=Object(o.k)(e,t.peerId,f.messageId);var m=geByClass1("_im_unread_bar_row",n),b=f?ot(f.date,e):0,g=Object(d.c)(t.peerId)&&Object(o.x)(e,t.peerId);if(!f||ct(s,f,t,e,a)){var h="",v=!1;if(m&&Object(c.r)(t)&&In(e,n,t.peerId),1===s.unread&&!Object(c.r)(t)&&a&&(h+=Object(D.n)("im_mess_bar",{}),v=!0,In(e,n,t.peerId)),!Object(p.h)(new Date(b))&&!g){var O=new Date,j=v?"im-page--history-new-bar_hide _im_invisible_bar":"";h+=Object(D.n)("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,Object(q.d)("months_of","raw"),!0),date:t.date,day_class:O.getDate()+O.getMonth()+O.getFullYear()+" "+j})}if(Object(c.s)(t))h+=Object(D.n)("im_service_row",{text:Ft(e,t,s.peerId),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var y=br(e,t);h+=Object(D.n)("im_mess_stack",Object.assign(y,{messages:l}))}Object(N.q)(sech(h)).forEach(e=>n&&n.appendChild(e))}else m&&e.peer===t.peerId&&!s.inplaceSearch&&Object(c.r)(t)&&In(e,n,t.peerId),geByClass1("_im_stack_messages",_).appendChild(se(l));return Object(c.r)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,W)&&addClass(e,"im-mess_sending")},500),u=u.filter(e=>e.rid!==t.randomId),Ge(n),We(u,e,n)}function We(e,t,n){var r;return(r="object"==typeof e?e:t.imQueue(e,!1)).length>0&&r.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(o.m)(t,e.peerId,e.messageId)).forEach(e=>ze(t,e,n,!1)),n}function Ye(e,t,n){var r=e.tabs[t];return Object(N.q)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&r.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function Je(e,t,n){var r=t.peerId,a=t.messageId,i=geByClass1("_im_msg_reply"+a,e),o=geByClass1("_im_msg_media"+a,e),c=n.tabs[r].mediacontent[a][0];return i&&(i.innerHTML=c[0]),o&&(o.innerHTML=c[1]),e}function Xe(e,t,n){var r=t.messageId,a=e.querySelector("._im_bot_carousel_"+r);if(a){var i=function(e,t){var n=Object(o.m)(e,t.peerId,t.messageId).kludges.template,r=!1;if(!n)return"";var a=n.elements.reduce((e,n,a)=>{var i="",o="",c=Object(D.c)(n.title),s=Object(D.c)(n.description);if(n.photo&&(i+=Object(D.n)("sImBotCarouselSlidePhoto",{url:n.photo.sizes.find(e=>"q"===e.type).url,alt:c||s||""}),r=!0),c&&(o+=Object(D.n)("sImBotCarouselSlideTitle",{content:c})),s&&(o+=Object(D.n)("sImBotCarouselSlideDescription",{content:s})),(n.title||n.description)&&(i+=Object(D.n)("sImBotCarouselSlideContent",{content:o})),n.action&&("open_link"===n.action.type&&(i=Object(D.n)("sImBotCarouselSlideLinkWrapper",{content:i,url:n.action.link})),"open_photo"===n.action.type&&(i=Object(D.n)("sImBotCarouselSlidePhotoLinkWrapper",{content:i,photo_id:`${n.photo.owner_id}_${n.photo.id}`,msg_id:t.messageId}))),n.buttons){var u=n.buttons.reduce((e,t,n)=>{var r=Number(a+""+n);return e+=Object(D.n)("sImBotCarouselSlideButton",{label:Object(R.f)(t),appearance:Object(R.e)(t),modifier:t.action.type.replace("_","-"),attributes:Object(R.d)(t.action,r),tag_name:"open_link"===t.action.type?"a":"button"})},"");i+=Object(D.n)("sImBotCarouselSlideButtons",{content:u})}return e+Object(D.n)("sImBotCarouselSlide",{content:i,index:a})},"");return n.elements.length>1?Object(D.n)("sImBotCarousel",{content:Object(D.n)("sImCarousel",{content:a,controls_class:r?"BotCarousel__control--fourth":"BotCarousel__control",scroll_count:"1"}),msg_id:t.messageId}):Object(D.n)("sImBotCarousel",{content:a,msg_id:t.messageId})}(n,t);return domReplaceEl(a,i),e}}var Qe=0,Ze=1,et=2;function tt(e,t){if(!Object(o.H)(t,e.peerId))return Qe;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?Ze:n.msgs["rid"+e.randomId]?et:Qe}function nt(e,t){return e===t.peer}function rt(e,t){return Object(G.a)(Object(o.s)(e,t),1024)}function at(e,t){return!!e.tabs[t]}function it(e,t){return!!at(e,t)&&null!==e.tabs[t].lastmsg}function ot(e,t){return 1e3*e+1e3*t.timeshift}function ct(e,t,n,r,a){if(Object(c.d)(t)!==Object(c.d)(n))return!0;var i=ot(t.date,r),s=ot(n.date,r);if(!isSameDate(i,s))return!0;if(Object(o.E)(r)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(c.s)(t)||Object(c.s)(n))return!0;var u=Object(c.i)(t),d=Object(c.i)(n);if(u!==d)return!0;var l=t.kludges.is_expired,_=n.kludges.is_expired;return!(!u||!d||l===_)||(!(!u||!d||l||_)||!(u&&d&&l&&_)&&(!(!Object(c.h)(n)&&!Object(c.h)(t))||(!(!Object(c.f)(n)&&!Object(c.f)(t))||(!(!Object(c.k)(t)&&!Object(c.k)(n))||(!(!Object(c.l)(t)&&!Object(c.l)(n))||(!!Object(c.e)(n)||!(Object(c.u)(e,t)===Object(c.u)(e,n)||!a||Object(c.r)(n)||Vt(n.peerId,r.gid))))))))}function st(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),c={},u=0;return t=(t=Object(s.d)(t||"",s.a.bind(null,r))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${u}_${i}!`;return c[t]=e,u++,t}),t=Object(s.f)(t),e.isMassMentionsMessageAllowed&&(t=Object(s.e)(t)),t=Object(s.b)(t),t=Object(s.c)(t,t=>{var n=Object(o.i)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${a||Object(E.e)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(c).forEach(e=>{t=t.replace(e,()=>c[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function ut(e){return Object(d.c)(e)?"c"+(e-2e9):Object(d.f)(e)?"e"+Math.abs(e+2e9):Object(d.e)(e)?"mr"+(e-19e8):e}function dt(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function lt(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function _t(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=Object(D.n)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function ft(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=Object(D.n)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return Object(D.n)("sImDialogImRowPhoto",{photo:`<img src="${e}" alt=""/>`});switch(e.length){case 1:return Object(D.n)("sImDialogImRowPhoto",{photo:`<img src="${e[0]}" alt=""/>`});case 2:return e.map((e,n)=>_t(e,t[n])).join("");case 3:return _t(e[0],t[0])+e.slice(1).map((e,n)=>ft(e,t[n+1])).join("");case 4:return e.map((e,n)=>ft(e,t[n])).join("")}}function bt(e,t,n){return"string"==typeof t.photo&&t.photo?Object(D.n)("sImDialogImRowPhoto",{photo:`<img src="${t.photo}" alt="">${t.photo_icon||""}`}):Object(d.c)(t.peerId)&&t.membersCount<2?Object(D.n)("sImDialogImRowPhoto",{photo:`<img src="${e.get().default_chat_photo}" alt="">`}):Array.isArray(t.photo)?mt(t.photo):Object(d.e)(t.peerId)?Object(D.n)("sImContactAvatar",{name:Re(t.tab),size:30,classes:"nim-peer--contact-avatar"}):mt(...Object(T.d)(e,t,n))}function pt(e){var t=e.get().gid?Object(q.d)("mail_search_only_messages_comm"):Object(q.d)("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${Ie}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function gt(){return`<li class="im-search-results-head">${Object(q.d)("mail_search_messages")}</li>`}function ht(){return`<li class="im-search-results-head">${Object(q.d)("mail_search_conversations_sep")}</li>`}function vt(){return`<li class="im-search-results-head">${Object(q.d)("mail_search_dialogs_sep")}</li>`}function Ot(){return`<li class="im-search-results-head _im_recent_bar">\n    ${Object(q.d)("mail_recent_searches")}\n    <button type="button" class="${je} im-page--clear-recent">${Object(q.d)("mail_clear_recent")}</button>\n  </li>`}function jt(e){var t=e.get().popular_sugg,n=Object(o.B)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,r=Object(S.c)(e,n)||t,a=e.get().tabs[n]||t,i=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,a.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(a.online)}" href="${r.link}"><img class="im-popular--avatar" src="${r.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${r.link}">${r.first_name||r.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${lt(a.unread)}</span>\n</div>`}).join("")+"</li>"}function yt(e){if(Object(E.d)(e,"messages_recommendation_list_hidden"))return"<div></div>";var t=Object(G.d)(e),n=t?t.items.map(e=>{return n=t.item_data[e],r=Object(d.e)(n.peer_id),a=r?"/im?sel="+n.peer_id:"/"+n.screen_name,i=!r&&n.online&&n.online_info?"online"+(n.online_info.is_mobile?" mobile":""):"",o=r&&!n.photo?Object(D.n)("sImContactAvatar",{name:Re(n.name),size:46,classes:""}):Object(D.n)("sImUserAvatar",{src:n.photo,online_class:i,classes:""}),Object(D.n)("sImConvoRecommendListUser",{name:n.name,id:n.peer_id,link:a,photo:o});var n,r,a,i,o}):[],r=[Object(D.n)("sImConvoRecommendListButton",{icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.75 3.5a7.25 7.25 0 104.45 12.97l4.26 4.27a.9.9 0 101.28-1.28l-4.27-4.26a7.25 7.25 0 00-5.72-11.7zm0 1.8a5.45 5.45 0 100 10.9 5.45 5.45 0 000-10.9z" fill="currentColor"/></svg>',title:Object(q.d)("mail_recommend_block_action_find_friends"),tag_name:"a",attributes:'href="/friends?act=find" target="_blank"'}),Object(D.n)("sImConvoRecommendListButton",{icon:'<svg fill="none" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M11.18 3.9h1.64c1.1 0 1.8 0 2.35.05.52.04.73.11.84.17a2 2 0 01.87.87c.06.11.13.32.17.84.05.54.05 1.26.05 2.35v7.64c0 1.1 0 1.8-.05 2.35-.04.52-.11.73-.17.84a2 2 0 01-.87.87c-.11.06-.32.13-.84.17-.54.05-1.26.05-2.35.05h-1.64c-1.1 0-1.8 0-2.35-.05a2.26 2.26 0 01-.84-.17 2 2 0 01-.87-.87 2.24 2.24 0 01-.17-.84c-.05-.54-.05-1.26-.05-2.35V8.18c0-1.1 0-1.8.05-2.35.04-.52.11-.73.17-.84a2 2 0 01.87-.87c.11-.06.32-.13.84-.17.54-.05 1.26-.05 2.35-.05zM5.1 8.18c0-2.13 0-3.2.41-4a3.8 3.8 0 011.66-1.66C8 2.1 9.05 2.1 11.18 2.1h1.64c2.13 0 3.2 0 4 .41a3.8 3.8 0 011.66 1.66c.42.82.42 1.88.42 4.01v7.64c0 2.13 0 3.2-.41 4a3.8 3.8 0 01-1.66 1.66c-.82.42-1.88.42-4.01.42h-1.64c-2.13 0-3.2 0-4-.41a3.8 3.8 0 01-1.67-1.66c-.41-.82-.41-1.88-.41-4.01zm6.15 8.02a.9.9 0 100 1.8h1.5a.9.9 0 000-1.8z" fill="currentColor" fill-rule="evenodd"/></svg>',title:Object(q.d)("mail_recommend_block_action_invite"),tag_name:"button",attributes:'data-action="invite_by_phone_number"',classes:"_convoRecommendAction"}),Object(D.n)("sImConvoRecommendListButton",{icon:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 12.73a1.53 1.53 0 012.1.48c.45.7.24 1.64-.47 2.08-.94.59-1.96 1-3.02 1.24l2.9 2.89c.6.59.6 1.55 0 2.14-.59.59-1.55.59-2.15 0L12 18.72l-2.85 2.84a1.53 1.53 0 01-2.16 0 1.5 1.5 0 010-2.14l2.9-2.89a9.8 9.8 0 01-3.01-1.24 1.5 1.5 0 01-.48-2.08c.45-.71 1.39-.92 2.1-.48a6.65 6.65 0 007 0zM12 2c2.87 0 5.2 2.32 5.2 5.16a5.19 5.19 0 01-5.2 5.16 5.19 5.19 0 01-5.2-5.16A5.19 5.19 0 0112 2zm0 3.03c-1.18 0-2.15.95-2.15 2.13S10.82 9.3 12 9.3c1.19 0 2.16-.96 2.16-2.14 0-1.18-.97-2.13-2.16-2.13z" fill="#ee8208"/></svg>',title:Object(q.d)("mail_recommend_block_action_import_ok"),tag_name:"button",attributes:'data-action="import_ok"',classes:"_convoRecommendAction"}),Object(D.n)("sImConvoRecommendListButton",{icon:'<svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#logo_google_color_24__clip0)"><path d="M21.99 12.19c0-.82-.07-1.42-.22-2.04H12.2v3.7h5.62c-.11.92-.72 2.3-2.08 3.23l-.02.13 3.02 2.29.21.02A9.63 9.63 0 0022 12.19z" fill="#4285F4"/><path d="M12.2 21.93c2.75 0 5.06-.88 6.75-2.41l-3.21-2.44c-.87.59-2.02 1-3.54 1a6.13 6.13 0 01-5.8-4.14h-.12l-3.15 2.39-.04.1a10.22 10.22 0 009.1 5.5z" fill="#34A853"/><path d="M6.4 13.94a6 6 0 01-.34-1.97c0-.7.12-1.36.33-1.98l-.01-.13-3.19-2.42-.1.05A9.79 9.79 0 002 11.96a9.79 9.79 0 001.09 4.48l3.3-2.5z" fill="#FBBC05"/><path d="M12.2 5.85c1.91 0 3.2.81 3.94 1.49l2.88-2.75A9.92 9.92 0 0012.2 2C8.2 2 4.77 4.24 3.09 7.5l3.3 2.5a6.15 6.15 0 015.81-4.15z" fill="#EB4335"/></g><defs><clipPath id="logo_google_color_24__clip0"><path fill="#fff" transform="translate(2 2)" d="M0 0h20v20H0z"/></clipPath></defs></svg>',title:Object(q.d)("mail_recommend_block_action_import_google"),tag_name:"button",attributes:'data-action="import_gmail"',classes:"_convoRecommendAction"})],a=n.length?Object(D.n)("sImCarousel",{content:n.join("")+r.join(""),controls_class:"ConvoRecommendList__control",scroll_count:"4"}):r.join("");return Object(D.n)("sImConvoRecommendList",{list_content:a})}function It(e){return Object(N.s)(e).findFriendsStub||""}function kt(e){var t=Boolean(e&&mobPlatforms[e]);return{is_online:Boolean(e&&!t),is_mobile:t}}function Ct(e){var t=Object(N.s)(e);return t.active_tab===P.d&&!Object(o.E)(e)&&t.isRecommendationListEnabled}function Et(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){attr(r,"aria-hidden","false"),addClass(r,"im-mess_failed "+Y);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",Object(q.d)("mail_send_message_error")),attr(a,"role","link")}return n}function wt(e,t,n){var r=geByClass1("_im_mess_"+t,n);if(r){removeClass(r,"im-mess_failed"),attr(r,"aria-hidden","true"),removeClass(r,Y);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",""),attr(a,"role","")}return n}function Pt(e,t){return Nt(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function Tt(e,t){var n=t||document,r=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var a=+t.dataset.count;if(t.dataset.count=a-1,t.classList.remove("_im_expired_message_"+e),1===a)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else r.includes(t)||r.push(t)}}),r.length&&r.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=fr(t),r=se(n);r.classList.add(...e.classList),e.replaceWith(r)}}),t}function Nt(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{var t=e.parentNode;if(t)if(e.classList.contains("im-mess_srv")){var n=t.parentNode;n&&n.removeChild(t)}else t.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>Object(F.Y)("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function St(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var r=Object(F.Y)("_im_mess_stack",n);r&&(t=r.previousElementSibling,1===domChildren(n.parentNode).length&&r.parentNode.removeChild(r))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function At(e,t,n,r){return e.map(e=>geByClass1("_im_mess_"+e,r)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var r=t.innerHTML,a="delete"===n?"mail_deleted_stop":"mail_marked_as_spam";return`<div class="im-mess--text">\n    ${Object(q.d)(a)} <button type="button" data-peer="${e}" class="${J} im-mess--btn">${Object(q.d)("mail_restore")}</button>\n    <div class="_im_mess_original im-mess--original">${r}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),r}function xt(e,t,n){var r=geByClass1("_im_mess_"+e,n);if(r){var a=geByClass1("_im_mess_original",r);val(r,a.innerHTML),removeClass(r,"im-mess_light")}return n}function Lt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return Dt(e,t,n,r,!0,a);var o=60,c=Dt(e,t,n,r,!1,a);return c.length>o?Dt(e,t,n,r,!0,a):c}function Mt(e){var t={[h.d]:1,[h.c]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),r={},a=n.reduce((t,n)=>{var a=(e[n]||{}).userIds;return(void 0===a?[]:a).forEach(e=>{r[e]||(r[e]=!0,t[n]=!0)}),t},{}),i=n.filter(e=>!!a[e]);return i.length>1?"":i[0]}function Dt(e,t,n,r,a,i){var c=function(e,t,n){var r=[],a={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(S.b)(e,t)?parseInt(t,10)!==e.id&&(a[t]=n):r.push(t)})}),r.length&&Object(h.jb)({[n]:r},e),Object.keys(a).sort((e,n)=>t[a[e]].ts-t[a[n]].ts)}(r,e,t);if(0===c.length)return"";var s=Object(d.j)(t)||Object(o.F)(t)?"first_name":a?"short_name":"name",u=Mt(e),l="";u===h.c?l=Object(q.d)("mail_recording_audio_several",c.length):u===h.d&&(l=Object(q.d)("mail_typing_several",c.length));var _=c.slice(0,Math.min(c.length-1,i)),f=_.map(e=>Object(S.c)(r,e)[s]).join(", ");if(c.length>i+1){var m=function(e){var t={};return Object.keys(e).forEach(n=>{var r=e[n].userIds;(void 0===r?[]:r).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);f+=" "+Object(q.d)("mail_and_peer").replace("{count}",m-i).replace("{typing}",l)}else{if(c.length>1&&(f+=" "+Object(q.d)("mail_and_peer_one")),!Object(d.c)(t)&&n)f+=" "+l;else f+=` ${Object(S.c)(r,c[_.length])[s]} ${l}`}return f.trim()}function Rt(){return`<div class="im-page--chat-search-empty">\n    ${Object(q.d)("mail_im_search_empty")}\n  </div>`}function Bt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${r}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${r}">${t}</span>`}function Ut(e,t){return"chat_invite_user_by_message_request"===t?e.name:t===ie?e.inv_name:e.kick_name}function Ht(e,t){return"chat_invite_user_by_message_request"===t?e.inv_name:e.name}function $t(e,t,n){return"chat_invite_user_by_message_request"===e?n:t}function Ft(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.kludges,i=a.source_act,o=intval(a.source_mid),c=intval(Object(d.c)(n)?a.from:t.userId),s=c===o,u=Object(S.c)(e,c),l="raw",_="";switch(i){case te:_="mail_im_chat_created";break;case ne:_=a.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case ae:_=s?"mail_im_returned_to_chat":"mail_im_invited";break;case ie:_=s?"mail_im_left":"mail_im_kicked_from_chat";break;case oe:_="mail_im_photo_set";break;case ce:_=a.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case ue:_=a.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case de:_=a.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case le:_="mail_im_invite_by_link";break;case"chat_invite_user_by_message_request":_="mail_im_invite_by_message_request";break;case _e:_=Object(N.s)(e).id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case fe:_="mail_im_start_group_call";break;case"chat_invite_user_by_call":_="mail_im_invited_to_call";break;case"chat_invite_user_by_call_join_link":_="mail_im_invite_by_call_link";break;case"sent_message_requests_count":_="mail_creation_count_mr_service_msg",l=intval(a.count_mr);break;case"accepted_message_request":_=u.contact_name?"mail_im_accepted_message_request":"mail_im_accepted_message_request_no_name";break;case me:_="mail_im_kick_user_call_block";break;default:return Object(q.d)("mail_no_support")}var f=Object(S.c)(e,o),m=f?$t(i,u.sex,f.sex):u.sex;if(_=(_=(_=langSex(m,Object(q.d)(_,l))).replace("{from}",Bt(u.link,Ht(u,i),r))).replace("{contact}",u.contact_name),o&&!s){var b=a.source_email,p=b?Bt("/im?email="+encodeURIComponent(b),"email",r):Bt(f.link,Ut(f,i),r);_=_.replace("{user}",p)}if(a.source_text&&a.source_text.length>0){var g=a.source_old_text?`«<b class="im_srv_lnk">${a.source_old_text}</b>» &rarr; `:"";_=_.replace("{title}",g+`«<b class="im_srv_lnk">${a.source_text}</b>»`)}if(a.source_act===ue||a.source_act===de)if(a.source_message){var h=Gt(Emoji.emojiToHTML(stripHTML(a.source_message.replace(/<br\s?\/?>/gi," ")),!0)),v=Bt("",h,!1,"im_srv_mess_link");_=_.replace("{msg}",v)}else _=_.replace(/{link}(.+){\/link}/i,(e,t)=>Bt("",t,!1,"im_srv_mess_link"));return _}function qt(e,t,n,r){if(t===oe){var a=geByClass1("_im_mess_"+e.messageId,r);if(a){var i=n.tabs[e.peerId];a.parentNode.innerHTML=Object(D.n)("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:Ft(n,e,i.peerId)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return r}function Gt(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(a.t,"$1$4")}function Vt(e,t){return!t&&e===vk.id}function Kt(e,t){return Object(f.c)(e,{url:Object(o.F)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function zt(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=se(Object(D.n)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",r].join(" ")})),i=!1;function o(){i=!0,removeClass(a,"im-preloader_visible"),a.parentNode&&a.parentNode.removeChild(a),e&&e.classList.remove("_is-loading-list")}e.classList.add("_is-loading-list"),setTimeout(()=>{i||("bottom"===n?e.appendChild(a):e.insertBefore(a,domFC(e)),addClass(a,"im-preloader_visible"))},0),t.then(o).catch(e=>{Object(L.a)("wrapLoading",e),o()})}}function Wt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,r.o,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Yt(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,r=8,a=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(a=i.test(n.className)))break}while(r--&&(n=n.parentNode));return!a||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Jt(e,t){return`<div class="im-mess--text">\n      <span>${Object(q.d)("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${ut(e)}&msgid=${t}">${Object(q.d)("mail_im_goto_conversation")}</a>\n    </div>`}function Xt(e,t,n){var r=Object(q.d)("mail_deleteall1"),a=Object(q.d)("mail_sure_to_delete_all"),i=Object(q.d)("mail_delete");return Object(d.c)(t)&&(Object(G.a)(e,1024)?(r=Object(q.d)("mail_leave_channel"),a=Object(q.d)("mail_unfollow_channel_confirmation"),i=Object(q.d)("mail_unfollow_channel")):a=Object(q.d)("mail_chat_sure_to_delete_all")),Object(o.F)(t)&&(a=Object(q.d)("mail_group_sure_to_delete_all")),Object(m.d)(r,a,i,n,Object(q.d)("global_cancel"))}function Qt(e,t,n){var r=Object(o.s)(e,t),a=Object(d.c)(t),i=a&&Object(o.z)(r),c=a&&Object(o.Z)(r),s=Object(q.d)("mail_deleteall1"),u=Object(q.d)("mail_sure_to_delete_all"),l=Object(q.d)("mail_delete");if(a){if(!Object(o.A)(r))return Xt(r,t,n.bind(null,!0));i?(s=Object(q.d)("mail_leave_channel"),u=Object(q.d)("mail_vkcomgroup_leave_confirm"),l=Object(q.d)("mail_leave_channel")):c?(s=Object(q.d)("mail_reject_mr_confirmation_title"),u=Object(q.d)("mail_reject_mr_confirmation_text"),l=Object(q.d)("mail_message_request_reject")):(s=Object(q.d)("mail_leave_chat"),u=Object(q.d)("mail_chat_leave_confirm"),l=Object(q.d)("mail_leave_chat"))}Object(o.F)(t)&&(u=Object(q.d)("mail_group_sure_to_delete_all"));var _=new MessageBox({title:s,width:i?450:500}).content(u).setButtons(l,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!a),Object(q.d)("global_cancel")).show();return!a||i||c||_.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${Object(q.d)("mail_deleteall1")}</div>`),_}function Zt(e){return Object(m.d)(Object(q.d)("mail_unpin_title"),Object(q.d)("mail_unpin_text"),Object(q.d)("mail_unpin"),e,Object(q.d)("global_cancel"))}function en(e,t,n,r){var a=Object(q.d)("mail_dialog_msg_delete_N",t),i=Object(m.d)(Object(q.d)("mail_dialog_msg_delete_title"),a,Object(q.d)("mail_delete"),()=>r(isChecked(geByClass1("_check_forall"))),Object(q.d)("global_cancel")),o="",c=!1;return n&&(o=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${Object(q.d)("mail_delete_for_all")}</div>`,c=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(o),c&&checkbox(geByClass1("_check_forall")),i}function tn(e,t,n,r,a){t.showProgress(),e.set(r.bind(null,a)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,a),n().updateDialogFilters(e)})}function nn(e,t,n,r){var a=e.get().tabs[t].memberIds;e.set(r.bind(null,"add_member",a)).then(n().showCreation)}function rn(e,t,n){var r=e.get();if(r.active_tab===a.g&&0===r.dialog_tab_cts.mr)return!1;var i=r.active_tab===a.k?a.g:a.k;return e.set(e=>n(i,e)).then(t)}function an(e,t,n){if(e.get().active_tab===a.g&&0===Object(E.i)(e))return Promise.resolve(!1);var r=e.get().active_tab===a.n?a.g:a.n;return e.set(n.bind(null,r)).then(e=>{t().restoreDialogs(e,!0)}).then(()=>!0)}function on(e,t,n,r){if(t.get().active_tab===e&&e!==a.m)return Promise.resolve(t);var i=Object(o.O)(t);return t.set(r.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,i!==Object(o.O)(e)),e))}function cn(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return a.j[a.h]&n.folders}function sn(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(o.G)(e))return!1;var r=n||e.get().tabs[t];return!!(a.j[a.o]&r.folders)}function un(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function dn(e){return null!=e.get().pendingForward}function ln(e,t){return(t.get().block_states[e]||{}).who===vk.id}function _n(e,t){var n=e.get().block_states;Object.keys(n).forEach(a=>{n[a].time?!1===n[a].free&&Date.now()-n[a].time>=5e4&&t.push([r.nb([,1,"gim"+e.get().gid,a,0,""])]):n[a].time=Date.now()})}function fn(e,t,n){var r;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,a)=>{a&&(r=t(n,e,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),r.unmount()}}},n)}function mn(e,t){return bn(e.get(),t,Object(o.s)(e,t).last_seen)}function bn(e,t,n,r){if(n.platform)return Object(q.d)("mail_header_online_status")+(n.mobile?pn(t,!1,!1,!0):"");if(!n.can_see){var a=Object(S.c)(e,t),i=a||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,i.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var o=getDateText(n.time,e.timeshift),c=langSex(Object(S.c)(e,t).sex,Object(q.d)("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",o);return n.mobile&&(c+=pn(t,!1,!1,r)),c}function pn(e,t,n,r){var a={mid:e};n||(a.was=1),t?a.forcetoup=!0:a.forcetodown=!0,a=Object.assign(a,r);var i=JSON.stringify(a).slice(1,-1).replace(/"/g,"&quot;");return Object(D.n)("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function gn(e,t){var n=t.get().tabs[e];return Object(m.b)("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function hn(e,t){return Object(m.b)("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function vn(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function On(e,t,n,r){var a;Hn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(r,i)=>{i&&(a=n(r,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},r),e)}function jn(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function yn(e,t,n){var r=geByClass1("_im_mess_"+e,n);return r&&toggleClass(r,"im-mess_fav",t),n}function In(e,t,n){var r=geByClass1("_im_unread_bar_row",t);if(!r)return t;var a,i=domClosestSibling(r,"._im_mess_stack",-1),c=domClosestSibling(r,"._im_mess_stack"),s=i?geByClass("_im_mess",i).pop():null,u=c?geByClass1("_im_mess",c):null;if(re(r),(a=geByClass1("_im_invisible_bar",t))&&(removeClass(a,"_im_invisible_bar"),removeClass(a,"im-page--history-new-bar_hide")),!u||!s)return t;var d=domData(u,"msgid"),l=Object(o.p)(e,n,d),_=Object(o.m)(e,n,d);if(!l||ct(e.tabs[n],l,_,e))return t;var f=geByClass1("_im_stack_messages",i),m=geByClass1("_im_stack_messages",c).children;return Object(N.q)(m).forEach(e=>{re(e),f.appendChild(e)}),re(c),t}function kn(e,t,n){var r=Object(o.h)(e,e.get().peer);if(!r)return[!1,0];var a=geByClass1("_im_mess_"+r,t);if(!a){var i=Object(o.k)(e,e.get().peer,r);if(!i)return[!0,0];a=geByClass1("_im_mess_"+i.messageId,t)}var c=hasClass(a,"_im_mess_srv")?a:Object(F.Y)("_im_mess_stack",a);if(!c)return[!0,0];var s=a?a.offsetTop:0,u=c.offsetTop+s,d=n.contHeight();return u<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,d-u)]}function Cn(e,t,n){cancelEvent(t);var r=Object(F.Y)("_im_top_notice",n);fadeOut(r,200,re.pbind(r));var a=Object(F.Y)("_im_page_dialogs",r);a&&hasClass(a,"im-page--dialogs-notice")&&removeClass(a,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function En(e,t,n){cancelEvent(t);var r=Object(F.Y)("_im_aside_notice",n);slideUp(r,200,re.pbind(r)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function wn(e,t){cancelEvent(e);var n=Object(F.Y)("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function Pn(e,t){Object(F.Y)("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function Tn(e){var t=e.filter(e=>"reply"!==e.type);return t.length>1?function(e){return[...e].sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(t):t}function Nn(e,t,n,r,a){var i=function(e,t){var n=e.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," ");return n=Object(s.f)(n,(e,t,n,r,a)=>a),t&&(n=Emoji.emojiToHTML(n,!0)),n}(n,r);if(t&&"..."!==t.trim()&&!Object(d.c)(e)&&(i=Object(D.n)("im_topic",{topic:t,cls:"im-topic_dialog"})+i),i)return i;var o=Tn(a),c=K(o,1)[0];return c?Object(D.n)("im_dialog_media",{name:Sn(c,o)}):""}function Sn(e,t){var n={photo:Object(q.d)("mail_added_photos","raw"),video:Object(q.d)("mail_added_videos","raw"),audio:Object(q.d)("mail_added_audios","raw")};switch(e.type){case"mail":var r=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(r,Object(q.d)("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var a=t.filter(t=>t.type===e.type).length;return langNumeric(a,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?Object(q.d)("mail_added_audio_album"):Object(q.d)("mail_added_audio_playlist");case"artist":return Object(q.d)("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return Object(q.d)("mail_added_graffiti");case"audiomsg":return Object(q.d)("mail_added_audiomsg");default:return Object(q.d)("mail_added_docs")}case"geo":case"map":return Object(q.d)("mail_added_geo");case"wall":return Object(q.d)("mail_added_wall");case"wall_reply":return Object(q.d)("mail_added_wall_reply");case"gift":return Object(q.d)("mail_added_gift");case"link":case"share":return Object(q.d)("mail_added_link");case"sticker":return Object(q.d)("mail_added_sticker");case"market":return Object(q.d)("mail_added_market_item");case"money_transfer":return Object(q.d)("mail_added_money_transfer");case"money_request":return Object(q.d)("mail_added_money_request");case"story":return Object(q.d)("mail_added_story");case"mask":return Object(q.d)("mail_added_mask");case"article":return Object(q.d)("mail_added_article");case"call":case"group_call_in_progress":return Object(q.d)("mail_added_call");case"poll":return Object(q.d)("mail_added_poll");case"podcast":return Object(q.d)("mail_added_podcast");default:return Object(q.d)("mail_added_"+e.type)}}function An(e){addClass(e,"im-send-btn_loading")}function xn(e){removeClass(e,"im-send-btn_loading")}function Ln(e){var t=e.get(),n=Object(o.o)(e);if(!n||!Object(A.a)(e,Object(E.e)(e)))return"";var r=Object(S.c)(e,n.userId);if(!r)return"";var a=function(e,t){var n="";if(t&&Object(c.q)(t)&&void 0!==t.kludges.attach1_tr_amount){var r="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(r=Object(q.d)("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var a=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,r,!0);n=Object(q.d)("mail_money_request_collected_amount_from").replace("{amount}",a).replace("{total_amount}",i)}else{var o=langNumeric(t.kludges.attach1_tr_amount/1e3,r,!0);n=Object(q.d)("mail_money_request_collected_amount").replace("{amount}",o)}if(intval(t.kludges.attach1_held_amount)){var s=langNumeric(t.kludges.attach1_held_amount/1e3,r,!0);n+=" "+Object(q.d)("mail_money_request_held_amount").replace("{amount}",s)}t.text&&(n+='<span class="divider"></span>'+st(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=Object(D.n)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}(e,n);if(!a)if(!(a=n.text)&&n.attaches.length){var i=Tn(n.attaches);a=Object(D.n)("im_pinned_message_media",{text:Sn(i[0],i)})}else a=st(e,a,n&&n.kludges||{})||"";return a=a.replace(/<br\s?\/?>/gi," "),Object(D.n)("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:a,link:r.link,name:r.name})}function Mn(e,t,n){var r=n.getAttribute("data-info");r&&Object(f.c)(n,{text:r,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function Dn(e,t,n){var r=+n.getAttribute("data-time");r&&Object(f.c)(n,{text:Object(q.d)("mail_message_edited")+" "+getSmDate(r,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function Rn(e,t,n){var r=n.target,a=r.closest("."+Z),i=a.querySelector("._im_mess");if(i){var o,c=Number(i.getAttribute("data-msgid")),s=B.g.getExpireTime(c),u="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var d=t.querySelectorAll(".im-mess-stack--bomb");Array.from(d).forEach(e=>{e!==r&&tooltips.hide(e,{fasthide:!0})})}var l=Bn(e);Object(f.c)(r,{text:m(formatTime(s)),className:"_im_history_tooltip "+u,appendParentCls:Z,black:1,shift:[12,4],onShowStart:_,onShowEnd(){o=setTimeout(_,500)},onHide(){clearTimeout(o)},force:!0,toup:r.getBoundingClientRect().top>l+37,hasover:!0}),setTimeout(_,500)}function _(){var e=a.querySelector(`.${u} .tt_text`);e&&(e.innerHTML=m(formatTime(B.g.getExpireTime(c)))),o=setTimeout(_,500)}function m(e){return`<div class="wrapped">${e}</div>`}}function Bn(e){var t=Object(E.e)(e),n=Object(o.s)(e,t),r=Object(A.a)(e,Object(E.e)(e))||n&&n.top_banner,a=Object(U.a)();return 105+(r?Un(e):0)+a}function Un(e){var t=Object(o.o)(e);return t&&Object(c.q)(t)?62:52}function Hn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?Dn(t,0,e.target):hasClass(e.target,"_im_page_info")&&Mn(0,0,e.target)})}function $n(e,t,n,r,a){var i,o=e.get();Hn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:o.tabs[n].hash},{onDone:(n,a)=>{a&&(i=r(n,e,t,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},a),e)}function Fn(e,t,n){var r=e.get();Hn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:r.peer,msgid:t,gid:r.gid,hash:r.tabs[r.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function qn(e,t){return!(!Object(d.c)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Gn(e){return!Object(d.c)(e.peerId)||e.data.kicked?0:e.membersCount}function Vn(e,t){var n=[],r=t.find(e=>"mail"===e[0]),a=r?r[1].split(";"):[];for(a.length>100&&(r[1]=a.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),n.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),a=a.slice(100);a.length;a=a.slice(100))n.push({attaches:[["mail",a.slice(0,100).join(";")]]});return n}function Kn(e){return e.length>4096}function zn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(Wn(t,r),{act:"a_chat_preview"}),o=!1;Object(m.b)("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),o&&o.unmount()}},onFail:e=>(setTimeout(()=>Object(m.d)(Object(q.d)("global_error"),e),0),!0),onDone(t){o=k(t.bodyNode,e,a)}},{})}function Wn(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link}:e}function Yn(){Object(m.d)(Object(q.d)("global_error"),Object(q.d)("mail_message_wait_until_uploaded"))}function Jn(e,t){var n=Object(o.s)(e,t.peerId)||{},r=e.get(),a=Object(d.c)(t.peerId)&&Object(M.F)(n,r.id),i=Object(d.c)(t.peerId)&&Object(M.F)(n,t.userId);if(!t)return!1;if(!Object(c.r)(t)&&(!a||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Ne(e,t.peerId,t.messageId))return!1;if(Object(d.c)(t.peerId)){if(!Object(o.A)(n))return!1}else if(n.block_error>0)return!1;return!0}function Xn(e,t){return t.map(t=>Object(S.c)(e,t))}function Qn(e,t){if("number"!=typeof e||0===e)return"";var n,r=[[31536e3,t?Object(q.d)("global_years_accusative","raw"):Object(q.d)("global_age_years","raw")],[2592e3,t?Object(q.d)("global_months_accusative","raw"):Object(q.d)("global_age_months","raw")],[604800,t?Object(q.d)("global_weeks_accusative","raw"):Object(q.d)("global_age_weeks","raw")],[86400,t?Object(q.d)("global_days_accusative","raw"):Object(q.d)("global_age_days","raw")],[3600,t?Object(q.d)("global_hours_accusative","raw"):Object(q.d)("global_hours","raw")],[60,t?Object(q.d)("global_minutes_accusative","raw"):Object(q.d)("global_minutes","raw")],[1,t?Object(q.d)("global_seconds_accusative","raw"):Object(q.d)("global_age_seconds","raw")]],a=e,i=[];if(r.forEach(e=>{var t=K(e,2),n=t[0],r=t[1],o=Math.floor(a/n);a%=n,o>=1&&i.push(langNumeric(o,r))}),1===(n=i.length))return i.pop();var o=i.slice(0,n-1).join(", "),c=i.pop();return Object(q.d)("global_and").replace(/{before}/gi,o).replace(/{after}/gi,c)}function Zn(e,t,n,r){r&&!Ne(e,n,r)&&(Object(o.m)(e,n,r)?(e.setState({msgid:r}),Object(i.b)({msgid:r}),t()):e.get().longpoll.push([Object(O.a)(n,r)]))}function er(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],r=Object(o.W)(n.msgs[domData(t,"msgid")]);return r&&r.peerId==e.get().peer?r:null}function tr(e,t){if(Object(o.B)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(o.d)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function nr(e){var t=Object(N.s)(e),n=Number(t.dialog_tab_cts[a.k]),r=n>0?n:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=r)}function rr(){for(var e=curBox();e;)e.hide(),e=curBox()}function ar(e,t){return Object(q.d)("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function ir(e,t){var n=Object(E.e)(e),r=Object(o.m)(e,n,t);return Object(M.A)(e,n)&&!Object(c.i)(r)}function or(e,t){var n=Object(E.e)(e);return!t.find(t=>{var r=Object(o.m)(e,n,t);return Object(c.i)(r)})}function cr(e,t){var n=Object(E.e)(e);return!t.find(t=>{var r=Object(o.m)(e,n,t);return Object(c.i)(r)})}function sr(e,t){var n=B.g.isProcessed(e.messageId),r=B.g.has(e.messageId),a=B.g.getExpireTime(e.messageId)>B.f;(!r&&!n||r&&a)&&t(e),r&&a&&B.g.remove(e.messageId)}function ur(e){return e===vk.id}function dr(e,t){return Object(d.j)(t)&&!ur(t)&&!Object(o.E)(e)&&!Object(d.e)(t)}function lr(e,t){var n=e.get(),r=Object(o.E)(e);return Object(d.j)(t)&&!ur(t)&&!r&&!inArray(t,n.moneyTransferExcept)&&!Object(d.e)(t)||Object(o.F)(t)&&n.moneyTransferCommAvail&&Object(G.b)(e).moneyTransferAvail&&!r||r&&n.moneyRequestAvail&&!Object(d.c)(t)||Object(d.c)(t)&&Object(G.b)(e).moneyRequestAvail&&!Object(o.x)(e,t)}function _r(e,t,n){var r=geByClass1("_im_mess_"+n.messageId,t),a=r&&r.closest("._im_mess_stack");if(!r||!a)return t;var i,o,c,s=Array.from(a.querySelectorAll("._im_mess")),u=K((o=(i=a).previousElementSibling,c=i.nextElementSibling,[o&&1===o.nodeType?o:null,c&&1===c.nodeType?c:null]),2),d=u[0],l=u[1],_=d&&d.classList.contains("im-expired-message"),f=l&&l.classList.contains("im-expired-message"),m=_&&0===s.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),b=f&&s.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===s.length-1,p=fr((m?+d.getAttribute("data-count"):0)+(b?+l.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),g=se(p);if(m&&(g.classList.add(...d.classList),d.remove()),b&&(g.classList.add(...l.classList),l.remove()),1===s.length)a.replaceWith(g);else{var h=K(s.reduce((e,t)=>{var r=+t.getAttribute("data-msgid");return r<n.messageId&&e[0].push(t),r>n.messageId&&e[1].push(t),e},[[],[]]),2),v=h[0],O=h[1];a.replaceWith(se(mr(e,v))||"",g,se(mr(e,O))||"")}return t}function fr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(D.n)("sImExpiredMessagePlaceholder",{text:langNumeric(e,Object(q.d)("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(l.a)(t)})}function mr(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),r=+t[0].getAttribute("data-msgid"),a=Object(o.m)(e,n,r);return Object(D.n)("im_mess_stack",Object.assign(br(e,a),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function br(e,t){var n=Object(N.s)(e),r=t.peerId,a=t.messageId,i=Object(o.s)(e,r),s=Object(c.d)(t),u=Object(c.a)(e,t),_=Object(S.c)(n,u?-n.gid:s)||i,f=Object(d.c)(r)?_.name:_.first_name,m=_.link||i.href,b=Object(d.c)(r)&&_.image_status?_.image_status:"",p=Object(D.n)("im_mess_stack_name",{name:f+b,link:m,class:Object(c.p)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(c.k)(t)&&(p+=Object(D.n)("sImGiftLabel",{content:langSex(_.sex||0,Object(q.d)("mail_gift_message_sent","raw"))})),Object(c.p)(t)){var g=Object(c.q)(t)?Object(q.d)("mail_money_request_message_sent","raw"):Object(q.d)("mail_money_tranfer_message_sent","raw");p+=Object(D.n)("sImMoneyTransferLabel",{content:langSex(_.sex||0,g)})}var h=function(e,t){var n=Object(N.s)(e),r=t.peerId,a=t.messageId,i=Object(d.c)(r)&&Object(o.x)(n,r),s=Object(c.a)(e,t),u=Object(o.E)(e)?"/gim"+n.gid:"/im",_=i?"":Object(D.n)("im_stack_date",{date:(f=t.date,m=n.timeshift,langDate(1e3*f,"{hour}:{minute} {am_pm}",1e3*m,[],!0)),link:`${u}?sel=${r}&msgid=${a}`});var f,m;if(s&&n.admins[s]){var b=n.admins[s],p=s===vk.id?Object(q.d)("mail_by_you"):b[0];_+=" "+Object(D.n)("im_admin_link",{name:p,href:b[1]})}return _+function(e,t){if(!Object(c.i)(t))return"";var n=K(B.g.getTimings(t.messageId),3),r=n[0],a=n[1],i=n[2],s=Math.max(r+a-i,0);return Object(D.n)("sImBomb",{classnames:Object(l.a)({"im-mess-stack--bomb_hidden":Object(o.x)(e,t.peerId),"im-mess-stack--bomb_expiring":s<=B.e,"im-mess-stack--bomb_expiring-soon":s<=B.d})})}(n,t)}(e,t);return{photo:_.photo,href:m,cls:"",date_attr:"",link:`/im?sel=${r}&msgid=${a}`,name:stripHTML(p),stack_name:p,peerId:s,messageMeta:h,admin:u}}function pr(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=Object(D.n)("im_dialog_media",{name:Object(q.d)("mail_expired_message")})})}function gr(e){return Object(d.c)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,Object(q.d)("mail_im_n_chat_members","raw")):""}var hr=C.f.CONVO_SNIPPET,vr=C.f.CONVO_HEADER,Or=C.f.CONVO_LIST,jr=C.f.CONVO_JOIN_SNIPPET,yr=C.f.CONVO_JOIN_HEADER,Ir=C.f.CONVO_JOIN_BANNER;function kr(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){if(!t)return void window.Calls.startCall(n,a);var i=Object(d.c)(t);if(i){var c=Object(o.s)(e,t),s=V({},c,{canAddMembers:Object(M.x)(e,t,void 0)});window.Calls.startGroupCall(t,[s],r,n,a)}else{var u=Object(S.c)(e,t),l=V({},u,{canAddMembers:!0});window.Calls.call(t,n,[l,[u]],a)}}}function Cr(e){var t=decodeURIComponent(e.target.getAttribute("href"));if(t&&window.Calls&&window.Calls.showJoinPopup)return cancelEvent(e),window.Calls.showJoinPopup(t,C.f.LINK_JOIN_SNIPPET)}function Er(e,t){var n=Object(o.s)(e,t);return!Object(o.E)(e)&&!!n.can_start_call}function wr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){var i=Object(o.s)(e,t);if(!Object(o.A)(i))return;window.Calls.joinCallByLink(n,[i],r,a)}}function Pr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t?"&msgid="+t:"";return`/im?sel=${ut(e)}${n}`}function Tr(e,t){Object(m.b)("al_im.php",{act:"group_calls_onboarding_box"},{params:{hideButtons:!0,hideOnBGClick:!1,width:655,onHide:()=>{"group_calls"===nav.objLoc.promo&&(delete nav.objLoc.promo,nav.setLoc(nav.objLoc)),ls.remove("group_calls_tooltip_shown"),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls"})}},containerClass:"GroupCallsOnboarding",onDone:t=>{var n=geByClass1("GroupCallsOnboarding__call-button",t.bodyNode),r=geByClass1("GroupCallsOnboarding__skipButton",t.bodyNode),a=geByClass1("GroupCallsOnboarding__closeButton",t.bodyNode),i=ge("box_layer",t.bodyNode),c=function(){t.hide();var n=new ElementTooltip(geByClass1("_im_create_call"),{content:Object(q.d)("mail_group_calls_im_search_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:geByClass1("_im_dialogs_search"),width:250,offset:Object(o.B)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){Object(b.i)(n._ttel,"click")}});n.show(),Object(b.b)(n._ttel,"click",()=>n.hide()),cur.destroy.push(()=>{Object(b.i)(n._ttel,"click"),n.destroy()})};Object(b.b)(n,"click",()=>{t.hide(),kr(e,null,!1,null,Or)}),Object(b.b)(r,"click",c),Object(b.b)(a,"click",c);var s=e=>{e.target===i&&(Object(b.i)(i,"click",s),c())};Object(b.b)(i,"click",s),cur.destroy.push(()=>{Object(b.i)(r,"click"),Object(b.i)(a,"click"),Object(b.i)(n,"click"),Object(b.i)(i,"click",s),t.hide(),t.destroy()})}})}function Nr(e,t){cur.groupCallsTooltip||"im"!==cur.module||!isVisible("im_dialogs_search")||cur.introTooltipShow||setTimeout((function(){var n=()=>{cur.groupCallsTooltip&&cur.groupCallsTooltip.destroy(),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})};cur.groupCallsTooltip=new ElementTooltip(geByClass1("_im_create_call"),{content:Object(q.d)("mail_group_calls_im_search_new_year_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:geByClass1("_im_dialogs_search"),width:200,offset:Object(o.B)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){cur.groupCallsTooltip&&(Object(b.i)(cur.groupCallsTooltip._ttel,"click",n),cur.groupCallsTooltip.destroy()),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})}}),cur.groupCallsTooltip.show(),Object(b.b)(cur.groupCallsTooltip._ttel,"click",n),cur.destroy.push((function(){cur.groupCallsTooltip&&(Object(b.i)(cur.groupCallsTooltip._ttel,"click",n),cur.groupCallsTooltip.destroy())}))}),1e3)}function Sr(e,t){var n=20,r=document.querySelector("._im_aside_notice");return r&&(n+=r.offsetHeight),Object(o.E)(e)?n+=268:(n+=120,e.get().hasContacts&&(n+=32),Object(o.d)(e)&&(n+=32)),Math.floor((t-n)/32)}function Ar(e,t,n,r){var a=r?()=>r.removeDialog(e,t):null,i=()=>Object(o.B)(e)&&n().updateMenu(e);return(Object(o.s)(e,t)?Promise.resolve():e.set(e=>Object(h.ub)(t,0,0,0,e))).then(()=>{var n=Object(o.s)(e,t);if(!Object(o.Z)(n)){var r=Object(O.a)(t,!1,!1,!1,"");return e.get().longpoll.push([r])}return zn(e,{receiver_peer_id:t},h.fb,!1,{updateList:a,updateMenu:i})})}function xr(e,t){var n=e.closest("."+ee)?"BotCarousel__slideButton--isLoading":"MessageKeyboard__button--isLoading";e.disabled=t,e.classList.toggle(n,t)}function Lr(e,t,n){var r=e.querySelector("._im_mess_"+t);return r?r.querySelector(`.${Q}[data-index="${n}"]`):null}},RdBX:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("Vd3H"),n("OG14"),n("a1Th"),n("Btvt"),n("KKXr"),n("Oyvg");function r(e,t,n){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}r.prototype.delimiter=r.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),r.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),r.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},r.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},r.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},r.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},r.prototype.strToPrefixes=function(e){for(var t={},n=winToUtf(e).toLowerCase().split(this.delimiter),r=n.length;r--;){var a=n[r],i="";if(a){for(var o=0;o<6;o++){var c=a.charCodeAt(o);if(c){var s=this.toTranslit[c],u=a.substr(o,1);i+=null!=s?s:u}}t[i]=1}}return t},r.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),r=n.length;r--;){var a={},i=n[r],o="",c="",s="",u=i.length>1;if(i){for(var d=0;d<6;d++){var l=i.charCodeAt(d);if(l){var _=this.toTranslit[l],f=i.substr(d,1);if(o+=null!=_?_:f,u){var m=this.toLocalCase[f],b=this.toLocalTranslit[l];c+=null!=m?m:f,s+=null!=b?b:f}}}a[o]=1,u&&(a[c]=2,a[s]=3),t.push(a)}}return t},r.prototype.toIndexTree=function(e,t){for(var n=this.index,r=0;r<6;r++){var a=e.substr(r,1)||-1;n=n[a]?n[a]:n[a]=5==r?[]:{}}n.push(t)},r.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)if(n.hasOwnProperty(r)){for(var a=this.index,i=0;i<6;i++){var o=r.substr(i,1)||-1;if(!a[o])break;a=a[o]}if(a.length)for(var c in a)if(this.equals(a[c],e)){a.splice(c,1);break}}},r.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var r in t)if(void 0===t[r])return!1;return!0},r.prototype.intersect=function(e,t){var n=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&n.push(e.shift()),t.shift());return n},r.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)n.hasOwnProperty(r)&&this.toIndexTree(r,e)},r.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),r=[],a=!1;for(var i in n)if(n.hasOwnProperty(i)){if(a&&!r)break;var o=this.localSearch(n[i],0,t);o.sort((function(e,t){return e._order-t._order})),r=a?this.intersect(r,o):o,a=!0}for(var c=r[0],s=r.length+1,u=[],d=1;d<s;d++){var l=r[d];l!=c&&(u.push(c),c=l)}return u},r.prototype.localSearch=function(e,t,n){if(!n)return[];var r={};for(var a in e)if(e.hasOwnProperty(a)){var i=a.substr(t,1)||-1;r[i]||(r[i]={}),r[i][a]=1}if(6==t++||!n)return n;var o=[];for(var c in r)if(-1==c)for(var s in n)n.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(r[c],t,n[s]));else{var u=this.localSearch(r[c],t,n[c]);o.push.apply(o,u)}return o}},S2bU:function(e,t,n){"use strict";n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return m}));var r,a=n("h++7"),i=n("t7n3"),o=n("hC3G");function c(e,t){for(var n,r=0,i=e;null!==(n=a.u.exec(e));){var o=(n=l(n))[0].length,c=n.index+o,s=e[n.index-1],u=e[c-1],d=void 0!==s&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(s),f=void 0!==u&&/([:;$])/i.test(u);if(!d&&!f){var m=_(n),b=m.domain.toLowerCase();if(b.length<=a.r&&a.A.includes(b)){var p=t(m);i=i.slice(0,n.index+r)+p+i.slice(c+r),r+=p.length-o}}}return i}function s(e,t){return e.replace(a.c,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function u(e,t){return e.replace(a.s,t||function(e,t,n,r,a){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(i.c)(r||"")+'" mention_id="'+Object(i.c)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+a+"</a>"})}function d(e,t){return e.replace(o.b,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}function l(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function _(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function f(e,t){return e.replace((r||(r=new RegExp(a.z,"ig")),r),(function(e,n,r,a,i){return(n||"")+t(r+(i||""))}))}function m(e,t){var n=t.url,r=t.full,o=t.protocol,c=t.query;try{r=decodeURIComponent(r)}catch(e){}if(r.length>55&&(r=r.substr(0,53)+".."),r=Object(i.c)(r).replace(/&amp;/g,"&"),!e&&n.match(a.v)){var s=n=Object(i.F)(n).replace(a.f,encodeURIComponent),u=n.indexOf("#/"),d="";u>=0?s=n.substr(u+1):(u=n.indexOf("#!"))>=0&&(s="/"+n.substr(u+2).replace(/^\//,""));var l=s.match(a.D);return l&&l[1].length<32&&(d=' mention_id="'+l[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(o+n+c)+'" target="_blank" rel="noopener"'+d+">"+r+"</a>"}var _=Object(i.F)(n+c).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(o+_))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.c)((o+n+c).replace(/'/g,"\\'"))+"', {}, event);")+'">'+r+"</a>"}},Syd7:function(e,t,n){"use strict";n.d(t,"a",(function(){return q})),n.d(t,"b",(function(){return V}));var r=n("q1tI"),a=n("i8i4"),i=n("rHUl"),o=n("P13b"),c=(n("91GP"),n("17x9"),n("ZxpX")),s=n("ErRf"),u=n("nAFc"),d=n("ERyv"),l=n("4+be"),_=n("6krn"),f=n("x9XA"),m=n("1Ot2"),b=n("s0Wt"),p=n("vT4u"),g=n("EasH"),h=_.a.getLang;class v extends r.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(g.d)(h("mail_ad_tag_no_access_box_title"),h("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`,n="";n=e.isEasyPromotedMarket?h("mail_ad_tag_easy_promoted_market"):e.hasAdAccess?`${h("mail_ad_tag_text_prefix")} ${e.adId}`:h("mail_ad_tag_no_access_text");var a=r.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},n);return r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&r.createElement("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},a),!e.hasAdAccess&&r.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},a))}return r.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},r.createElement("span",null,Object(u.a)(e.name)))}}var O=_.a.getLang;class j extends r.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,a=e.isPeerProfileCollapsed,i=e.adId,o=e.hasAdAccess,c=e.isEasyPromotedMarket,s=e.toggleProfile,u=n.filter(e=>t.includes(e.id));i&&u.unshift({adId:i,hasAdAccess:o,isEasyPromotedMarket:c});var d=0;a&&this.state.isTagsCollapsed&&u.length>5&&(d=u.splice(5).length);return u=u.map((e,t)=>r.createElement(v,{key:t,data:e})),r.createElement("div",{className:"PeerProfileTagsList"},u.length>0&&u,d>0&&r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+O("mail_im_peer_profile_extra_tags",d)),!u.length&&r.createElement("div",{className:"PeerProfileTagsListItem--empty"},O("mail_im_peer_profile_tags_empty")," ",r.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",r.createElement(f.a,{className:"PeerProfileTagsList__toggleProfileLink",onClick:s},O(a?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var y=n("wQFj");function I(e){var t=e.data,n=e.onCheckboxChange,a=Object(u.a)(t.name);return r.createElement("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),n(t.id,!t.isChecked)}},r.createElement(y.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,r)=>n(t.id,r)},r.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),r.createElement("span",{className:"PeerProfileTagsGridItem__name",title:a},a)))}class k extends r.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return r.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>r.createElement(I,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var C=n("e87a"),E=n("BiHW"),w=n("WfnU"),P=n("GSQL"),T=_.a.getLang;class N extends r.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=r.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,a=e.onNameChange,i=e.onRemove;return r.createElement("div",{className:"PeerProfileTagsModalField"},r.createElement("input",{type:"hidden",value:n.id?n.id:""}),r.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(u.a)(n.name),ref:this.inputRef,onChange:e=>a(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:T("mail_im_peer_profile_manage_tags_placeholder")}),r.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),r.createElement(b.default,{position:"t",text:T("mail_im_peer_profile_manage_tags_remove")},r.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var A=_.a.getLang,x=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],L=x[0];class M extends r.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():L,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return x.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,r)=>r===t?S({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.state.tags,a=r[e];!n&&a.id&&a.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter((t,n)=>n!==e),deletedTags:[...t.state.deletedTags,S({},a,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map(e=>S({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=r.createRef()}render(){var e=this.state,t=e.tags,n=e.isConfirmationModalOpen,a=t[e.indexToRemove],i=Object(c.a)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":n});return r.createElement(r.Fragment,null,r.createElement(C.default,{onClose:this.props.onClose,className:i,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(P.default.Header,{title:A("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(P.default.Body,null,r.createElement(m.a,{className:"PeerProfileTagsModal__scroll",neverHide:!0},r.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>r.createElement(N,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?r.createElement(f.a,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},A("mail_im_peer_profile_manage_tags_add_link")):""))),r.createElement(P.default.Footer,{actionButtons:[r.createElement(E.a,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},A("global_cancel")),r.createElement(w.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},A("global_save"))]}))),n&&r.createElement(P.default,{title:A("global_warning"),appearance:"blue",actionButtons:[r.createElement(E.a,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},A("global_cancel")),r.createElement(E.a,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)}},A("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},Object(l.l)(1===a.uses?A("mail_im_peer_profile_tag_delete_confirmation_text_single"):A("mail_im_peer_profile_tag_delete_confirmation_text",a.uses,!0),"tag_name",Object(u.a)(a.name))))}}var D=n("s1Gz"),R=_.a.getLang;class B extends r.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.preventDefault();var r=t.state.note&&t.state.note.trim();n||r?(t.setState({isLoading:!0}),t.props.onNoteSave(r)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=r.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=Object(c.a)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[r.createElement(E.a,{key:"delete",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton"},R("mail_im_peer_profile_note_delete_link"))]:[],r.createElement(E.a,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},R("global_cancel")),r.createElement(w.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},R("global_save"))];return r.createElement(r.Fragment,null,r.createElement(C.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(P.default.Header,{title:R("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(P.default.Body,null,r.createElement(D.default,{className:"PeerProfileNoteModal__input",value:Object(u.a)(this.state.note),placeholder:R("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})),r.createElement(P.default.Footer,{actionButtons:t}))),this.state.isConfirmationModalOpen&&r.createElement(P.default,{title:R("global_warning"),appearance:"blue",actionButtons:[r.createElement(E.a,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},R("global_cancel")),r.createElement(E.a,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},()=>this.onSubmit(null,!0))}},R("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},R("mail_im_peer_profile_note_delete_confirmation_text")))}}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var H=_.a.getLang;class $ extends r.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,r=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(p.Gb.bind(null,e,t,t?"bind":"unbind",r)).catch(e=>Object(d.a)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(p.Eb.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),showDoneBox(H("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(d.a)("PeerProfile.manageTags",e))})},this.onNoteSave=e=>{var t=this.props.store,n=t.get().peer;t.set(p.Fb.bind(null,n,e)).then(()=>{this.setState({note:e,isNoteModalOpened:!1}),showDoneBox(H(e?"mail_im_peer_profile_save_note_success":"mail_im_peer_profile_delete_note_success"),{out:1e3})}).catch(e=>Object(d.a)("PeerProfile.saveNote",e))},this.toggleModal=(e,t,n)=>{switch(e&&e.preventDefault(),n){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&Object(s.c)("peer_profile_modal",()=>{Object(s.a)("peer_profile_modal"),this.toggleModal(null,!1,n)})};var t=e.store.get(),n=t.peer,r=Object(i.s)(t,n),a=r.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:r.peer_tags?r.peer_tags.ids:[],note:a.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.s)(e,e.peer),n=this.state,a=n.isCollapsed,o=n.tags,s=n.peerTags,d=n.note,_=n.isTagsModalOpened,p=n.isNoteModalOpened,g=o.length>0,h=g?o.reduce((e,t)=>(e[t.id]=!0,e),{}):[],v=s.filter(e=>h[e]),O=t.peer_profile_info,y=O&&(O.city||O.age),I=Object(c.a)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":a});return r.createElement("div",{className:I},r.createElement(m.a,{className:"PeerProfile__scroll",neverHide:!0},r.createElement("dl",{className:"PeerProfile__container"},r.createElement("dt",{className:"PeerProfile__label"},H("mail_im_peer_profile_tags_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},a&&!g&&!t.ad_id&&r.createElement(f.a,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},H("mail_im_peer_profile_manage_tags")),(g||t.ad_id)&&r.createElement(j,{tags:o,peerTags:v,isPeerProfileCollapsed:a,adId:t.ad_id,hasAdAccess:t.has_ad_access,isEasyPromotedMarket:t.is_easy_promoted_market,toggleProfile:this.toggleProfile}),!a&&r.createElement(k,{tags:[...o].map(e=>U({},e,{isChecked:s.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!a&&r.createElement(f.a,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},H("mail_im_peer_profile_manage_tags")),_&&r.createElement(M,{tags:o,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})),r.createElement("dt",{className:"PeerProfile__label"},H("mail_im_peer_profile_info_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},y&&r.createElement(r.Fragment,null,O.city&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.a)(O.city)),O.age&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.a)(O.age)),O.likes_cnt&&r.createElement(b.default,{className:"PeerProfile__infoTooltip",position:"t",text:H("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},r.createElement("span",{className:"PeerProfile__infoItem"},O.likes_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.a)(O.likes_cnt)),O.replies_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.a)(O.replies_cnt))))),!y&&r.createElement("span",null,H("mail_im_peer_profile_info_empty"))),e.is_peer_profile_note_enabled&&r.createElement(r.Fragment,null,r.createElement("dt",{className:"PeerProfile__label"},H("mail_im_peer_profile_note_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__note"},!d&&r.createElement(f.a,{onClick:e=>this.toggleModal(e,!0,"note")},H("mail_im_peer_profile_note_add_link")),!!d&&r.createElement(r.Fragment,null,r.createElement("span",{className:"PeerProfile__noteText"},Object(u.a)(d)),r.createElement("span",{className:"PeerProfile__noteDivider"}," · "),r.createElement(f.a,{onClick:e=>this.toggleModal(e,!0,"note")},H("mail_im_peer_profile_note_edit_link"))),p&&r.createElement(B,{note:d,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")}))),r.createElement("dt",{className:"PeerProfile__label"},H("mail_im_peer_profile_join_date_label_text")),r.createElement("dd",{className:"PeerProfile__content"},O&&O.join_date?Object(u.a)(O.join_date):Object(l.k)(t.sex,H("mail_im_peer_profile_join_date_empty_text","raw"))))),(g||t.ad_id)&&r.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}function F(){return document.querySelector("#PeerProfile")}function q(){var e=F();return e?e.offsetHeight:0}function G(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+q()+"px"}else e.style.removeProperty("padding-top")}function V(e){return{render(t){var n=t.get(),c=F(),s=n.peer,u=Object(i.s)(n,s);n.is_peer_profile_enabled&&c&&Object(o.Sb)(n,s)&&!Object(i.z)(u)&&!Object(i.D)(t,s)&&(c.innerHTML&&a.unmountComponentAtNode(c),a.render(r.createElement($,{store:t}),c,()=>{G(e,!0)}))},destroy(){var t=F();t&&(a.unmountComponentAtNode(t),G(e,!1))}}}},UIlX:function(e,t,n){"use strict";n.d(t,"h",(function(){return m})),n.d(t,"k",(function(){return p})),n.d(t,"l",(function(){return g})),n.d(t,"c",(function(){return h})),n.d(t,"i",(function(){return v})),n.d(t,"j",(function(){return O})),n.d(t,"m",(function(){return j})),n.d(t,"e",(function(){return I})),n.d(t,"d",(function(){return k})),n.d(t,"b",(function(){return E})),n.d(t,"g",(function(){return w})),n.d(t,"f",(function(){return P})),n.d(t,"a",(function(){return T})),n.d(t,"n",(function(){return N}));n("HEwt"),n("rGqo"),n("rE2o"),n("ioFf"),n("a1Th"),n("Btvt"),n("KKXr"),n("Vd3H");var r=n("vT4u"),a=n("rHUl"),i=n("h++7"),o=n("zxIV"),c=n("4+be"),s=n("FWc3"),u=n("nAFc"),d=n("rDjD");function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){var n=0,r=[],a=[],i=!1;return e.forEach(e=>{e.width=e.width?e.width:function(e){return 12+9*Object(u.a)(e.name).length}(e),e.width+(i?0:69)>=t-n?(a.push(e),i||(n+=69,i=!0)):(r.push(e),n+=e.width)}),[r,a]}function m(e,t){var n=e.target,r=Object(o.Y)("_im_dialog",n),i=parseInt(Object(o.v)(r,"peer")),c=t.get(),u=Object(a.s)(c,i),d=u.peerTagsMaxWidth;if(d){var _=l(f(b(c,u),d),2)[1].reduce((e,t)=>e+=getTemplate("sImPeerTagsExtraTooltipItem",{name:t.name,color:t.color}),"");Object(s.c)(n,{text:_,center:!0,dir:"bottom",className:"PeerTagsExtraTooltip",hasover:!0})}}function b(e,t){var n=t.peer_tags&&t.peer_tags.ids.length?e.peer_profile_tags.filter(e=>t.peer_tags.ids.includes(e.id)):[];return t.ad_id&&n.unshift(function(e){var t,n;return e.is_easy_promoted_market?(t=Object(c.d)("mail_ad_tag_easy_promoted_market"),n=145):(t=e.has_ad_access?`${Object(c.d)("mail_ad_tag_text_prefix")} ${e.ad_id}`:Object(c.d)("mail_ad_tag_no_access_text"),n=e.has_ad_access?104:97),{isAdTag:!0,adTagText:t,width:n,name:t,color:"#e5ebf1"}}(t)),n}function p(e,t,n,r){if(t<69)e.innerHTML="";else{e.style.maxWidth=t+"px";var i=n.get(),o=Object(a.s)(i,r),s=b(i,o);if(s.length){var u=l(f(s,t),2),d=u[0],_=u[1],m=d.reduce((e,t)=>(t.isAdTag?e+=getTemplate("sImPeerTagsAdTag",{ad_tag_text:t.adTagText,url:`ads?act=office&union_id=${o.ad_id}&utm_medium=community_messages_ad_tag&utm_source=dialog`,extra_class:o.has_ad_access?"PeerTagsItem--hasAdAccess":""}):e+=getTemplate("sImPeerTagsItem",{tag_id:t.id,name:t.name,color:t.color}),e),""),p=_.length,g="+"+Object(c.d)("mail_im_peer_profile_extra_tags",p);p&&(m+=getTemplate("sImPeerTagsExtra",{text:g})),e.innerHTML=m}else e.innerHTML=""}}function g(e){var t=Object(o.L)("_im_peer_tags_filter_tags"),n=e.peer_profile_tags||[];n.length>0&&t&&(t.innerHTML=n.reduce((t,n)=>t+=getTemplate("sImPeerTagsFilterItem",{tag_id:n.id,name:n.name,color:n.color,checked:e.peer_tags_filter.ids.includes(n.id)?"checked":"",count:n.uses}),""))}function h(e){var t=e.get(),n=Object(o.L)("_im_peer_tags_filter_control");if(n)if(!t.peer&&t.peer_profile_tags&&t.peer_profile_tags.length>0){Object(o.mb)(n,"PeerTagsFilter__control--hidden");var a=C(t.peer_profile_tags,t.peer_tags_filter.mask);e.set(e=>Object(r.wd)(a,e)).then(()=>y(e,a,!0))}else Object(o.c)(n,"PeerTagsFilter__control--hidden")}function v(e,t){var n=t.get(),a=e.target,i=parseInt(a.id.slice(9)),o=a.checked?[].concat(n.peer_tags_filter.ids,i):n.peer_tags_filter.ids.filter(e=>e!==i);t.set(e=>Object(r.wd)(o,e)).then(()=>y(t,o))}function O(e,t){var n=t.get(),a=Object(o.ab)(e.target,"_im_peer_tags_filter_pane_item")?e.target:Object(o.Y)("_im_peer_tags_filter_pane_item",e.target),i=parseInt(Object(o.v)(a,"id")),c=n.peer_tags_filter.ids.filter(e=>e!==i);t.set(e=>Object(r.wd)(c,e)).then(()=>y(t,c))}function j(e){var t,n,r=e.peer_tags_filter.ids,a=r.length>0,i=Object(o.L)("_im_peer_tags_filter_pane"),c=(t=Object(o.L)("_im_page_dialogs"),n=Object(o.L)("_im_peer_tags_filter_pane"),parseFloat(getComputedStyle(t)["padding-top"])-(n&&n.offsetHeight>0?n.offsetHeight+1:0));if(a&&i){var s=(e.peer_profile_tags||[]).filter(e=>r.includes(e.id)).sort((e,t)=>r.indexOf(e.id)-r.indexOf(t.id));i.innerHTML=s.reduce((e,t)=>e+=getTemplate("sImPeerTagsFilterPaneItem",{tag_id:t.id,name:t.name,color:t.color}),"")}Object(o.zb)(i,"PeerTagsFilterPane--active",a),function(e,t){var n=Object(o.L)("_im_page_dialogs"),r=Object(o.L)("_im_peer_tags_filter_pane");if(e&&r){var a=t+(r.offsetHeight+1);n.style.paddingTop=a+"px"}else n.style.paddingTop=t+"px"}(a,c),N()}function y(e,t,n){var r=e.get();g(r),j(r),function(e){var t=Object(o.L)("_im_right_menu"),n=Object(o.L)("ui_rmenu_item_sel",t),r=Object(o.L)("_ui_item_all",t);(e.length>0||!n)&&uiRightMenu.switchMenu(r)}(t),n||r.longpoll.push([Object(d.b)(t.length>0?i.m:i.g)])}function I(e,t){var n=e.target,a=[parseInt(Object(o.v)(n,"id"))];t.set(e=>Object(r.wd)(a,e)).then(()=>y(t,a))}function k(e){return e.get().active_tab===i.m}function C(e,t){if(!e||!e.length||!t)return[];var n=t.toString(2).split("").reverse().reduce((e,t,n)=>("1"===t&&e.push(1<<n),e),[]);return e.filter(e=>n.includes(e.mask)).map(e=>e.id)}function E(e,t){return Number.isInteger(t)?t:e&&e.length&&t&&t.length?e.filter(e=>t.includes(e.id)).reduce((e,t)=>e+=t.mask,0):null}function w(e,t,n){var a=n.peerId,i=n.peerTagsMask,o=e.get(),c=C(o.peer_profile_tags,i);e.set(e=>Object(r.vd)(a,c,i,e)).then(()=>{g(e.get()),o.peer||(t.renderPeerTags(e,a),k(e)&&e.set(r.xd).then(()=>t.restoreDialogs(e)))})}function P(e,t){e.set(r.ud).then(()=>{g(e.get()),e.get().peer||(t.restoreDialogs(e),t.renderPeerTags(e))})}function T(e,t){var n=e.peer_tags_filter.mask;return!(!n||!t.peer_tags)&&!!(n&t.peer_tags.mask)}function N(){var e=Object(o.L)("im-page--dialogs-empty");if(e){var t=Object(o.L)("_im_peer_tags_filter_pane"),n=t&&t.offsetHeight>0?t.offsetHeight/2:5;e.style.marginTop=n+"px"}}},Wfj7:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("aong");function a(e,t){var n=Object(r.s)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},Wu9C:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"b",(function(){return y}));var r=n("ofcU"),a=n("vT4u"),i=n("P13b");function o(e){return{unmount(){Object(r.c)(e)}}}function c(e,t,n,a){var c=Object(r.b)(o).bindMutations,s=t=>{n().messageKeyboardButtonClick(t),e.hide()};return c(Object(r.a)({handlers:(t,n)=>{n(e.bodyNode,"click",i.A,s)}}))}var s=n("rHUl"),u=n("aong"),d=n("uytb"),l=n("FWc3"),_=n("rudk"),f=n("kxld");function m(e,t){if(Object(u.s)(e).searchShown)return!1;var n=Object(s.s)(e,t);return!!(n&&Object(_.c)(t)&&n.pinned)&&!Object(f.p)(n)}function b(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(s.s)(e,t),i=a&&Object(s.W)(a.pinned);a&&i&&(a.pinHideId=i.chat_local_id,cur.imDb.update(d.a,[a.peerId,a.pinHideId]),v(n,t,e),re(geByClass1("_im_pinned_tt")),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function p(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(s.s)(e,t);a&&a.pinHideId&&(delete a.pinHideId,cur.imDb.update(d.a,[a.peerId,void 0]),v(n,t,e),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function g(e,t,n){var r=v.bind(null,n,t),o=Object(i.zd)(()=>{o.hideProgress(),o.hide(),e.set(a.ed.bind(null,t)).then(r).then(e=>e.set(a.dd.bind(null,t))).then(r)})}function h(e,t,n){var r=e.get().peer,a=Object(s.W)(Object(s.s)(e,r).pinned);if(n.target.classList.contains("_im_pin_hide"))a&&b(e,r,t);else if("A"!==n.target.tagName){var o=a&&a.messageId;o&&!Object(i.Ib)(e,r,o)?Object(i.eb)(e,t().focusOnMessage,r,o):Object(i.wd)(e,t,r,c,n),statlogsValueEvent("im_pinned_messages","open")}}function v(e,t,n){return e().updateChatTopic(t,n),Object(a.Bc)(n.get()),e().updateActions(n),n}function O(e){Object(l.c)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function j(e){return{unmount(){Object(r.c)(e)}}}function y(e,t,n){var a=Object(r.b)(j).bindMutations,i=h.bind(null,t,n),o=O.bind(null);return a(Object(r.a)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",i),n(e,"mouseover","_im_pin_hide",o)}}))}},ambf:function(e,t,n){"use strict";n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"g",(function(){return p}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("MhhX");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=2e3,c=6e4,s=1e4,u="expiring",d="expiring_soon",l="expired",_=[],f={},m={},b=0,p={add(e){var t=a(h(e),3),n=t[0],r=t[1],i=t[2],o=Math.max(n+r-c-i,0),_=Math.max(n+r-s-i,0),b=Math.max(n+r-i,0),p=setTimeout(()=>{g({type:u,message:e})},o),v=setTimeout(()=>{g({type:d,message:e})},_),O=setTimeout(()=>{g({type:l,message:e}),m[e.messageId]=!0,delete f[e.messageId]},b);f[e.messageId]={message:e,expiringTime:o,expiredTime:b,timers:[p,v,O]}},remove(e){this.has(e)&&(f[e].timers.forEach(clearTimeout),delete f[e])},setTimeshift(e){b=1e3*(e||0)},getTimings:e=>f[e]?h(f[e].message):[0,0,0],getExpireTime(e){if(!f[e])return 0;var t=a(h(f[e].message),3),n=t[0],r=t[1],i=t[2];return Math.max(Math.floor((n+r-i)/1e3),0)},isProcessed:e=>!!m[e],subscribe(e){_.push(e)},unsubscribe(e){_=_.filter(t=>t!==e)},has:e=>!!f[e],destroy(){f={},_=[],m={}}};function g(e){_.forEach(t=>t(e))}function h(e){return[1e3*e.date+b,1e3*(Object(r.c)(e)||0),Date.now()]}},bIHZ:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r=n("t7n3");function a(e){var t=Object(r.i)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function i(){var e={};return{scheduleNav:function(t){e=Object(r.i)(e,t)},commitNav:function(){a(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(r.i)(e,t),setTimeout((function(){a(e),e={}}),n)}}}},cYwl:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return d}));var r,a=n("DM2o"),i=n("r0fY"),o=n("FbVm"),c=new(function(){function e(){this.productionStatCollector=new o.f,this.actionStatCollector=new o.a(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t;return this.actionStatCollector.logEvent(((t={type:i.a.TYPE_CUSTOM_METRICS_ITEM})[i.a.TYPE_CUSTOM_METRICS_ITEM]=e,t))},e}());!function(e){e.DIALOG_ACTIONS="dialog_actions",e.PROFILE_SCREEN="profile_screen",e.CONTACT_SCREEN="contact_screen"}(r||(r={}));var s=function(e,t){Object(a.a)("convo_invite",e,t)},u=function(e){c.logEvent({experiment_id:1285,service:"messages",metric_name:"open_vk_service_chat",metric_value:3,unit_id:e,unit_type_id:1})},d=function(e){c.logEvent({experiment_id:1285,service:"messages",metric_name:"push_find_friends_button",metric_value:3,unit_id:e,unit_type_id:1})}},eaP7:function(e,t,n){"use strict";n.d(t,"mb",(function(){return o})),n.d(t,"gb",(function(){return c})),n.d(t,"Y",(function(){return s})),n.d(t,"cb",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"R",(function(){return l})),n.d(t,"S",(function(){return _})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return m})),n.d(t,"ib",(function(){return b})),n.d(t,"V",(function(){return p})),n.d(t,"kb",(function(){return g})),n.d(t,"jb",(function(){return h})),n.d(t,"O",(function(){return v})),n.d(t,"w",(function(){return O})),n.d(t,"j",(function(){return j})),n.d(t,"bb",(function(){return y})),n.d(t,"X",(function(){return I})),n.d(t,"fb",(function(){return k})),n.d(t,"eb",(function(){return C})),n.d(t,"W",(function(){return E})),n.d(t,"hb",(function(){return w})),n.d(t,"db",(function(){return P})),n.d(t,"N",(function(){return T})),n.d(t,"b",(function(){return N})),n.d(t,"c",(function(){return S})),n.d(t,"k",(function(){return A})),n.d(t,"ab",(function(){return x})),n.d(t,"h",(function(){return L})),n.d(t,"i",(function(){return M})),n.d(t,"Z",(function(){return D})),n.d(t,"v",(function(){return R})),n.d(t,"lb",(function(){return B})),n.d(t,"U",(function(){return U})),n.d(t,"T",(function(){return H})),n.d(t,"f",(function(){return $})),n.d(t,"g",(function(){return F})),n.d(t,"Q",(function(){return q})),n.d(t,"P",(function(){return G})),n.d(t,"p",(function(){return V})),n.d(t,"o",(function(){return K})),n.d(t,"q",(function(){return z})),n.d(t,"l",(function(){return W})),n.d(t,"r",(function(){return Y})),n.d(t,"n",(function(){return J})),n.d(t,"m",(function(){return X})),n.d(t,"u",(function(){return Q})),n.d(t,"t",(function(){return Z})),n.d(t,"s",(function(){return ee})),n.d(t,"H",(function(){return te})),n.d(t,"z",(function(){return ne})),n.d(t,"x",(function(){return re})),n.d(t,"D",(function(){return ae})),n.d(t,"G",(function(){return ie})),n.d(t,"I",(function(){return oe})),n.d(t,"K",(function(){return ce})),n.d(t,"J",(function(){return se})),n.d(t,"y",(function(){return ue})),n.d(t,"A",(function(){return de})),n.d(t,"E",(function(){return le})),n.d(t,"F",(function(){return _e})),n.d(t,"C",(function(){return fe})),n.d(t,"B",(function(){return me})),n.d(t,"L",(function(){return be})),n.d(t,"M",(function(){return pe})),n.d(t,"ob",(function(){return he})),n.d(t,"pb",(function(){return ve})),n.d(t,"rb",(function(){return Oe})),n.d(t,"qb",(function(){return je})),n.d(t,"nb",(function(){return ye}));var r=n("3qfP"),a=n("jE6c"),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function o(e){switch(e[0]){case 0:return{type:"event_delete",localId:e[1]};case 1:return function(e){var t=e[1],n=e[2],r=e[3];return{type:s,messageId:t,mask:n,peerId:r}}(e);case 2:return function(e){var t=e[1],n=e[2],r=e[3];return{type:c,messageId:t,flags:n,peerId:r}}(e);case 3:return function(e){var t=e[1],n=e[2],r=e[3];return{type:u,messageId:t,flags:n,peerId:r}}(e);case 4:return function(e){var t=e[1],n=e[2],a=e[3],o=e[4],c=e[5],s=e[6],u=e[7],l=e[8],_=e[9],f=e[10],m=e[11];return i(i({type:d},Object(r.a)([Number(t),Number(n),Number(o),Number(c),s,u,l,_,f,m])),{minorSortId:a})}(e);case 5:return ge(e);case 6:return he(e);case 7:return function(e){var t=e[1],n=e[2],r=e[3];return{type:_,peerId:t,upToId:n,unread:r}}(e);case 10:return ve(e);case 11:return function(e){var t=e[1],n=e[2];return{type:I,peerId:t,mask:n}}(e);case 12:return Oe(e);case 13:return function(e){var t=e[1],n=e[2];return{type:L,peerId:t,localId:n}}(e);case 18:return function(e){var t=e[1],n=e[2],a=e[3],o=e[4],c=e[5],s=e[6],u=e[7],d=e[8],l=e[9],_=e[10];return i({type:D},Object(r.a)([Number(t),Number(n),Number(a),Number(o),c,s,u,d,l,_]))}(e);case 19:return function(e){var t=e[1];return{type:R,messageId:t}}(e);case 20:return function(e){var t=e[1],n=e[2];return{type:$,peerId:t,majorId:n}}(e);case 21:return function(e){var t=e[1],n=e[2];return{type:F,peerId:t,minorId:n}}(e);case 23:return function(e){var t=e[1],n=e[2];return{type:q,peerId:t,peerTagsMask:n}}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:f,chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],r=e[3];return{type:m,peerId:n,updateType:t,updateArg:r}}(e);case 63:return function(e){var t=e[1],n=e[2],r=e[3],a=e[4];return{type:b,peerId:t,userIds:n,totalCount:r,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],r=e[3],a=e[4];return{type:p,peerId:t,userIds:n,totalCount:r,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:g,userId:t,callId:n}}(e);case 80:return function(e){var t=e[1],n=e[2],r=e[3];return{type:h,count:t,countNotMuted:n,showOnlyNotMuted:r}}(e);case 114:return function(e){var t=e[1]||{},n=t.peer_id,r=t.sound,a=t.disabled_until;return{type:v,peerId:n,sound:r,disabledUntil:a}}(e);case 115:return function(e){var t=e[1];return{type:"incoming_call",payload:t}}(e);case 116:return function(e){var t=e[1]||{},n=t.id,r=t.flags,a=t.peer_id,i=t.date,o=t.message,c=t.kludges,s=t.random_id,u=t.chat_local_id,d=t.update_time,l=t.title;return ge([5,n,r,a,i,o,Object.assign({},c||{},{title:l||""}),{},s,u,d])}(e);case 117:return function(e){var t=e[1]||{},n=t.uuid,r=t.device_name;return{type:"event_audio_start",uuid:n,deviceName:void 0===r?"":r}}(e);case 119:return function(e){var t=e[1],n=t.event_id,r=t.owner_id,a=t.peer_id,i=t.action;return{type:O,event_id:n,owner_id:r,peer_id:a,action:i}}(e);case 120:return{type:G};case-1:return je();case-2:return function(e){var t=e[1],n=e[2];return{type:E,key:t,url:n}}(e);case-3:return function(e){var t=e[1];return{type:B,timeout:t}}(e);case-4:return{type:U};case-5:return{type:H};default:return function(e){return{type:j,params:e}}(e)}}var c="event_set_flags",s="event_replace_flags",u="event_reset_flags",d="event_add_message",l="event_read_inbound",_="event_read_outbound",f="event_chat_changed",m="event_chat_updated",b="event_typing",p="event_recoding_audio",g="event_video_call",h="event_unread_count",v="event_notify_settings_changed",O="event_keyboard_callback_received",j="event_empty",y="event_reset_directories",I="event_replace_directories",k="event_set_directories",C="event_resync",E="event_refresh_lp_key",w="transition_event",P="reset_peer",T="mutex",N="change_peer",S="event_change_tab",A="event_failed_message",x="event_resend",L="event_delete_dialog",M="event_edit_message",D="event_replace_message",R="event_invalidate_event",B="event_waiting_for_reconnect",U="event_reconnecting",H="event_reconnected",$="event_convo_major_id_changed",F="event_convo_minor_id_changed",q="peer_tags_changed",G="peer_profile_tags_changed",V=2,K=8,z=64,W=128,Y=65536,J=1<<21,X=1<<22,Q=1,Z=8,ee=32768,te=1,ne=2,re=3,ae=4,ie=5,oe=6,ce=7,se=8,ue=9,de=10,le=11,_e=12,fe=13,me=19,be=1,pe=3;function ge(e){var t=e[1],n=e[2],a=e[3],o=e[4],c=e[5],s=e[6],u=e[7],d=e[8],l=e[9],_=e[10];return i({type:M},Object(r.a)([Number(t),Number(n),Number(a),Number(o),c,s,u,d,l,_]))}function he(e){var t=e[1],n=e[2],r=e[3];return{type:l,peerId:t,upToId:n,unread:r}}function ve(e){var t=e[1],n=e[2],r=e[3];return{type:y,peerId:t,mask:n,local:void 0!==r&&r}}function Oe(e){var t=e[1],n=e[2],r=e[3];return{type:k,peerId:t,mask:n,local:void 0!==r&&r}}function je(){return{type:C}}function ye(e){var t=e[1],n=e[2],r=e[3],i=e[4],o=e[5];return{type:T,free:!!Object(a.f)(t)||Object(a.f)(i)===window.vk.id,resource:n,peerId:Object(a.f)(r),who:Object(a.f)(i),name:o}}},ftTi:function(e,t,n){"use strict";n.d(t,"k",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"j",(function(){return c})),n.d(t,"m",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return _})),n.d(t,"d",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"c",(function(){return b})),n.d(t,"a",(function(){return p})),n.d(t,"l",(function(){return g}));var r=n("aong"),a=n("PEW9");function i(e){return Object(r.s)(e).isLastMsgFalseDebugger}function o(e){return Object(r.s)(e).gid}function c(e){return!!o(e)}function s(e){var t=Object(r.s)(e);return!!c(e)&&((19542789===t.gid||103416369===t.gid)&&(t.active_tab===a.c.UNRESPOND||t.active_tab===a.c.UNREAD))}function u(e){return Object(r.s)(e).peer}function d(e){var t=Object(r.s)(e);return t.settings.show_only_not_muted_messages?t.unread_counters.countNotMuted:t.unread_counters.count}function l(e){return Object(r.s)(e).unread_counters.countNotMuted}function _(e){return Object(r.s)(e).unread_counters.count}function f(e,t){return Object(r.s)(e).settings[t]}function m(e,t){var n=Object(r.s)(t),a=u(t),i=n.keyboardCallbackEventButtons.get(a);return i?i.get(e):void 0}function b(e){return Object(r.s)(e).keyboard_app_hash}function p(e){return Object(r.s)(e).keyboardActionCallbackTimeout}function g(e){return Object(r.s)(e).isRecommendationListNeedUpdate}},hC3G:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return o}));n("Oyvg");var r=112,a={all:["all","everyone","все"],online:["online","here","здесь","тут"]},i=new RegExp(['(?!,|;|:|\\.|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(a.all).concat(a.online).map(e=>`@${e}|\\*${e}`).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),o=-22822305},jm8g:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n("6Rqf"),a={domain:"login.vk.com"};function i(e){e=Object.assign({},a,e),a=e}function o(e,t,n){var i=a;n&&(i=Object.assign({},a,n));var c,s=i.domain,u=i.onCaptcha,d="https://"+s+"/?act="+e,l={version:(c=i).version||"1",app_id:c.appId},_=Object.assign({},t,l);return Object(r.a)(d,_).then((function(r){if("error"===r.type)return Promise.reject({type:"login_error",error:r.error_info});if("captcha"===r.type){if(!u)return Promise.reject({type:"login_error",error:"captcha"});var a=r.captcha_sid,i=r.captcha_img;return u({captcha_sid:a,captcha_img:i}).then((function(r){var a=Object.assign({},t,r);return o(e,a,n)}))}return r.data}),(function(e){return{type:"network_error",error:e}}))}},kxld:function(e,t,n){"use strict";n.d(t,"o",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"j",(function(){return l})),n.d(t,"k",(function(){return _})),n.d(t,"f",(function(){return f})),n.d(t,"b",(function(){return m})),n.d(t,"s",(function(){return b})),n.d(t,"t",(function(){return p})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return h})),n.d(t,"h",(function(){return v})),n.d(t,"m",(function(){return O})),n.d(t,"n",(function(){return j})),n.d(t,"g",(function(){return y})),n.d(t,"l",(function(){return I})),n.d(t,"r",(function(){return k})),n.d(t,"i",(function(){return C})),n.d(t,"p",(function(){return E})),n.d(t,"d",(function(){return w})),n.d(t,"q",(function(){return P}));var r=n("aong"),a=n("PEW9"),i=n("ftTi"),o=n("rudk"),c=n("/rNY"),s=n("sp2a");function u(e,t){var n=d(e,t);return!(void 0===(null==n?void 0:n.history)||!(null==n?void 0:n.msgs))}function d(e,t){var n=Object(r.s)(e);return n.tabs&&n.tabs[t]}function l(e){return Object(o.c)(e.peerId)}function _(e){return Object(o.c)(e.peerId)&&!!e.notifications}function f(e,t){return d(e,void 0===t?0:t)}function m(e){return d(e,Object(i.e)(e))}function b(e){return!!(e.folders&&e.folders&a.g[a.f])}function p(e){return Boolean(e.is_message_request||e.folders&&e.folders&a.g[a.c.MR]||e.folders&&e.folders&a.g[a.i])}function g(e,t){var n=e.get().msg_local_ids_sort,r=n&&t.lastmsg&&n[t.lastmsg]||0;return r>0?2e9+r:t.minor_sort_id||0}function h(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function v(e){return l(e)&&h(e,s.f)}function O(e){return l(e)&&h(e,s.d)}function j(e){return l(e)&&h(e,s.e)}function y(e){return l(e)&&h(e,s.c)}function I(e){return l(e)&&h(e,s.b)}function k(e){return l(e)&&h(e,s.s)}function C(e){return!e.data.closed&&!e.data.kicked}function E(e){var t=e.pinned&&Object(c.a)(e.pinned);return!!t&&e.pinHideId===t.chat_local_id}function w(e){return Object(r.s)(e).recommendationList}function P(e,t){var n=Object(r.s)(e).recommendationList;return Boolean(n&&n.item_data[t])}},pdqG:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"c",(function(){return h})),n.d(t,"g",(function(){return v}));var r=n("6x51"),a=n("ftTi"),i=n("kxld"),o=n("Czjj"),c=n("PEW9"),s=n("aong"),u=n("rudk"),d=n("W9Tc"),l=n("sp2a"),_=function(){return(_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function f(e,t){Object(r.h)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((function(n,r){var i=Number(r),c=t.tabs[i]?t.tabs[i].msgs:{},s=Object.assign({},c||{},e[i].msgs||{});return n[i]=Object.assign({},t.tabs[i]||{},e[i]),s&&(n[i].msgs=s),e[i].lastmsg||(Object(a.k)(t)&&!1!==n[i].lastmsg&&(console.log(_({},e[i])),Object(o.a)()),n[i].lastmsg=!1),n}),t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function m(e,t,n,a,i){t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((function(e,o){var c=e[o];return!n&&!Object(r.e)(o)(t)||i&&!i(o,c,t)||(e[o]=Object(s.a)(a(c,o))),e}),e.dialog_tabs))}function b(e,t,n){var r=Object(i.e)(n,e);if(!r)return Promise.resolve(n);r.unread=r.unread?r.unread-t.length:0;var a=t.reduce((function(e,t){return e[t]=!0,e}),{});return p(e,(function(e){return!a[e]}),n),g(e,(function(e){return!a[e]}),n),Promise.resolve(n)}function p(e,t,n){var r=Object(i.e)(n,e);return r?(r.expiring_messages&&(r.expiring_messages=r.expiring_messages.filter(t),r.expiring_messages.length||delete r.expiring_messages),n):n}function g(e,t,n){var r=Object(i.e)(n,e);return r?(r.mentions&&(r.mentions=r.mentions.filter(t),r.mentions.length||delete r.mentions),n):n}function h(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=Object(i.e)(e,t);if(!n)return Promise.resolve(e);var o=Object(u.c)(t),s=Object(i.h)(n),_=Object(i.m)(n),f=Object(i.g)(n),m=Object(i.t)(n),b=o&&!Object(i.i)(n),p=!!n.offset,g=[];p&&g.push(c.b.MEDIA),p&&g.push(c.b.SEARCH),0===n.unread&&g.push(c.b.UNREAD),!Object(u.f)(t)&&!p||s||g.push(c.b.CLEAR),!Object(a.j)(e)||s||_||g.push(c.b.BLOCK),s&&!b&&g.push(c.b.SETTINGS),Object(u.d)(t)&&(n.can_send_notify?g.push(c.b.BLOCK_NOTIFY):g.push(n.blocked_community?c.b.ALLOW_COMMUNITY:c.b.BLOCK_COMMUNITY)),!Object(a.j)(e)&&!Object(u.e)(t)&&(o||Object(u.j)(t)||Object(u.d)(t))&&(!o||!b)&&g.push(e.mutedPeers.includes(t)?c.b.UNMUTE:c.b.MUTE),!Object(a.j)(e)&&Object(u.j)(t)&&n.is_friend&&!n.block_error&&!e.isMRToChatEnabled&&g.push(c.b.CREATE_CHAT),o&&!b&&Object(l.x)(e,t)&&g.push(c.b.CHAT_INVITE),!Object(a.j)(e)&&Object(u.j)(t)&&t!==window.vk.id&&!n.blacklisted&&!n.block_error&&n.canBeAddedToChat&&e.isMRToChatEnabled&&g.push(c.b.USER_INVITE),!o||b||Object(a.j)(e)||g.push(c.b.LEAVE),o&&n.data.closed&&!n.data.kicked&&g.push(c.b.RETURN),!Object(d.b)("pinned_conversations")||Object(a.j)(e)||!p||f||m||g.push(Object(u.h)(n.major_sort_id||0)?c.b.UNPIN_CONVO:c.b.PIN_CONVO),o&&n.pinned&&(g.push(Object(i.p)(n)?c.b.PIN_UNHIDE:c.b.PIN_HIDE),Object(l.A)(e)&&g.push(c.b.UNPIN));var h=Object(r.b)(n,Object(a.j)(e));return e.curActions=g.reduce((function(e,t){return e[t]=h[t],e}),{}),Promise.resolve(e)}function v(e,t,n,r){var a=e.recommendationList,i=a&&a.item_data[t];return i&&(i.online=n||r?1:0,i.online_info&&(i.online_info.is_online=n,i.online_info.is_mobile=r)),Promise.resolve(e)}},rDjD:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"h",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return _}));var r=n("eaP7"),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e){return a(a({},e),{type:r.i})}function o(e){return{type:r.hb,state:e}}function c(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),{type:r.db,cancelSearch:e,removeActivePeer:t}}function s(e,t,n,a,i){return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===a&&(a=!1),void 0===i&&(i=""),{type:r.b,peerId:e,msgid:t,forward:n,cancelSearch:a,entryPoint:i}}function u(e){return{type:r.c,tab:e}}function d(e,t,n){return{type:r.k,message:t,peerId:e,error:n}}function l(e,t){return{type:r.ab,message:t,peerId:e}}function _(e){var t=!1;return e.reduceRight((function(e,n){var a=n.type===r.jb,i=!t&&a;return a&&!i||e.unshift(n),i&&(t=!0),e}),[])}},rFFZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n("Db7M"),a=n("jm8g"),i=function(){return Object(a.a)("web_token").then((function(e){return e.access_token}))},o=!1,c=function(e,t){return o||(Object(r.b)({version:"5.133",domain:t,onTokenExpired:i,onCaptcha:e}),o=!0),Promise.resolve()},s=null,u=function(e,t,n){return s||(Object(a.b)({appId:6287487,domain:n,onCaptcha:e}),Object(r.b)({appId:6287487,version:"5.133",domain:t,onTokenExpired:i,onCaptcha:e}),s=Object(a.a)("web_token").then((function(e){return Object(r.b)({accessToken:e.access_token})})).catch((function(e){console.error("Init api auth failed",e)})))},d=n("EasH"),l=null,_=function(e){return new Promise((function(t){var n={imgSrc:e.captcha_img,onSubmit:function(e,n){t({captcha_sid:e,captcha_key:n}),l&&l.hide()},onHide:function(){return l=null}};l=Object(d.c)(e.captcha_sid,l,null,n)}))},f=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return c(_,window.vk.apiConfigDomains.apiDomain).then((function(){return e.apply(void 0,t)}))}};t.b=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return u(_,window.vk.apiConfigDomains.apiDomain,window.vk.apiConfigDomains.loginDomain).then((function(){return e.apply(void 0,t)}))}}},rHUl:function(e,t,n){"use strict";n.d(t,"h",(function(){return m})),n.d(t,"Q",(function(){return b})),n.d(t,"g",(function(){return p})),n.d(t,"j",(function(){return g})),n.d(t,"r",(function(){return h})),n.d(t,"n",(function(){return v})),n.d(t,"b",(function(){return O})),n.d(t,"P",(function(){return j})),n.d(t,"l",(function(){return y})),n.d(t,"k",(function(){return I})),n.d(t,"e",(function(){return k})),n.d(t,"m",(function(){return C})),n.d(t,"p",(function(){return E})),n.d(t,"B",(function(){return w})),n.d(t,"K",(function(){return P})),n.d(t,"G",(function(){return T})),n.d(t,"f",(function(){return N})),n.d(t,"V",(function(){return S})),n.d(t,"I",(function(){return A})),n.d(t,"J",(function(){return x})),n.d(t,"v",(function(){return L})),n.d(t,"T",(function(){return M})),n.d(t,"C",(function(){return D})),n.d(t,"a",(function(){return R})),n.d(t,"R",(function(){return B})),n.d(t,"q",(function(){return U})),n.d(t,"S",(function(){return H})),n.d(t,"N",(function(){return $})),n.d(t,"o",(function(){return F})),n.d(t,"c",(function(){return q})),n.d(t,"w",(function(){return G})),n.d(t,"i",(function(){return V})),n.d(t,"t",(function(){return K})),n.d(t,"u",(function(){return z})),n.d(t,"Y",(function(){return W})),n.d(t,"bb",(function(){return Y})),n.d(t,"Z",(function(){return J})),n.d(t,"X",(function(){return X})),n.d(t,"M",(function(){return Q})),n.d(t,"ab",(function(){return Z})),n.d(t,"d",(function(){return ee})),n.d(t,"L",(function(){return te})),n.d(t,"D",(function(){return ne})),n.d(t,"x",(function(){return re}));n("hhXQ"),n("Vd3H"),n("rGqo"),n("Btvt");var r=n("MhhX"),a=n("eaP7"),i=n("h++7"),o=n("86+7"),c=n("rjmT"),s=n("aong"),u=n("sp2a"),d=n("rudk");n.d(t,"F",(function(){return d.d}));var l=n("kxld");n.d(t,"H",(function(){return l.o})),n.d(t,"s",(function(){return l.f})),n.d(t,"U",(function(){return l.s})),n.d(t,"z",(function(){return l.h})),n.d(t,"A",(function(){return l.i})),n.d(t,"y",(function(){return l.g}));var _=n("ftTi");n.d(t,"E",(function(){return _.j})),n.d(t,"O",(function(){return _.m}));var f=n("/rNY");function m(e,t){var n=Object(s.s)(e),a=n.tabs[n.peer];return Object.keys(a.msgs).filter(n=>{var i=C(e,t,n);return!Object(r.r)(i)&&intval(n)>a.in_up_to})[0]}function b(e){return Object(s.s)(e).searchShown}function p(e){return g(e,Object(_.e)(e))}function g(e,t){var n=(Object(l.f)(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function h(e){return Object(s.s)(e).selectedMessages}function v(e,t,n){var a=Object(l.f)(e,t),i=h(e)[0];if(void 0===i)return[n];var o=Math.min(n,i),c=Math.max(n,i);return Object.keys(a.msgs).filter(e=>e>=o&&e<=c).filter(t=>{var n=C(e,e.get().peer,t);return!Object(r.s)(n)&&!Object(r.h)(n)}).map(intval)}function O(e,t){var n=Object(s.s)(t),a=Object(l.f)(n,e),i=0;for(var o in a.msgs)if(a.msgs.hasOwnProperty(o)){var c=C(t,e,o);Object(r.r)(c)||(i+=Object(r.u)(a,c)?1:0)}return i}function j(e,t,n){return!!function(e,t,n){var r=Object(l.f)(e,t);return Object.keys(r.msgs).filter(r=>intval(C(e,t,r).randomId)===n).length>0}(e,t,n)}function y(e,t){var n=Object(s.s)(e),r=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==r?2e9+r:t}function I(e,t,n){var r=Object(l.f)(e,t),i=C(e,t,n),o=Object.keys(e.msg_local_ids_sort||{}).length>1?Object.values(r.msgs).sort((t,n)=>{var r=Object(f.a)(t).messageId,a=Object(f.a)(n).messageId;return y(e,r)-y(e,a)}):Object.values(r.msgs);if(!i)return Object(f.a)(o[o.length-1]);for(var c=i.local,s=o.length-1;s>=0;s--){var u=Object(f.a)(o[s]),d=u.local&&u.type!==a.i;if(!(!c&&d))if(c&&!d||y(e,i.messageId)>y(e,u.messageId))return u}}function k(e,t,n){var a=Object(l.f)(e,t),i=C(e,t,n),c=Object(s.s)(e);return Object(r.r)(i)?Object(o.c)(e,c.id).name:i.userId!==i.peerId?!!Object(o.b)(e,i.userId)&&Object(o.c)(e,i.userId).name:a.tab}function C(e,t,n){var r=Object(l.f)(e,t),a=r&&r.msgs&&r.msgs[n];return a?Object(f.a)(a):null}function E(e,t,n){var r=Object(l.f)(e,t),a=r&&r.msgs&&Object.keys(r.msgs).sort((e,t)=>+e-t);if(!a)return null;var i=a&&a.indexOf(""+n),o=i>-1?a[i-1]:null;return r.msgs[o]}function w(e){var t=Object(s.s)(e);return t.gid||t.isClassic}function P(e){return Object(s.s)(e).gid}function T(e){return Object(s.s)(e).gid}function N(e,t){var n=Object(s.s)(t);return n.tabs[e]||n.mapped_index[e]}function S(e,t){var n=Object(l.f)(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function A(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function x(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function L(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function M(e){return!Object(s.s)(e).lockedSending}function D(e,t){return!!Object(d.d)(t)&&!!Object(l.f)(e,t).blocked_community}function R(e){return Object(s.s)(e).voice_message_available}function B(e){var t=Object(s.s)(e);return!(!U(t)&&!t.recentSearch)}function U(e){return Object(s.s)(e).searchText}function H(e,t){var n=Object(s.s)(e);return!!(t&&t!==U(e)||n.recentSearch)}function $(e){return Object(s.s)(e).recentSearch}function F(e){var t=Object(l.b)(e);return t&&t.pinned&&Object(f.a)(t.pinned)}function q(e){var t=e.get().popular_sugg;return t&&t.length>0}function G(e){return 1==Object(s.s)(e).isEditing}function V(e){return Object(s.s)(e).gid}function K(e){return e.draft||(e.draft=Object(c.b)(cur.imDb,e.peerId)),e.draft}function z(e){return(Object(s.s)(e).templates||[]).filter(e=>!e.deleted)}function W(e){return!!e&&Object(l.t)(e)}function Y(e){return Boolean(e.folders&i.j[i.l])}function J(e){return Object(d.c)(e.peerId)&&W(e)}function X(e){return e&~i.j[i.k]&~i.j[i.l]}function Q(e){return Object(s.s)(e).active_tab===i.k}function Z(e){return e.peerId>19e8&&e.peerId<2e9}function ee(e){return!!Object(s.s)(e).dialog_tab_cts[i.k]}function te(e){var t=e.type,n=e.updateType;return t===a.e&&(n===a.F||n===a.C)}function ne(e,t){var n=Object(l.f)(e,t);return!!n&&Object(l.m)(n)}function re(e,t){return Object(l.a)(Object(l.f)(e,t),u.c)}n.d(t,"W",(function(){return f.a}))},rjmT:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return d}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var r=n("ER42"),a=n("eaP7"),i=n("vT4u");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function u(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function d(e,t){return new s(e,"draft_"+t)}s.prototype.dump=function(){if(this._key){var e,t={txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0},n=0===t.txt.length&&!t.attaches&&!t.urlBinds&&!t.cancelled;this._db.updateByKey(this._key,n?void 0:t)}},s.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},s.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},s.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},s.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var r=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===r?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[r]={type:e,id:t,object:n},this.dump())},s.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=o(e,2),n=t[0],r=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==r)||{type:n,id:r}})),this.dump()},s.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},s.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},s.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},s.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},s.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},s.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&a.n&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},s.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},s.prototype.hasAttaches=function(){return this.dData.attaches.length>0},s.prototype.destroy=function(){this.dData={},this._key=this._db=null},s.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(u)?Object(r.b)(i.e,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=o(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},s.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},s.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"i",(function(){return u})),n.d(t,"j",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return _})),n.d(t,"e",(function(){return f})),n.d(t,"d",(function(){return m})),n.d(t,"a",(function(){return b})),n.d(t,"h",(function(){return p})),n.d(t,"g",(function(){return g}));var r=n("jE6c"),a=n("hC3G");function i(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var o={};function c(e){if(o[e])return o[e];for(var t=e?e.length:0,n=[],r=[],a="",c=0;c<t;c++){var s=e[c],u=s.charCodeAt(0);u>=48&&u<=57||"_"===s||"-"===s?a+=s:"("!==s&&")"!==s&&":"!==s&&","!==s||(""!==a&&(r.push(a),n.push("id"),a=""),r.push(s),n.push(s))}a.length>0&&(r.push(a),n.push("id"));var d=function e(t,n,r,a){if(void 0===r&&(r=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var o=[],c="";r<t.length;){var s=t[r];if("id"===s)c=n[r];else if(","===s&&c)o.push(i(c)),c="";else if("("===s){var u=e(t,n,r+1,a+1),d=u[0];r=u[1],o.push(i(c,d)),c=""}else if(")"===s)return""!==c&&o.push(i(c)),[o,r];r++}return c&&o.push(i(c)),[o,r]}(n,r)[0];return Object.keys(o).length>300&&(o={}),o[e]=d,d}function s(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:c(e.fwd).length}});for(var a=1;e["attach"+a+"_type"];++a)"call"===e["attach"+a+"_type"]?n.push({type:e["attach"+a+"_type"],id:e["attach"+a],initiatorId:Object(r.f)(e["attach"+a+"_call_initiator_id"]),state:e["attach"+a+"_call_state"],duration:Object(r.f)(e["attach"+a+"_call_duration"]),receiverId:Object(r.f)(e["attach"+a+"_call_receiver_id"])}):n.push({type:e["attach"+a+"_type"],id:e["attach"+a],kind:e["attach"+a+"_kind"],productId:e["attach"+a+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function u(e){return 0==e}function d(e){return e>0&&e<2e9}function l(e){return e>2e9}function _(e){return e<-2e9}function f(e){return e>19e8&&e<2e9}function m(e){return e>-2e9&&e<0}function b(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}function p(e){return e>0&&(e|a.c)===a.c}function g(e){return/(^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com)?\/onboarding_find_friends/.test(decodeURIComponent(e))}},shih:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return _}));var r=n("07n8"),a=n("Iqrf"),i=n("4edV"),o=n("Wfj7"),c=n("pdqG"),s=n("XzvV"),u=Object(r.b)((function(e,t,n,r){return Object(a.c)(e.writeHash,e.gid,t,n,r).then((function(e){return e[0]}))}));function d(e,t,n,r,u){return void 0===n&&(n=a.a.ALL),Object(a.e)(e,r.hidegid?0:u.gid,n,t).then((function(e){var t=e[0],n=e[1],r=e[2];return n.forEach((function(e){return Object(o.a)(u,e)})),Object(i.i)(r,u).then((function(){}),(function(){})),Object(c.a)(t,u).then((function(){}),(function(){})),t})).then((function(t){if(e){var n=t&&Object.keys(t).length;Object(s.t)(s.M,0,n,e)}return Object.keys(t).sort((function(e,n){return t[+e].order-t[+n].order})).map((function(e){return t[+e]}))}))}var l=Object(r.b)((function(e,t){var n;return Object(a.j)(t,(null===(n=e.tabs[t])||void 0===n?void 0:n.hash)||"")})),_=Object(r.b)((function(e,t){var n;return Object(a.l)(t,(null===(n=e.tabs[t])||void 0===n?void 0:n.hash)||"")}))},sp2a:function(e,t,n){"use strict";n.d(t,"i",(function(){return u})),n.d(t,"k",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"a",(function(){return _})),n.d(t,"s",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return g})),n.d(t,"e",(function(){return h})),n.d(t,"j",(function(){return v})),n.d(t,"p",(function(){return O})),n.d(t,"o",(function(){return j})),n.d(t,"n",(function(){return y})),n.d(t,"q",(function(){return I})),n.d(t,"l",(function(){return k})),n.d(t,"r",(function(){return C})),n.d(t,"g",(function(){return E})),n.d(t,"m",(function(){return w})),n.d(t,"C",(function(){return T})),n.d(t,"z",(function(){return N})),n.d(t,"u",(function(){return S})),n.d(t,"t",(function(){return A})),n.d(t,"x",(function(){return x})),n.d(t,"y",(function(){return L})),n.d(t,"A",(function(){return M})),n.d(t,"E",(function(){return D})),n.d(t,"v",(function(){return R})),n.d(t,"B",(function(){return B})),n.d(t,"D",(function(){return U})),n.d(t,"w",(function(){return H})),n.d(t,"F",(function(){return F})),n.d(t,"G",(function(){return q}));var r,a,i=n("rudk"),o=n("aong"),c=n("kxld"),s=n("ftTi"),u=1,d=4,l=8,_=16,f=64,m=1024,b=16384,p=32768,g=1<<17,h=1<<18,v=1<<19,O=1<<20,j=1<<21,y=1<<22,I=1<<23,k=1<<24,C=1<<25,E=1<<26,w=1<<27;!function(e){e.SEE_INVITE_LINK="see_invite_link",e.CHANGE_INVITE_LINK="change_invite_link",e.INVITE_USER="invite_user",e.PIN_OR_UNPIN="pin_unpin",e.CHANGE_TITLE="change_title",e.ADD_ADMIN="add_admin",e.MASS_MENTION="mass_mention",e.START_GROUP_CALL="call"}(a||(a={}));var P=((r={})[a.CHANGE_INVITE_LINK]=[32,32],r[a.ADD_ADMIN]=[_,_],r[a.SEE_INVITE_LINK]=[k,C],r[a.INVITE_USER]=[u,j],r[a.PIN_OR_UNPIN]=[d,I],r[a.CHANGE_TITLE]=[l,y],r[a.MASS_MENTION]=[v,O],r[a.START_GROUP_CALL]=[E,w],r);function T(e,t,n){return $(e,a.SEE_INVITE_LINK,t,n)}function N(e,t,n){return $(e,a.MASS_MENTION,t,n)}function S(e,t,n){return $(e,a.CHANGE_INVITE_LINK,t,n)}function A(e,t,n,r){var i=Object(o.s)(e),s=n||i.peer,u=Object(c.e)(i,s);return!(!u||!Object(c.j)(u))&&(!q(u,t)&&$(e,a.ADD_ADMIN,s,r))}function x(e,t,n){return $(e,a.INVITE_USER,t,n)}function L(e,t,n,r){if(function(e,t){var n=Object(o.s)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var a=Object(o.s)(e),i=n||a.peer,s=void 0===r?a.viewer_id:r,u=Object(c.e)(a,i);return!(!u||!Object(c.k)(u))&&(!(u.data.kicked&&!u.data.closed)&&(!Object(c.h)(u)&&(!q(u,t)&&(!!q(u,s)||(F(u,s)||function(e,t){return e.invitedByMe.includes(t)}(u,t))&&!F(u,t)))))}function M(e,t,n){return $(e,a.PIN_OR_UNPIN,t,n)}function D(e,t,n){return $(e,a.START_GROUP_CALL,t,n)}function R(e,t,n){return $(e,a.CHANGE_TITLE,t,n)}function B(e,t,n){var r=Object(o.s)(e),a=n||r.viewer_id,u=t||Object(s.e)(e);if(!Object(i.d)(a))return!0;var d=Object(c.e)(e,u);return!(!d||!Object(c.k)(d))&&!!d.caccess[a]}function U(e,t,n){var r=Object(o.s)(e),a=n||r.viewer_id,i=t||Object(s.e)(e),u=Object(c.e)(e,i);if(!u||!Object(c.k)(u))return!1;var d=Object(c.h)(u);if(!Object(c.m)(u))return q(u,a)&&!d;var l=Object(c.i)(u),_=q(u,-r.gid)&&l||F(u,a)&&l,f=(u.allowedUpdateFlags||[]).filter((function(e){return e!==b}));return _&&f.length>0}function H(e,t,n){var r=Object(o.s)(e),a=n||r.viewer_id,i=t||Object(s.e)(e),u=Object(c.e)(e,i);if(!u||!Object(c.k)(u))return!1;var d=Object(c.m)(u),l=Object(c.n)(u),_=Object(c.i)(u),f=q(u,-r.gid)&&_||F(u,a)&&_;return d&&!l&&f&&(u.allowedUpdateFlags||[]).includes(b)}function $(e,t,n,r){var i=Object(o.s)(e),u=Object(s.j)(e)?i.id:i.viewer_id,d=void 0===r?u:r,l=void 0===n?i.peer:n,_=Object(c.e)(i,l);if(!_||!Object(c.j)(_))return!1;var f=Object(c.i)(_),m=P[t],b=m[0],p=m[1],g=p|b,h=Object(c.h)(_),v=q(_,d)&&f,O=v||F(_,d)&&f;if(h)switch(t){case a.ADD_ADMIN:case a.INVITE_USER:return!1;case a.SEE_INVITE_LINK:return f;default:return Object(s.j)(i)}if(Object(c.m)(_)){if(Object(c.l)(_))return!1;switch(t){case a.SEE_INVITE_LINK:return Object(c.r)(_)?f:Object(c.a)(_,g)?Object(c.a)(_,p)?f:O:v;case a.CHANGE_INVITE_LINK:return v||O;case a.ADD_ADMIN:return Object(c.a)(_,g)?O:v;case a.MASS_MENTION:case a.START_GROUP_CALL:case a.INVITE_USER:return Object(c.r)(_)?f:!v&&(Object(c.a)(_,g)?O:f);case a.PIN_OR_UNPIN:case a.CHANGE_TITLE:return Object(c.r)(_)?f:O;default:return!1}}switch(t){case a.CHANGE_INVITE_LINK:return Object(c.a)(_,b)?O:v;case a.ADD_ADMIN:return Object(c.a)(_,g)?O:v;case a.SEE_INVITE_LINK:return Object(c.a)(_,g)?Object(c.a)(_,p)?f:O:v;case a.INVITE_USER:case a.PIN_OR_UNPIN:case a.MASS_MENTION:case a.START_GROUP_CALL:case a.CHANGE_TITLE:return Object(c.a)(_,g)?Object(c.a)(_,b)?O:v:f}return!1}function F(e,t){return(e.adminIds||[]).includes(t)}function q(e,t){return e.ownerId===t}},tEnI:function(e,t,n){"use strict";var r,a,i,o,c,s;n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return s})),function(e){e.AUDIO="ok_audio",e.AUDIO_TO_VIDEO="ok_video",e.VIDEO="ok_started_as_video",e.GROUP_AUDIO="group_audio",e.GROUP_AUDIO_TO_VIDEO="group_video",e.GROUP_VIDEO="group_started_as_video"}(r||(r={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(a||(a={})),function(e){e.REMOTE_NO_CONNECT="push_not_delivered",e.REMOTE_FAILED_ACCEPT="cant_connect",e.REMOTE_DECLINE="declined_remote",e.LOCAL_DECLINE="declined_local",e.REMOTE_TIMEOUT="declined_timeout",e.REMOTE_BUSY="busy",e.CONNECTION_LOST="lost_connection"}(i||(i={})),function(e){e.CONVO_HEADER="im_header",e.CONVO_SNIPPET="im_message",e.CONVO_LIST="im_create",e.CONVO_JOIN_SNIPPET="im_join_message",e.CONVO_JOIN_HEADER="im_join_header",e.CONVO_JOIN_BANNER="im_join_header",e.FRIENDS_LIST="friends_list",e.LINK_JOIN_SNIPPET="join_deeplink",e.LINK_JOIN_PAGE="join_deeplink",e.PROFILE="profile"}(o||(o={})),function(e){e.OUTGOING_CALL_STARTED_VIDEO="OutgoingCallStartedVideo",e.OUTGOING_CALL_STARTED_AUDIO="OutgoingCallStartedAudio",e.OUTGOING_CALL_ADD_PARTICIPANTS_SENT="OutgoingCallAddParticipantsSent",e.OUTGOING_CALL_REMOTE_RINGING="OutgoingCallRemoteRinging",e.OUTGOING_CALL_ACCEPTED_REMOTELY="OutgoingCallAcceptedRemotely",e.OUTGOING_CALL_FAILED="OutgoingCallFailed",e.OUTGOING_CALL_COMPLETED="OutgoingCallCompleted",e.INCOMING_CALL_RECEIVED="IncomingCallReceived",e.INCOMING_CALL_ACCEPTED="IncomingCallAccepted",e.CALL_DECLINED_OR_HANGED_LOCALLY="CallDeclinedOrHangedLocally",e.CALL_DECLINED_OR_HANGED_REMOTELY="CallDeclinedOrHangedRemotely",e.CALL_CONNECTED="CallConnected",e.CALL_DISCONNECTED="CallDisconnected",e.VIDEO_ENABLED="VideoEnabled",e.VIDEO_DISABLED="VideoDisabled",e.RELAY_CONNECTION_ESTABLISHED="RelayConnectionEstablished",e.USER_FEEDBACK_RECEIVED="UserFeedbackReceived",e.SYSTEM_STAT="SystemStat",e.GROUP_CALL_JOINED="GroupCallJoined",e.HAND_RAISED="HandRaised",e.HAND_LOWERED="HandLowered",e.SCREEN_SHARING_STARTED="ScreenSharingStarted",e.SCREEN_SHARING_STOPPED="ScreenSharingStopped",e.ALL_MICS_DISABLED="AllMicsDisabled",e.MIC_OFF_WHILE_TALKING_ALERT="MicOffWhileTalkingAlert",e.MIC_OFF_WHILE_TALKING_ENABLE_CLICK="MicOffWhileTalkingEnableClick",e.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT="VideoDisabledDueToBadConnectionAlert",e.ALL_MICS_AND_VIDEO_DISABLED="AllMicsAndVideoDisabled",e.USER_MICS_AND_VIDEO_DISABLED="UserMicsAndVideoDisabled",e.ASK_ALL_TO_UNMUTE="AskAllToUnmute",e.ASK_USER_TO_UNMUTE="AskUserToUnmute",e.ASSIGN_ADMIN="AssignAdmin",e.RETRIEVE_ADMIN="RetrieveAdmin",e.ADMIN_PIN="AdminPin",e.ADMIN_UNPIN="AdminUnpin"}(c||(c={})),function(e){e[e.ONCE=0]="ONCE",e[e.PERMANENT=1]="PERMANENT"}(s||(s={}))},tbKy:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("Iqrf");function a(e,t,n){return Object(r.k)(e,t.hidegid?void 0:n.gid)}},uytb:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return _}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("BJj/");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o="recent_search",c="pin_hide";function s(e){return"im_store_"+e}function u(e){return ls.get(s(e))||{}}function d(e,t,n){if(ls.checkVersion()){var r=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",r.length),n(s(e),r)}}function l(e,t,n){n.key===s(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function _(e){var t=Object(r.a)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&function(e,t){for(var n=["fwd","draft","bind_attach"],r=u(e),a=!1,i=n.length;i--;)n[i]in r&&(delete r[n[i]],a=!0);a&&d(e,r,t)}(e,t);var n={db:u(e),checkTime:Date.now()},i=l.bind(null,e,n);return window.addEventListener("storage",i,!1),{select:(t,r)=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),function(e,t,n){return t===o?e[t]||[]:t===c?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,r)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),n.db[t]),update(r,i){var s=function(e,t,n){switch(e[t]||(e[t]={}),t){case o:var r=n;r&&r.length>0?e[t]=r:delete e[t];break;case c:var i=a(n,2),s=i[0],u=i[1];u?e[t][s]=+u:delete e[t][s]}return e}(n.db,r,i);return n.db=s,n.checkTime=Date.now(),d(e,s,t)},updateByKey:(r,a)=>(n.db[r]=a,n.checkTime=Date.now(),d(e,n.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vT4u:function(e,t,n){"use strict";n.d(t,"e",(function(){return j.a})),n.d(t,"lb",(function(){return I.a})),n.d(t,"k",(function(){return k.a})),n.d(t,"pc",(function(){return w.c})),n.d(t,"gd",(function(){return T.i})),n.d(t,"Db",(function(){return S.a})),n.d(t,"wb",(function(){return A.c})),n.d(t,"J",(function(){return A.e})),n.d(t,"Bc",(function(){return S.c})),n.d(t,"b",(function(){return q})),n.d(t,"d",(function(){return G})),n.d(t,"c",(function(){return V})),n.d(t,"a",(function(){return J})),n.d(t,"Qc",(function(){return Q})),n.d(t,"Dc",(function(){return Z})),n.d(t,"ub",(function(){return ee})),n.d(t,"ic",(function(){return te})),n.d(t,"Vb",(function(){return ne})),n.d(t,"Ub",(function(){return re})),n.d(t,"wc",(function(){return ie})),n.d(t,"xc",(function(){return ce})),n.d(t,"r",(function(){return se})),n.d(t,"rd",(function(){return ue})),n.d(t,"sb",(function(){return de})),n.d(t,"ob",(function(){return le})),n.d(t,"Ob",(function(){return fe})),n.d(t,"Pb",(function(){return me})),n.d(t,"xb",(function(){return be})),n.d(t,"pb",(function(){return pe})),n.d(t,"qb",(function(){return ge})),n.d(t,"Lc",(function(){return he})),n.d(t,"dc",(function(){return ve})),n.d(t,"i",(function(){return ye})),n.d(t,"Bd",(function(){return Ie})),n.d(t,"H",(function(){return ke})),n.d(t,"j",(function(){return Ce})),n.d(t,"Bb",(function(){return we})),n.d(t,"Cb",(function(){return Pe})),n.d(t,"X",(function(){return Te})),n.d(t,"Nb",(function(){return Ne})),n.d(t,"td",(function(){return Se})),n.d(t,"Cc",(function(){return Ae})),n.d(t,"fd",(function(){return xe})),n.d(t,"Dd",(function(){return Le})),n.d(t,"yc",(function(){return De})),n.d(t,"F",(function(){return Re})),n.d(t,"E",(function(){return Be})),n.d(t,"l",(function(){return Ue})),n.d(t,"v",(function(){return He})),n.d(t,"G",(function(){return $e})),n.d(t,"cc",(function(){return Fe})),n.d(t,"rb",(function(){return qe})),n.d(t,"h",(function(){return Ge})),n.d(t,"g",(function(){return Ve})),n.d(t,"Gc",(function(){return Ke})),n.d(t,"Jc",(function(){return ze})),n.d(t,"Fc",(function(){return We})),n.d(t,"qc",(function(){return Ye})),n.d(t,"vc",(function(){return Xe})),n.d(t,"rc",(function(){return Qe})),n.d(t,"sc",(function(){return Ze})),n.d(t,"Jb",(function(){return et})),n.d(t,"kb",(function(){return tt})),n.d(t,"tc",(function(){return nt})),n.d(t,"bb",(function(){return rt})),n.d(t,"cb",(function(){return at})),n.d(t,"o",(function(){return it})),n.d(t,"x",(function(){return ot})),n.d(t,"uc",(function(){return st})),n.d(t,"mb",(function(){return ut})),n.d(t,"gb",(function(){return dt})),n.d(t,"Zb",(function(){return lt})),n.d(t,"Yb",(function(){return _t})),n.d(t,"Xb",(function(){return ft})),n.d(t,"ac",(function(){return mt})),n.d(t,"jc",(function(){return bt})),n.d(t,"kc",(function(){return pt})),n.d(t,"f",(function(){return ht})),n.d(t,"Qb",(function(){return vt})),n.d(t,"Ac",(function(){return Ot})),n.d(t,"zc",(function(){return jt})),n.d(t,"M",(function(){return yt})),n.d(t,"Lb",(function(){return It})),n.d(t,"D",(function(){return kt})),n.d(t,"K",(function(){return Ct})),n.d(t,"jd",(function(){return Et})),n.d(t,"ib",(function(){return wt})),n.d(t,"jb",(function(){return Pt})),n.d(t,"u",(function(){return Tt})),n.d(t,"tb",(function(){return Nt})),n.d(t,"id",(function(){return St})),n.d(t,"eb",(function(){return xt})),n.d(t,"mc",(function(){return Lt})),n.d(t,"bd",(function(){return Mt})),n.d(t,"ad",(function(){return Dt})),n.d(t,"Mc",(function(){return Rt})),n.d(t,"Ic",(function(){return Bt})),n.d(t,"I",(function(){return Ut})),n.d(t,"ld",(function(){return Ht})),n.d(t,"qd",(function(){return $t})),n.d(t,"vb",(function(){return Ft})),n.d(t,"L",(function(){return qt})),n.d(t,"Ec",(function(){return Gt})),n.d(t,"S",(function(){return Vt})),n.d(t,"O",(function(){return Kt})),n.d(t,"Mb",(function(){return zt})),n.d(t,"y",(function(){return Wt})),n.d(t,"lc",(function(){return Yt})),n.d(t,"cd",(function(){return Jt})),n.d(t,"Hc",(function(){return Xt})),n.d(t,"Z",(function(){return Qt})),n.d(t,"s",(function(){return Zt})),n.d(t,"kd",(function(){return en})),n.d(t,"nc",(function(){return tn})),n.d(t,"q",(function(){return nn})),n.d(t,"Oc",(function(){return rn})),n.d(t,"nd",(function(){return an})),n.d(t,"Yc",(function(){return on})),n.d(t,"yb",(function(){return cn})),n.d(t,"Ab",(function(){return sn})),n.d(t,"zb",(function(){return un})),n.d(t,"R",(function(){return dn})),n.d(t,"Rb",(function(){return ln})),n.d(t,"Wc",(function(){return _n})),n.d(t,"A",(function(){return fn})),n.d(t,"hc",(function(){return mn})),n.d(t,"Pc",(function(){return bn})),n.d(t,"zd",(function(){return pn})),n.d(t,"ab",(function(){return gn})),n.d(t,"w",(function(){return hn})),n.d(t,"Rc",(function(){return vn})),n.d(t,"od",(function(){return On})),n.d(t,"pd",(function(){return jn})),n.d(t,"Vc",(function(){return yn})),n.d(t,"Sc",(function(){return In})),n.d(t,"n",(function(){return kn})),n.d(t,"Nc",(function(){return Cn})),n.d(t,"Xc",(function(){return En})),n.d(t,"yd",(function(){return wn})),n.d(t,"Y",(function(){return Pn})),n.d(t,"db",(function(){return Tn})),n.d(t,"P",(function(){return Nn})),n.d(t,"ec",(function(){return Sn})),n.d(t,"fb",(function(){return An})),n.d(t,"oc",(function(){return xn})),n.d(t,"fc",(function(){return Ln})),n.d(t,"Wb",(function(){return Mn})),n.d(t,"Ib",(function(){return Dn})),n.d(t,"ed",(function(){return Rn})),n.d(t,"Hb",(function(){return Bn})),n.d(t,"dd",(function(){return Un})),n.d(t,"U",(function(){return Hn})),n.d(t,"Q",(function(){return $n})),n.d(t,"N",(function(){return qn})),n.d(t,"md",(function(){return Gn})),n.d(t,"Tb",(function(){return Vn})),n.d(t,"Uc",(function(){return Kn})),n.d(t,"Tc",(function(){return zn})),n.d(t,"t",(function(){return Wn})),n.d(t,"V",(function(){return Yn})),n.d(t,"Cd",(function(){return Jn})),n.d(t,"W",(function(){return Xn})),n.d(t,"m",(function(){return Qn})),n.d(t,"hb",(function(){return Zn})),n.d(t,"Kc",(function(){return er})),n.d(t,"B",(function(){return tr})),n.d(t,"Zc",(function(){return nr})),n.d(t,"nb",(function(){return rr})),n.d(t,"p",(function(){return ar})),n.d(t,"C",(function(){return ir})),n.d(t,"z",(function(){return or})),n.d(t,"Ad",(function(){return cr})),n.d(t,"gc",(function(){return sr})),n.d(t,"sd",(function(){return ur})),n.d(t,"hd",(function(){return dr})),n.d(t,"Kb",(function(){return lr})),n.d(t,"Gb",(function(){return _r})),n.d(t,"Eb",(function(){return fr})),n.d(t,"Fb",(function(){return mr})),n.d(t,"Sb",(function(){return br})),n.d(t,"T",(function(){return pr})),n.d(t,"bc",(function(){return gr})),n.d(t,"wd",(function(){return hr})),n.d(t,"vd",(function(){return vr})),n.d(t,"xd",(function(){return Or})),n.d(t,"ud",(function(){return jr}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("rGqo"),n("91GP"),n("VRzm"),n("Btvt");var r=n("ER42"),a=n("bIHZ"),i=n("eaP7"),o=n("DM26"),c=n("rudk"),s=n("aong"),u=n("uytb"),d=n("P13b"),l=n("h++7"),_=n("hC3G"),f=n("rHUl"),m=n("MhhX"),b=n("86+7"),p=n("ERyv"),g=n("sp2a"),h=n("O8ze"),v=n("zxIV"),O=n("ambf"),j=n("PEW9"),y=n("07n8"),I=n("tbKy"),k=n("zjLC"),C=n("rDjD"),E=n("3qfP"),w=n("shih"),P=n("kxld"),T=n("4edV"),N=n("UIlX"),S=n("pdqG"),A=n("6x51"),x=n("Iqrf"),L=n("RdBX"),M=n("ftTi"),D=n("MNOG"),R=n("y/eL"),B=n("rFFZ"),U=n("Db7M");function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var q=5,G="typing",V="audiomessage",K=Object(a.a)(),z=K.scheduleNav,W=K.commitNav,Y=K.scheduleNavWithTimeOut,J={[j.b.SEARCH]:0,[j.b.MEDIA]:1,[j.b.CHAT_INVITE]:2,[j.b.USER_INVITE]:2,[j.b.CREATE_CHAT]:2,[j.b.SETTINGS]:3,[j.b.PIN_HIDE]:10,[j.b.PIN_UNHIDE]:10,[j.b.UNPIN]:11,[j.b.UNREAD]:20,[j.b.MUTE]:21,[j.b.UNMUTE]:21,[j.b.PIN_CONVO]:22,[j.b.UNPIN_CONVO]:22,[j.b.CLEAR]:30,[j.b.BLOCK]:31,[j.b.BLOCK_COMMUNITY]:32,[j.b.ALLOW_COMMUNITY]:32,[j.b.BLOCK_NOTIFY]:33,[j.b.LEAVE]:34,[j.b.RETURN]:34};function X(e){return"string"==typeof e?Object(v.rb)(`<div>${e}</div>`):e}function Q(e){return"string"==typeof e?e:e.innerHTML}function Z(e,t){return t.tabs[e].can_start_call=Object(g.E)(t,e),Promise.resolve(t)}function ee(e,t,n,a,i){return i.tabHistoryNotChanged=!1,Object(o.e)(r.b,3,e=>e-1)(j.a,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:i.prevPeer,gid:i.gid,block:a}).then(t=>{var r=$(t,6),a=r[0],o=r[1],c=r[2],s=r[3],u=r[4],_=r[5];if(o.forEach(e=>Object(b.a)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},u,{[l.k]:i.dialog_tab_cts[l.k]}),i.tabs[e]||(i.tabs[e]=Object(d.uc)(i,a)),Object(T.i)(s,i),n){if(i.tabs[e]){var f=i.tabs[e].lastmsg,m=i.tabs[e].lastmsg_meta;extend(i.tabs[e],a),i.tabs[e].lastmsg=f,i.tabs[e].lastmsg_meta=m}}else extend(i.tabs[e],a);return i.admins=extend(i.admins,c),i.imQueue(e,!1),Jn(),_&&(i.tabs[e].peer_profile_info=_),te(e,i)}).catch(e=>Object(p.a)("loadPeer",e))}function te(e,t){var n=t.imQueue(e,!1),r=t.tabs[e],a=n.filter(n=>!Object(f.P)(t,e,n.rid));return r.msgs=a.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),r.msgs),t.imQueueSet(e,a),t.tabs[e].history=Object(d.bd)(a,t,X(t.tabs[e].history)),Promise.resolve(t)}function ne(e,t,n,r,a){var i=a.imQueue(n),o=[],c=[];i.forEach(e=>{e.failed&&r&&e.mess.messageId!==r&&c.push(e),!e.failed||r&&e.mess.messageId!==r||o.push("rid"+e.rid)}),a.imQueueSet(n,c);var s=Object(f.s)(a,n);if(!s)return Promise.resolve(a);var u=c.length?c[c.length-1].mess:Object(f.k)(e,n,o[0]);return s.lastmsg=u&&u.messageId,s.lastmsg_meta=u,o.forEach(e=>delete s.msgs[e]),s.history=Object(d.Ac)(o,X(s.history)),Object(d.Ac)(o,t),Promise.resolve(a)}function re(e,t,n){var r=n.imQueue(t),a=[],i=[],o=Date.now();return r.forEach(e=>{e.failed&&o-e.ts<864e5&&i.push(e),e.failed&&o-e.ts>=864e5&&a.push("rid"+e.rid)}),n.imQueueSet(t,i),n.tabs[t].history=Object(d.Ac)(a,X(n.tabs[t].history)),Object(d.Ac)(a,e),Promise.resolve(n)}function ae(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(r.b)(j.a,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>{var n=$(e,1)[0];return Object(T.i)(n,t)})}function ie(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(d.Sb)(t,n)&&!t.tabs[n].msgid?(t.gid&&ae(n,t),Promise.resolve(t).then(S.c)):(Object(d.Sb)(t,n)&&(t.tabs[n].msgid=!1),ee(n,e,!1,!0,t)))).then(S.c).then(oe.bind(null,n))}function oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(d.ic)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(d.ic)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function ce(e,t,n){var r=n.msgid,a=n.peer;return!e&&Object(d.Sb)(n,a)&&n.tabs[a].msgs[r]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&ae(a,n),Promise.resolve(n).then(S.c).then(oe.bind(null,a))):ee(a,!0,r,!0,n).then(S.c).then(()=>(Object(f.s)(n,a).msgid=r,n)).then(oe.bind(null,a))}function se(e,t,n,r){if(Qt(r))throw Object(d.Cd)(),new Error("Cant change peer while loading something");var a=r.gid?"gim"+r.gid:"im";if(r.prevPeer=r.peer,r.peer=e,r.msgid=t||"",r.currentEntryPoint=n,cur.peer=e,z({sel:e?Object(d.ab)(e):null,msgid:r.msgid,email:"",0:a}),0!==r.prevPeer&&oe(r.prevPeer,r,!0),0!==e){Object(d.ic)(r,e)&&oe(e,r,!0),pn(r.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(r.tabbedPeers):r.tabbedPeers.map(t=>(t.peer===e&&"perm"!==t.type&&(t.type="perm"),t)),!1,r)}else pn(r.tabbedPeers,!1,r);return W(),Object(R.a)(location.href,document.referrer),it(r.prevPeer,r)}function ue(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,r)=>{if(cur.wallMentions=[],!Object(d.Lb)(e.peer)||!Object(d.Sb)(e,e.peer)||Object(d.Tb)(e,e.peer))return r();var a=e.tabs[e.peer];function i(){var r=[];Object.keys(a.msgs||{}).reverse().forEach(e=>{var t=Object(f.W)(a.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===r.indexOf(n)&&Object(d.mc)(a,n)&&r.push(n)}),(a.memberIds||[]).forEach(e=>{-1===r.indexOf(e)&&r.push(e)});var i=[];r.forEach(t=>{if(Object(b.b)(e,t)){var n=Object(b.c)(e,t),r=n.link.substring(1);i.push([n.id,n.name,"@"+r,n.photo,void 0,void 0,void 0,r,n.first_name,"",n.note])}});var o=getLang("mail_im_mention_all"),c=getLang("mail_im_mention_online");t&&Object(g.z)(e)&&i&&i.length>1&&(_.a.online.forEach(e=>i.push(["online",c,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""])),_.a.all.forEach(e=>i.push(["all",o,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""]))),n(i)}a.membersLoaded?i():Fn(e.peer,e).then(i)})}function de(e,t,n){var a=n.tabs[n.peer];return Object(r.b)(j.a,{peer:n.peer,whole:e,act:"a_history",offset:a.offset+(a.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=$(e,4),r=t[0],i=t[1],o=t[2],c=t[3];return a.allShown=o,n.admins=extend(n.admins,c),a.history=r+Q(a.history),a.historyToAppend=r,a.offset+=Object.keys(i).length,a.msgs=extend(a.msgs,i),n})}function le(e){var t=e.tabs[e.peer];return Object(r.b)(j.a,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var r=$(n,5),a=r[0],i=r[1],o=r[2];r[3],r[4];t.allShown=t.allShown||o,t.history=Q(t.history)+a,t.historyToAppend=a;var c=Object.keys(i).length;return t.skipped-=c,t.offset+=c,t.msgs=extend(t.msgs,i),e})}function _e(e,t,n,r){var a=e.tabs[t];return r===i.p&&a.out_up_to>n||(r===i.p?a.out_up_to=n:a.in_up_to=n),e}var fe=Object(y.a)((function(e,t){if(Object(P.t)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],a=n.msgs||{},o=Object.keys(a).map(n=>Object(f.m)(t,e,n)).filter(e=>!Object(m.r)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(o=o.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(o=intval(o.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([i.ob([6,e,o,null])]),Object(r.b)(j.a,{peer:e,ids:[o],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>_e(t,e,o,i.p)).catch(()=>t))})),me=Object(y.a)((function(e,t,n){var a=n.tabs[t];return Object(P.t)(a)||Object(d.Jd)(a)||e<=a.in_up_to?Promise.resolve(n):(n.longpoll.push([i.ob([6,t,e,null])]),Object(r.b)(j.a,{peer:t,ids:[e],hash:a.hash,act:"a_mark_read",gid:n.gid}).then(()=>_e(n,t,e,i.p)))})),be=Object(y.a)((function(e,t,n){var a=n.tabs[e];return Object(r.b)(j.a,{peer:e,id:t,hash:a.hash,act:"a_mark_listened",gid:n.gid})}));function pe(e){return Object(r.b)(j.a,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=$(t,3),r=n[0],a=n[1],i=n[2];return extend({},e,{imKey:r,imUrl:a,imPart:i})})}function ge(e){return Object(r.b)(j.a,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=$(t,1)[0];return extend({},e,{imTs:n})})}function he(e,t,n){var r=n.tabs[e];return r.msgs[t.messageId]&&(r.msgs[t.messageId].errored=1,r.history=Object(d.hd)(e,t,X(r.history))),Promise.resolve(n)}function ve(e,t,n,r){var a=r.tabs[e];return a.msgs[t]&&(a.msgs[t].errored=0,a.lastmsg_meta=n,a.lastmsg=t,a.history=Object(d.Gd)(e,t,X(a.history))),Promise.resolve(r)}function Oe(e,t){return 0===e.length?Promise.resolve(t):Object(r.b)(j.a,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=$(e,1)[0];return t.admins=extend(t.admins,n),t})}function je(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};pn(t.tabbedPeers.concat([n]),!1,t)}}function ye(e,t,n){return Object(d.gc)(n)?t.concat([e]):[e].concat(t)}function Ie(e,t){var n=e.get().peer,r=Object(f.s)(e,n);if(Object(d.Sb)(e,n)){var a=X(r.history);r.history=Object(d.Od)(e,a,t)}}function ke(e,t){var n=Object(f.s)(t,e.peerId);if(Object(d.Sb)(t,e.peerId)){var r=X(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(d.cb)(t,e,r)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var a=n&&n.pinned&&Object(f.W)(n.pinned);if(a&&a.messageId===e.messageId&&(n.pinned=e),Object(d.ic)(t,e.peerId)&&!Object(m.r)(e)&&Object(m.u)(n,e)){var i=Object(E.b)(e,t.id),o=n.mentions&&n.mentions.includes(e.messageId);i&&!o?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!i&&o&&Object(S.e)(e.peerId,t=>t!==e.messageId,t)}return Promise.resolve(t)}function Ce(e,t){var n=e.flags&i.p,r=e.peerId,a=H({},e);if(delete a.minorSortId,Object(d.ic)(t,r)){var o=t.tabs[r];if("number"==typeof e.messageId&&o.lastmsg>e.messageId)return Promise.resolve(t);if(o.deletedDialog=!1,e.local&&(t.msg_local_ids_sort=t.msg_local_ids_sort||{lastSortId:0},t.msg_local_ids_sort[e.messageId]=++t.msg_local_ids_sort.lastSortId),n||Object(P.t)(o)?o.unread=0:(e.messageId>o.in_up_to&&(o.lastmsg===e.messageId&&o.unread?Ee(t,1,e.peerId):(!o.unread&&Ee(t,1,e.peerId),o.unread++)),O.g.has(e.messageId)&&!Object(f.y)(o)&&(o.expiring_messages||(o.expiring_messages=[]),o.expiring_messages.push(e.messageId)),Object(E.b)(e,t.id)&&(o.mentions||(o.mentions=[]),o.mentions.push(e.messageId)),je(e.peerId,t)),Object(d.Sb)(t,r)){var c=Object(m.o)(o,e),s=c||0===o.offset;c&&(o.blocked_community=0),o.skipped>0&&o.skipped++,o.offset++,o.msgs[e.messageId]=a;var u=X(o.history);o.history=Object(d.M)(t,e,u,!0,!0,!0),s&&Object(S.c)(t)}if(o.typing){var l=o.typing.userIds.indexOf(e.userId);l>=0&&o.typing.userIds.splice(l,1)}return o.lastmsg=e.messageId,o.lastmsg_meta=a,o.minor_sort_id=e.minorSortId,oe(e.peerId,t),Object(S.f)(t,o,!1,ye.bind(null,r),rn.bind(null,t)),Promise.resolve(t)}return e.flags&i.r?Promise.resolve(t):ee(r,0,0,0,t).then(t=>{var a=t.tabs[r];return Object(S.f)(t,a,!1,ye.bind(null,r),rn.bind(null,t)),oe(e.peerId,t),n||je(e.peerId,t),t})}function Ee(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],Object(T.a)(t,n,e).then(D.a)}function we(e,t){var n=Object(f.s)(t,e.peerId);if(Object(d.Sb)(t,e.peerId)){var r=n.unread;if(t=_e(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(f.b)(e.peerId,t)+(n.unread>0?+n.skipped:0),r>0&&!n.unread&&Ee(t,-1,e.peerId),!n.skipped){var a=X(n.history);n.history=Object(d.Dc)(t,a,e.peerId)}}else Object(d.ic)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&0===e.unread&&Ee(t,-1,e.peerId),t.tabs[e.peerId].unread=e.unread||0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(d.ic)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[l.n]=t.dialog_tabs[l.n].filter(t=>intval(t)!==e.peerId)),Object(d.ic)(t,e.peerId)&&(Object(S.d)(e.peerId,t=>t>e.upToId,t),Object(S.e)(e.peerId,t=>t>e.upToId,t)),0!==Object(M.i)(t)||t.active_tab!==l.n||t.gid?Promise.resolve(t):nn(l.g,t)}function Pe(e,t){var n=t.tabs[e.peerId];if(Object(d.ic)(t,e.peerId)&&_e(t,e.peerId,e.upToId,i.p),Object(d.Sb)(t,e.peerId)){var r=X(n.history);n.history=Object(d.tc)(t,e.peerId,r)}return Promise.resolve(t)}function Te(e,t,n,r,a){return a.text={},a.imQueue=e,a.imQueueResend=t,a.imQueueSet=n,a.imQueueComplete=r,Promise.resolve(a)}function Ne(e,t,n){function r(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var a=e[0],i=Object(f.m)(n,t,a),o=Object(f.e)(n,t,a);return!1===o?n.set(Pt.bind(null,{[t]:[i.userId]})).then(n=>{var o=Object(f.e)(n,t,a);return{msgIds:e,object:r(i,o)}}):Promise.resolve({msgIds:e,object:r(i,o)})}return Promise.resolve({msgIds:e})}function Se(e,t,n,r){var a=Object(f.s)(r,e);if(a&&a.last_seen&&a.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:a.last_seen.mobile;a.online=t,a.last_seen={platform:t,time:n||a.last_seen.time,mobile:i,can_see:a.last_seen.can_see}}var o=Object(d.Z)(t),c=o.is_online,s=o.is_mobile;return Object(S.g)(r,e,c,s)}function Ae(e,t,n){var r=Object(f.s)(n,e.peerId);return r&&(e.ts=Date.now()/1e3,r.activity||(r.activity={}),r.activity[t]=e,r.typing===G&&(r.typing=e)),Promise.resolve(n)}function xe(e,t){var n=Object(f.s)(t,e.peerId),r=Object(m.g)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[r]&&(n.activity[r].userIds=n.activity[r].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function Le(e,t,n){var r=e.peerId;return Object(o.c)(q+2).then(()=>{if(Object(d.ic)(n,r)){var e=n.tabs[r];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*q&&(delete e.activity[t],0===Object.keys(e.activity).length&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*q&&(e.typing=void 0)}return n})}function Me(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var r=$(n,3)[2];Object.assign(t,r)}return t}var De=function(e,t,n,a){var i=Date.now()+rand(0,100).toFixed(0),o=a.ref_id,s=a.ref_source;a.ref_source=void 0,a.ref_id=void 0,(s||o)&&(z({ref_source:null,ref:null}),W()),Object(h.i)(a);var u=t.attaches.length>0,d=Object(h.k)(a,"send","server",u),l=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:s,ref:o,msg:t.message,payload:t.payload,media:Object(c.a)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:a.gid,entrypoint:a.currentEntryPoint||"",sticker_referrer:t.sticker_referrer,module:cur.module},n.external,Me(t.attaches));return Object(r.b)(j.a,l,2e4).then(e=>{var t=$(e,1)[0];return d(),a.version!==t.version&&nav.reload({force:!0}),a.currentEntryPoint="",a}).catch(e=>{throw Object(h.h)(a,e,"send","server_send"),e})},Re=Object(y.a)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,a=r.tabs[e];return De(e,t,H({hash:a.hash},n),r)})),Be=Object(y.a)((function(e,t,n){var a=t.attaches.length>0,i=Object(h.k)(n,"edit","server",a);return Object(r.b)(j.a,Object.assign({act:"a_edit_message",module:cur.module,hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(c.a)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Me(t.attaches)),2e4).then(e=>{$(e,1)[0];return i(),n}).catch(e=>{throw Object(h.h)(n,e,"edit","server_send"),e})}));function Ue(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(s.a)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function He(e){return e.selectedMessages=[],Promise.resolve(e)}function $e(e){return e.selectedMessages=[],Promise.resolve(e)}function Fe(e,t){if(Object(d.Sb)(t,e.peerId)){var n=t.tabs[e.peerId],r=H({},e);delete r.minorSortId;var a=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,a),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=r,n.lastmsg=e.messageId,n.minor_sort_id=e.minorSortId,n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=r,delete n.msgs["rid"+e.randomId]),t.msg_local_ids_sort&&delete t.msg_local_ids_sort["rid"+e.randomId],n.history=Object(d.Yc)(t,X(n.history),r)}return Promise.resolve(t)}function qe(e,t){var n=Object(h.k)(t,"unknown","attach"),a={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(o.e)(r.b,3,e=>e*e)(j.a,a).then(r=>(n(),Ve(e,r,t))).catch(n=>(Object(h.h)(t,n,"unknown","server_load_attach"),Ve(e,null,t)))}function Ge(e,t){return(n=e.peerId,r=e.chat_local_id,Object(B.b)(U.a)("messages.getByConversationMessageId",{peer_id:n,conversation_message_ids:r,extended:1,fields:"kludges"})).then(n=>{var r=t.tabs[e.peerId],a=n.items[0].template;return a&&r.msgs&&(r.msgs[e.messageId].kludges.template=a),Promise.resolve(t)}).then(t=>function(e,t){var n=t.tabs[e.peerId];n.history&&(n.history=Object(d.Vc)(X(n.history),e,t));return Promise.resolve(t)}(e,t));var n,r}function Ve(e,t,n){var r=n.tabs[e.peerId],a=t&&t[2];return r.mediacontent||(r.mediacontent={}),r.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],a&&(a.no_forward&&(r.msgs[e.messageId].kludges.no_forward=!0),a.no_pin&&(r.msgs[e.messageId].kludges.no_pin=!0)),function(e,t){var n=t.tabs[e.peerId];return n.history=Object(d.Uc)(X(n.history),e,t),Promise.resolve(t)}(e,n)}function Ke(e,t,n){var r=Object(d.bb)(t),a=n.tabs[e];return a.searchDay=r,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[],Promise.resolve(n)}function ze(e,t,n){return n.tabs[t].searchText=e,ct(t,n),n}function We(e,t,n){if(t){var r=n.tabs[t];r.searchText=e,r.searchOffset=0,r.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function Ye(e,t,n,r){return Object(w.c)(e,t,n,{},r).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function Je(e){return(t,n)=>e(n).then(e=>{var r=(t?e.search(t):e.list).map(A.c);return n.mapped_index||(n.mapped_index={}),r.forEach(e=>{n.mapped_index[e.peerId]=e}),r})}var Xe=Je(e=>e.topConvTree),Qe=Je(e=>e.imTopConvTree),Ze=Je(e=>e.hintsTree);function et(e,t){var n,a,i;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{a=e}),t.imTopConvTree=new Promise(e=>{i=e});var c=e?e.select(u.b):[];return Object(o.e)(r.b,1,()=>4)(j.a,{act:"a_dialogs_preload",rs:c.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var r=$(e,4),o=r[0],c=r[1],s=r[2],u=r[3];return t.popular_sugg=s,new L.a(o,e=>e[1],n),new L.a(c,e=>e[1],a),u&&u.length>0?new L.a(u,e=>e[1],i):i(),t})}function tt(e){var t,n,a=e.active_tab,i=e.dialog_tabs[a];return i.length>0?i.forEach(r=>{var a=e.tabs[r],i=a.minor_sort_id,o=a.major_sort_id;(i||o)&&(void 0===t||t>o?(t=o,n=i):t===o&&n>i&&(n=i))}):(t=0,n=0),Object(r.b)(j.a,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:a,gid:e.gid,tags:a===l.m&&e.peer_tags_filter?e.peer_tags_filter.mask:null}).then(t=>{var n=$(t,4),r=n[0],o=n[1],c=n[2],s=n[3];return c.forEach(t=>Object(b.a)(e,t)),Object(T.i)(s,e),Object(S.a)(o,e),e.dialog_tabs[a]=i.filter(e=>!o[e]).concat(Object.keys(o).map(intval)),e.dialog_tabs_all[a]=!r.has_more,Promise.resolve(e)})}var nt=Object(y.a)((function(e,t){return Object(r.b)(j.a,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var r=$(n,5),a=r[0],i=r[1],o=r[2],c=r[3],s=r[4];return i.forEach(e=>Object(b.a)(t,e)),Object(d.vc)(t,a),e===t.searchText&&(t.searchOffset=c,t.searchAllLoaded=s),Object.keys(a).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=a[e]}),[a,o]})}));function rt(e,t){return t.tabs[e].searchAllLoaded}function at(e,t){return!(t.peer!==e||!Object(d.Sb)(t,e))&&t.tabs[e].inplaceSearch}function it(e,t){if(Object(d.Sb)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,z({st:""}),W()}return Promise.resolve(t)}function ot(e,t){if(Object(d.Sb)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function ct(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var st=Object(y.a)((function(e,t){var n=t.tabs[e],a="";if(ct(e,t),n.searchDay&&(a="day:"+n.searchDay),!a&&!n.searchText)return Promise.reject();var i=`in:${e} ${a} ${n.searchText||""}`;return z({st:n.searchText}),W(),Object(r.b)(j.a,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=$(e,4),r=t[0],a=t[1],i=t[2],o=t[3];return n.searchOffset=a,n.searchAllLoaded=i,n.searchMsgs=(n.searchMsgs||[]).concat(o),r})}));function ut(e){return Object(r.b)(j.a,{act:"a_important",offset:e,part:e>0})}function dt(e,t){var n=Object(f.s)(e,t);return Object(r.b)(j.a,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(r=>{var a=$(r,4),i=a[0],o=a[1],c=a[2],s=a[3],u=intval(i[0]);Object(d.Wb)(e)&&!u&&!1!==n.lastmsg&&(console.log(H({},n)),Object(d.md)(!0)),n.lastmsg=u||!1,n.lastmsg_meta=i;var _=$(o,3);n.unread=_[0],n.in_up_to=_[1],n.out_up_to=_[2],c?n.mentions=c:n.mentions&&delete n.mentions,s?n.expiring_messages=s:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[l.n]=e.get().dialog_tabs[l.n].filter(e=>e!=t)),Object(S.f)(e.get(),n,!1,ye.bind(null,t),rn.bind(null,e.get()))})}function lt(e,t,n){if(Object(d.Sb)(n,t)){var r=n.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e}return Promise.resolve(n)}function _t(e,t,n){if(Object(d.Sb)(n,t)){var r=n.tabs[t];if(r.history=Object(d.Ac)(e,X(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length,e.forEach(e=>delete r.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),r.inplaceSearch){var a=e.reduce((e,t)=>(e[t]=!0,e),{});r.searchMsgs=r.searchMsgs.filter(e=>!a[e]),r.searchOffset=r.searchMsgs.length}}return Promise.resolve(n)}var ft=Object(y.a)((function(e,t,n,a,i){return Object(r.b)(j.a,{act:"a_mark",peer:t,hash:n||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:a})}));function mt(e,t,n,r){if(Object(d.Sb)(r,t)){var a=r.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e,a.history=Object(d.Bc)(e,t,n,X(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length}return Promise.resolve(r)}function bt(e,t,n){if(Object(d.Sb)(n,t)){var r=n.tabs[t];r.deleted&&(r.deleted=r.deleted.filter(t=>t!==e)),r.history=Object(d.ad)(e,t,X(r.history)),r.offset++}return Promise.resolve(n)}function pt(e,t,n,a){return Object(r.b)(j.a,{act:"a_restore",id:e,peer:t,hash:n,gid:a})}var gt=Object(y.a)((function(e,t,n){return Object(P.t)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(r.b)(j.a,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),ht=Object(y.a)((e,t)=>Object(r.b)(j.a,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(f.X)(n.folders),t})),vt=Object(y.a)((e,t)=>Object(r.b)(j.a,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(Object(S.f)(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),pn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Ot=Object(y.a)((function(e,t){return gt(e,G,t)})),jt=Object(y.a)((function(e,t){return gt(e,V,t)}));function yt(e,t,n,r){return t&&(r.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(r)}function It(e,t){return t.pendingForward=e,Promise.resolve(t)}function kt(e,t,n){if(!Object(d.ic)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var r=n.tabs[e];return Object(S.f)(n,r,!0,t=>t.filter(t=>t!==e)),r.unread>0&&!Object(P.t)(r)&&Ee(n,-1,e),r.deletedDialog=!0,pn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var a=$(t,2);a[0],a[1];return delete n.blockedFlagUpdates[e],r.msgs=null,r.history=null,r.unread=0,r.lastmsg=!1,r.lastmsg_meta=null,n})}var Ct=Object(y.a)((function(e,t){return kt(e,Object(r.b)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Et=Object(y.a)((function(e,t,n){return Object(r.b)(j.a,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),wt=Object(y.a)((function(e,t){return Object(r.b)(j.a,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var r=$(n,1)[0];return t.tabs[e]=extend(t.tabs[e],r),t})}));function Pt(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(r.b)(j.a,{act:"a_load_member",need:n,gid:t.gid}).then(e=>($(e,1)[0].forEach(e=>Object(b.a)(t,e)),t))}function Tt(e,t,n){var r={},a=n.get();function o(e,t){Object(d.Lb)(e)&&t&&!Object(b.b)(a,t)&&(r[e]?-1===r[e].indexOf(t)&&r[e].push(t):r[e]=[t])}var c=t.filter(e=>!Object(d.ic)(a,e.peerId)).map(e=>e.peerId);t.forEach(e=>{o(e.peerId,e.userId)}),e.forEach(e=>{o(e.peerId,Number(e.kludges.source_mid)),o(e.peerId,Number(e.kludges.from))});var s=t.filter(e=>e.flags&i.p&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!a.admins[e]);return 0===Object.keys(r).length&&0===s.length&&0===c.length?Promise.resolve(a):{shouldLoad:Object.keys(r).length>0||s.length>0||c.length>0,needMembers:r,needAdminIds:s,needPeers:c}}function Nt(e,t,n){var r=e.needMembers,a=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([Pt(r,n),Oe(a,n),Promise.all(i.map(e=>ee(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var St=Object(y.a)((function(e,t){return e.kludges.source_act===d.m?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(r.b)(j.a,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var r=$(n,2),a=r[0],i=r[1];t.chat_photo_msg=i;var o=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=a[0],t.tabs[e.peerId].photoLarge=a[1],Object(d.Sb)(t,e.peerId)){var c=e.kludges.source_act;o.history=Object(d.L)(e,c,t,X(o.history))}return t}))}));function At(e,t,n,r){return t!==vk.id||Object(d.ic)(r,n)&&r.peer==n&&(r=Object(S.c)(r)),Promise.resolve(r)}var xt=Object(y.a)((function(e,t){return Object(r.b)(j.a,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(At.bind(null,d.k,vk.id,e,t))})),Lt=Object(y.a)((function(e,t){return Object(r.b)(j.a,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(At.bind(null,d.j,vk.id,e,t))})),Mt=Object(y.a)((function(e,t,n,a){return Object(r.b)(j.a,{act:"a_mute",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),a}).then(Rt.bind(null,e,t))})),Dt=Object(y.a)((function(e,t,n){return Object(r.b)(j.a,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function Rt(e,t,n){var r=n.mutedPeers.filter(t=>t!==e);return t&&r.push(e),n.mutedPeers=r,cur.mutedPeers=n.mutedPeers,Object(S.c)(n)}function Bt(e,t){return t.stack=e,Promise.resolve(t)}var Ut=Object(y.a)((function(e,t,n,a){return Ht(e,n,t,a),Object(r.b)(j.a,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:a.gid,peer:n,hash:a.tabs[n].hash}).then(()=>a)}));function Ht(e,t,n,r){if(Object(d.Sb)(r,t)){var a=r.tabs[t];e.filter(e=>a.msgs[e]).forEach(e=>{var o=Object(f.m)(r,t,e),c=n?o.flags|i.o:o.flags&~i.o;o.flags=c,a.msgs[e]=o,a.history=Object(d.Qd)(e,n,X(a.history))})}return Promise.resolve(r)}function $t(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function Ft(e,t){return Object(r.b)(j.a,{act:"a_spam",offset:e,gid:t,part:e>0})}function qt(e,t){return Object(r.b)(j.a,{act:"a_flush_spam",gid:t,hash:e})}function Gt(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function Vt(e,t){return Object(x.h)(JSON.parse(e).data[0],t)}function Kt(e){return Object(r.b)(j.a,{act:"a_get_contacts"}).then(t=>{var n=$(t,1)[0];return e.contactsList=n,e})}function zt(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}var Wt=Object(y.a)((function(e,t,n){return n.creating=!0,Object(r.b)(j.a,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var r=$(t,1)[0].peer_id;if(!r)throw new Error("No peer_id");return n.peer=r,e?Object(k.e)(n,r,e):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function Yt(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,a=e.active_tab;return Object(s.i)("Resync started"),Object(r.b)(j.a,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:a,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var r=$(n,5),i=r[0],o=r[1],c=r[2],u=r[3],_=r[4];o.forEach(t=>Object(b.a)(e,t)),Object(d.vc)(e,i),Object(s.i)("Resync success","success");var f,m=e.peer;if(Object(d.fc)(m))f=Promise.resolve(!1);else{var p={tabs:{[m]:e.tabs[m]},oCache:{}};f=Object(S.a)({[m]:i[m]},p)}return f.then(n=>{e.tabs=i,e.admins=extend(e.admins,u),n&&(e.tabs[m]=n.tabs[m],e.tabs[m].history=Object(d.bd)(m,e,X(e.tabs[m].history))),e.loadingDialogs=!1,e.mutedPeers=c.mutedPeers,e.lastDialogsOptions={has_more:c.has_more},e.dialog_tab_cts=Object.assign({},c.folder_cts,{[l.k]:e.dialog_tab_cts[l.k]}),e.dialog_tabs[a]=_.map(intval);var r=e.dialog_tabs[a].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=a).forEach(t=>{a==l.g?e.dialog_tabs[t]=r.filter(Object(A.e)(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),Object(T.f)({count:intval(c.unread),countNotMuted:intval(c.unreadNotMuted)},e)})}).then(e=>(Object(D.a)(e),e)).catch(t=>(Object(s.i)("Resync error: "+t.message+" "+t.stack,"error"),Object(o.c)(2).then(Yt.bind(null,e))))}function Jt(e,t){return t.lockedSending=e,Promise.resolve(t)}function Xt(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function Qt(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function Zt(e,t){return t.ctrl_submit=!!e,Object(r.b)(j.a,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function en(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var r=document.title,a=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var i=function(e,t,n){return function(){n.update_old_title=e;var r=Object.keys(n.cur_unread_cnt).length;if(0===r)return Object(v.tb)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(v.tb)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(r>9?10:r)+t+".ico"),Object(v.tb)(winToUtf(getLang("mail_im_new_messages",r))))}}(r,a,n);n.update_title_to=setInterval(i,1e3),i()}else!t&&n.update_old_title&&(Object(v.tb)(n.update_old_title),n.cur_unread_cnt={},r=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+a+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function tn(e,t,n,r,a){return Object(d.Sb)(a,e)&&(a.tabs[e].scrollTop=intval(t),a.tabs[e].scrollBottom=intval(n),a.tabs[e].contHeight=intval(r)),Promise.resolve(a)}function nn(e,t){var n=t.active_tab;t.active_tab=e,Object(a.b)({tab:e===l.g?null:e,tags:e===l.m&&t.peer_tags_filter?t.peer_tags_filter.mask:null});var r=[];if(e!==l.g&&!Object(d.gc)(t)){var i=t.dialog_tabs[e];r=t.dialog_tabs[l.g].map(e=>t.tabs[e]).filter(Object(A.e)(e)).map(e=>e.peerId),t.dialog_tabs[e]=i.length>=r.length?i:r}return n===l.m&&e!==n&&(t.peer_tags_filter.ids=[],Object(N.l)(t),Object(N.m)(t)),Promise.resolve(t)}function rn(e,t,n,r){var a=e.dialog_tabs_all;return!(!a[l.g]&&!a[t])||(!!n.includes(r.peerId)||("r"===r.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(d.gc)(e)?t.major_sort_id>r.major_sort_id||t.minor_sort_id>r.minor_sort_id:t.major_sort_id<r.major_sort_id||t.minor_sort_id<r.minor_sort_id).length>0))}function an(e,t,n,r,a,o){if(Object(d.ic)(o,e)&&!a){var c=o.tabs[e];return n===i.X&&(t^=c.folders),function(e,t,n){return!(e===i.fb&&n.folders&t)&&(!!(e!==i.bb||n.folders&t)&&!Object(P.t)(n))}(n,t,c)&&Object.keys(l.j).filter(e=>l.j[e]&t).forEach(e=>{o.dialog_tab_cts[e]+=function(e,t,n){return t!==i.bb||e.folders&l.j[n]?t===i.X?e.folders&l.j[n]?-1:1:t===i.fb?1:-1:0}(c,n,e)}),n===i.fb?o.tabs[e].folders|=t:n===i.bb?o.tabs[e].folders&=~t:o.tabs[e].folders=t^=c.folders,Object(S.f)(o,o.tabs[e],!0,(t,n)=>n===l.m?t:t.concat([e]).map(e=>o.tabs[e]).filter(Object(A.e)(n)).map(e=>e.peerId),rn.bind(null,o)),Promise.resolve(o)}return ee(e,0,0,0,o).then(an.bind(null,e,t,n,null,!1,o))}var on=Object(y.a)((function(e,t){var n=l.j[l.h],a=t.tabs[e].folders&n,o=a?i.pb:i.rb;return t.longpoll.push([o([0,e,n,!0])]),Object(r.b)(j.a,{act:"a_dialog_star",val:a?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),cn=Object(y.a)((function(e,t,n){var a=l.j[l.o];return n.longpoll.push([i.pb([0,e,a,!0]),i.ob([6,e,t,null])]),Object(r.b)(j.a,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)})),sn=Object(y.a)((e,t)=>(t.longpoll.push([Object(C.g)(),i.rb([0,e,l.j[l.i],!0])]),Object(r.b)(j.a,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid}))),un=Object(y.a)((e,t)=>{t.longpoll.push([i.pb([0,e,l.j[l.i],!0])]);var n=t.tabs[e];return Object(r.b)(j.a,{peer:e,ids:n.lastmsg?[n.lastmsg]:[],mark_conversation_as_read:!0,hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>t)});function dn(e){return Object(r.b)(j.a,{act:"a_get_mutex_key",gid:e})}function ln(e,t){return Object(T.i)({[e]:{free:!0}},t),Object(r.b)(j.a,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function _n(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var fn=Object(y.a)((function(e,t){return Object(S.f)(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(r.b)(j.a,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(pn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,Object(S.f)(t,t.tabs[e],!1,ye.bind(null,e),rn.bind(null,t))),n))}));function mn(e,t,n,a){return Object(r.b)(j.a,{act:"a_restore_dialog",hash:t,gid:a.gid,spam:n?1:0,peer:e}).then(t=>(a.tabs[e].deletedDialog=!1,Object(S.f)(a,a.tabs[e],!1,t=>[e].concat(t)),a.tabs[e].unread=t,a))}function bn(e,t,n){return Object(r.b)(j.a,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function pn(e,t,n){return n.tabbedPeers=e,Object(d.Mb)(n)&&(z({peers:n.tabbedPeers.filter(e=>{var t=e.peer,r=e.type;return t!==n.peer&&"perm"===r}).map(e=>Object(d.kb)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(d.ab).join("_"),to:""}),t&&W()),Promise.resolve(n)}function gn(e){return!e.peer||(at(e.peer,e)?rt(e.peer,e):!!Object(d.Sb)(e,e.peer)&&e.tabs[e.peer].allShown)}function hn(e,t){var n=t.tabs[e];return Object(d.Sb)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function vn(e,t){var n=t.tabs[e];return Object(d.Sb)(t,e)&&(n.history=Q(n.history)),Promise.resolve(t)}function On(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function jn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function yn(e,t,n){if(!Object(d.Ob)(t))return Promise.resolve(n);var a=Object(f.s)(n,t);return a.blocked_community=!e,!1===e&&(a.can_send_notify=!1),Object(r.b)(j.a,{act:"a_toggle_community",peer_id:t,hash:a.hash,state:e?1:0}).then(()=>Object(S.c)(n))}function In(e){if(0!==e.peer&&Object(d.Sb)(e,e.peer)){var t=Object(f.s)(e,e.peer),n=geByClass1("_im_peer_history");n&&(t.history=X(n.innerHTML))}return Promise.resolve(e)}function kn(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Cn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function En(e){z({act:e?"create":null}),W()}function wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;z({q:e}),W()}function Pn(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(d.ob)()>window.clientHeight()&&Object(d.fd)(0)),Promise.resolve(e)}var Tn=Object(y.a)((function(e,t,n,a){return Object(r.b)(j.a,{act:"a_join_chat",chat_id:e,hash:t,invite_link:n,write_hash:a.writeHash}).then(e=>{var t=$(e,4),n=t[0],r=t[1],i=t[2],o=t[3];return i.forEach(e=>Object(b.a)(a,e)),a.tabs[n]=r,Object(S.f)(a,r,!1,ye.bind(null,n),rn.bind(null,a)),a.admins=extend(a.admins,o),[n]})}));function Nn(e,t){return Object(r.b)(j.a,{act:"a_get_link",gid:t.gid,chat_id:e})}var Sn=Object(y.a)((function(e,t){var n=t.tabs[e];return Object(r.b)(j.a,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function An(e){return Y({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function xn(e,t){var n=Object(s.a)([e].concat(t.select(u.b))).slice(0,500);t.update(u.b,n)}function Ln(e){e.update(u.b,[])}function Mn(e,t){var n=t.select(u.b).filter(t=>t!==e);return t.update(u.b,n),n}function Dn(e,t,n){var r=n.tabs[t],a=Object(f.m)(n,t,e);return Object(f.A)(r)&&!a.kludges.source_act&&(r.pinned=a),Promise.resolve(n)}function Rn(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var Bn=Object(y.a)((function(e,t,n){var a=n.tabs[t];return Object(f.A)(a)?Object(r.b)(j.a,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var r=$(e,1)[0];return n.tabs[t]=Object.assign({},a,r),n}):Promise.resolve(n)})),Un=Object(y.a)((function(e,t){var n=t.tabs[e];return Object(f.A)(n)?Object(r.b)(j.a,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>{var a=$(r,1)[0];return t.tabs[e]=Object.assign({},n,a),t}):Promise.resolve(t)})),Hn=Object(y.a)((function(e,t){var n=t.tabs[e];return Object(r.b)(j.a,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var r=$(e,1)[0];return n.pinned=r||null,t})})),$n=Object(y.a)((function(e,t,n){var a=n.tabs[e];return Object(r.b)(j.a,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:a.hash})})),Fn=Object(y.a)((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(r.b)(j.a,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=$(e,1),a=$(r[0],3),i=a[0],o=a[1],c=a[2];return n.memberIds=i,n.adminIds=o,c.forEach(e=>Object(b.a)(t,e)),n.membersLoaded=!0,t})})),qn=Object(y.a)((function(e,t){return Promise.all([Fn(e,t),function(e,t){var n=t.tabs[e];return Object(r.b)(j.a,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=$(e,1)[0];return n.photoGrid=r.grid,n.photoLarge=r.photo,n.membersLastSeen=r.lastSeen||null,n.inviters=r.inviters,n.caccess=r.caccess,n.invitedByMe=r.invitedByMe||[],n.inviteLinks=r.links||null,n.invitedByMessageRequest=r.invitedByMessageRequest,n.serverSettings=r.serverSettings||null,n.isDefaultPhotoOwner=r.isDefaultPhotoOwner||null,n.owner=r.owner||null,n.allowedUpdateFlags=r.allowedUpdateFlags,n.canInvite=r.canInvite||null,n.notifications=r.notifications,t})}(e,t)]).then(()=>t)})),Gn=Object(y.a)((function(e,t,n){var a=n.tabs[e];return Object(r.b)(j.a,{act:"a_update_flags",chat:e,gid:n.gid,hash:a.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),Vn=Object(y.a)((function(e,t){var n=t.tabs[e];return Object(r.b)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function Kn(e,t,n,r){var a=r.tabs[e];return a.adminIds=n?[].concat(a.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):a.adminIds.filter(e=>e!==t),Promise.resolve(r)}var zn=Object(y.a)((function(e,t,n,a){var i=a.tabs[e];return Object(r.b)(j.a,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+n,gid:a.gid}).then(()=>Kn(e,t,n,a))}));function Wn(e,t,n,r){var a=Object(f.m)(e,n,t).userId;return Object(b.c)(r,a)?Promise.resolve(r):Pt({[n]:[a]},r)}function Yn(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function Jn(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var Xn=Object(y.a)((function(e,t){return t.tabs[e].top_banner=void 0,Object(r.b)(j.a,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),Qn=Object(y.a)((function(e,t,n){n.tabs[e].top_banner=void 0;var a=n.tabs[e];return Object(r.b)(j.a,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:a.hash}).then(()=>n)}));function Zn(e,t){return Object(r.b)(j.a,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var r=$(n,1)[0];return t.tabs[e].top_banner=r,t})}function er(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,nr(e,!1,!0,n)}function tr(e,t){return er(e,null,t)}function nr(e,t,n,r){return((r.tabs||{})[e]||{}).keyboard&&(r.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(r)}var rr=Object(y.a)((function(e,t){var n=t.tabs[e];return Object(r.b)(j.a,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var r=$(n,1)[0];return er(e,r,t)})}));function ar(e,t,n,a){var i=a.tabs[e];return i.caccess[t]=n,Object(r.b)(j.a,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:n?1:0,gid:a.gid}).then(()=>a).catch(e=>{throw i.caccess[t]=!n,e})}var ir=Object(y.a)((function(e,t){var n=t.tabs[t.peer];return Object(r.b)(j.a,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function or(e,t,n){var a=n.tabs[n.peer];return Object(r.b)(j.a,{act:"a_create_template",hash:a.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function cr(e,t,n,a){var i=a.tabs[a.peer];return Object(r.b)(j.a,{act:"a_update_template",template_id:e,hash:i.hash,gid:a.gid,peer_id:a.peer,group_id:a.gid,name:t,text:n}).then(t=>{var n=a.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),a})}function sr(e,t){if(Object(d.Sb)(t,e)){var n=Object(f.s)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function ur(e,t){var n=e.updateType,r=e.updateArg,a=0;return n===i.F&&(a=r===i.M?1:-1),n===i.C&&(a=-1),t.dialog_tab_cts[l.k]+=a,Promise.resolve(t)}function dr(e,t,n){if(Object(d.Sb)(n,e.peerId)){var r=Object(f.s)(n,e.peerId);r.history=Object(d.ed)(r.history,t,e.messageId)}return Promise.resolve(n)}function lr(e,t){return Promise.resolve().then(()=>{if(Object(d.Sb)(t,e)){var n=Object(f.s)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(f.W)(e);Object(m.i)(t)&&!O.g.has(t.messageId)&&O.g.add(t)})}return Promise.resolve(t)})}var _r=Object(y.a)((function(e,t,n,a,i){return Object(r.b)(j.a,{act:"a_peer_profile_toggle_tag",hash:i.manage_tags_hash,group_id:i.gid,peer_id:a,tag_id:e,action:n}).then(n=>{i.tabs[a].peer_tags=n[0];var r=i.peer_profile_tags.findIndex(t=>t.id===e);return t?i.peer_profile_tags[r].uses++:!t&&i.peer_profile_tags[r].uses>0&&i.peer_profile_tags[r].uses--,i})})),fr=Object(y.a)((function(e,t){return Object(r.b)(j.a,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t))})),mr=Object(y.a)((function(e,t,n){return Object(r.b)(j.a,{act:"a_peer_profile_save_note",hash:n.manage_tags_hash,group_id:n.gid,peer_id:e,note:t}).then(()=>(n.tabs[e].peer_profile_info.note=t,n))})),br=Object(y.a)((e,t)=>Object(r.b)(j.a,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then(e=>$(e,1)[0])),pr=Object(y.a)((e,t)=>{var n=t.tabs[e];return Object(r.b)(j.a,{act:"a_get_active_call_data",peer_id:n.peerId,hash:n.hash}).then(e=>{var r=$(e,1)[0];return r?n.callInProgress=r:n.callInProgress&&delete n.callInProgress,t})}),gr=(e,t)=>{var n=t.tabs[e];return n.callInProgress&&delete n.callInProgress,Promise.resolve(t)};function hr(e,t){return t.peer_tags_filter&&t.peer_tags_filter.ids!==e&&(t.dialog_tabs[l.m]=[],t.dialog_tabs_all[l.m]=!1),t.peer_tags_filter={ids:e,mask:Object(N.b)(t.peer_profile_tags,e)},Promise.resolve(t)}function vr(e,t,n,r){var a=Object(f.s)(r,e);if(a){var i,o,c=a.peer_tags?a.peer_tags.ids:[];if(a.peer_tags={ids:t,mask:n},t.length!==c.length)t.length>c.length?(i=!0,o=t.filter(e=>!c.includes(e))[0]):(i=!1,o=c.filter(e=>!t.includes(e))[0]),r=function(e,t,n){if(!n.peer_profile_tags)return n;var r=n.peer_profile_tags.find(t=>t.id===e);r&&(t?r.uses++:r.uses>0&&r.uses--);return n}(o,i,r)}return Promise.resolve(r)}function Or(e){return e.dialog_tabs[l.m]=e.dialog_tabs[l.g].map(t=>Object(f.s)(e,t)).filter(t=>Object(N.a)(e,t)).map(e=>e.peerId),Promise.resolve(e)}function jr(e){return Object(r.b)(j.a,{act:"a_get_peer_profile_tags",group_id:e.gid}).then(t=>(e.peer_profile_tags=t[0].tags,e.active_tab===l.m?(e.peer_tags_filter.ids=e.peer_profile_tags.filter(t=>e.peer_tags_filter.ids.includes(t.id)).map(e=>e.id),e.peer_tags_filter.mask=Object(N.b)(e.peer_profile_tags,e.peer_tags_filter.ids),Object(a.b)({tab:l.m,tags:e.peer_tags_filter.mask}),Or(e)):e))}},"wSs/":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return _}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var r=n("rHUl"),a=n("MhhX"),i=n("P13b"),o=n("rudk"),c=n("aong");function s(e,t){t=Object(r.W)(t);var n=Object(c.s)(e),o=vk.id==t.peerId&&!n.gid,s=n.pinMessageEditSettings,u=s.messageEditAllowedTime,d=s.pinEditDelayTime,l=s.isPinEditEnabled,_=Date.now()/1e3,f=Object(r.o)(n),m=f&&f.messageId===t.messageId,b=t.kludges&&t.kludges.pinned_at,p=_-t.date>u,g=b&&_-b<d;if(333==t.peerId)return!1;if(!o&&!Object(a.r)(t))return!1;if(Object(a.s)(t))return!1;if(m&&p&&l){if(g)return!1}else if(p)return!1;return!(Object(a.k)(t)||Object(a.t)(t)||Object(a.g)(t)||Object(a.l)(t)||Object(a.p)(t)||Object(a.v)(t)||Object(a.h)(t))&&!Object(i.Ib)(e,t.peerId,t.messageId)}function u(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function d(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>s(e,t.msgs[n]))||null}function l(e,t,n){var r=Object(o.b)(t.kludges,t.messageId),a=n.dData.attaches;if(u(t.text)!==n.dData.txt||r.length!==a.length)return!0;for(var i=r.length;i--;){var c=r[i],s=a[i];if(c.id!=s.id||c.type!=s.type||"poll"==c.type&&s.object&&s.object.poll_is_edited)return!0}return!1}function _(e,t,n,r,a,o){t.origText=n,t.text=Object(i.Zc)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=r,t.kludges.emoji=1,t.local=1,t.share_url=a,t.cancelled_shares=o,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},zjLC:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return d}));var r=n("07n8"),a=n("Iqrf"),i=n("pdqG"),o=Object(r.a)((function(e,t,n,r){var i;return Object(a.b)(e,t,r.gid,(null===(i=r.tabs[e])||void 0===i?void 0:i.hash)||"",n).then((function(){return r}))})),c=Object(r.b)((function(e,t,n,r,o){var c;return e.creating=!0,null===(c=e.longpoll)||void 0===c||c.pause(),Object(a.g)(e.writeHash,n,r,o).then((function(t){var n,r=t[0];return e.next_peer=r.peerId,e.tabs[r.peerId]=r,Object(i.f)(e,r,!1,(function(e){return[r.peerId].concat(e)})),null===(n=e.longpoll)||void 0===n||n.resume(),e})).then((function(e){return t?s(e,e.next_peer,t):e})).then((function(e){return e.creating=!1,e})).catch((function(t){var n;throw e.creating=!1,null===(n=e.longpoll)||void 0===n||n.resume(),t}))}));function s(e,t,n){return Object(a.i)(t,n,e.gid).then((function(){return e}))}var u=Object(r.b)((function(e,t,n){return Object(a.f)(t,n,e.tabs[t].hash||"").then((function(){var r=e.tabs[t];return r&&r.invitedByMessageRequest&&(r.invitedByMessageRequest=r.invitedByMessageRequest.filter((function(e){return e.id!==n}))),e}))})),d=Object(r.b)((function(e,t,n){var r=e.tabs[t];return Object(a.f)(t,n,r.hash||"",e.gid).then((function(){return r.memberIds=r.memberIds.filter((function(e){return e!==n})),r.adminIds=r.adminIds.filter((function(e){return e!==n})),r.membersCount=r.memberIds.length,e}))}))}}]);try{stManager.done("cmodules/bundles/29ce115e24facf4cb9fb345ec7c74430.3fb24f7a151677e9ecae.js")}catch(e){}